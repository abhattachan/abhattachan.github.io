{"version":3,"sources":["../../../node_modules/@wix/wix-bi-logger-client/lib/assert.js","../../../node_modules/@wix/wix-bi-logger-client/lib/utils/collections.js","../../../node_modules/@wix/wix-bi-logger-client/lib/utils/promise.js","../../../node_modules/@wix/wix-bi-logger-client/lib/utils/log.js","../../../node_modules/@wix/wix-bi-logger-client/lib/utils/debounce.js","../../../node_modules/@wix/wix-bi-logger-client/lib/utils/throttle.js","../../../node_modules/@wix/wix-bi-logger-client/lib/utils/batch-queue.js","../../../node_modules/@wix/wix-bi-logger-client/lib/consent-policy.js","../../../node_modules/@wix/wix-bi-logger-client/lib/bi-logger.js","../../../node_modules/@wix/wix-bi-logger-client/lib/bi-logger-manager.js","../../../node_modules/@wix/wix-bi-logger-client/lib/bi-logger-factory.js","../../../node_modules/@wix/wix-bi-logger-client/lib/index.js","../../cli-telemetry/src/command-bi-event.ts","../../cli-telemetry/src/environment.ts","../../cli-telemetry/src/index.ts","../../cli-telemetry/src/create-bi-logger.ts","../../../node_modules/@wix/standalone-node-bi-logger/src/index.ts","../../cli-telemetry/src/add-user-fields.ts"],"sourcesContent":["'use strict'; // eslint-disable-line strict\n\nclass AssertionError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = this.constructor.name;\n  }\n}\n\nfunction assertDefined(target, message) {\n  if (target === undefined) {\n    throw new AssertionError(message);\n  }\n}\n\nfunction assertObject(target, message) {\n  if (\n    target !== undefined &&\n    (typeof target !== 'object' || Array.isArray(target) || target === null)\n  ) {\n    throw new AssertionError(message);\n  }\n}\n\nfunction assertOk(target, message) {\n  if (!target) {\n    throw new AssertionError(message);\n  }\n}\n\nfunction assertFunc(target, message) {\n  if (target !== undefined && typeof target !== 'function') {\n    throw new AssertionError(message);\n  }\n}\n\nfunction assertBoolean(target, message) {\n  if (target !== undefined && typeof target !== 'boolean') {\n    throw new AssertionError(message);\n  }\n}\n\nfunction assertNumber(target, message) {\n  if (target !== undefined && typeof target !== 'number') {\n    throw new AssertionError(message);\n  }\n}\n\nfunction assertArray(target, message) {\n  if (typeof Array.isArray === 'function') {\n    if (!Array.isArray(target)) {\n      throw new AssertionError(message);\n    }\n  } else if (Object.prototype.toString.call(target) !== '[object Array]') {\n    throw new AssertionError(message);\n  }\n}\n\nmodule.exports.defined = assertDefined;\nmodule.exports.object = assertObject;\nmodule.exports.ok = assertOk;\nmodule.exports.func = assertFunc;\nmodule.exports.boolean = assertBoolean;\nmodule.exports.number = assertNumber;\nmodule.exports.array = assertArray;\nmodule.exports.AssertionError = AssertionError;\n","/**\n * This callback type is called `requestCallback` and is displayed as a global symbol.\n *\n * @callback iterateeCallback\n * @param {*} Value\n * @param {string} Key\n * @param {object} Original object\n */\n/**\n * Iterates over object values\n * @param {Object} collection\n * @param {iterateeCallback} iteratee\n * @return {Object} iterated object\n */\nmodule.exports.mapValues = function(collection, iteratee) {\n  if (!collection) {\n    return {};\n  }\n\n  return Object.keys(collection).reduce((acc, key) => {\n    acc[key] = iteratee(collection[key], key, collection);\n    return acc;\n  }, {});\n};\n\nmodule.exports.filterValues = function(collection, iteratee) {\n  if (!collection) {\n    return {};\n  }\n\n  return Object.keys(collection).reduce((acc, key) => {\n    const keep = iteratee(collection[key], key, collection);\n\n    if (keep) {\n      acc[key] = collection[key];\n    }\n\n    return acc;\n  }, {});\n};\n","/**\n * rejects original promise after specified timeout\n * @param {Promise<R>} promise Original promise\n * @param {string} [message] Additional message for timeout reject\n * @param {number} timeout Time for reject\n * @return {Promise<R>}\n */\nmodule.exports.timedPromise = function(promise, { message, timeout }) {\n  const timeoutPromise = new Promise((resolve, reject) => {\n    setTimeout(reject, timeout, message ? `Timeout: ${message}` : 'Timeout');\n  });\n  return Promise.race([promise, timeoutPromise]);\n};\n\n/**\n * Works like Promise.all expect uses object instead of array.\n * @param {Object} promiseObject\n * @return {Promise} Promise with original keys and resolved values\n */\nmodule.exports.allAsObject = function(promiseObject) {\n  const keys = Object.keys(promiseObject);\n  return Promise.all(keys.map(key => promiseObject[key])).then(resolved => {\n    return resolved.reduce((acc, value, i) => {\n      acc[keys[i]] = value;\n      return acc;\n    }, {});\n  });\n};\n","module.exports = {\n  error(...args) {\n    if (console && console.error) {\n      console.error(...args);\n    }\n  },\n};\n","// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\nfunction debounce(func, wait, immediate) {\n  let timeout;\n\n  // This is the function that is actually executed when\n  // the DOM event is triggered.\n  return function() {\n    // Store the context of this and any parameters passed to executedFunction\n    const context = this;\n    const args = arguments;\n\n    // The function to be called after\n    // the debounce time has elapsed\n    const later = function() {\n      // null timeout to indicate the debounce ended\n      timeout = null;\n\n      // Call function now if you did not on the leading end\n      if (!immediate) {\n        func.apply(context, args);\n      }\n    };\n\n    // Determine if you should call the function\n    // on the leading or trail end\n    const callNow = immediate && !timeout;\n\n    // This will reset the waiting every function execution.\n    // This is the step that prevents the function from\n    // being executed because it will never reach the\n    // inside of the previous setTimeout\n    clearTimeout(timeout);\n\n    // Restart the debounce waiting period.\n    // setTimeout returns a truthy value (it differs in web vs node)\n    timeout = setTimeout(later, wait);\n\n    // Call immediately if you're dong a leading\n    // end execution\n    if (callNow) {\n      func.apply(context, args);\n    }\n  };\n}\n\nmodule.exports = debounce;\n","function throttle(func, wait) {\n  let timeout;\n\n  return (...args) => {\n    if (!timeout) {\n      timeout = setTimeout(() => {\n        func(...args);\n        timeout = null;\n      }, wait);\n    }\n  };\n}\n\nmodule.exports = throttle;\n","const debounce = require('./debounce');\nconst throttle = require('./throttle');\n\nconst createEvent = (event, context, startTime) => ({\n  dt: Date.now() - startTime,\n  f: event,\n  context,\n});\n\nconst createBatch = (events, startTime) => ({\n  dt: Date.now() - startTime,\n  e: events,\n  g: {},\n});\n\nconst optimizeBatch = batch => {\n  const fieldCounts = {};\n  const batchLen = batch.e.length;\n\n  let events = batch.e.map(event => {\n    const fields = Object.keys(event.f).map(field => {\n      const value = event.f[field];\n      const key = `${field}|${value}`;\n      fieldCounts[key] = fieldCounts[key] || 0;\n      fieldCounts[key]++;\n      return [field, value, key];\n    });\n\n    return {\n      ...event,\n      f: fields,\n    };\n  });\n\n  const globalFields = {};\n  events = events.map(event => {\n    const fields = event.f.reduce((res, [field, value, key]) => {\n      if (fieldCounts[key] === batchLen) {\n        globalFields[field] = value;\n      } else {\n        res[field] = value;\n      }\n\n      return res;\n    }, {});\n\n    return {\n      ...event,\n      f: fields,\n    };\n  });\n\n  return {\n    ...batch,\n    e: events,\n    g: globalFields,\n  };\n};\n\nclass BatchQueue {\n  constructor() {\n    this._initilized = false;\n  }\n\n  _reset() {\n    this._startTime = Date.now();\n    this._resolve = null;\n    this._promise = new Promise(resolve => (this._resolve = resolve));\n  }\n\n  init({ delayMs, maxBatchSize, useThrottle, optimizeBatch }, flushHandler) {\n    if (this._initilized) {\n      return;\n    }\n\n    this._maxBatchSize = maxBatchSize;\n    this._optimizeBatch = optimizeBatch;\n    this._queue = [];\n    this._flushHandler = flushHandler;\n    this._flushDebounced = useThrottle\n      ? throttle(() => this.flush(), delayMs)\n      : debounce(() => this.flush(), delayMs);\n    this._initilized = true;\n\n    this._reset();\n  }\n\n  flush() {\n    if (!this._queue.length) {\n      return Promise.resolve();\n    }\n\n    const events = this._queue.splice(0, this._queue.length);\n    const resolve = this._resolve;\n    const startTime = this._startTime;\n\n    this._reset();\n\n    let batch = createBatch(events, startTime);\n\n    if (this._optimizeBatch) {\n      batch = optimizeBatch(batch);\n    }\n\n    return this._flushHandler(batch).then(resolve);\n  }\n\n  feed(event, context) {\n    this._queue.push(createEvent(event, context, this._startTime));\n\n    if (this._queue.length === this._maxBatchSize) {\n      return this.flush();\n    }\n\n    this._flushDebounced();\n\n    return this._promise;\n  }\n}\n\nmodule.exports = BatchQueue;\n","'use strict'; // eslint-disable-line strict\n\nconst DefaultConsentPolicy = {\n  functional: true,\n  analytics: true,\n  __default: true,\n};\n\nconst getPolicy = consentPolicyGetter => {\n  return (\n    (typeof consentPolicyGetter === 'function' && consentPolicyGetter()) ||\n    DefaultConsentPolicy\n  );\n};\n\nconst shouldMuteNonEssentials = policy => {\n  return policy.functional === false || policy.analytics === false;\n};\n\nconst shouldMuteByCategory = (policy, category) => {\n  if (category === 'essential') {\n    return false;\n  }\n\n  if (category === 'functional' || category === 'analytics') {\n    return policy[category] === false;\n  }\n\n  return shouldMuteNonEssentials(policy);\n};\n\nmodule.exports = {\n  shouldMuteNonEssentials,\n  shouldMuteByCategory,\n  getPolicy,\n};\n","'use strict'; // eslint-disable-line strict\nconst assert = require('./assert');\nconst { mapValues, filterValues } = require('./utils/collections');\nconst promise = require('./utils/promise');\nconst log = require('./utils/log');\nconst BatchQueue = require('./utils/batch-queue');\nconst {\n  shouldMuteByCategory,\n  shouldMuteNonEssentials,\n  getPolicy,\n} = require('./consent-policy');\n\nclass BiLogger {\n  // TODO: validate args\n  constructor(options, context) {\n    this._publishers = options.publishers;\n    this._validators = options.validators || [];\n    this._defaults = options.defaults;\n    this._ownDefaults = {};\n    this._events = options.events || {};\n    this._context = context || {};\n    this._defaultValueTimeout = options.defaultValueTimeout || 5000;\n    this._defaultContinueOnFail = options.defaultContinueOnFail || false;\n    this._onPublisherFailHandler =\n      options.onPublisherFailHandler || BiLogger._defaultPublisherFailHandler;\n    this._isMuted = options.isMuted || (() => false);\n    this._eventTransformer = options.eventTransformer || (event => event);\n    this._payloadTransformer =\n      options.payloadTransformer || (payload => payload);\n    this._consentPolicyGetter = options.consentPolicyGetter || (() => null);\n    this._nonEssentialDefaults = options.nonEssentialDefaults || {};\n    this._maxBatchSize = options.maxBatchSize || 100;\n    this._globalBatchQueue = options.globalBatchQueue;\n  }\n\n  report(data) {\n    assert.defined(data, 'Data must be provided');\n    assert.object(data, 'Data must be an object');\n\n    const { src, evid, params, ...context } = data;\n\n    return this.log({ src, evid, ...params }, context);\n  }\n\n  log(eventOrKey, eventOrContextOrUndefined, contextOrUndefined) {\n    assert.defined(eventOrKey, 'Event object or event key must be provided.');\n\n    const { event, context } = this._extractEventAndContext(\n      eventOrKey,\n      eventOrContextOrUndefined,\n      contextOrUndefined,\n    );\n    const policy = getPolicy(this._consentPolicyGetter);\n    const fullContext = { ...this._context, ...context };\n\n    if (this._isMuted() || shouldMuteByCategory(policy, fullContext.category)) {\n      return Promise.resolve();\n    }\n\n    if (fullContext.useBatch) {\n      const queue = this._initQueue(fullContext, policy);\n\n      const transformAndQueue = _event => {\n        const transformedEvent = this._eventTransformer(_event, fullContext);\n\n        return queue.feed(transformedEvent, fullContext);\n      };\n\n      if (this._globalBatchQueue) {\n        return this._getDefaults(this._defaults).then(defaults => {\n          const fullEvent = {\n            ...defaults,\n            ...this._getDynamicNonEssentialDefaults(policy),\n            ...this._getStaticNonEssentialDefaults(policy),\n            ...event,\n            ...this._getPolicyFields(policy, fullContext.category),\n          };\n\n          return transformAndQueue(fullEvent);\n        });\n      } else {\n        const fullEvent = {\n          ...this._getDynamicDefaults(this._defaults),\n          ...this._getDynamicNonEssentialDefaults(policy),\n          ...event,\n          ...this._getPolicyFields(policy, fullContext.category),\n        };\n\n        return transformAndQueue(fullEvent);\n      }\n    }\n\n    return this._getDefaults(this._defaults).then(defaults => {\n      const fullEvent = Object.assign(\n        defaults,\n        this._getDynamicNonEssentialDefaults(policy),\n        this._getStaticNonEssentialDefaults(policy),\n        event,\n        this._getPolicyFields(policy, fullContext.category),\n      );\n\n      const validatorsResult =\n        this._validators.length === 0\n          ? true\n          : this._validators.some(\n              validator =>\n                validator.match(fullEvent) &&\n                (validator.execute(fullEvent) || true),\n            );\n\n      if (!validatorsResult) {\n        throw new Error(\n          `No validator accepted the event. Source: ${\n            fullEvent.src\n          } Evid: ${fullEvent.evid || fullEvent.evtId}`,\n        );\n      }\n\n      let transformedEvent = this._eventTransformer(fullEvent, fullContext);\n      transformedEvent = this._payloadTransformer(\n        transformedEvent,\n        fullContext,\n      );\n\n      return this._send(transformedEvent, fullContext);\n    });\n  }\n\n  flush() {\n    if (!this._queue) {\n      return Promise.resolve();\n    }\n    return this._queue.flush();\n  }\n\n  updateDefaults(defaults) {\n    assert.defined(defaults, 'Defaults must be provided');\n    assert.object(defaults, 'Defaults must be an object');\n    Object.assign(this._ownDefaults, defaults);\n    return this;\n  }\n\n  _send(payload, context = {}) {\n    return Promise.all(\n      this._publishers.map(publisher => {\n        const cloned = { ...payload };\n\n        return Promise.resolve()\n          .then(() => publisher(cloned, context))\n          .catch(error =>\n            this._onPublisherFailHandler(error, {\n              publisherName: publisher.name,\n              payload,\n            }),\n          );\n      }),\n    ).then(() => undefined);\n  }\n\n  _extractEventAndContext(\n    eventOrKey,\n    eventOrContextOrUndefined,\n    contextOrUndefined,\n  ) {\n    let event;\n    let context = {};\n\n    if (typeof eventOrKey !== 'string') {\n      event = eventOrKey;\n      context = eventOrContextOrUndefined || context;\n    } else {\n      event = this._events[eventOrKey];\n\n      if (!event) {\n        throw new assert.AssertionError(\n          `Event with key '${eventOrKey}' not found in event map.`,\n        );\n      }\n\n      if (eventOrContextOrUndefined) {\n        event = { ...event, ...eventOrContextOrUndefined };\n        context = contextOrUndefined || context;\n      }\n    }\n\n    return { event, context };\n  }\n\n  _initQueue(context, policy) {\n    if (this._queue) {\n      return this._queue;\n    }\n\n    this._queue = this._globalBatchQueue || new BatchQueue();\n\n    const onFlush = batch => {\n      // if queue is global don't define global properties\n      if (!this._globalBatchQueue) {\n        batch.g = Object.assign(\n          this._getStaticDefaults(this._defaults),\n          this._getStaticNonEssentialDefaults(policy),\n        );\n      }\n\n      const transformedPayload = this._payloadTransformer(batch, context);\n\n      return this._send(transformedPayload, context);\n    };\n\n    this._queue.init(\n      {\n        delayMs: context.useBatch === true ? 300 : context.useBatch,\n        maxBatchSize: this._maxBatchSize,\n        useThrottle: !!this._globalBatchQueue,\n        optimizeBatch: !!this._globalBatchQueue,\n      },\n      onFlush,\n    );\n\n    return this._queue;\n  }\n\n  _handleDefaultsError(err) {\n    if (this._defaultContinueOnFail) {\n      log.error(err);\n      return null;\n    }\n    return Promise.reject(err);\n  }\n\n  _getDynamicNonEssentialDefaults(policy) {\n    if (!shouldMuteNonEssentials(policy)) {\n      return this._getDynamicDefaults(this._nonEssentialDefaults);\n    }\n  }\n\n  _getStaticNonEssentialDefaults(policy) {\n    if (!shouldMuteNonEssentials(policy)) {\n      return this._getStaticDefaults(this._nonEssentialDefaults);\n    }\n  }\n\n  _withOwnDefaults(defaults) {\n    return Object.assign({}, defaults, this._ownDefaults);\n  }\n\n  _getDynamicDefaults(defaults) {\n    defaults = this._withOwnDefaults(defaults);\n    const dynamicDefaults = filterValues(\n      defaults,\n      v => typeof v === 'function',\n    );\n    return mapValues(dynamicDefaults, v => v());\n  }\n\n  _getStaticDefaults(defaults) {\n    defaults = this._withOwnDefaults(defaults);\n    const staticDefaults = filterValues(defaults, v => typeof v !== 'function');\n    return staticDefaults;\n  }\n\n  _getDefaults(defaults) {\n    defaults = this._withOwnDefaults(defaults);\n    if (!defaults) {\n      return Promise.resolve({});\n    }\n\n    const promises = mapValues(defaults, (value, key) => {\n      if (typeof value === 'function') {\n        try {\n          value = value();\n        } catch (err) {\n          return this._handleDefaultsError(err);\n        }\n      }\n\n      if (value && typeof value.then === 'function') {\n        return promise\n          .timedPromise(value, {\n            message: `Cannot get default value '${key} for BI Event'`,\n            timeout: this._defaultValueTimeout,\n          })\n          .catch(err => this._handleDefaultsError(err));\n      }\n\n      return value;\n    });\n\n    return promise.allAsObject(promises);\n  }\n\n  _encodePolicyValue(policy, key) {\n    if (!policy) {\n      return 1;\n    }\n\n    if (typeof policy[key] === 'boolean') {\n      return policy[key] ? 1 : 0;\n    }\n\n    return policy[key];\n  }\n\n  _getPolicyFields(policy, category) {\n    return {\n      _isca: this._encodePolicyValue(policy, 'analytics'),\n      _iscf: this._encodePolicyValue(policy, 'functional'),\n      _ispd: policy.__default ? 1 : 0,\n      _ise: category === 'essential' ? 1 : 0,\n    };\n  }\n\n  static _defaultPublisherFailHandler(error, { publisherName }) {\n    return publisherName; // do nothing\n  }\n}\n\nmodule.exports = BiLogger;\n","'use strict'; // eslint-disable-line strict\n\nconst assert = require('./assert');\n\nclass BiLoggerManager {\n  constructor() {\n    this.reset();\n  }\n\n  reset() {\n    this._handlers = [];\n  }\n\n  onLoggerCreated(handler) {\n    assert.defined(handler, 'Handler must be provided.');\n    assert.func(handler, 'Handler must be a function.');\n\n    this._handlers.push(handler);\n\n    return () => {\n      const index = this._handlers.indexOf(handler);\n\n      if (index !== -1) {\n        this._handlers.splice(index, 1);\n      }\n    };\n  }\n\n  notifyLoggerCreated(logger) {\n    this._handlers.forEach(handler => handler(logger));\n  }\n}\n\nmodule.exports = {\n  manager: new BiLoggerManager(),\n  BiLoggerManager,\n};\n","'use strict'; // eslint-disable-line strict\nconst assert = require('./assert');\nconst BiLogger = require('./bi-logger');\nconst biLoggerManager = require('./bi-logger-manager');\nconst BatchQueue = require('./utils/batch-queue');\n\nclass BiLoggerFactory {\n  constructor() {\n    this._publishers = [];\n    this._validators = [];\n    this._defaults = {};\n    this._nonEssentialDefaults = {};\n    this._events = {};\n    this._isMuted = false;\n    this._eventTransformer = null;\n    this._payloadTransformer = null;\n    this._consentPolicyGetter = null;\n    this._maxBatchSize = null;\n    this._batchQueue = null;\n  }\n\n  addPublisher(publisher) {\n    assert.defined(publisher, 'Publisher must be provided');\n    assert.ok(typeof publisher === 'function', 'Expected a publisher function');\n    this._publishers.push(publisher);\n    return this;\n  }\n\n  addValidator(validator) {\n    assert.defined(validator, 'Validator must be provided');\n    assert.ok(\n      typeof validator === 'object' && validator,\n      'Expected a validator object',\n    );\n    assert.ok(\n      validator.execute && validator.match,\n      'Provided validator does not match the interface',\n    );\n    this._validators.push(validator);\n    return this;\n  }\n\n  setDefaults(defaults) {\n    assert.defined(defaults, 'Defaults must be provided');\n    assert.object(defaults, 'Defaults must be an object');\n    this._defaults = defaults;\n    return this;\n  }\n\n  updateDefaults(defaults) {\n    assert.defined(defaults, 'Defaults must be provided');\n    assert.object(defaults, 'Defaults must be an object');\n    Object.assign(this._defaults, defaults);\n    return this;\n  }\n\n  updateNonEssentialDefaults(defaults) {\n    assert.defined(defaults, 'Non-essential Defaults must be provided');\n    assert.object(defaults, 'Non-essential Defaults must be an object');\n    Object.assign(this._nonEssentialDefaults, defaults);\n    return this;\n  }\n\n  setEvents(events) {\n    assert.defined(events, 'Events must be provided');\n    assert.object(events, 'Events must be an object');\n    this._events = events;\n    return this;\n  }\n\n  setDefaultValueTimeout(defaultValueTimeout) {\n    assert.defined(\n      defaultValueTimeout,\n      'Default Value Timeout must be provided',\n    );\n    this._defaultValueTimeout = defaultValueTimeout;\n    return this;\n  }\n\n  setDefaultContinueOnFail(defaultContinueOnFail) {\n    assert.defined(\n      defaultContinueOnFail,\n      'Default Continue On Fail must be provided',\n    );\n    this._defaultContinueOnFail = defaultContinueOnFail;\n    return this;\n  }\n\n  setPublisherFailHandler(onPublisherFailHandler) {\n    assert.defined(\n      onPublisherFailHandler,\n      'Publisher Fail Handler must be provided',\n    );\n    this._onPublisherFailHandler = onPublisherFailHandler;\n    return this;\n  }\n\n  setMuted(isMuted) {\n    assert.defined(isMuted, 'Is Muted must be provided');\n    assert.boolean(isMuted, 'Is Muted must be a boolean');\n    this._isMuted = isMuted;\n    return this;\n  }\n\n  setMaxBatchSize(maxBatchSize) {\n    assert.defined(maxBatchSize, 'Max Batch Size must be provided');\n    assert.number(maxBatchSize, 'Max Batch Size must be a number');\n    assert.ok(maxBatchSize > 0, 'Max Batch Size must be higher than 0');\n    this._maxBatchSize = maxBatchSize;\n    return this;\n  }\n\n  setGlobalBatchQueue(batchQueue) {\n    assert.defined(batchQueue, 'Global Batch Queue must be provided');\n    assert.ok(\n      batchQueue instanceof BatchQueue,\n      'Global Batch Queue must be an instance of BatchQueue',\n    );\n    this._globalBatchQueue = batchQueue;\n    return this;\n  }\n\n  withEventTransformer(transformer) {\n    assert.defined(transformer, 'Event Transformer must be provided');\n    assert.func(transformer, 'Event Transformer must be a function');\n    this._eventTransformer = transformer;\n    return this;\n  }\n\n  withPayloadTransformer(transformer) {\n    assert.defined(transformer, 'Payload Transformer must be provided');\n    assert.func(transformer, 'Payload Transformer must be a function');\n    this._payloadTransformer = transformer;\n    return this;\n  }\n\n  withConsentPolicyGetter(getter) {\n    assert.defined(getter, 'Consent Policy Getter must be provided');\n    assert.func(getter, 'Consent Policy Getter must be a function');\n    this._consentPolicyGetter = getter;\n    return this;\n  }\n\n  logger(context) {\n    const logger = new BiLogger(\n      {\n        publishers: this._publishers,\n        validators: this._validators,\n        defaults: this._defaults,\n        events: this._events,\n        defaultValueTimeout: this._defaultValueTimeout,\n        defaultContinueOnFail: this._defaultContinueOnFail,\n        onPublisherFailHandler: this._onPublisherFailHandler,\n        isMuted: () => this._isMuted,\n        eventTransformer: this._eventTransformer,\n        payloadTransformer: this._payloadTransformer,\n        consentPolicyGetter: this._consentPolicyGetter,\n        nonEssentialDefaults: this._nonEssentialDefaults,\n        maxBatchSize: this._maxBatchSize,\n        globalBatchQueue: this._globalBatchQueue,\n      },\n      context,\n    );\n\n    biLoggerManager.manager.notifyLoggerCreated(logger);\n\n    return logger;\n  }\n}\n\nmodule.exports = BiLoggerFactory;\n","'use strict'; // eslint-disable-line strict\nconst BiLoggerClientFactory = require('./bi-logger-factory');\nconst BiLogger = require('./bi-logger');\nconst biLoggerManager = require('./bi-logger-manager');\nconst BatchQueue = require('./utils/batch-queue');\n\nmodule.exports.BiLoggerFactory = BiLoggerClientFactory;\nmodule.exports.BiLogger = BiLogger;\nmodule.exports.BiLoggerManager = biLoggerManager.BiLoggerManager;\n\nmodule.exports.factory = () => new BiLoggerClientFactory();\nmodule.exports.manager = biLoggerManager.manager;\nmodule.exports.createBatchQueue = () => new BatchQueue();\n","import type { BiLogger } from '@wix/wix-bi-logger-client';\nimport {\n  wixCliCliCommand,\n  wixCliCliCommandStatus,\n} from '@wix/bi-logger-wix-cli/v2';\nimport { isCliError, isCliSystemError } from '@wix/cli-error';\nimport { uptime } from 'node:process';\nimport { getEnvironmentInfo } from './environment.js';\n\ninterface CommandLike {\n  name: () => string;\n  args: string[];\n  opts: () => Record<string, unknown>;\n}\n\nconst getDuration = () => Math.round(uptime() * 1000);\n\nexport function reportCommandStartEvent({\n  biLogger,\n  command,\n  flow,\n  cliVersion,\n  projectId,\n  extensions,\n  extraFields,\n}: {\n  biLogger: BiLogger;\n  command: CommandLike;\n  flow: 'Apps' | 'Sites' | null;\n  cliVersion: string;\n  projectId?: string;\n  extensions?: Record<string, number>;\n  extraFields?: Record<string, unknown>;\n}) {\n  const options = command.opts();\n  const args = command.args;\n\n  const privateOptions = new Set(['apiKey']);\n  const sanitizedOptions = Object.fromEntries(\n    Object.entries(options).map(([flagName, flagValue]) => {\n      const value = privateOptions.has(flagName) ? '<censored>' : flagValue;\n      return [flagName, value];\n    })\n  );\n\n  const commandFields = {\n    command: command.name(),\n    arguments: args.join(','),\n    flags: Object.keys(sanitizedOptions).length\n      ? JSON.stringify(sanitizedOptions)\n      : '',\n  };\n\n  void biLogger.report(\n    wixCliCliCommand({\n      ...getEnvironmentInfo({ cliVersion, flow }),\n      ...commandFields,\n      ...(projectId ? { projectId } : {}),\n      ...(extraFields ? { extraFields: JSON.stringify(extraFields) } : {}),\n      isValid: true,\n    })\n  );\n\n  return {\n    succeed() {\n      void biLogger.report(\n        wixCliCliCommandStatus({\n          ...commandFields,\n          ...(extensions ? { extensions: JSON.stringify(extensions) } : {}),\n          duration: getDuration(),\n          isSuccess: true,\n          isValid: true,\n        })\n      );\n    },\n    failed(error: unknown) {\n      const errorFields = isCliError(error)\n        ? {\n            errorType: isCliSystemError(error) ? 'SystemError' : 'UserError',\n            errorName: error.name,\n            errorMessage: error.message,\n          }\n        : error instanceof Error\n        ? {\n            errorType: 'UnknownError',\n            errorName: error.name,\n            errorMessage: error.message,\n          }\n        : {\n            errorType: 'UnknownError',\n            errorMessage: JSON.stringify(error),\n          };\n\n      void biLogger.report(\n        wixCliCliCommandStatus({\n          ...commandFields,\n          ...errorFields,\n          ...(extensions ? { extensions: JSON.stringify(extensions) } : {}),\n          duration: getDuration(),\n          isSuccess: false,\n          isValid: true,\n        })\n      );\n    },\n  };\n}\n","import os from 'node:os';\nimport { platform, version as nodeVersion } from 'node:process';\nimport isCI from 'is-ci';\n\nexport function getEnvironmentInfo({\n  cliVersion,\n  flow,\n}: {\n  cliVersion: string;\n  flow: 'Sites' | 'Apps' | null;\n}) {\n  return {\n    ...(flow ? { flow } : {}),\n    cliVersion,\n    isCI,\n    nodeVersion,\n    osName: getOsName(),\n    osVersion: os.release(),\n  };\n}\n\nexport type EnvironmentInfo = ReturnType<typeof getEnvironmentInfo>;\n\n// https://stackoverflow.com/a/8684009\nfunction getOsName() {\n  switch (platform) {\n    case 'darwin':\n      return 'mac';\n    case 'win32':\n      return 'windows';\n    default:\n      return 'linux';\n  }\n}\n","export type { BiLogger } from '@wix/wix-bi-logger-client';\nexport { createBiLogger } from './create-bi-logger.js';\nexport { reportCommandStartEvent } from './command-bi-event.js';\nexport { addUserFields } from './add-user-fields.js';\n","import { StandaloneNodeLogger } from '@wix/standalone-node-bi-logger';\nimport type { BiEvent, BiLogger } from '@wix/wix-bi-logger-client';\nimport { readUserConfig } from '@wix/cli-user-config';\nimport { getTestOverrides } from '@wix/cli-test-overrides';\nimport { resolveUserFields } from './add-user-fields.js';\n\nexport async function createBiLogger(\n  defaultFields?: BiEvent,\n  userId?: string\n): Promise<BiLogger> {\n  const testBaseUrl = getTestOverrides().biLoggerBaseUrl;\n  const options = testBaseUrl ? { baseUrl: testBaseUrl } : {};\n  const userFields = resolveUserFields(userId);\n  const { telemetry: isTelemetryOn } = await readUserConfig();\n\n  return new StandaloneNodeLogger()\n    .factory(options)\n    .updateDefaults({\n      localTime: () => Date.now(),\n      ...defaultFields,\n      ...userFields,\n    })\n    .setMuted(!isTelemetryOn)\n    .logger();\n}\n",null,"import { randomUUID } from 'node:crypto';\nimport type { BiLogger } from '@wix/wix-bi-logger-client';\n\nexport function addUserFields(logger: BiLogger, userId: string) {\n  logger.updateDefaults(resolveUserFields(userId));\n}\n\nexport function resolveUserFields(userId?: string): Record<string, string> {\n  if (!userId) {\n    // anonymous users need to have an identifier for the bi platform to accept the event\n    return {\n      _client_id: randomUUID(),\n    };\n  }\n\n  return {\n    _client_id: userId,\n    _uuid: userId,\n    logged_user_id: userId,\n    logged_account_id: userId,\n    target_account_id: userId,\n  };\n}\n"],"mappings":"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","names":["require_assert","__commonJSMin","exports","module","init_esm_shims","AssertionError","message","_classCallCheck","_this","_possibleConstructorReturn","name","constructor","Error","assertDefined","target","undefined","assertObject","_typeof","Array","isArray","assertOk","assertFunc","assertBoolean","assertNumber","assertArray","Object","prototype","toString","call","defined","object","ok","func","boolean","number","array","module","exports","mapValues","collection","iteratee","Object","keys","reduce","acc","key","filterValues","keep","module","exports","timedPromise","promise","_ref","message","timeout","timeoutPromise","Promise","resolve","reject","setTimeout","race","allAsObject","promiseObject","keys","Object","all","map","key","then","resolved","reduce","acc","value","i","module","exports","error","console","_console","debounce","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","setTimeout","module","exports","throttle","func","wait","timeout","_len","args","_key","setTimeout","module","exports","debounce","require","throttle","createEvent","event","context","startTime","dt","Date","now","f","createBatch","events","e","g","optimizeBatch","batch","fieldCounts","batchLen","length","map","fields","Object","keys","field","value","key","_extends","globalFields","reduce","res","_ref","_ref2","_slicedToArray","BatchQueue","_classCallCheck","_initilized","_this","_startTime","_resolve","_promise","Promise","resolve","flushHandler","_this2","delayMs","_ref3","maxBatchSize","useThrottle","_maxBatchSize","_optimizeBatch","_queue","_flushHandler","_flushDebounced","flush","_reset","splice","then","push","module","exports","require_consent_policy","__commonJSMin","exports","module","init_esm_shims","DefaultConsentPolicy","functional","analytics","__default","getPolicy","consentPolicyGetter","shouldMuteNonEssentials","policy","shouldMuteByCategory","category","require_bi_logger","__commonJSMin","exports","module","init_esm_shims","assert","require","mapValues","filterValues","promise","log","BatchQueue","shouldMuteByCategory","shouldMuteNonEssentials","getPolicy","BiLogger","options","context","_classCallCheck","_publishers","publishers","_validators","validators","_defaults","defaults","_ownDefaults","_events","events","_context","_defaultValueTimeout","defaultValueTimeout","_defaultContinueOnFail","defaultContinueOnFail","_onPublisherFailHandler","onPublisherFailHandler","_defaultPublisherFailHandler","_isMuted","isMuted","_eventTransformer","eventTransformer","event","_payloadTransformer","payloadTransformer","payload","_consentPolicyGetter","consentPolicyGetter","_nonEssentialDefaults","nonEssentialDefaults","_maxBatchSize","maxBatchSize","_globalBatchQueue","globalBatchQueue","data","defined","object","src","evid","params","_objectWithoutProperties","_extends","eventOrKey","eventOrContextOrUndefined","contextOrUndefined","_this","_extractEventAndConte","_extractEventAndContext","policy","fullContext","category","Promise","resolve","useBatch","queue","_initQueue","transformAndQueue","_event","transformedEvent","feed","_getDefaults","then","fullEvent","_getDynamicNonEssentialDefaults","_getStaticNonEssentialDefaults","_getPolicyFields","_getDynamicDefaults","Object","assign","validatorsResult","length","some","validator","match","execute","Error","evtId","_send","_queue","flush","_this2","all","map","publisher","cloned","catch","error","publisherName","name","AssertionError","_this3","onFlush","batch","g","_getStaticDefaults","transformedPayload","init","delayMs","useThrottle","optimizeBatch","err","reject","_withOwnDefaults","dynamicDefaults","v","staticDefaults","_this4","promises","value","key","_handleDefaultsError","timedPromise","message","timeout","allAsObject","_isca","_encodePolicyValue","_iscf","_ispd","__default","_ise","_ref","require_bi_logger_manager","__commonJSMin","exports","module","init_esm_shims","assert","require","BiLoggerManager","_classCallCheck","reset","_handlers","handler","_this","defined","func","push","index","indexOf","splice","logger","forEach","manager","require_bi_logger_factory","__commonJSMin","exports","module","init_esm_shims","assert","require","BiLogger","biLoggerManager","BatchQueue","BiLoggerFactory","_classCallCheck","_publishers","_validators","_defaults","_nonEssentialDefaults","_events","_isMuted","_eventTransformer","_payloadTransformer","_consentPolicyGetter","_maxBatchSize","_batchQueue","publisher","defined","ok","push","validator","_typeof","execute","match","defaults","object","Object","assign","events","defaultValueTimeout","_defaultValueTimeout","defaultContinueOnFail","_defaultContinueOnFail","onPublisherFailHandler","_onPublisherFailHandler","isMuted","boolean","maxBatchSize","number","batchQueue","_globalBatchQueue","transformer","func","getter","context","_this","logger","publishers","validators","eventTransformer","payloadTransformer","consentPolicyGetter","nonEssentialDefaults","globalBatchQueue","manager","notifyLoggerCreated","require_dist","__commonJSMin","exports","module","init_esm_shims","BiLoggerClientFactory","require","BiLogger","biLoggerManager","BatchQueue","BiLoggerFactory","BiLoggerManager","factory","manager","createBatchQueue","init_esm_shims","uptime","init_esm_shims","import_is_ci","os","platform","nodeVersion","getEnvironmentInfo","cliVersion","flow","isCI","getOsName","getDuration","uptime","reportCommandStartEvent","biLogger","command","flow","cliVersion","projectId","extensions","extraFields","options","args","privateOptions","sanitizedOptions","flagName","flagValue","value","commandFields","wixCliCliCommand","getEnvironmentInfo","wixCliCliCommandStatus","error","errorFields","isCliError","isCliSystemError","init_esm_shims","init_esm_shims","import_wix_bi_logger_client","import_http_client","defaultOptions","StandaloneNodeLogger","options","_this","fullOptions","__assign","biLoggerFactory","biLoggerClient","eventParams","context","__awaiter","endpoint","baseUrl","userAgent","logError","headers","e","_a","src_default","StandaloneNodeLogger","init_esm_shims","randomUUID","addUserFields","logger","userId","resolveUserFields","createBiLogger","defaultFields","userId","testBaseUrl","getTestOverrides","options","userFields","resolveUserFields","isTelemetryOn","readUserConfig","StandaloneNodeLogger"]}