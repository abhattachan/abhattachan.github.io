{"version":3,"sources":["../../../node_modules/normalize-path/index.js","../../../node_modules/@wix/ambassador-velo-apps-v1-app/types.impl.ts","../../cli-site/src/utils.ts","../../../node_modules/@wix/ambassador-velo-apps-v1-app/http.impl.ts","../../cli-site/src/gridapp/loadProjectGridAppContent.ts"],"sourcesContent":["/*!\n * normalize-path <https://github.com/jonschlinkert/normalize-path>\n *\n * Copyright (c) 2014-2018, Jon Schlinkert.\n * Released under the MIT License.\n */\n\nmodule.exports = function(path, stripTrailing) {\n  if (typeof path !== 'string') {\n    throw new TypeError('expected path to be a string');\n  }\n\n  if (path === '\\\\' || path === '/') return '/';\n\n  var len = path.length;\n  if (len <= 1) return path;\n\n  // ensure that win32 namespaces has two leading slashes, so that the path is\n  // handled properly by the win32 version of path.parse() after being normalized\n  // https://msdn.microsoft.com/library/windows/desktop/aa365247(v=vs.85).aspx#namespaces\n  var prefix = '';\n  if (len > 4 && path[3] === '\\\\') {\n    var ch = path[2];\n    if ((ch === '?' || ch === '.') && path.slice(0, 2) === '\\\\\\\\') {\n      path = path.slice(2);\n      prefix = '//';\n    }\n  }\n\n  var segs = path.split(/[/\\\\]+/);\n  if (stripTrailing !== false && segs[segs.length - 1] === '') {\n    segs.pop();\n  }\n  return prefix + segs.join('/');\n};\n",null,"import { readdir, readFile, stat } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { extractHttpError } from '@wix/cli-http-client';\n\n/**\n * reads a file contents recursively and returns an array of all files\n */\nexport async function readFiles(\n  dir: string,\n  subPath = ''\n): Promise<Array<{ path: string; content: string }>> {\n  return (\n    await Promise.all(\n      (\n        await readdir(join(dir, subPath))\n      ).map(async (file) => {\n        const path = join(subPath, file);\n        if ((await stat(join(dir, path))).isDirectory()) {\n          return readFiles(dir, path);\n        }\n        return {\n          path,\n          content: await readFile(join(dir, path), 'utf-8'),\n        };\n      })\n    )\n  ).flat();\n}\n\nexport function isSiteNotPublishedError(err: unknown) {\n  if (err instanceof Error) {\n    const httpError = extractHttpError(err);\n    const errorCode =\n      httpError?.response?.data?.details?.applicationError?.code;\n\n    if (errorCode === 'SITE_NOT_PUBLISHED') {\n      return true;\n    }\n  }\n  return false;\n}\n",null,"import { join } from 'node:path';\nimport { readFile } from 'node:fs/promises';\nimport { GridAppLayout } from '@wix/ambassador-velo-apps-v1-app/types';\nimport { getSourceFolder } from '@wix/velo-github-layout-definitions';\nimport normalizePath from 'normalize-path';\nimport { pathExists } from '@wix/cli-fs';\nimport { CliError, CliErrorCode } from '@wix/cli-error';\nimport {\n  PACKAGE_JSON_FILENAME,\n  WIX_LOCK_FILENAME,\n} from '@wix/cli-core-definitions';\nimport { readFiles } from '../utils.js';\n\ninterface File {\n  path: string;\n  content: string;\n}\n\nasync function readFileOrThrow(path: string): Promise<string> {\n  try {\n    return await readFile(path, 'utf-8');\n  } catch (e) {\n    throw new CliError({\n      code: CliErrorCode.FailedToReadProjectFiles({ cause: e }),\n      cause: e,\n    });\n  }\n}\n\nasync function readFilesOrThrow(root: string): Promise<File[]> {\n  try {\n    return await readFiles(root);\n  } catch (e) {\n    throw new CliError({\n      code: CliErrorCode.FailedToReadProjectFiles({ cause: e }),\n      cause: e,\n    });\n  }\n}\n\nasync function loadProjectRootFiles(projectFolder: string) {\n  if (await pathExists(join(projectFolder, WIX_LOCK_FILENAME))) {\n    return Promise.all(\n      [PACKAGE_JSON_FILENAME, WIX_LOCK_FILENAME].map(async (path) => {\n        const content = await readFileOrThrow(join(projectFolder, path));\n\n        return { path, content };\n      })\n    );\n  }\n\n  return [];\n}\n\nexport async function loadProjectGridAppContent(projectFolder: string) {\n  const sourceFiles = (\n    await readFilesOrThrow(getSourceFolder(projectFolder))\n  ).map((file) => ({\n    content: file.content,\n    path: normalizePath(join(getSourceFolder(''), file.path)),\n  }));\n\n  const rootFiles = await loadProjectRootFiles(projectFolder);\n\n  return {\n    ignoreForbiddenPaths: true,\n    layout: GridAppLayout.GITHUB,\n    files: sourceFiles.concat(rootFiles),\n  };\n}\n"],"mappings":"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","names":["require_normalize_path","__commonJSMin","exports","module","init_esm_shims","path","stripTrailing","len","prefix","ch","segs","init_esm_shims","AppType","GridAppLayout","DeploymentOperation","RcLabel","WebhookIdentityType","init_esm_shims","readdir","readFile","stat","join","readFiles","dir","subPath","readdir","join","file","path","stat","readFile","isSiteNotPublishedError","err","extractHttpError","init_esm_shims","_createAppRequest","_createAppResponse","_deployAppRequest","_deployAppResponse","_pagesDiffRequest","_pagesDiffResponse","resolveWixVeloAppsV1LifecycleServiceUrl","opts","domainToMappings","resolveUrl","pagesDiff","payload","_a","serializer","_pagesDiffRequest","toReq","fromReq","fromRes","_pagesDiffResponse","__pagesDiff","host","serializedData","metadata","createApp","_createAppRequest","_createAppResponse","__createApp","deployApp","payload","_a","serializer","_deployAppRequest","toReq","fromReq","fromRes","_deployAppResponse","__deployApp","host","serializedData","metadata","resolveWixVeloAppsV1LifecycleServiceUrl","init_esm_shims","join","readFile","import_normalize_path","readFileOrThrow","path","readFile","e","CliError","CliErrorCode","readFilesOrThrow","root","readFiles","loadProjectRootFiles","projectFolder","pathExists","join","WIX_LOCK_FILENAME","PACKAGE_JSON_FILENAME","content","loadProjectGridAppContent","sourceFiles","getSourceFolder","file","normalizePath","rootFiles","GridAppLayout"]}