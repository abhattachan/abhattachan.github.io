{"version":3,"sources":["../../cli-site/src/commands/run-command.ts"],"sourcesContent":["import { reportCommandStartEvent } from '@wix/cli-telemetry';\nimport type { Command } from '@commander-js/extra-typings';\nimport { cwd } from 'node:process';\nimport type { CommandServices } from '@wix/cli-command-contract';\nimport { loadProjectModel } from '../model.js';\n\nasync function initServices({ biLogger, errorReporter }: CommandServices) {\n  const { metaSiteId } = await loadProjectModel(cwd());\n\n  errorReporter.setContext('site info', {\n    siteId: metaSiteId,\n  });\n\n  biLogger.updateDefaults({\n    _msid: metaSiteId,\n  });\n}\n\nexport async function runCommand(\n  command: Command<unknown[]>,\n  services: CommandServices,\n  cliVersion: string,\n  commandFn: () => Promise<void>\n) {\n  await initServices(services);\n\n  const commandStatus = reportCommandStartEvent({\n    biLogger: services.biLogger,\n    command,\n    cliVersion,\n    flow: 'Sites',\n  });\n\n  try {\n    await commandFn();\n    commandStatus.succeed();\n  } catch (e) {\n    commandStatus.failed(e);\n    throw e;\n  }\n}\n"],"mappings":";;gSAAAA,IAEA,OAAS,OAAAC,MAAW,eAIpB,eAAeC,EAAa,CAAE,SAAAC,EAAU,cAAAC,CAAc,EAAoB,CACxE,GAAM,CAAE,WAAAC,CAAW,EAAI,MAAMC,EAAiBC,EAAI,CAAC,EAEnDH,EAAc,WAAW,YAAa,CACpC,OAAQC,CACV,CAAC,EAEDF,EAAS,eAAe,CACtB,MAAOE,CACT,CAAC,CACH,CAEA,eAAsBG,EACpBC,EACAC,EACAC,EACAC,EACA,CACA,MAAMV,EAAaQ,CAAQ,EAE3B,IAAMG,EAAgBC,EAAwB,CAC5C,SAAUJ,EAAS,SACnB,QAAAD,EACA,WAAAE,EACA,KAAM,OACR,CAAC,EAED,GAAI,CACF,MAAMC,EAAU,EAChBC,EAAc,QAAQ,CACxB,OAASE,EAAG,CACV,MAAAF,EAAc,OAAOE,CAAC,EAChBA,CACR,CACF","names":["init_esm_shims","cwd","initServices","biLogger","errorReporter","metaSiteId","loadProjectModel","cwd","runCommand","command","services","cliVersion","commandFn","commandStatus","reportCommandStartEvent","e"]}