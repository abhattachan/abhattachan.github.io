import { createRequire as _createRequire } from 'node:module';
const require = _createRequire(import.meta.url);
import{c as le,h as ye,i as ge,j as ve,k as vt}from"./chunk-SHTCM5ZT.js";import{a as R,b as Y,d as fe,e as me,j as pe,l as qt,m as U,n as L,o as b,p as de,q as he,t as B,w as gt}from"./chunk-SPXP6KD4.js";import{c as Ct,k as At,l as z}from"./chunk-CNRVJIPG.js";import{a as Dt,b as yt,c as Z,e as Ft}from"./chunk-3VDYJ2A2.js";import{a as m,b as M}from"./chunk-NWTFQJ5S.js";import{a as T,c as l,e as v}from"./chunk-CU4HXYD6.js";import{a as J,c as D,e as d,g as __dirname,i as a}from"./chunk-UO4ZAUJK.js";var _e=D((ln,Ae)=>{"use strict";a();function w(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Ae.exports=w;w.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};w.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};w.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var o=this;return this._timer=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},r),this._options.unref&&this._timer.unref(),!0};w.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};w.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};w.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};w.prototype.start=w.prototype.try;w.prototype.errors=function(){return this._errors};w.prototype.attempts=function(){return this._attempts};w.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,r=0,o=0;o<this._errors.length;o++){var n=this._errors[o],i=n.message,s=(t[i]||0)+1;t[i]=s,s>=r&&(e=n,r=s)}return e}});var xe=D(F=>{"use strict";a();var $r=_e();F.operation=function(t){var e=F.timeouts(t);return new $r(e,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})};F.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],n=0;n<e.retries;n++)o.push(this.createTimeout(n,e));return t&&t.forever&&!o.length&&o.push(this.createTimeout(n,e)),o.sort(function(i,s){return i-s}),o};F.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,o=Math.round(r*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return o=Math.min(o,e.maxTimeout),o};F.wrap=function(t,e,r){if(e instanceof Array&&(r=e,e=null),!r){r=[];for(var o in t)typeof t[o]=="function"&&r.push(o)}for(var n=0;n<r.length;n++){var i=r[n],s=t[i];t[i]=function(u){var f=F.operation(e),p=Array.prototype.slice.call(arguments,1),h=p.pop();p.push(function(y){f.retry(y)||(y&&(arguments[0]=f.mainError()),h.apply(this,arguments))}),f.attempt(function(){u.apply(t,p)})}.bind(t,s),t[i].options=e}}});var Se=D((An,we)=>{"use strict";a();we.exports=xe()});var ee=D((cs,Ar)=>{"use strict";a();var vr=J("fs"),te;function Qo(){try{return vr.statSync("/.dockerenv"),!0}catch{return!1}}function tn(){try{return vr.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}Ar.exports=()=>(te===void 0&&(te=Qo()||tn()),te)});var wr=D((fs,re)=>{"use strict";a();var en=J("os"),rn=J("fs"),_r=ee(),xr=()=>{if(process.platform!=="linux")return!1;if(en.release().toLowerCase().includes("microsoft"))return!_r();try{return rn.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")?!_r():!1}catch{return!1}};process.env.__IS_WSL_TEST__?re.exports=xr:re.exports=xr()});var Rr=D((ps,Sr)=>{"use strict";a();Sr.exports=(t,e,r)=>{let o=n=>Object.defineProperty(t,e,{value:n,enumerable:!0,writable:!0});return Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){let n=r();return o(n),n},set(n){o(n)}}),t}});var qr=D((hs,Er)=>{"use strict";a();var on=J("path"),nn=J("child_process"),{promises:kt,constants:br}=J("fs"),Ot=wr(),an=ee(),ne=Rr(),Tr=on.join(__dirname,"xdg-open"),{platform:G,arch:Or}=process,sn=()=>{try{return kt.statSync("/run/.containerenv"),!0}catch{return!1}},oe;function cn(){return oe===void 0&&(oe=sn()||an()),oe}var un=(()=>{let t="/mnt/",e;return async function(){if(e)return e;let r="/etc/wsl.conf",o=!1;try{await kt.access(r,br.F_OK),o=!0}catch{}if(!o)return t;let n=await kt.readFile(r,{encoding:"utf8"}),i=/(?<!#.*)root\s*=\s*(?<mountPoint>.*)/g.exec(n);return i?(e=i.groups.mountPoint.trim(),e=e.endsWith("/")?e:`${e}/`,e):t}})(),kr=async(t,e)=>{let r;for(let o of t)try{return await e(o)}catch(n){r=n}throw r},Pt=async t=>{if(t={wait:!1,background:!1,newInstance:!1,allowNonzeroExitCode:!1,...t},Array.isArray(t.app))return kr(t.app,c=>Pt({...t,app:c}));let{name:e,arguments:r=[]}=t.app||{};if(r=[...r],Array.isArray(e))return kr(e,c=>Pt({...t,app:{name:c,arguments:r}}));let o,n=[],i={};if(G==="darwin")o="open",t.wait&&n.push("--wait-apps"),t.background&&n.push("--background"),t.newInstance&&n.push("--new"),e&&n.push("-a",e);else if(G==="win32"||Ot&&!cn()&&!e){let c=await un();o=Ot?`${c}c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe`:`${process.env.SYSTEMROOT}\\System32\\WindowsPowerShell\\v1.0\\powershell`,n.push("-NoProfile","-NonInteractive","\u2013ExecutionPolicy","Bypass","-EncodedCommand"),Ot||(i.windowsVerbatimArguments=!0);let u=["Start"];t.wait&&u.push("-Wait"),e?(u.push(`"\`"${e}\`""`,"-ArgumentList"),t.target&&r.unshift(t.target)):t.target&&u.push(`"${t.target}"`),r.length>0&&(r=r.map(f=>`"\`"${f}\`""`),u.push(r.join(","))),t.target=Buffer.from(u.join(" "),"utf16le").toString("base64")}else{if(e)o=e;else{let c=!__dirname||__dirname==="/",u=!1;try{await kt.access(Tr,br.X_OK),u=!0}catch{}o=process.versions.electron||G==="android"||c||!u?"xdg-open":Tr}r.length>0&&n.push(...r),t.wait||(i.stdio="ignore",i.detached=!0)}t.target&&n.push(t.target),G==="darwin"&&r.length>0&&n.push("--args",...r);let s=nn.spawn(o,n,i);return t.wait?new Promise((c,u)=>{s.once("error",u),s.once("close",f=>{if(!t.allowNonzeroExitCode&&f>0){u(new Error(`Exited with code ${f}`));return}c(s)})}):(s.unref(),s)},ae=(t,e)=>{if(typeof t!="string")throw new TypeError("Expected a `target`");return Pt({...e,target:t})},fn=(t,e)=>{if(typeof t!="string")throw new TypeError("Expected a `name`");let{arguments:r=[]}=e||{};if(r!=null&&!Array.isArray(r))throw new TypeError("Expected `appArguments` as Array type");return Pt({...e,app:{name:t,arguments:r}})};function Pr(t){if(typeof t=="string"||Array.isArray(t))return t;let{[Or]:e}=t;if(!e)throw new Error(`${Or} is not supported`);return e}function ie({[G]:t},{wsl:e}){if(e&&Ot)return Pr(e);if(!t)throw new Error(`${G} is not supported`);return Pr(t)}var bt={};ne(bt,"chrome",()=>ie({darwin:"google chrome",win32:"chrome",linux:["google-chrome","google-chrome-stable","chromium"]},{wsl:{ia32:"/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe",x64:["/mnt/c/Program Files/Google/Chrome/Application/chrome.exe","/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe"]}}));ne(bt,"firefox",()=>ie({darwin:"firefox",win32:"C:\\Program Files\\Mozilla Firefox\\firefox.exe",linux:"firefox"},{wsl:"/mnt/c/Program Files/Mozilla Firefox/firefox.exe"}));ne(bt,"edge",()=>ie({darwin:"microsoft edge",win32:"msedge",linux:["microsoft-edge","microsoft-edge-dev"]},{wsl:"/mnt/c/Program Files (x86)/Microsoft/Edge/Application/msedge.exe"}));ae.apps=bt;ae.openApp=fn;Er.exports=ae});a();a();a();var nr=d(T(),1);a();a();var Te=d(Se(),1),Gr=new Set(["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed"]),It=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},Xr=(t,e,r)=>{let o=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=o,t},Yr=t=>Gr.has(t),Re=t=>globalThis.DOMException===void 0?new Error(t):new DOMException(t);async function Q(t,e){return new Promise((r,o)=>{e={onFailedAttempt(){},retries:10,...e};let n=Te.default.operation(e);n.attempt(async i=>{try{r(await t(i))}catch(s){if(!(s instanceof Error)){o(new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`));return}if(s instanceof It)n.stop(),o(s.originalError);else if(s instanceof TypeError&&!Yr(s.message))n.stop(),o(s);else{Xr(s,i,e);try{await e.onFailedAttempt(s)}catch(c){o(c);return}n.retry(s)||o(n.mainError())}}}),e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",()=>{n.stop();let i=e.signal.reason===void 0?Re("The operation was aborted."):e.signal.reason;o(i instanceof Error?i:Re(i))},{once:!0})})}a();a();a();a();function Oe(t=""){let[e,r]=Zr(t);return r?{schemaName:r,schemaType:e}:{schemaName:e}}var Zr=t=>t.split("#");a();a();function ke(t,e,r,o){let n=t;for(let i of e.split(".")){if(!n)return r;n=n[i]}return`${n}${o}`}var Qr="_",to=["wix.com","editorx.com"],eo=["42.wixprod.net","uw2-edt-1.wixprod.net"],ro="dev.wix-code.com",oo=/{(.*)}/,no=new RegExp(`\\.(${to.join("|")})$`),ao=new RegExp(`\\.(${eo.join("|")})$`),io=new RegExp(`.*\\.${ro}$`);function _t(t){let e=uo(t.host),r=mo(e,t.domainToMappings),o=so(t.protoPath,t.data||{});return po(o,r)}function so(t,e){return t.split("/").map(r=>co(r,e)).join("/")}function co(t,e){let r=t.match(oo)||[],o=r[1];if(o){let n=t.replace(r[0],"");return ke(e,o,t,n)}return t}function uo(t){return fo(t).replace(no,"._base_domain_").replace(ao,"._api_base_domain_").replace(io,"*.dev.wix-code.com")}function fo(t){return t.replace("create.editorx.com","editor.editorx.com")}function mo(t,e){let r=e[t]||e[Qr];return!r&&ho(t)?e[lo]:r}function po(t,e){let r=e?.find(o=>t.startsWith(o.destPath));return r?r.srcPath+t.slice(r.destPath.length):t}function ho(t){return!!t.match(/\._base_domain_$/)}var lo="www._base_domain_";a();a();var Nt=typeof Buffer=="function",Dn=typeof TextDecoder=="function"?new TextDecoder:void 0,Pe=typeof TextEncoder=="function"?new TextEncoder:void 0,yo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",tt=Array.prototype.slice.call(yo),Fn=(t=>{let e={};return t.forEach((r,o)=>e[r]=o),e})(tt);var O=String.fromCharCode.bind(String),In=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),go=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_");var vo=t=>{let e,r,o,n,i="",s=t.length%3;for(let c=0;c<t.length;){if((r=t.charCodeAt(c++))>255||(o=t.charCodeAt(c++))>255||(n=t.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=r<<16|o<<8|n,i+=tt[e>>18&63]+tt[e>>12&63]+tt[e>>6&63]+tt[e&63]}return s?i.slice(0,s-3)+"===".substring(s):i},Ee=typeof btoa=="function"?t=>btoa(t):Nt?t=>Buffer.from(t,"binary").toString("base64"):vo,Ao=Nt?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let o=0,n=t.length;o<n;o+=4096)r.push(O.apply(null,t.subarray(o,o+4096)));return Ee(r.join(""))};var _o=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?O(192|e>>>6)+O(128|e&63):O(224|e>>>12&15)+O(128|e>>>6&63)+O(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return O(240|e>>>18&7)+O(128|e>>>12&63)+O(128|e>>>6&63)+O(128|e&63)}},xo=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,wo=t=>t.replace(xo,_o),be=Nt?t=>Buffer.from(t,"utf8").toString("base64"):Pe?t=>Ao(Pe.encode(t)):t=>Ee(wo(t)),qe=(t,e=!1)=>e?go(be(t)):be(t);function Ce(t,e=""){let r={};return Object.entries(t).forEach(([o,n])=>{let i=n!==null&&typeof n=="object"&&!Array.isArray(n),s=So(e,o);if(i){let c=Ce(n,s);Object.assign(r,c)}else r[s]=n}),r}function So(t,e){return`${t}${t?".":""}${e}`}function xt(t,e){let r=Ce(t),o=Object.entries(r).reduce((n,[i,s])=>((Array.isArray(s)?s:[s]).forEach(u=>{u!=null&&n.append(i,u)}),n),new URLSearchParams);return e&&o.append(".r",qe(JSON.stringify(t),!0)),o}a();a();var g;(function(t){t[t.TO_JSON=0]="TO_JSON",t[t.FROM_JSON=1]="FROM_JSON"})(g||(g={}));a();function De(t,e={},r){return function(n={},i){return typeof n=="string"?n:s(t,n);function s(p,h){let y={};return[null,void 0].includes(h)?h:(Object.entries(h).forEach(([X,C])=>{let Kr=p[X],{schemaName:ht,schemaType:Vr}=Oe(Kr),Hr=Vr==="Map",jr=u(ht)?.checkRepetable?.(C)??Array.isArray(C),lt;jr?lt=C.map(Wr=>c(Wr,ht)):Hr?lt=f(C,ht):lt=c(C,ht),y[X]=lt}),y)}function c(p,h){if(!h)return p;let y=e[h];if(u(h))return u(h).transform(p);if(y)return s(y,p);throw new Error(`${h} is neither schema nor serializable type`)}function u(p){return r[p]?.[i]}function f(p,h){return Object.entries(p).reduce((y,[X,C])=>(y[X]=c(C,h),y),{})}}}a();a();var Fe={types:["google.protobuf.Timestamp"],[g.TO_JSON]:{transform:t=>t?.toISOString()},[g.FROM_JSON]:{transform:t=>t?new Date(t):void 0}};a();var Ie={types:["google.protobuf.FieldMask"],[g.TO_JSON]:{transform:t=>t.join(","),checkRepetable:t=>t.some(e=>Array.isArray(e))},[g.FROM_JSON]:{transform:t=>typeof t=="object"?t.paths:t.split(",")}};a();var Ne={types:["google.protobuf.BytesValue","BYTES"],[g.TO_JSON]:{transform:t=>{let e=t.reduce((r,o)=>r+String.fromCharCode(o),"");return btoa(e)}},[g.FROM_JSON]:{transform:t=>Uint8Array.from(atob(t),e=>e.charCodeAt(0))}};a();var Je={types:["google.protobuf.Duration"],[g.TO_JSON]:{transform:({seconds:t="0",nanos:e=0})=>{let r="";return e!==0&&(r=`.${e.toString().padStart(9,"0")}`),`${t}${r}s`}},[g.FROM_JSON]:{transform:t=>{let[e,r]=t.substring(0,t.length-1).split(".");return{seconds:e,nanos:Ro(r)}}}};function Ro(t){let e=0;if(t!==void 0){let r=3-t.length/3;e=parseInt(t,10)*Math.pow(1e3,r)}return e}a();var Ue={types:["FLOAT","DOUBLE","google.protobuf.FloatValue","google.protobuf.DoubleValue"],[g.TO_JSON]:{transform:t=>isFinite(t)?t:t.toString()},[g.FROM_JSON]:{transform:t=>t==="NaN"?NaN:t==="Infinity"?1/0:t==="-Infinity"?-1/0:t}};var Le=[Fe,Ie,Ne,Je,Ue];a();function Me(t){return t.reduce((e,r)=>{let o=r.types.reduce((n,i)=>({...n,[i]:r}),{});return{...e,...o}},{})}var To=Me([...Le]);function k(t,e={}){let r=De(t,e,To);return{fromJSON(o){let n=Oo(o)||o;return r(n,g.FROM_JSON)},toJSON(o){return r(o,g.TO_JSON)}}}function Oo(t){try{return JSON.parse(t)}catch{}}var ko={dateCreated:"google.protobuf.Timestamp",dateUpdated:"google.protobuf.Timestamp"},Po={account:"_account"};var bo={};function Eo(t){var e={"api._api_base_domain_":[{srcPath:"/account-server",destPath:""}],"www._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"manage._base_domain_":[{srcPath:"/_api/account-server",destPath:""},{srcPath:"/account-server",destPath:""}],"premium._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"editor._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"blocks._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"create.editorx":[{srcPath:"/_api/account-server",destPath:""}],"bo._base_domain_":[{srcPath:"/account-server",destPath:""}],"wixbo.ai":[{srcPath:"/account-server",destPath:""}],"wix-bo.com":[{srcPath:"/account-server",destPath:""}],"www.wixapis.com":[{srcPath:"/accounts",destPath:""}],"users._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"*.dev.wix-code.com":[{srcPath:"/_api/account-server",destPath:""}]};return _t(Object.assign(t,{domainToMappings:e}))}function Be(t){var e=k(bo,{}),r=e.toJSON,o=e.fromJSON,n=k(Po,{_account:ko}).fromJSON;function i(s){var c=s.host,u=r(t),f={entityFqdn:"wix.identity.account.v2.account",method:"GET",methodFqn:"com.wixpress.account.api.AccountService.getMyAccount",url:Eo({protoPath:"/v1/accounts/my_account",data:u,host:c}),params:xt(u),transformResponse:n};return f}return i.fromReq=o,i.__isAmbassador=!0,i}a();var qo={},Co={};var Do={body:"BYTES"},Fo={body:"BYTES"},Io={},No={};function Jt(t){var e={"manage._base_domain_":[{srcPath:"/oauth2",destPath:"/v1/oauth"}],"www.wixapis.com":[{srcPath:"/oauth2",destPath:"/v1/oauth"},{srcPath:"/oauth2/token_info",destPath:"/v1/token_info"}],"users._base_domain_":[{srcPath:"/v1/oauth/device/verify",destPath:"/v1/oauth/device/verify"},{srcPath:"/v1/oauth/manage/user-code",destPath:"/v1/oauth/manage/user-code"},{srcPath:"/v2/oauth/device/verify",destPath:"/v2/oauth/device/verify"}],_:[{srcPath:"/_api/oauth2",destPath:"/v1/oauth"}]};return _t(Object.assign(t,{domainToMappings:e}))}function Ut(t){var e=k(Do,{}),r=e.toJSON,o=e.fromJSON,n=k(Fo,{}).fromJSON;function i(s){var c=s.host,u=r(t),f={entityFqdn:"wix.identity.oauth.v1.refresh_token",method:"POST",methodFqn:"wix.identity.oauth2.v1.Oauth2Ng.Token",url:Jt({protoPath:"/v1/oauth/token",data:u,host:c}),data:u,transformResponse:n};return f}return i.fromReq=o,i.__isAmbassador=!0,i}function ze(t){var e=k(qo,{}),r=e.toJSON,o=e.fromJSON,n=k(Co,{}).fromJSON;function i(s){var c=s.host,u=r(t),f={entityFqdn:"wix.identity.oauth.v1.refresh_token",method:"GET",methodFqn:"wix.identity.oauth2.v1.Oauth2Ng.DeviceCode",url:Jt({protoPath:"/v1/oauth/device/code",data:u,host:c}),params:xt(u),transformResponse:n};return f}return i.fromReq=o,i.__isAmbassador=!0,i}function Ke(t){var e=k(Io,{}),r=e.toJSON,o=e.fromJSON,n=k(No,{}).fromJSON;function i(s){var c=s.host,u=r(t),f={entityFqdn:"wix.identity.oauth.v1.refresh_token",method:"POST",methodFqn:"wix.identity.oauth2.v1.Oauth2Ng.RevokeRefreshToken",url:Jt({protoPath:"/v1/oauth/revoke",data:u,host:c}),data:u,transformResponse:n};return f}return i.fromReq=o,i.__isAmbassador=!0,i}a();var He=d(Ct(),1);a();var Ve=d(Ct(),1);function et(t){return Ve.HttpClient.isHttpError(t)}var Jo={backoffice:"https://manage.wix.com",editor:"https://editor.wix.com",code:"https://code.wix.com",general:"https://www.wix.com",standalone:void 0};function E(t,e){return(...r)=>e.apply(t,r).catch(o=>{throw et(o)&&!t.isCancel(o)&&!o.response?new l({code:v.NetworkError({cause:o}),cause:o,info:{code:o.code}}):o})}function wt({getAppToken:t,createHeaders:e,type:r}){let o=(0,He.createHttpClient)({baseURL:Jo[r],...r!=="standalone"?{getAppToken:t}:{},createHeaders:()=>({...e?.(),"X-XSRF-TOKEN":"nocheck",Cookie:"XSRF-TOKEN=nocheck","User-Agent":"wix-cli"})});return{...o,request:E(o,o.request),get:E(o,o.get),delete:E(o,o.delete),head:E(o,o.head),options:E(o,o.options),post:E(o,o.post),put:E(o,o.put),patch:E(o,o.patch)}}var V=d(T(),1);a();var je=m.object({deviceCode:m.string(),verificationUri:m.string().url(),userCode:m.string(),expiresIn:m.number()}),Lt=m.object({access_token:m.string(),refresh_token:m.string(),expires_in:m.number()}).transform(t=>({accessToken:t.access_token,refreshToken:t.refresh_token,expiresIn:t.expires_in})),Mt=m.object({userId:m.string().uuid(),email:m.string().email()}),We=m.object({account:m.object({slug:m.string(),accountId:m.string().uuid(),accountOwner:m.string().uuid()})}),Bt=m.object({accessToken:m.string(),refreshToken:m.string(),expiresIn:m.number(),issuedAt:m.number()}),$e=Bt.extend({userInfo:Mt}),Ge=m.object({token:m.string(),accountId:m.string().uuid(),userInfo:m.object({userId:m.string().uuid(),email:m.string()})});var{InvalidResponseData:Uo,FailedToGetAuthToken:Lo,FailedToGetDeviceCode:Mo,FailedToRenewAuthToken:Bo,FailedToRenewAuthTokenSiteNotFound:zo,FailedToRevokeRefreshToken:Ko}=v,zt="6f95cec8-3e98-48b9-b4e5-1fb92fcd9973",Xe=()=>Math.floor(Date.now()/1e3),rt=class extends Error{},K=(0,V.variant)({TokenRenewed:(0,V.payload)(),RefreshTokenRevoked:(0,V.fields)()}),Kt=class{constructor(e){this.httpClient=e;let{minRetryTimeout:r}=M();this.retryOptions={retries:3,minTimeout:r,maxTimeout:3*1e3}}retryOptions;async requestDeviceCode(e={}){try{let{data:r}=await Q(()=>this.httpClient.request(ze({...e,clientId:zt})),this.retryOptions);return je.parse(r)}catch(r){throw new l({code:Mo(),cause:r})}}async createToken(e){try{let r={clientId:zt,grantType:"urn:ietf:params:oauth:grant-type:device_code",scope:"offline_access",...e};return{...await Q(async()=>{let{data:n,requestId:i}=await this.httpClient.request(Ut(r)),s=Lt.safeParse(n);if(s.success)return s.data;throw new l({code:Uo(),cause:s.error,info:{requestId:i,data:n}})},this.retryOptions),issuedAt:Xe()}}catch(r){throw et(r)&&(r.response?.data?.message==="Device code is not yet verified"||r.response?.data?.error==="authorization_pending")?new rt("Device code is not yet verified."):new l({code:Lo(),cause:r})}}async renewToken(e){try{let r={clientId:zt,grantType:"refresh_token",...e},{data:o}=await Q(()=>this.httpClient.request(Ut(r)),this.retryOptions),n=Lt.parse(o);return K.TokenRenewed({...n,issuedAt:Xe()})}catch(r){if(et(r)){if(r.response?.status===400&&r.response.data?.error==="invalid_grant")return K.RefreshTokenRevoked({cause:r});if(e.siteId&&r.response?.status===404&&r.response.data?.details?.applicationError?.code==="SITE_NOT_FOUND")throw new l({code:zo({siteId:e.siteId}),cause:r})}throw new l({code:Bo(),cause:r})}}async revokeRefreshToken(e,{email:r}){try{let{data:o}=await this.httpClient.request(Ke(e));return o}catch(o){throw new l({code:Ko({email:r}),info:{email:r},cause:o})}}async userInfo({accessToken:e}){try{let r=wt({type:"backoffice",getAppToken:async()=>e}),{data:o}=await r.get("/_serverless/wix-cli-userinfo/userinfo");return Mt.parse(o)}catch(r){throw new l({code:v.FailedToGetUserInfo(),cause:r})}}async getMyAccount({token:e}){try{let r=wt({type:"backoffice",getAppToken:async()=>e}),{data:o}=await r.request(Be({}));return We.parse(o).account}catch(r){throw new l({code:v.FailedToGetMyAccount(),cause:r})}}},S=new Kt(wt({type:"backoffice"}));a();import{unlink as Vo,rm as Ho}from"node:fs/promises";import{resolve as nt}from"node:path";var _=d(T(),1);function Ye(){return nt(Ft(),"auth.json")}function St(){return nt(Ft(),"auth")}function Ze(){return nt(St(),"api-key.json")}function Qe(){return nt(St(),"account.json")}function tr(t){return nt(St(),`${t}.json`)}var Ht=(0,_.variant)({Authenticated:(0,_.payload)(),Unauthenticated:{}});async function jt(){let t=Ze();if(!await Z(t))return Ht.Unauthenticated();let e=await yt(t),r=Ge.parse(e);return Ht.Authenticated(r)}async function er(t){try{let e=Ze();await Dt(e,t)}catch(e){throw new l({code:v.FailedToSaveApiKeyAuthData({cause:e}),cause:e})}}var ot=(0,_.variant)({Authenticated:(0,_.fields)(),Unauthenticated:{},Expired:(0,_.fields)()});async function at(){let t=Qe();if(!await Z(t))return ot.Unauthenticated();let e=await yt(t),r=$e.parse(e);return j(r)?ot.Authenticated(r):ot.Expired(r)}var Vt=(0,_.variant)({Authenticated:(0,_.fields)(),Unauthenticated:{},Expired:(0,_.fields)()});async function rr(t){let e=tr(t);if(!await Z(e))return Vt.Unauthenticated();let r=await yt(e),o=Bt.parse(r);return j(o)?Vt.Authenticated(o):Vt.Expired(o)}async function it(t,e){try{let r=e?tr(e):Qe();await Dt(r,t)}catch(r){throw new l({code:v.FailedToSaveAuthData({cause:r}),cause:r})}}async function H(){try{await Ho(St(),{recursive:!0,force:!0})}catch(t){throw new l({code:v.FailedToDeleteAuthData({cause:t}),cause:t})}await Wt()&&await jo()}async function jo(){try{await Vo(Ye())}catch(t){throw new l({code:v.FailedToDeleteLegacyAuthData({cause:t}),cause:t})}}async function Wt(){return Z(Ye())}function j(t){let e=Math.floor(Date.now()/1e3),r=10*60,o=t.expiresIn-r;return t.issuedAt+o>e}async function Wo(){let t=await jt();if((0,_.isType)(t,Ht.Authenticated))return t.payload.userInfo;let e=await at();return(0,_.match)(e,{Authenticated:({userInfo:r})=>r,Expired:({userInfo:r})=>r,Unauthenticated:()=>null})}function or({authData:{token:t,accountId:e,userInfo:r},siteId:o}){return{getAccessToken:async()=>t,getRefreshToken:()=>{throw new Error("API key auth does not support refresh tokens")},getRequestHeaders:()=>({"wix-account-id":e,...o&&{"wix-site-id":o}}),userInfo:r}}var I={async isLoggedIn({siteId:t}={}){let e=await jt();return(0,nr.match)(e,{Authenticated:({payload:r})=>or({authData:r,siteId:t}),Unauthenticated:()=>null})},async login({token:t}){let{accountId:e,accountOwner:r,slug:o}=await S.getMyAccount({token:t}),n={token:t,accountId:e,userInfo:{userId:r,email:o}};return await H(),await er(n),or({authData:n})}};a();a();a();var $t=class{value;next;constructor(e){this.value=e}},st=class{#t;#e;#r;constructor(){this.clear()}enqueue(e){let r=new $t(e);this.#t?(this.#e.next=r,this.#e=r):(this.#t=r,this.#e=r),this.#r++}dequeue(){let e=this.#t;if(e)return this.#t=this.#t.next,this.#r--,e.value}clear(){this.#t=void 0,this.#e=void 0,this.#r=0}get size(){return this.#r}*[Symbol.iterator](){let e=this.#t;for(;e;)yield e.value,e=e.next}};function ct(t){if(!((Number.isInteger(t)||t===Number.POSITIVE_INFINITY)&&t>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let e=new st,r=0,o=()=>{r--,e.size>0&&e.dequeue()()},n=async(c,u,f)=>{r++;let p=(async()=>c(...f))();u(p);try{await p}catch{}o()},i=(c,u,f)=>{e.enqueue(n.bind(void 0,c,u,f)),(async()=>(await Promise.resolve(),r<t&&e.size>0&&e.dequeue()()))()},s=(c,...u)=>new Promise(f=>{i(c,f,u)});return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),s}var q=d(T(),1);a();a();var W=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Gt=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},ar=t=>globalThis.DOMException===void 0?new Gt(t):new DOMException(t),ir=t=>{let e=t.reason===void 0?ar("This operation was aborted."):t.reason;return e instanceof Error?e:ar(e)};function Xt(t,e){let{milliseconds:r,fallback:o,message:n,customTimers:i={setTimeout,clearTimeout}}=e,s,u=new Promise((f,p)=>{if(typeof r!="number"||Math.sign(r)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(e.signal){let{signal:y}=e;y.aborted&&p(ir(y)),y.addEventListener("abort",()=>{p(ir(y))})}if(r===Number.POSITIVE_INFINITY){t.then(f,p);return}let h=new W;s=i.setTimeout.call(void 0,()=>{if(o){try{f(o())}catch(y){p(y)}return}typeof t.cancel=="function"&&t.cancel(),n===!1?f():n instanceof Error?p(n):(h.message=n??`Promise timed out after ${r} milliseconds`,p(h))},r),(async()=>{try{f(await t)}catch(y){p(y)}})()}).finally(()=>{u.clear()});return u.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},u}var Yt=Symbol("resolveValue");async function ut(t,e={}){let{interval:r=20,timeout:o=Number.POSITIVE_INFINITY,before:n=!0}=e,i,s=!1,c=new Promise((u,f)=>{let p=async()=>{try{let h=await t();if(typeof h=="object"&&h[Yt])u(h[Yt]);else{if(typeof h!="boolean")throw new TypeError("Expected condition to return a boolean");h===!0?u():s||(i=setTimeout(p,r))}}catch(h){f(h)}};n?p():i=setTimeout(p,r)});if(o===Number.POSITIVE_INFINITY)return c;try{return await Xt(c,typeof o=="number"?{milliseconds:o}:o)}finally{s=!0,clearTimeout(i)}}ut.resolveWith=t=>({[Yt]:t});var sr=t=>1e3*t;async function $o({deviceCode:t,expiresIn:e},{signal:r}){try{let o=await ut(async()=>{try{let s=await S.createToken({deviceCode:t});return ut.resolveWith(s)}catch(s){if(s instanceof rt)return!1;throw s}},{interval:M().waitForLoginInterval??sr(3),timeout:{milliseconds:sr(e),signal:r}}),n=await S.userInfo({accessToken:o.accessToken}),i={...o,userInfo:n};return await H(),await it(i),i}catch(o){throw o instanceof W?new l({code:v.DeviceCodeTimedOut()}):o}}async function ur({refreshToken:t,userInfo:e}){let r=await S.renewToken({refreshToken:t});return(0,q.isType)(r,K.TokenRenewed)&&await it({...r.payload,userInfo:e}),r}async function Go(){let t=await at();return(0,q.match)(t,{Authenticated:e=>e,Unauthenticated:()=>null,Expired:async e=>{let r=await ur(e);return(0,q.match)(r,{TokenRenewed:({payload:o})=>({...o,userInfo:e.userInfo}),RefreshTokenRevoked:(0,q.constant)(null)})}})}function cr({userInfo:t,...e}){let r=ct(1),o={...e};return{getAccessToken:()=>r(async()=>{if(j(o))return o.accessToken;let n=await ur({...o,userInfo:t});return(0,q.match)(n,{TokenRenewed:({payload:i})=>(o=i,o.accessToken),RefreshTokenRevoked:({cause:i})=>{throw new l({code:v.FailedToRenewAuthTokenRefreshTokenRevoked(),cause:i})}})}),getRefreshToken:()=>o.refreshToken,userInfo:t}}var P={async isLoggedIn(){let t=await I.isLoggedIn();if(t)return t;let e=await Go();return e?cr(e):null},async login({deviceCode:t,signal:e}){let r=await $o(t,{signal:e});return cr(r)}};a();var x=d(T(),1);async function pr({accountRefreshToken:t,siteId:e}){let r=await S.renewToken({refreshToken:t,siteId:e});return(0,x.isType)(r,K.TokenRenewed)&&await it(r.payload,e),r}var Rt=(0,x.variant)({Ok:(0,x.payload)(),RefreshTokenRevoked:(0,x.fields)()});async function fr({siteId:t,accountRefreshToken:e}){let r=await rr(t);return(0,x.matcher)(r).with({Authenticated:o=>Rt.Ok(o)}).when(["Unauthenticated","Expired"],async()=>{let o=await pr({accountRefreshToken:e,siteId:t});return(0,x.match)(o,{TokenRenewed:({payload:n})=>Rt.Ok(n),RefreshTokenRevoked:({cause:n})=>Rt.RefreshTokenRevoked({cause:n})})}).complete()}function mr({siteAuth:t,accountRefreshToken:e,siteId:r,userInfo:o}){let n=ct(1),i={...t};return{getAccessToken:()=>n(async()=>{if(j(i))return i.accessToken;let s=await pr({accountRefreshToken:e,siteId:r});return(0,x.match)(s,{TokenRenewed:({payload:c})=>(i=c,i.accessToken),RefreshTokenRevoked:({cause:c})=>{throw new l({code:v.FailedToRenewAuthTokenRefreshTokenRevoked(),cause:c})}})}),getRefreshToken:()=>i.refreshToken,userInfo:o}}var Zt=t=>({async isLoggedIn(){let e=await I.isLoggedIn({siteId:t});if(e)return e;let r=await P.isLoggedIn();if(r){let o=r.getRefreshToken(),n=await fr({siteId:t,accountRefreshToken:o});if((0,x.isType)(n,Rt.Ok))return mr({siteId:t,siteAuth:n.payload,accountRefreshToken:o,userInfo:r.userInfo})}return null},async login({deviceCode:e,signal:r}){let o=await P.login({deviceCode:e,signal:r}),n=o.getRefreshToken(),i=await fr({siteId:t,accountRefreshToken:n});return(0,x.match)(i,{Ok:({payload:s})=>mr({siteId:t,siteAuth:s,accountRefreshToken:n,userInfo:o.userInfo}),RefreshTokenRevoked:({cause:s})=>{throw new l({code:v.FailedToRenewAuthTokenRefreshTokenRevoked(),cause:s})}})}});a();var dr=d(T(),1);async function Xo(){let t=await at();return(0,dr.isType)(t,ot.Unauthenticated)||await S.revokeRefreshToken({token:t.refreshToken},t.userInfo),await H(),null}a();var lr=d(R(),1);a();var hr=d(R(),1),$=(0,hr.createContext)(null);function Qt(){let t=(0,lr.useContext)($);if(!t)throw new Error("useAuth() cannot be used without an <AuthProvider>");return t}a();var yr=d(R(),1);var gr=d(T(),1);var Yo=({token:t,onLogin:e,onError:r})=>{let o=vt(),{status:n}=b(async()=>(o.report(At({})),I.login({token:t})),[],{onSuccess:i=>{o.report(z({isSuccess:!0})),e(i)},onError:i=>{o.report(z({isSuccess:!1,...i instanceof Error?{errorType:i.name}:{errorType:"unknown",errorMessage:JSON.stringify(i)}})),r(i)}});return(0,gr.match)(n,{Error:()=>null,Loading:()=>yr.default.createElement(U,null),Success:()=>null})};a();var ft=d(R(),1);var Lr=d(T(),1);var Tt={"login.instructions_title":"Authorize the CLI to access your Wix account:","login.instructions_details":`1. Copy this code to the clipboard: <0>{code}</0>
2. Press <1/> to <2>log in</2> and then paste the code`,"login.legacy_auth_notice":"We implemented a new and more secure login method. You'll need to re-login to continue using the CLI.","login.error_opening_browser":"Failed to open browser, please try opening <0/> manually."};a();var A=d(R(),1);a();var Fr=d(qr(),1);a();var Cr=d(Ct(),1);async function Dr(t,e){await(0,Cr.createHttpClient)().post(t,void 0,{params:{url:e}})}async function Ir(t){let{userBrowserTestEndpoint:e}=M();e?await Dr(e,t):await(0,Fr.default)(t,{background:!0})}a();var Nr=d(R(),1);function Jr(t){return(0,Nr.useMemo)(()=>{let e=new URL(t);return e.searchParams.set("color","developer"),e.searchParams.set("studio","true"),e.toString()},[t])}var Ur=({userCode:t,verificationUri:e})=>{let r=Jr(e),{reportError:o}=ge(),[n,i]=(0,A.useState)(null);return fe((s,c)=>{c.return&&Ir(r).catch(u=>{o(u),i(u)})}),A.default.createElement(A.default.Fragment,null,A.default.createElement(B,{i18nKey:"login.instructions_title"}),A.default.createElement(Y,{flexDirection:"column",marginTop:1,marginBottom:1,marginLeft:2},A.default.createElement(B,{i18nKey:"login.instructions_details",components:[A.default.createElement(me,{skin:"legacyBlue"}),A.default.createElement(pe,{value:"enter"}),A.default.createElement(qt,{url:r})],values:{code:t}})),n&&A.default.createElement(A.default.Fragment,null,A.default.createElement(Y,{flexDirection:"column",marginBottom:1},A.default.createElement(le,{error:n})),A.default.createElement(B,{i18nKey:"login.error_opening_browser",components:[A.default.createElement(qt,{url:r})]})))};var se=({loginFn:t,onLogin:e,onError:r})=>{let o=vt();function n(c){o.report(z({isSuccess:!1,...c instanceof Error?{errorType:c.name}:{errorType:"unknown",errorMessage:JSON.stringify(c)}})),r(c)}let i=de(async({signal:c},u)=>{try{let f=await t({deviceCode:u,signal:c});o.report(z({isSuccess:!0})),e(f)}catch(f){n(f)}}),{status:s}=b(async()=>(o.report(At({})),S.requestDeviceCode()),[],{onSuccess:c=>{i.execute(c)},onError:n});return(0,Lr.match)(s,{Error:()=>null,Loading:()=>ft.default.createElement(U,null),Success:({result:{userCode:c,verificationUri:u}})=>ft.default.createElement(Ur,{userCode:c,verificationUri:u})})};function mn(t){return ft.default.createElement(gt,{messages:Tt},ft.default.createElement(se,{loginFn:P.login,...t}))}a();var ce=d(R(),1);a();var pt=d(R(),1),zr=d(T(),1);a();var mt=d(R(),1),Mr=d(T(),1);var Br=({children:t})=>{let{status:e}=b(Wt,[],{onError:()=>{}});return(0,Mr.match)(e,{Error:()=>null,Loading:()=>null,Success:({result:r})=>mt.default.createElement(mt.default.Fragment,null,r&&mt.default.createElement(Y,{marginBottom:1},mt.default.createElement(B,{i18nKey:"login.legacy_auth_notice"})),t)})};var Et=({authStrategy:{login:t,isLoggedIn:e},onLogin:r,onError:o,children:n})=>{let{status:i,merge:s}=b(e,[],{onSuccess:c=>{c&&r(c)},onError:o});return(0,zr.match)(i,{Loading:()=>pt.default.createElement(U,null),Error:()=>null,Success:({result:c})=>c===null?pt.default.createElement(gt,{messages:Tt},pt.default.createElement(Br,null,pt.default.createElement(se,{loginFn:t,onLogin:u=>{s({result:u}),r(u)},onError:o}))):n(c)})};var pn=({children:t,onError:e,onLogin:r})=>{let o=L();return ce.default.createElement(Et,{authStrategy:P,onLogin:({userInfo:n})=>r?.(n),onError:e??o},({getAccessToken:n,getRequestHeaders:i,userInfo:s})=>ce.default.createElement($.Provider,{value:{getAccessToken:n,getRequestHeaders:i,userInfo:s}},t))};a();var dt=d(R(),1);var ue=({children:t,siteId:e,onError:r,onLogin:o})=>{let n=L(),i=(0,dt.useMemo)(()=>Zt(e),[e]);return dt.default.createElement(Et,{authStrategy:i,onLogin:({userInfo:s})=>o?.(s),onError:r??n},({getAccessToken:s,getRequestHeaders:c,userInfo:u})=>dt.default.createElement($.Provider,{value:{getAccessToken:s,getRequestHeaders:c,userInfo:u}},t))};a();var N=d(R(),1);var dn=({onReady:t})=>{let e=L(),r=Qt();return(0,N.useEffect)(()=>{t(r),e()},[e,r,t]),null};function hn(t,e,r){return new Promise((o,n)=>{he(N.default.createElement(ye,{value:r},N.default.createElement(ve,{value:e},N.default.createElement(ue,{siteId:t},N.default.createElement(dn,{onReady:o}))))).catch(i=>n(i))})}var{isLoggedIn:Ac}=P;export{et as a,wt as b,Q as c,_t as d,xt as e,k as f,Wo as g,ct as h,Xt as i,ut as j,Xo as k,Qt as l,Yo as m,Ir as n,mn as o,pn as p,ue as q,hn as r,Ac as s};
//# sourceMappingURL=chunk-QKI65SFV.js.map