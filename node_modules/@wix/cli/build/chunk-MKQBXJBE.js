import { createRequire as _createRequire } from 'node:module';
const require = _createRequire(import.meta.url);
import{a as p,d as D,e as N}from"./chunk-Q6WPLZZC.js";import{a as m}from"./chunk-XBIKRRQN.js";import{a as P,d as y,e as _,f as d,j as h}from"./chunk-QKI65SFV.js";import{f as w}from"./chunk-NUQ6G6J3.js";import{a as k,b as v,c as R,d as x}from"./chunk-3VDYJ2A2.js";import{c as o,e as i}from"./chunk-CU4HXYD6.js";import{i as r}from"./chunk-UO4ZAUJK.js";r();import j from"node:path";var U=async e=>R(j.join(e,"yarn.lock")),X=async e=>await U(e)?"yarn":"npm";r();r();var W={},I={};var Y={},$={};function q(e){var n={"api._api_base_domain_":[{srcPath:"/wix-code-user-code-dependencies",destPath:""}],"editor._base_domain_":[{srcPath:"/wix-code-user-code-dependencies",destPath:""}],"blocks._base_domain_":[{srcPath:"/wix-code-user-code-dependencies",destPath:""}],"create.editorx":[{srcPath:"/wix-code-user-code-dependencies",destPath:""}]};return y(Object.assign(e,{domainToMappings:n}))}function F(e){var n=d(Y,{}),t=n.toJSON,a=n.fromJSON,s=d($,{}).fromJSON;function c(g){var u=g.host,l=t(e),f={entityFqdn:"wix.velo.npm.v1.npm_package_info",method:"POST",methodFqn:"wix.velo.npm.v1.UserCodeNpmPackages.ResolveNpmDependencies",url:q({protoPath:"/v1/npm/resolve-dependencies",data:l,host:u}),data:l,transformResponse:s};return f}return c.fromReq=a,c.__isAmbassador=!0,c}function O(e){var n=d(W,{}),t=n.toJSON,a=n.fromJSON,s=d(I,{}).fromJSON;function c(g){var u=g.host,l=t(e),f={entityFqdn:"wix.velo.npm.v1.npm_package_info",method:"GET",methodFqn:"wix.velo.npm.v1.UserCodeNpmPackages.GetResolveNpmDependenciesResult",url:q({protoPath:"/v1/npm/resolve-dependencies/{jobId}",data:l,host:u}),params:_(l),transformResponse:s};return f}return c.fromReq=a,c.__isAmbassador=!0,c}r();import{join as J}from"node:path";async function C(e){let n=J(e,"package.json"),t=await v(n);return Object.entries(t.dependencies??{}).map(([a,s])=>({name:a,version:s}))}async function ie(e,n){let t=J(e,"package.json"),a=await v(t);if(a.dependencies&&Object.keys(a.dependencies).length>0)throw new o({code:i.FailedMigrationToAnyNpm()});a.dependencies={},Object.keys(n.dependencies).forEach(s=>{a.devDependencies?.[s]&&delete a.devDependencies[s],a.dependencies[s]=n.dependencies[s]}),await k(t,a)}r();import{join as z}from"node:path";async function S(e,n){let t=z(e,w);try{await x(t,n)}catch(a){throw new o({code:i.FailedToWriteWixLock(),cause:a})}}var V=async(e,{authState:n})=>h(async()=>{try{let{data:t}=await m({type:"editor",authState:n},O({jobId:e})),a=N.parse(t);return h.resolveWith({wixLockFileUrl:a.result.npmDependenciesLockFile})}catch(t){if(P(t)&&t.response?.status===428)return!1;throw new o({code:i.FailedToGetResolveNpmDependenciesResult(),cause:t})}},{interval:3*1e3,timeout:2*60*1e3}),G=async(e,n)=>{let t=await m({type:"standalone"},{url:e});return S(n,t.data)},_e=async(e,{authState:n})=>{try{let t=await C(e),{data:a}=await m({type:"editor",authState:n},F({npmPackageInfos:t})),{jobId:s}=D.parse(a),{wixLockFileUrl:c}=await V(s,{authState:n});await G(c,e)}catch(t){throw new o({code:i.FailedToResolveNpmDependencies(),cause:t})}};r();r();var A=async(e,n,t)=>{let a=["add",`${e}${n?`@${n}`:""}`];return p("yarn",a,{cwd:t})},T=(e,n)=>p("yarn",["remove",e],{cwd:n}),b=e=>p("yarn",["install"],{cwd:e});r();var E=async(e,n,t)=>{let a=["install",`${e}${n?`@${n}`:""}`];return p("npm",a,{cwd:t})},L=(e,n)=>p("npm",["uninstall",e],{cwd:n}),M=e=>p("npm",["install"],{cwd:e});var Ee=async(e,n,t,a)=>{try{a==="yarn"?await A(e,n,t):await E(e,n,t)}catch(s){throw new o({code:i.FailedToInstallPackage({packageName:e,cause:s}),cause:s})}},Le=async(e,n,t)=>{try{t==="yarn"?await T(e,n):await L(e,n)}catch(a){throw new o({code:i.FailedToUninstallPackage({packageName:e,cause:a}),cause:a})}},Me=async(e,n)=>{try{n==="yarn"?await b(e):await M(e)}catch(t){throw new o({code:i.FailedToInstallPackages({cause:t}),cause:t})}};export{X as a,ie as b,_e as c,Ee as d,Le as e,Me as f};
//# sourceMappingURL=chunk-MKQBXJBE.js.map