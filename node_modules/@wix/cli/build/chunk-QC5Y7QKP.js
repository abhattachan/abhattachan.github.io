import { createRequire as _createRequire } from 'node:module';
const require = _createRequire(import.meta.url);
import{c as Pe,d as R,e as O}from"./chunk-CNRVJIPG.js";import{a as De,e as S,g as U,h as G,k as Be}from"./chunk-SYHT5LTW.js";import{k as I}from"./chunk-NUQ6G6J3.js";import{b as z}from"./chunk-NWTFQJ5S.js";import{f as Q,g as H}from"./chunk-CU4HXYD6.js";import{c as m,e as T,i as o}from"./chunk-UO4ZAUJK.js";var D=m((qt,p)=>{"use strict";o();var Fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};function Le(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:n}function Ne(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var y=function(n){Ne(t,n);function t(e){Le(this,t);var r=Me(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name=r.constructor.name,r}return t}(Error);function qe(n,t){if(n===void 0)throw new y(t)}function Ae(n,t){if(n!==void 0&&((typeof n>"u"?"undefined":Fe(n))!=="object"||Array.isArray(n)||n===null))throw new y(t)}function Ve(n,t){if(!n)throw new y(t)}function ze(n,t){if(n!==void 0&&typeof n!="function")throw new y(t)}function Qe(n,t){if(n!==void 0&&typeof n!="boolean")throw new y(t)}function He(n,t){if(n!==void 0&&typeof n!="number")throw new y(t)}function Ue(n,t){if(typeof Array.isArray=="function"){if(!Array.isArray(n))throw new y(t)}else if(Object.prototype.toString.call(n)!=="[object Array]")throw new y(t)}p.exports.defined=qe;p.exports.object=Ae;p.exports.ok=Ve;p.exports.func=ze;p.exports.boolean=Qe;p.exports.number=He;p.exports.array=Ue;p.exports.AssertionError=y});var Y=m((Vt,C)=>{"use strict";o();C.exports.mapValues=function(n,t){return n?Object.keys(n).reduce(function(e,r){return e[r]=t(n[r],r,n),e},{}):{}};C.exports.filterValues=function(n,t){return n?Object.keys(n).reduce(function(e,r){var i=t(n[r],r,n);return i&&(e[r]=n[r]),e},{}):{}}});var Z=m((Qt,j)=>{"use strict";o();j.exports.timedPromise=function(n,t){var e=t.message,r=t.timeout,i=new Promise(function(a,u){setTimeout(u,r,e?"Timeout: "+e:"Timeout")});return Promise.race([n,i])};j.exports.allAsObject=function(n){var t=Object.keys(n);return Promise.all(t.map(function(e){return n[e]})).then(function(e){return e.reduce(function(r,i,a){return r[t[a]]=i,r},{})})}});var K=m((Ut,$)=>{"use strict";o();$.exports={error:function(){if(console&&console.error){var t;(t=console).error.apply(t,arguments)}}}});var te=m((Rt,ee)=>{"use strict";o();function Ge(n,t,e){var r=void 0;return function(){var i=this,a=arguments,u=function(){r=null,e||n.apply(i,a)},s=e&&!r;clearTimeout(r),r=setTimeout(u,t),s&&n.apply(i,a)}}ee.exports=Ge});var re=m((Jt,ne)=>{"use strict";o();function Re(n,t){var e=void 0;return function(){for(var r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];e||(e=setTimeout(function(){n.apply(void 0,i),e=null},t))}}ne.exports=Re});var B=m((Xt,ie)=>{"use strict";o();var Ie=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),Je=function(){function n(t,e){var r=[],i=!0,a=!1,u=void 0;try{for(var s=t[Symbol.iterator](),h;!(i=(h=s.next()).done)&&(r.push(h.value),!(e&&r.length===e));i=!0);}catch(c){a=!0,u=c}finally{try{!i&&s.return&&s.return()}finally{if(a)throw u}}return r}return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),F=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n};function We(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var Xe=te(),Ye=re(),Ze=function(t,e,r){return{dt:Date.now()-r,f:t,context:e}},$e=function(t,e){return{dt:Date.now()-e,e:t,g:{}}},Ke=function(t){var e={},r=t.e.length,i=t.e.map(function(u){var s=Object.keys(u.f).map(function(h){var c=u.f[h],f=h+"|"+c;return e[f]=e[f]||0,e[f]++,[h,c,f]});return F({},u,{f:s})}),a={};return i=i.map(function(u){var s=u.f.reduce(function(h,c){var f=Je(c,3),v=f[0],d=f[1],g=f[2];return e[g]===r?a[v]=d:h[v]=d,h},{});return F({},u,{f:s})}),F({},t,{e:i,g:a})},et=function(){function n(){We(this,n),this._initilized=!1}return Ie(n,[{key:"_reset",value:function(){var e=this;this._startTime=Date.now(),this._resolve=null,this._promise=new Promise(function(r){return e._resolve=r})}},{key:"init",value:function(e,r){var i=this,a=e.delayMs,u=e.maxBatchSize,s=e.useThrottle,h=e.optimizeBatch;this._initilized||(this._maxBatchSize=u,this._optimizeBatch=h,this._queue=[],this._flushHandler=r,this._flushDebounced=s?Ye(function(){return i.flush()},a):Xe(function(){return i.flush()},a),this._initilized=!0,this._reset())}},{key:"flush",value:function(){if(!this._queue.length)return Promise.resolve();var e=this._queue.splice(0,this._queue.length),r=this._resolve,i=this._startTime;this._reset();var a=$e(e,i);return this._optimizeBatch&&(a=Ke(a)),this._flushHandler(a).then(r)}},{key:"feed",value:function(e,r){return this._queue.push(Ze(e,r,this._startTime)),this._queue.length===this._maxBatchSize?this.flush():(this._flushDebounced(),this._promise)}}]),n}();ie.exports=et});var oe=m((Zt,ue)=>{"use strict";o();var tt={functional:!0,analytics:!0,__default:!0},nt=function(t){return typeof t=="function"&&t()||tt},ae=function(t){return t.functional===!1||t.analytics===!1},rt=function(t,e){return e==="essential"?!1:e==="functional"||e==="analytics"?t[e]===!1:ae(t)};ue.exports={shouldMuteNonEssentials:ae,shouldMuteByCategory:rt,getPolicy:nt}});var M=m((Kt,de)=>{"use strict";o();var E=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},it=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function at(n,t){var e={};for(var r in n)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}function ut(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var x=D(),he=Y(),se=he.mapValues,le=he.filterValues,fe=Z(),ot=K(),st=B(),L=oe(),lt=L.shouldMuteByCategory,ce=L.shouldMuteNonEssentials,ft=L.getPolicy,ct=function(){function n(t,e){ut(this,n),this._publishers=t.publishers,this._validators=t.validators||[],this._defaults=t.defaults,this._ownDefaults={},this._events=t.events||{},this._context=e||{},this._defaultValueTimeout=t.defaultValueTimeout||5e3,this._defaultContinueOnFail=t.defaultContinueOnFail||!1,this._onPublisherFailHandler=t.onPublisherFailHandler||n._defaultPublisherFailHandler,this._isMuted=t.isMuted||function(){return!1},this._eventTransformer=t.eventTransformer||function(r){return r},this._payloadTransformer=t.payloadTransformer||function(r){return r},this._consentPolicyGetter=t.consentPolicyGetter||function(){return null},this._nonEssentialDefaults=t.nonEssentialDefaults||{},this._maxBatchSize=t.maxBatchSize||100,this._globalBatchQueue=t.globalBatchQueue}return it(n,[{key:"report",value:function(e){x.defined(e,"Data must be provided"),x.object(e,"Data must be an object");var r=e.src,i=e.evid,a=e.params,u=at(e,["src","evid","params"]);return this.log(E({src:r,evid:i},a),u)}},{key:"log",value:function(e,r,i){var a=this;x.defined(e,"Event object or event key must be provided.");var u=this._extractEventAndContext(e,r,i),s=u.event,h=u.context,c=ft(this._consentPolicyGetter),f=E({},this._context,h);if(this._isMuted()||lt(c,f.category))return Promise.resolve();if(f.useBatch){var v=this._initQueue(f,c),d=function(_){var P=a._eventTransformer(_,f);return v.feed(P,f)};if(this._globalBatchQueue)return this._getDefaults(this._defaults).then(function(w){var _=E({},w,a._getDynamicNonEssentialDefaults(c),a._getStaticNonEssentialDefaults(c),s,a._getPolicyFields(c,f.category));return d(_)});var g=E({},this._getDynamicDefaults(this._defaults),this._getDynamicNonEssentialDefaults(c),s,this._getPolicyFields(c,f.category));return d(g)}return this._getDefaults(this._defaults).then(function(w){var _=Object.assign(w,a._getDynamicNonEssentialDefaults(c),a._getStaticNonEssentialDefaults(c),s,a._getPolicyFields(c,f.category)),P=a._validators.length===0?!0:a._validators.some(function(V){return V.match(_)&&(V.execute(_)||!0)});if(!P)throw new Error("No validator accepted the event. Source: "+_.src+" Evid: "+(_.evid||_.evtId));var k=a._eventTransformer(_,f);return k=a._payloadTransformer(k,f),a._send(k,f)})}},{key:"flush",value:function(){return this._queue?this._queue.flush():Promise.resolve()}},{key:"updateDefaults",value:function(e){return x.defined(e,"Defaults must be provided"),x.object(e,"Defaults must be an object"),Object.assign(this._ownDefaults,e),this}},{key:"_send",value:function(e){var r=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Promise.all(this._publishers.map(function(a){var u=E({},e);return Promise.resolve().then(function(){return a(u,i)}).catch(function(s){return r._onPublisherFailHandler(s,{publisherName:a.name,payload:e})})})).then(function(){})}},{key:"_extractEventAndContext",value:function(e,r,i){var a=void 0,u={};if(typeof e!="string")a=e,u=r||u;else{if(a=this._events[e],!a)throw new x.AssertionError("Event with key '"+e+"' not found in event map.");r&&(a=E({},a,r),u=i||u)}return{event:a,context:u}}},{key:"_initQueue",value:function(e,r){var i=this;if(this._queue)return this._queue;this._queue=this._globalBatchQueue||new st;var a=function(s){i._globalBatchQueue||(s.g=Object.assign(i._getStaticDefaults(i._defaults),i._getStaticNonEssentialDefaults(r)));var h=i._payloadTransformer(s,e);return i._send(h,e)};return this._queue.init({delayMs:e.useBatch===!0?300:e.useBatch,maxBatchSize:this._maxBatchSize,useThrottle:!!this._globalBatchQueue,optimizeBatch:!!this._globalBatchQueue},a),this._queue}},{key:"_handleDefaultsError",value:function(e){return this._defaultContinueOnFail?(ot.error(e),null):Promise.reject(e)}},{key:"_getDynamicNonEssentialDefaults",value:function(e){if(!ce(e))return this._getDynamicDefaults(this._nonEssentialDefaults)}},{key:"_getStaticNonEssentialDefaults",value:function(e){if(!ce(e))return this._getStaticDefaults(this._nonEssentialDefaults)}},{key:"_withOwnDefaults",value:function(e){return Object.assign({},e,this._ownDefaults)}},{key:"_getDynamicDefaults",value:function(e){e=this._withOwnDefaults(e);var r=le(e,function(i){return typeof i=="function"});return se(r,function(i){return i()})}},{key:"_getStaticDefaults",value:function(e){e=this._withOwnDefaults(e);var r=le(e,function(i){return typeof i!="function"});return r}},{key:"_getDefaults",value:function(e){var r=this;if(e=this._withOwnDefaults(e),!e)return Promise.resolve({});var i=se(e,function(a,u){if(typeof a=="function")try{a=a()}catch(s){return r._handleDefaultsError(s)}return a&&typeof a.then=="function"?fe.timedPromise(a,{message:"Cannot get default value '"+u+" for BI Event'",timeout:r._defaultValueTimeout}).catch(function(s){return r._handleDefaultsError(s)}):a});return fe.allAsObject(i)}},{key:"_encodePolicyValue",value:function(e,r){return e?typeof e[r]=="boolean"?e[r]?1:0:e[r]:1}},{key:"_getPolicyFields",value:function(e,r){return{_isca:this._encodePolicyValue(e,"analytics"),_iscf:this._encodePolicyValue(e,"functional"),_ispd:e.__default?1:0,_ise:r==="essential"?1:0}}}],[{key:"_defaultPublisherFailHandler",value:function(e,r){var i=r.publisherName;return i}}]),n}();de.exports=ct});var N=m((tn,ge)=>{"use strict";o();var ht=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function dt(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var me=D(),ve=function(){function n(){dt(this,n),this.reset()}return ht(n,[{key:"reset",value:function(){this._handlers=[]}},{key:"onLoggerCreated",value:function(e){var r=this;return me.defined(e,"Handler must be provided."),me.func(e,"Handler must be a function."),this._handlers.push(e),function(){var i=r._handlers.indexOf(e);i!==-1&&r._handlers.splice(i,1)}}},{key:"notifyLoggerCreated",value:function(e){this._handlers.forEach(function(r){return r(e)})}}]),n}();ge.exports={manager:new ve,BiLoggerManager:ve}});var ye=m((rn,_e)=>{"use strict";o();var mt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vt=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function gt(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var l=D(),_t=M(),yt=N(),pt=B(),bt=function(){function n(){gt(this,n),this._publishers=[],this._validators=[],this._defaults={},this._nonEssentialDefaults={},this._events={},this._isMuted=!1,this._eventTransformer=null,this._payloadTransformer=null,this._consentPolicyGetter=null,this._maxBatchSize=null,this._batchQueue=null}return vt(n,[{key:"addPublisher",value:function(e){return l.defined(e,"Publisher must be provided"),l.ok(typeof e=="function","Expected a publisher function"),this._publishers.push(e),this}},{key:"addValidator",value:function(e){return l.defined(e,"Validator must be provided"),l.ok((typeof e>"u"?"undefined":mt(e))==="object"&&e,"Expected a validator object"),l.ok(e.execute&&e.match,"Provided validator does not match the interface"),this._validators.push(e),this}},{key:"setDefaults",value:function(e){return l.defined(e,"Defaults must be provided"),l.object(e,"Defaults must be an object"),this._defaults=e,this}},{key:"updateDefaults",value:function(e){return l.defined(e,"Defaults must be provided"),l.object(e,"Defaults must be an object"),Object.assign(this._defaults,e),this}},{key:"updateNonEssentialDefaults",value:function(e){return l.defined(e,"Non-essential Defaults must be provided"),l.object(e,"Non-essential Defaults must be an object"),Object.assign(this._nonEssentialDefaults,e),this}},{key:"setEvents",value:function(e){return l.defined(e,"Events must be provided"),l.object(e,"Events must be an object"),this._events=e,this}},{key:"setDefaultValueTimeout",value:function(e){return l.defined(e,"Default Value Timeout must be provided"),this._defaultValueTimeout=e,this}},{key:"setDefaultContinueOnFail",value:function(e){return l.defined(e,"Default Continue On Fail must be provided"),this._defaultContinueOnFail=e,this}},{key:"setPublisherFailHandler",value:function(e){return l.defined(e,"Publisher Fail Handler must be provided"),this._onPublisherFailHandler=e,this}},{key:"setMuted",value:function(e){return l.defined(e,"Is Muted must be provided"),l.boolean(e,"Is Muted must be a boolean"),this._isMuted=e,this}},{key:"setMaxBatchSize",value:function(e){return l.defined(e,"Max Batch Size must be provided"),l.number(e,"Max Batch Size must be a number"),l.ok(e>0,"Max Batch Size must be higher than 0"),this._maxBatchSize=e,this}},{key:"setGlobalBatchQueue",value:function(e){return l.defined(e,"Global Batch Queue must be provided"),l.ok(e instanceof pt,"Global Batch Queue must be an instance of BatchQueue"),this._globalBatchQueue=e,this}},{key:"withEventTransformer",value:function(e){return l.defined(e,"Event Transformer must be provided"),l.func(e,"Event Transformer must be a function"),this._eventTransformer=e,this}},{key:"withPayloadTransformer",value:function(e){return l.defined(e,"Payload Transformer must be provided"),l.func(e,"Payload Transformer must be a function"),this._payloadTransformer=e,this}},{key:"withConsentPolicyGetter",value:function(e){return l.defined(e,"Consent Policy Getter must be provided"),l.func(e,"Consent Policy Getter must be a function"),this._consentPolicyGetter=e,this}},{key:"logger",value:function(e){var r=this,i=new _t({publishers:this._publishers,validators:this._validators,defaults:this._defaults,events:this._events,defaultValueTimeout:this._defaultValueTimeout,defaultContinueOnFail:this._defaultContinueOnFail,onPublisherFailHandler:this._onPublisherFailHandler,isMuted:function(){return r._isMuted},eventTransformer:this._eventTransformer,payloadTransformer:this._payloadTransformer,consentPolicyGetter:this._consentPolicyGetter,nonEssentialDefaults:this._nonEssentialDefaults,maxBatchSize:this._maxBatchSize,globalBatchQueue:this._globalBatchQueue},e);return yt.manager.notifyLoggerCreated(i),i}}]),n}();_e.exports=bt});var we=m((un,b)=>{"use strict";o();var pe=ye(),wt=M(),be=N(),Et=B();b.exports.BiLoggerFactory=pe;b.exports.BiLogger=wt;b.exports.BiLoggerManager=be.BiLoggerManager;b.exports.factory=function(){return new pe};b.exports.manager=be.manager;b.exports.createBatchQueue=function(){return new Et}});o();import{uptime as Ce}from"node:process";o();var J=T(De(),1);import ke from"node:os";import{platform as Te,version as Se}from"node:process";function W({cliVersion:n,flow:t}){return{...t?{flow:t}:{},cliVersion:n,isCI:J.default,nodeVersion:Se,osName:Oe(),osVersion:ke.release()}}function Oe(){switch(Te){case"darwin":return"mac";case"win32":return"windows";default:return"linux"}}var X=()=>Math.round(Ce()*1e3);function je({biLogger:n,command:t,flow:e,cliVersion:r,projectId:i,extensions:a,extraFields:u}){let s=t.opts(),h=t.args,c=new Set(["apiKey"]),f=Object.fromEntries(Object.entries(s).map(([d,g])=>{let w=c.has(d)?"<censored>":g;return[d,w]})),v={command:t.name(),arguments:h.join(","),flags:Object.keys(f).length?JSON.stringify(f):""};return n.report(R({...W({cliVersion:r,flow:e}),...v,...i?{projectId:i}:{},...u?{extraFields:JSON.stringify(u)}:{},isValid:!0})),{succeed(){n.report(O({...v,...a?{extensions:JSON.stringify(a)}:{},duration:X(),isSuccess:!0,isValid:!0}))},failed(d){let g=Q(d)?{errorType:H(d)?"SystemError":"UserError",errorName:d.name,errorMessage:d.message}:d instanceof Error?{errorType:"UnknownError",errorName:d.name,errorMessage:d.message}:{errorType:"UnknownError",errorMessage:JSON.stringify(d)};n.report(O({...v,...g,...a?{extensions:JSON.stringify(a)}:{},duration:X(),isSuccess:!1,isValid:!0}))}}}o();o();o();Be();var Ee=T(we()),xe=T(Pe()),xt={baseUrl:process.env.BI_BASE_URL||"https://frog.wix.com",endpoint:"",logError:!1},q=function(){function n(){}return n.prototype.factory=function(t){var e=this;t===void 0&&(t={});var r=S(S({},xt),t),i=Ee.default.factory();return r.onError&&i.setPublisherFailHandler(r.onError),i.addPublisher(function(a,u){return U(e,void 0,void 0,function(){var s,h,c,f,v;return G(this,function(d){switch(d.label){case 0:return s=u.endpoint||r.endpoint,h=r.baseUrl,c=r.userAgent,f=r.logError,v=c?{headers:{"User-Agent":c}}:{},[4,new xe.HttpClient({baseURL:h}).get(s,{headers:v,params:a,timeout:30*1e3}).catch(function(g){return f?console.error(g.toJSON()):Promise.reject(g)})];case 1:return d.sent(),[2]}})})}),i},n}();var ln=new q;o();import{randomUUID as Dt}from"node:crypto";function Bt(n,t){n.updateDefaults(A(t))}function A(n){return n?{_client_id:n,_uuid:n,logged_user_id:n,logged_account_id:n,target_account_id:n}:{_client_id:Dt()}}async function Pt(n,t){let e=z().biLoggerBaseUrl,r=e?{baseUrl:e}:{},i=A(t),{telemetry:a}=await I();return new q().factory(r).updateDefaults({localTime:()=>Date.now(),...n,...i}).setMuted(!a).logger()}export{Bt as a,Pt as b,je as c};
//# sourceMappingURL=chunk-QC5Y7QKP.js.map