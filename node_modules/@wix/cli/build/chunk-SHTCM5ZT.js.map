{"version":3,"sources":["../../../node_modules/@opentelemetry/core/src/trace/suppress-tracing.ts","../../../node_modules/@opentelemetry/core/src/baggage/constants.ts","../../../node_modules/@opentelemetry/core/src/baggage/utils.ts","../../../node_modules/@opentelemetry/core/src/baggage/propagation/W3CBaggagePropagator.ts","../../../node_modules/@opentelemetry/core/src/common/anchored-clock.ts","../../../node_modules/@opentelemetry/core/src/common/attributes.ts","../../../node_modules/@opentelemetry/core/src/common/logging-error-handler.ts","../../../node_modules/@opentelemetry/core/src/common/global-error-handler.ts","../../../node_modules/@opentelemetry/core/src/utils/sampling.ts","../../../node_modules/@opentelemetry/core/src/utils/environment.ts","../../../node_modules/@opentelemetry/core/src/platform/node/environment.ts","../../../node_modules/@opentelemetry/core/src/platform/node/globalThis.ts","../../../node_modules/@opentelemetry/core/src/common/hex-to-binary.ts","../../../node_modules/@opentelemetry/core/src/platform/node/hex-to-base64.ts","../../../node_modules/@opentelemetry/core/src/platform/node/RandomIdGenerator.ts","../../../node_modules/@opentelemetry/core/src/platform/node/performance.ts","../../../node_modules/@opentelemetry/core/src/version.ts","../../../node_modules/@opentelemetry/core/src/platform/node/sdk-info.ts","../../../node_modules/@opentelemetry/core/src/platform/node/timer-util.ts","../../../node_modules/@opentelemetry/core/src/platform/node/index.ts","../../../node_modules/@opentelemetry/core/src/platform/index.ts","../../../node_modules/@opentelemetry/core/src/common/time.ts","../../../node_modules/@opentelemetry/core/src/common/types.ts","../../../node_modules/@opentelemetry/core/src/ExportResult.ts","../../../node_modules/@opentelemetry/core/src/propagation/composite.ts","../../../node_modules/@opentelemetry/core/src/internal/validators.ts","../../../node_modules/@opentelemetry/core/src/trace/TraceState.ts","../../../node_modules/@opentelemetry/core/src/trace/W3CTraceContextPropagator.ts","../../../node_modules/@opentelemetry/core/src/trace/IdGenerator.ts","../../../node_modules/@opentelemetry/core/src/trace/rpc-metadata.ts","../../../node_modules/@opentelemetry/core/src/trace/sampler/AlwaysOffSampler.ts","../../../node_modules/@opentelemetry/core/src/trace/sampler/AlwaysOnSampler.ts","../../../node_modules/@opentelemetry/core/src/trace/sampler/ParentBasedSampler.ts","../../../node_modules/@opentelemetry/core/src/trace/sampler/TraceIdRatioBasedSampler.ts","../../../node_modules/@opentelemetry/core/src/utils/lodash.merge.ts","../../../node_modules/@opentelemetry/core/src/utils/merge.ts","../../../node_modules/@opentelemetry/core/src/utils/timeout.ts","../../../node_modules/@opentelemetry/core/src/utils/url.ts","../../../node_modules/@opentelemetry/core/src/utils/wrap.ts","../../../node_modules/@opentelemetry/core/src/utils/promise.ts","../../../node_modules/@opentelemetry/core/src/utils/callback.ts","../../../node_modules/@opentelemetry/core/src/internal/exporter.ts","../../../node_modules/@opentelemetry/core/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-http/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-http/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-http/src/version.ts","../../../node_modules/@opentelemetry/api-logs/src/types/Logger.ts","../../../node_modules/@opentelemetry/api-logs/src/types/LoggerProvider.ts","../../../node_modules/@opentelemetry/api-logs/src/types/LogRecord.ts","../../../node_modules/@opentelemetry/api-logs/build/esm/types/LoggerOptions.js","../../../node_modules/@opentelemetry/api-logs/src/types/AnyValue.ts","../../../node_modules/@opentelemetry/api-logs/src/NoopLogger.ts","../../../node_modules/@opentelemetry/api-logs/src/NoopLoggerProvider.ts","../../../node_modules/@opentelemetry/api-logs/src/platform/node/globalThis.ts","../../../node_modules/@opentelemetry/api-logs/src/platform/node/index.ts","../../../node_modules/@opentelemetry/api-logs/src/platform/index.ts","../../../node_modules/@opentelemetry/api-logs/src/internal/global-utils.ts","../../../node_modules/@opentelemetry/api-logs/src/api/logs.ts","../../../node_modules/@opentelemetry/api-logs/src/index.ts","../../../node_modules/@opentelemetry/instrumentation/src/autoLoaderUtils.ts","../../../node_modules/@opentelemetry/instrumentation/src/autoLoader.ts","../../../node_modules/shimmer/index.js","../../../node_modules/@opentelemetry/instrumentation/src/instrumentation.ts","../../../node_modules/resolve/lib/homedir.js","../../../node_modules/resolve/lib/caller.js","../../../node_modules/path-parse/index.js","../../../node_modules/resolve/lib/node-modules-paths.js","../../../node_modules/resolve/lib/normalize-options.js","../../../node_modules/function-bind/implementation.js","../../../node_modules/function-bind/index.js","../../../node_modules/hasown/index.js","../../../node_modules/is-core-module/core.json","../../../node_modules/is-core-module/index.js","../../../node_modules/resolve/lib/async.js","../../../node_modules/resolve/lib/core.json","../../../node_modules/resolve/lib/core.js","../../../node_modules/resolve/lib/is-core.js","../../../node_modules/resolve/lib/sync.js","../../../node_modules/resolve/index.js","../../../node_modules/module-details-from-path/index.js","../../../node_modules/require-in-the-middle/package.json","../../../node_modules/require-in-the-middle/index.js","../../../node_modules/@opentelemetry/instrumentation/src/platform/node/ModuleNameTrie.ts","../../../node_modules/@opentelemetry/instrumentation/src/platform/node/RequireInTheMiddleSingleton.ts","../../../node_modules/import-in-the-middle/lib/register.js","../../../node_modules/import-in-the-middle/index.js","../../../node_modules/@opentelemetry/instrumentation/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation/src/platform/node/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation/src/platform/node/normalize.ts","../../../node_modules/@opentelemetry/instrumentation/src/platform/node/index.ts","../../../node_modules/@opentelemetry/instrumentation/src/platform/index.ts","../../../node_modules/@opentelemetry/instrumentation/src/instrumentationNodeModuleDefinition.ts","../../../node_modules/@opentelemetry/instrumentation/src/instrumentationNodeModuleFile.ts","../../../node_modules/@opentelemetry/instrumentation/src/types.ts","../../../node_modules/@opentelemetry/instrumentation/src/types_internal.ts","../../../node_modules/@opentelemetry/instrumentation/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-http/src/http.ts","../../../node_modules/@opentelemetry/instrumentation-http/build/src/types.js","../../../node_modules/@opentelemetry/instrumentation-http/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-express/src/enums/ExpressLayerType.ts","../../../node_modules/@opentelemetry/instrumentation-express/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-express/src/internal-types.ts","../../../node_modules/@opentelemetry/instrumentation-express/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-express/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-express/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-express/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-fastify/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-fastify/src/constants.ts","../../../node_modules/@opentelemetry/instrumentation-fastify/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-fastify/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-fastify/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-fastify/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-graphql/src/enum.ts","../../../node_modules/@opentelemetry/instrumentation-graphql/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-graphql/src/symbols.ts","../../../node_modules/@opentelemetry/instrumentation-graphql/src/internal-types.ts","../../../node_modules/@opentelemetry/instrumentation-graphql/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-graphql/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-graphql/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-graphql/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-mongodb/src/internal-types.ts","../../../node_modules/@opentelemetry/instrumentation-mongodb/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-mongodb/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-mongodb/src/types.ts","../../../node_modules/@opentelemetry/instrumentation-mongodb/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-mongoose/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-mongoose/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-mongoose/src/mongoose.ts","../../../node_modules/@opentelemetry/instrumentation-mongoose/build/src/types.js","../../../node_modules/@opentelemetry/instrumentation-mongoose/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-mysql/src/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-mysql/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-mysql/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-mysql/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-mysql/src/index.ts","../../../node_modules/@opentelemetry/sql-common/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-mysql2/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-mysql2/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-mysql2/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-mysql2/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-ioredis/src/utils.ts","../../../node_modules/@opentelemetry/redis-common/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-ioredis/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-ioredis/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-ioredis/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-redis-4/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-redis-4/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-redis-4/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-redis-4/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-nestjs-core/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-nestjs-core/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-nestjs-core/src/enums/NestType.ts","../../../node_modules/@opentelemetry/instrumentation-nestjs-core/src/enums/index.ts","../../../node_modules/@opentelemetry/instrumentation-nestjs-core/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-nestjs-core/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-pg/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-pg/src/enums/SpanNames.ts","../../../node_modules/@opentelemetry/instrumentation-pg/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-pg/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-pg/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-pg/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-hapi/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-hapi/src/internal-types.ts","../../../node_modules/@opentelemetry/instrumentation-hapi/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-hapi/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-hapi/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-hapi/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-koa/src/types.ts","../../../node_modules/@opentelemetry/instrumentation-koa/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-koa/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-koa/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-koa/src/internal-types.ts","../../../node_modules/@opentelemetry/instrumentation-koa/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-koa/src/index.ts","../../../node_modules/@opentelemetry/instrumentation-connect/src/enums/AttributeNames.ts","../../../node_modules/@opentelemetry/instrumentation-connect/src/version.ts","../../../node_modules/@opentelemetry/instrumentation-connect/src/internal-types.ts","../../../node_modules/@opentelemetry/instrumentation-connect/src/utils.ts","../../../node_modules/@opentelemetry/instrumentation-connect/src/instrumentation.ts","../../../node_modules/@opentelemetry/instrumentation-connect/src/index.ts","../../cli-error-reporting/src/create-error-handler.tsx","../../cli-debug-log/src/index.tsx","../../cli-http-client/src/extract-error.ts","../../cli-http-client/src/error-info.ts","../../cli-error-reporting/src/components/ErrorViewer.ts","../../cli-error-reporting/src/get-error-component.tsx","../../../node_modules/outdent/src/index.ts","../../cli-error-reporting/src/components/ErrorMessage.tsx","../../cli-error-reporting/src/error-reporter.ts","../../../node_modules/@sentry/node/build/esm/index.js","../../../node_modules/@sentry/opentelemetry/src/utils/spanTypes.ts","../../../node_modules/@sentry/opentelemetry/src/utils/getRequestSpanData.ts","../../../node_modules/@sentry/opentelemetry/src/custom/client.ts","../../../node_modules/@sentry/opentelemetry/src/utils/getSpanKind.ts","../../../node_modules/@sentry/opentelemetry/src/constants.ts","../../../node_modules/@sentry/opentelemetry/src/utils/contextData.ts","../../../node_modules/@sentry/opentelemetry/src/utils/isSentryRequest.ts","../../../node_modules/@sentry/opentelemetry/src/utils/parseSpanDescription.ts","../../../node_modules/@sentry/opentelemetry/src/utils/enhanceDscWithOpenTelemetryRootSpanName.ts","../../../node_modules/@sentry/opentelemetry/src/utils/makeTraceState.ts","../../../node_modules/@sentry/opentelemetry/src/utils/generateSpanContextForPropagationContext.ts","../../../node_modules/@sentry/opentelemetry/src/utils/getActiveSpan.ts","../../../node_modules/@sentry/opentelemetry/src/debug-build.ts","../../../node_modules/@sentry/opentelemetry/src/utils/getSamplingDecision.ts","../../../node_modules/@sentry/opentelemetry/src/utils/setupCheck.ts","../../../node_modules/@sentry/opentelemetry/src/propagator.ts","../../../node_modules/@sentry/opentelemetry/src/trace.ts","../../../node_modules/@sentry/opentelemetry/src/utils/suppressTracing.ts","../../../node_modules/@sentry/opentelemetry/src/setupEventContextTrace.ts","../../../node_modules/@sentry/opentelemetry/src/asyncContextStrategy.ts","../../../node_modules/@sentry/opentelemetry/src/contextManager.ts","../../../node_modules/@sentry/opentelemetry/src/semanticAttributes.ts","../../../node_modules/@sentry/opentelemetry/src/utils/groupSpansWithParents.ts","../../../node_modules/@sentry/opentelemetry/src/utils/mapStatus.ts","../../../node_modules/@sentry/opentelemetry/src/spanExporter.ts","../../../node_modules/@sentry/opentelemetry/src/spanProcessor.ts","../../../node_modules/@sentry/opentelemetry/src/sampler.ts","../../../node_modules/@sentry/opentelemetry/src/instrumentation.ts","../../../node_modules/@sentry/node/src/sdk/scope.ts","../../../node_modules/@sentry/node/src/utils/addOriginToSpan.ts","../../../node_modules/@sentry/node/src/utils/getRequestUrl.ts","../../../node_modules/@sentry/node/src/integrations/http.ts","../../../node_modules/@sentry/node/src/debug-build.ts","../../../node_modules/@sentry/node/src/nodeVersion.ts","../../../node_modules/@sentry/node/src/integrations/node-fetch.ts","../../../node_modules/@sentry/node/src/integrations/console.ts","../../../node_modules/@sentry/node/src/integrations/context.ts","../../../node_modules/@sentry/node/src/integrations/contextlines.ts","../../../node_modules/@sentry/node/src/integrations/local-variables/common.ts","../../../node_modules/@sentry/node/src/integrations/local-variables/local-variables-async.ts","../../../node_modules/@sentry/node/src/integrations/local-variables/local-variables-sync.ts","../../../node_modules/@sentry/node/src/integrations/local-variables/index.ts","../../../node_modules/@sentry/node/src/integrations/modules.ts","../../../node_modules/@sentry/node/src/utils/errorhandling.ts","../../../node_modules/@sentry/node/src/integrations/onuncaughtexception.ts","../../../node_modules/@sentry/node/src/integrations/onunhandledrejection.ts","../../../node_modules/@sentry/node/src/otel/instrument.ts","../../../node_modules/@sentry/node/src/utils/commonjs.ts","../../../node_modules/@sentry/node/src/integrations/tracing/express.ts","../../../node_modules/@sentry/node/src/integrations/tracing/fastify.ts","../../../node_modules/@sentry/node/src/integrations/tracing/graphql.ts","../../../node_modules/@sentry/node/src/integrations/tracing/mongo.ts","../../../node_modules/@sentry/node/src/integrations/tracing/mongoose.ts","../../../node_modules/@sentry/node/src/integrations/tracing/mysql.ts","../../../node_modules/@sentry/node/src/integrations/tracing/mysql2.ts","../../../node_modules/@sentry/node/src/utils/redisCache.ts","../../../node_modules/@sentry/node/src/integrations/tracing/redis.ts","../../../node_modules/@sentry/node/src/integrations/tracing/nest.ts","../../../node_modules/@sentry/node/src/integrations/tracing/postgres.ts","../../../node_modules/@sentry/node/src/integrations/tracing/hapi/index.ts","../../../node_modules/@sentry/node/src/integrations/tracing/koa.ts","../../../node_modules/@sentry/node/src/integrations/tracing/connect.ts","../../../node_modules/@sentry/node/src/integrations/tracing/index.ts","../../../node_modules/@sentry/node/src/proxy/base.ts","../../../node_modules/@sentry/node/src/proxy/parse-proxy-response.ts","../../../node_modules/@sentry/node/src/proxy/index.ts","../../../node_modules/@sentry/node/src/transports/http.ts","../../../node_modules/@sentry/node/src/utils/module.ts","../../../node_modules/@sentry/node/src/sdk/api.ts","../../../node_modules/@sentry/node/src/sdk/client.ts","../../../node_modules/@sentry/node/src/sdk/index.ts","../../cli-error-reporting/src/user-feedback.tsx","../../cli-fs-cache/src/index.ts","../../cli-error-reporting/src/components/UserFeedback/Form.tsx","../../cli-error-reporting/src/components/UserFeedback/ContactUs.tsx","../../cli-error-reporting/src/components/UserFeedback/Fallback.tsx","../../cli-error-reporting/src/messages.json","../../cli-error-reporting/src/error-reporter-context.tsx","../../cli-error-reporting/src/index.ts","../../cli-telemetry-react/src/useBi.tsx","../../cli-telemetry-react/src/index.ts"],"sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Context, createContextKey } from '@opentelemetry/api';\n\nconst SUPPRESS_TRACING_KEY = createContextKey(\n  'OpenTelemetry SDK Context Key SUPPRESS_TRACING'\n);\n\nexport function suppressTracing(context: Context): Context {\n  return context.setValue(SUPPRESS_TRACING_KEY, true);\n}\n\nexport function unsuppressTracing(context: Context): Context {\n  return context.deleteValue(SUPPRESS_TRACING_KEY);\n}\n\nexport function isTracingSuppressed(context: Context): boolean {\n  return context.getValue(SUPPRESS_TRACING_KEY) === true;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const BAGGAGE_KEY_PAIR_SEPARATOR = '=';\nexport const BAGGAGE_PROPERTIES_SEPARATOR = ';';\nexport const BAGGAGE_ITEMS_SEPARATOR = ',';\n\n// Name of the http header used to propagate the baggage\nexport const BAGGAGE_HEADER = 'baggage';\n// Maximum number of name-value pairs allowed by w3c spec\nexport const BAGGAGE_MAX_NAME_VALUE_PAIRS = 180;\n// Maximum number of bytes per a single name-value pair allowed by w3c spec\nexport const BAGGAGE_MAX_PER_NAME_VALUE_PAIRS = 4096;\n// Maximum total length of all name-value pairs allowed by w3c spec\nexport const BAGGAGE_MAX_TOTAL_LENGTH = 8192;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  Baggage,\n  BaggageEntryMetadata,\n  baggageEntryMetadataFromString,\n} from '@opentelemetry/api';\nimport {\n  BAGGAGE_ITEMS_SEPARATOR,\n  BAGGAGE_PROPERTIES_SEPARATOR,\n  BAGGAGE_KEY_PAIR_SEPARATOR,\n  BAGGAGE_MAX_TOTAL_LENGTH,\n} from './constants';\n\ntype ParsedBaggageKeyValue = {\n  key: string;\n  value: string;\n  metadata: BaggageEntryMetadata | undefined;\n};\n\nexport function serializeKeyPairs(keyPairs: string[]): string {\n  return keyPairs.reduce((hValue: string, current: string) => {\n    const value = `${hValue}${\n      hValue !== '' ? BAGGAGE_ITEMS_SEPARATOR : ''\n    }${current}`;\n    return value.length > BAGGAGE_MAX_TOTAL_LENGTH ? hValue : value;\n  }, '');\n}\n\nexport function getKeyPairs(baggage: Baggage): string[] {\n  return baggage.getAllEntries().map(([key, value]) => {\n    let entry = `${encodeURIComponent(key)}=${encodeURIComponent(value.value)}`;\n\n    // include opaque metadata if provided\n    // NOTE: we intentionally don't URI-encode the metadata - that responsibility falls on the metadata implementation\n    if (value.metadata !== undefined) {\n      entry += BAGGAGE_PROPERTIES_SEPARATOR + value.metadata.toString();\n    }\n\n    return entry;\n  });\n}\n\nexport function parsePairKeyValue(\n  entry: string\n): ParsedBaggageKeyValue | undefined {\n  const valueProps = entry.split(BAGGAGE_PROPERTIES_SEPARATOR);\n  if (valueProps.length <= 0) return;\n  const keyPairPart = valueProps.shift();\n  if (!keyPairPart) return;\n  const separatorIndex = keyPairPart.indexOf(BAGGAGE_KEY_PAIR_SEPARATOR);\n  if (separatorIndex <= 0) return;\n  const key = decodeURIComponent(\n    keyPairPart.substring(0, separatorIndex).trim()\n  );\n  const value = decodeURIComponent(\n    keyPairPart.substring(separatorIndex + 1).trim()\n  );\n  let metadata;\n  if (valueProps.length > 0) {\n    metadata = baggageEntryMetadataFromString(\n      valueProps.join(BAGGAGE_PROPERTIES_SEPARATOR)\n    );\n  }\n  return { key, value, metadata };\n}\n\n/**\n * Parse a string serialized in the baggage HTTP Format (without metadata):\n * https://github.com/w3c/baggage/blob/master/baggage/HTTP_HEADER_FORMAT.md\n */\nexport function parseKeyPairsIntoRecord(\n  value?: string\n): Record<string, string> {\n  if (typeof value !== 'string' || value.length === 0) return {};\n  return value\n    .split(BAGGAGE_ITEMS_SEPARATOR)\n    .map(entry => {\n      return parsePairKeyValue(entry);\n    })\n    .filter(keyPair => keyPair !== undefined && keyPair.value.length > 0)\n    .reduce<Record<string, string>>((headers, keyPair) => {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      headers[keyPair!.key] = keyPair!.value;\n      return headers;\n    }, {});\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BaggageEntry,\n  Context,\n  propagation,\n  TextMapGetter,\n  TextMapPropagator,\n  TextMapSetter,\n} from '@opentelemetry/api';\n\nimport { isTracingSuppressed } from '../../trace/suppress-tracing';\nimport {\n  BAGGAGE_HEADER,\n  BAGGAGE_ITEMS_SEPARATOR,\n  BAGGAGE_MAX_NAME_VALUE_PAIRS,\n  BAGGAGE_MAX_PER_NAME_VALUE_PAIRS,\n} from '../constants';\nimport { getKeyPairs, parsePairKeyValue, serializeKeyPairs } from '../utils';\n\n/**\n * Propagates {@link Baggage} through Context format propagation.\n *\n * Based on the Baggage specification:\n * https://w3c.github.io/baggage/\n */\nexport class W3CBaggagePropagator implements TextMapPropagator {\n  inject(context: Context, carrier: unknown, setter: TextMapSetter): void {\n    const baggage = propagation.getBaggage(context);\n    if (!baggage || isTracingSuppressed(context)) return;\n    const keyPairs = getKeyPairs(baggage)\n      .filter((pair: string) => {\n        return pair.length <= BAGGAGE_MAX_PER_NAME_VALUE_PAIRS;\n      })\n      .slice(0, BAGGAGE_MAX_NAME_VALUE_PAIRS);\n    const headerValue = serializeKeyPairs(keyPairs);\n    if (headerValue.length > 0) {\n      setter.set(carrier, BAGGAGE_HEADER, headerValue);\n    }\n  }\n\n  extract(context: Context, carrier: unknown, getter: TextMapGetter): Context {\n    const headerValue = getter.get(carrier, BAGGAGE_HEADER);\n    const baggageString = Array.isArray(headerValue)\n      ? headerValue.join(BAGGAGE_ITEMS_SEPARATOR)\n      : headerValue;\n    if (!baggageString) return context;\n    const baggage: Record<string, BaggageEntry> = {};\n    if (baggageString.length === 0) {\n      return context;\n    }\n    const pairs = baggageString.split(BAGGAGE_ITEMS_SEPARATOR);\n    pairs.forEach(entry => {\n      const keyPair = parsePairKeyValue(entry);\n      if (keyPair) {\n        const baggageEntry: BaggageEntry = { value: keyPair.value };\n        if (keyPair.metadata) {\n          baggageEntry.metadata = keyPair.metadata;\n        }\n        baggage[keyPair.key] = baggageEntry;\n      }\n    });\n    if (Object.entries(baggage).length === 0) {\n      return context;\n    }\n    return propagation.setBaggage(context, propagation.createBaggage(baggage));\n  }\n\n  fields(): string[] {\n    return [BAGGAGE_HEADER];\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface Clock {\n  /**\n   * Return the current time in milliseconds from some epoch such as the Unix epoch or process start\n   */\n  now(): number;\n}\n\n/**\n * A utility for returning wall times anchored to a given point in time. Wall time measurements will\n * not be taken from the system, but instead are computed by adding a monotonic clock time\n * to the anchor point.\n *\n * This is needed because the system time can change and result in unexpected situations like\n * spans ending before they are started. Creating an anchored clock for each local root span\n * ensures that span timings and durations are accurate while preventing span times from drifting\n * too far from the system clock.\n *\n * Only creating an anchored clock once per local trace ensures span times are correct relative\n * to each other. For example, a child span will never have a start time before its parent even\n * if the system clock is corrected during the local trace.\n *\n * Heavily inspired by the OTel Java anchored clock\n * https://github.com/open-telemetry/opentelemetry-java/blob/main/sdk/trace/src/main/java/io/opentelemetry/sdk/trace/AnchoredClock.java\n */\nexport class AnchoredClock implements Clock {\n  private _monotonicClock: Clock;\n  private _epochMillis: number;\n  private _performanceMillis: number;\n\n  /**\n   * Create a new AnchoredClock anchored to the current time returned by systemClock.\n   *\n   * @param systemClock should be a clock that returns the number of milliseconds since January 1 1970 such as Date\n   * @param monotonicClock should be a clock that counts milliseconds monotonically such as window.performance or perf_hooks.performance\n   */\n  public constructor(systemClock: Clock, monotonicClock: Clock) {\n    this._monotonicClock = monotonicClock;\n    this._epochMillis = systemClock.now();\n    this._performanceMillis = monotonicClock.now();\n  }\n\n  /**\n   * Returns the current time by adding the number of milliseconds since the\n   * AnchoredClock was created to the creation epoch time\n   */\n  public now(): number {\n    const delta = this._monotonicClock.now() - this._performanceMillis;\n    return this._epochMillis + delta;\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { diag, SpanAttributeValue, SpanAttributes } from '@opentelemetry/api';\n\nexport function sanitizeAttributes(attributes: unknown): SpanAttributes {\n  const out: SpanAttributes = {};\n\n  if (typeof attributes !== 'object' || attributes == null) {\n    return out;\n  }\n\n  for (const [key, val] of Object.entries(attributes)) {\n    if (!isAttributeKey(key)) {\n      diag.warn(`Invalid attribute key: ${key}`);\n      continue;\n    }\n    if (!isAttributeValue(val)) {\n      diag.warn(`Invalid attribute value set for key: ${key}`);\n      continue;\n    }\n    if (Array.isArray(val)) {\n      out[key] = val.slice();\n    } else {\n      out[key] = val;\n    }\n  }\n\n  return out;\n}\n\nexport function isAttributeKey(key: unknown): key is string {\n  return typeof key === 'string' && key.length > 0;\n}\n\nexport function isAttributeValue(val: unknown): val is SpanAttributeValue {\n  if (val == null) {\n    return true;\n  }\n\n  if (Array.isArray(val)) {\n    return isHomogeneousAttributeValueArray(val);\n  }\n\n  return isValidPrimitiveAttributeValue(val);\n}\n\nfunction isHomogeneousAttributeValueArray(arr: unknown[]): boolean {\n  let type: string | undefined;\n\n  for (const element of arr) {\n    // null/undefined elements are allowed\n    if (element == null) continue;\n\n    if (!type) {\n      if (isValidPrimitiveAttributeValue(element)) {\n        type = typeof element;\n        continue;\n      }\n      // encountered an invalid primitive\n      return false;\n    }\n\n    if (typeof element === type) {\n      continue;\n    }\n\n    return false;\n  }\n\n  return true;\n}\n\nfunction isValidPrimitiveAttributeValue(val: unknown): boolean {\n  switch (typeof val) {\n    case 'number':\n    case 'boolean':\n    case 'string':\n      return true;\n  }\n\n  return false;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { diag, Exception } from '@opentelemetry/api';\nimport { ErrorHandler } from './types';\n\n/**\n * Returns a function that logs an error using the provided logger, or a\n * console logger if one was not provided.\n */\nexport function loggingErrorHandler(): ErrorHandler {\n  return (ex: Exception) => {\n    diag.error(stringifyException(ex));\n  };\n}\n\n/**\n * Converts an exception into a string representation\n * @param {Exception} ex\n */\nfunction stringifyException(ex: Exception | string): string {\n  if (typeof ex === 'string') {\n    return ex;\n  } else {\n    return JSON.stringify(flattenException(ex));\n  }\n}\n\n/**\n * Flattens an exception into key-value pairs by traversing the prototype chain\n * and coercing values to strings. Duplicate properties will not be overwritten;\n * the first insert wins.\n */\nfunction flattenException(ex: Exception): Record<string, string> {\n  const result = {} as Record<string, string>;\n  let current = ex;\n\n  while (current !== null) {\n    Object.getOwnPropertyNames(current).forEach(propertyName => {\n      if (result[propertyName]) return;\n      const value = current[propertyName as keyof typeof current];\n      if (value) {\n        result[propertyName] = String(value);\n      }\n    });\n    current = Object.getPrototypeOf(current);\n  }\n\n  return result;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Exception } from '@opentelemetry/api';\nimport { loggingErrorHandler } from './logging-error-handler';\nimport { ErrorHandler } from './types';\n\n/** The global error handler delegate */\nlet delegateHandler = loggingErrorHandler();\n\n/**\n * Set the global error handler\n * @param {ErrorHandler} handler\n */\nexport function setGlobalErrorHandler(handler: ErrorHandler): void {\n  delegateHandler = handler;\n}\n\n/**\n * Return the global error handler\n * @param {Exception} ex\n */\nexport function globalErrorHandler(ex: Exception): void {\n  try {\n    delegateHandler(ex);\n  } catch {} // eslint-disable-line no-empty\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum TracesSamplerValues {\n  AlwaysOff = 'always_off',\n  AlwaysOn = 'always_on',\n  ParentBasedAlwaysOff = 'parentbased_always_off',\n  ParentBasedAlwaysOn = 'parentbased_always_on',\n  ParentBasedTraceIdRatio = 'parentbased_traceidratio',\n  TraceIdRatio = 'traceidratio',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DiagLogLevel } from '@opentelemetry/api';\nimport { TracesSamplerValues } from './sampling';\n\nconst DEFAULT_LIST_SEPARATOR = ',';\n\n/**\n * Environment interface to define all names\n */\n\nconst ENVIRONMENT_BOOLEAN_KEYS = ['OTEL_SDK_DISABLED'] as const;\n\ntype ENVIRONMENT_BOOLEANS = {\n  [K in (typeof ENVIRONMENT_BOOLEAN_KEYS)[number]]?: boolean;\n};\n\nfunction isEnvVarABoolean(key: unknown): key is keyof ENVIRONMENT_BOOLEANS {\n  return (\n    ENVIRONMENT_BOOLEAN_KEYS.indexOf(key as keyof ENVIRONMENT_BOOLEANS) > -1\n  );\n}\n\nconst ENVIRONMENT_NUMBERS_KEYS = [\n  'OTEL_BSP_EXPORT_TIMEOUT',\n  'OTEL_BSP_MAX_EXPORT_BATCH_SIZE',\n  'OTEL_BSP_MAX_QUEUE_SIZE',\n  'OTEL_BSP_SCHEDULE_DELAY',\n  'OTEL_BLRP_EXPORT_TIMEOUT',\n  'OTEL_BLRP_MAX_EXPORT_BATCH_SIZE',\n  'OTEL_BLRP_MAX_QUEUE_SIZE',\n  'OTEL_BLRP_SCHEDULE_DELAY',\n  'OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT',\n  'OTEL_ATTRIBUTE_COUNT_LIMIT',\n  'OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT',\n  'OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT',\n  'OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT',\n  'OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT',\n  'OTEL_SPAN_EVENT_COUNT_LIMIT',\n  'OTEL_SPAN_LINK_COUNT_LIMIT',\n  'OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT',\n  'OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT',\n  'OTEL_EXPORTER_OTLP_TIMEOUT',\n  'OTEL_EXPORTER_OTLP_TRACES_TIMEOUT',\n  'OTEL_EXPORTER_OTLP_METRICS_TIMEOUT',\n  'OTEL_EXPORTER_OTLP_LOGS_TIMEOUT',\n  'OTEL_EXPORTER_JAEGER_AGENT_PORT',\n] as const;\n\ntype ENVIRONMENT_NUMBERS = {\n  [K in (typeof ENVIRONMENT_NUMBERS_KEYS)[number]]?: number;\n};\n\nfunction isEnvVarANumber(key: unknown): key is keyof ENVIRONMENT_NUMBERS {\n  return (\n    ENVIRONMENT_NUMBERS_KEYS.indexOf(key as keyof ENVIRONMENT_NUMBERS) > -1\n  );\n}\n\nconst ENVIRONMENT_LISTS_KEYS = [\n  'OTEL_NO_PATCH_MODULES',\n  'OTEL_PROPAGATORS',\n] as const;\n\ntype ENVIRONMENT_LISTS = {\n  [K in (typeof ENVIRONMENT_LISTS_KEYS)[number]]?: string[];\n};\n\nfunction isEnvVarAList(key: unknown): key is keyof ENVIRONMENT_LISTS {\n  return ENVIRONMENT_LISTS_KEYS.indexOf(key as keyof ENVIRONMENT_LISTS) > -1;\n}\n\nexport type ENVIRONMENT = {\n  CONTAINER_NAME?: string;\n  ECS_CONTAINER_METADATA_URI_V4?: string;\n  ECS_CONTAINER_METADATA_URI?: string;\n  HOSTNAME?: string;\n  KUBERNETES_SERVICE_HOST?: string;\n  NAMESPACE?: string;\n  OTEL_EXPORTER_JAEGER_AGENT_HOST?: string;\n  OTEL_EXPORTER_JAEGER_ENDPOINT?: string;\n  OTEL_EXPORTER_JAEGER_PASSWORD?: string;\n  OTEL_EXPORTER_JAEGER_USER?: string;\n  OTEL_EXPORTER_OTLP_ENDPOINT?: string;\n  OTEL_EXPORTER_OTLP_TRACES_ENDPOINT?: string;\n  OTEL_EXPORTER_OTLP_METRICS_ENDPOINT?: string;\n  OTEL_EXPORTER_OTLP_LOGS_ENDPOINT?: string;\n  OTEL_EXPORTER_OTLP_HEADERS?: string;\n  OTEL_EXPORTER_OTLP_TRACES_HEADERS?: string;\n  OTEL_EXPORTER_OTLP_METRICS_HEADERS?: string;\n  OTEL_EXPORTER_OTLP_LOGS_HEADERS?: string;\n  OTEL_EXPORTER_ZIPKIN_ENDPOINT?: string;\n  OTEL_LOG_LEVEL?: DiagLogLevel;\n  OTEL_RESOURCE_ATTRIBUTES?: string;\n  OTEL_SERVICE_NAME?: string;\n  OTEL_TRACES_EXPORTER?: string;\n  OTEL_TRACES_SAMPLER_ARG?: string;\n  OTEL_TRACES_SAMPLER?: string;\n  OTEL_LOGS_EXPORTER?: string;\n  OTEL_EXPORTER_OTLP_INSECURE?: string;\n  OTEL_EXPORTER_OTLP_TRACES_INSECURE?: string;\n  OTEL_EXPORTER_OTLP_METRICS_INSECURE?: string;\n  OTEL_EXPORTER_OTLP_LOGS_INSECURE?: string;\n  OTEL_EXPORTER_OTLP_CERTIFICATE?: string;\n  OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE?: string;\n  OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE?: string;\n  OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE?: string;\n  OTEL_EXPORTER_OTLP_COMPRESSION?: string;\n  OTEL_EXPORTER_OTLP_TRACES_COMPRESSION?: string;\n  OTEL_EXPORTER_OTLP_METRICS_COMPRESSION?: string;\n  OTEL_EXPORTER_OTLP_LOGS_COMPRESSION?: string;\n  OTEL_EXPORTER_OTLP_CLIENT_KEY?: string;\n  OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY?: string;\n  OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY?: string;\n  OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY?: string;\n  OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE?: string;\n  OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE?: string;\n  OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE?: string;\n  OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE?: string;\n  OTEL_EXPORTER_OTLP_PROTOCOL?: string;\n  OTEL_EXPORTER_OTLP_TRACES_PROTOCOL?: string;\n  OTEL_EXPORTER_OTLP_METRICS_PROTOCOL?: string;\n  OTEL_EXPORTER_OTLP_LOGS_PROTOCOL?: string;\n  OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE?: string;\n} & ENVIRONMENT_BOOLEANS &\n  ENVIRONMENT_NUMBERS &\n  ENVIRONMENT_LISTS;\n\nexport type RAW_ENVIRONMENT = {\n  [key: string]: string | number | undefined | string[];\n};\n\nexport const DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT = Infinity;\n\nexport const DEFAULT_ATTRIBUTE_COUNT_LIMIT = 128;\n\nexport const DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT = 128;\nexport const DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT = 128;\n\n/**\n * Default environment variables\n */\nexport const DEFAULT_ENVIRONMENT: Required<ENVIRONMENT> = {\n  OTEL_SDK_DISABLED: false,\n  CONTAINER_NAME: '',\n  ECS_CONTAINER_METADATA_URI_V4: '',\n  ECS_CONTAINER_METADATA_URI: '',\n  HOSTNAME: '',\n  KUBERNETES_SERVICE_HOST: '',\n  NAMESPACE: '',\n  OTEL_BSP_EXPORT_TIMEOUT: 30000,\n  OTEL_BSP_MAX_EXPORT_BATCH_SIZE: 512,\n  OTEL_BSP_MAX_QUEUE_SIZE: 2048,\n  OTEL_BSP_SCHEDULE_DELAY: 5000,\n  OTEL_BLRP_EXPORT_TIMEOUT: 30000,\n  OTEL_BLRP_MAX_EXPORT_BATCH_SIZE: 512,\n  OTEL_BLRP_MAX_QUEUE_SIZE: 2048,\n  OTEL_BLRP_SCHEDULE_DELAY: 5000,\n  OTEL_EXPORTER_JAEGER_AGENT_HOST: '',\n  OTEL_EXPORTER_JAEGER_AGENT_PORT: 6832,\n  OTEL_EXPORTER_JAEGER_ENDPOINT: '',\n  OTEL_EXPORTER_JAEGER_PASSWORD: '',\n  OTEL_EXPORTER_JAEGER_USER: '',\n  OTEL_EXPORTER_OTLP_ENDPOINT: '',\n  OTEL_EXPORTER_OTLP_TRACES_ENDPOINT: '',\n  OTEL_EXPORTER_OTLP_METRICS_ENDPOINT: '',\n  OTEL_EXPORTER_OTLP_LOGS_ENDPOINT: '',\n  OTEL_EXPORTER_OTLP_HEADERS: '',\n  OTEL_EXPORTER_OTLP_TRACES_HEADERS: '',\n  OTEL_EXPORTER_OTLP_METRICS_HEADERS: '',\n  OTEL_EXPORTER_OTLP_LOGS_HEADERS: '',\n  OTEL_EXPORTER_OTLP_TIMEOUT: 10000,\n  OTEL_EXPORTER_OTLP_TRACES_TIMEOUT: 10000,\n  OTEL_EXPORTER_OTLP_METRICS_TIMEOUT: 10000,\n  OTEL_EXPORTER_OTLP_LOGS_TIMEOUT: 10000,\n  OTEL_EXPORTER_ZIPKIN_ENDPOINT: 'http://localhost:9411/api/v2/spans',\n  OTEL_LOG_LEVEL: DiagLogLevel.INFO,\n  OTEL_NO_PATCH_MODULES: [],\n  OTEL_PROPAGATORS: ['tracecontext', 'baggage'],\n  OTEL_RESOURCE_ATTRIBUTES: '',\n  OTEL_SERVICE_NAME: '',\n  OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT: DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,\n  OTEL_ATTRIBUTE_COUNT_LIMIT: DEFAULT_ATTRIBUTE_COUNT_LIMIT,\n  OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT: DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,\n  OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT: DEFAULT_ATTRIBUTE_COUNT_LIMIT,\n  OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:\n    DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT,\n  OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT: DEFAULT_ATTRIBUTE_COUNT_LIMIT,\n  OTEL_SPAN_EVENT_COUNT_LIMIT: 128,\n  OTEL_SPAN_LINK_COUNT_LIMIT: 128,\n  OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:\n    DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,\n  OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:\n    DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT,\n  OTEL_TRACES_EXPORTER: '',\n  OTEL_TRACES_SAMPLER: TracesSamplerValues.ParentBasedAlwaysOn,\n  OTEL_TRACES_SAMPLER_ARG: '',\n  OTEL_LOGS_EXPORTER: '',\n  OTEL_EXPORTER_OTLP_INSECURE: '',\n  OTEL_EXPORTER_OTLP_TRACES_INSECURE: '',\n  OTEL_EXPORTER_OTLP_METRICS_INSECURE: '',\n  OTEL_EXPORTER_OTLP_LOGS_INSECURE: '',\n  OTEL_EXPORTER_OTLP_CERTIFICATE: '',\n  OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE: '',\n  OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE: '',\n  OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE: '',\n  OTEL_EXPORTER_OTLP_COMPRESSION: '',\n  OTEL_EXPORTER_OTLP_TRACES_COMPRESSION: '',\n  OTEL_EXPORTER_OTLP_METRICS_COMPRESSION: '',\n  OTEL_EXPORTER_OTLP_LOGS_COMPRESSION: '',\n  OTEL_EXPORTER_OTLP_CLIENT_KEY: '',\n  OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY: '',\n  OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY: '',\n  OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY: '',\n  OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE: '',\n  OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE: '',\n  OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE: '',\n  OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE: '',\n  OTEL_EXPORTER_OTLP_PROTOCOL: 'http/protobuf',\n  OTEL_EXPORTER_OTLP_TRACES_PROTOCOL: 'http/protobuf',\n  OTEL_EXPORTER_OTLP_METRICS_PROTOCOL: 'http/protobuf',\n  OTEL_EXPORTER_OTLP_LOGS_PROTOCOL: 'http/protobuf',\n  OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE: 'cumulative',\n};\n\n/**\n * @param key\n * @param environment\n * @param values\n */\nfunction parseBoolean(\n  key: keyof ENVIRONMENT_BOOLEANS,\n  environment: ENVIRONMENT,\n  values: RAW_ENVIRONMENT\n) {\n  if (typeof values[key] === 'undefined') {\n    return;\n  }\n\n  const value = String(values[key]);\n  // support case-insensitive \"true\"\n  environment[key] = value.toLowerCase() === 'true';\n}\n\n/**\n * Parses a variable as number with number validation\n * @param name\n * @param environment\n * @param values\n * @param min\n * @param max\n */\nfunction parseNumber(\n  name: keyof ENVIRONMENT_NUMBERS,\n  environment: ENVIRONMENT,\n  values: RAW_ENVIRONMENT,\n  min = -Infinity,\n  max = Infinity\n) {\n  if (typeof values[name] !== 'undefined') {\n    const value = Number(values[name] as string);\n    if (!isNaN(value)) {\n      if (value < min) {\n        environment[name] = min;\n      } else if (value > max) {\n        environment[name] = max;\n      } else {\n        environment[name] = value;\n      }\n    }\n  }\n}\n\n/**\n * Parses list-like strings from input into output.\n * @param name\n * @param environment\n * @param values\n * @param separator\n */\nfunction parseStringList(\n  name: keyof ENVIRONMENT_LISTS,\n  output: ENVIRONMENT,\n  input: RAW_ENVIRONMENT,\n  separator = DEFAULT_LIST_SEPARATOR\n) {\n  const givenValue = input[name];\n  if (typeof givenValue === 'string') {\n    output[name] = givenValue.split(separator).map(v => v.trim());\n  }\n}\n\n// The support string -> DiagLogLevel mappings\nconst logLevelMap: { [key: string]: DiagLogLevel } = {\n  ALL: DiagLogLevel.ALL,\n  VERBOSE: DiagLogLevel.VERBOSE,\n  DEBUG: DiagLogLevel.DEBUG,\n  INFO: DiagLogLevel.INFO,\n  WARN: DiagLogLevel.WARN,\n  ERROR: DiagLogLevel.ERROR,\n  NONE: DiagLogLevel.NONE,\n};\n\n/**\n * Environmentally sets log level if valid log level string is provided\n * @param key\n * @param environment\n * @param values\n */\nfunction setLogLevelFromEnv(\n  key: keyof ENVIRONMENT,\n  environment: RAW_ENVIRONMENT | ENVIRONMENT,\n  values: RAW_ENVIRONMENT\n) {\n  const value = values[key];\n  if (typeof value === 'string') {\n    const theLevel = logLevelMap[value.toUpperCase()];\n    if (theLevel != null) {\n      environment[key] = theLevel;\n    }\n  }\n}\n\n/**\n * Parses environment values\n * @param values\n */\nexport function parseEnvironment(values: RAW_ENVIRONMENT): ENVIRONMENT {\n  const environment: ENVIRONMENT = {};\n\n  for (const env in DEFAULT_ENVIRONMENT) {\n    const key = env as keyof ENVIRONMENT;\n\n    switch (key) {\n      case 'OTEL_LOG_LEVEL':\n        setLogLevelFromEnv(key, environment, values);\n        break;\n\n      default:\n        if (isEnvVarABoolean(key)) {\n          parseBoolean(key, environment, values);\n        } else if (isEnvVarANumber(key)) {\n          parseNumber(key, environment, values);\n        } else if (isEnvVarAList(key)) {\n          parseStringList(key, environment, values);\n        } else {\n          const value = values[key];\n          if (typeof value !== 'undefined' && value !== null) {\n            environment[key] = String(value);\n          }\n        }\n    }\n  }\n\n  return environment;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  DEFAULT_ENVIRONMENT,\n  ENVIRONMENT,\n  RAW_ENVIRONMENT,\n  parseEnvironment,\n} from '../../utils/environment';\n\n/**\n * Gets the environment variables\n */\nexport function getEnv(): Required<ENVIRONMENT> {\n  const processEnv = parseEnvironment(process.env as RAW_ENVIRONMENT);\n  return Object.assign({}, DEFAULT_ENVIRONMENT, processEnv);\n}\n\nexport function getEnvWithoutDefaults(): ENVIRONMENT {\n  return parseEnvironment(process.env as RAW_ENVIRONMENT);\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** only globals that common to node and browsers are allowed */\n// eslint-disable-next-line node/no-unsupported-features/es-builtins\nexport const _globalThis = typeof globalThis === 'object' ? globalThis : global;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nfunction intValue(charCode: number): number {\n  // 0-9\n  if (charCode >= 48 && charCode <= 57) {\n    return charCode - 48;\n  }\n\n  // a-f\n  if (charCode >= 97 && charCode <= 102) {\n    return charCode - 87;\n  }\n\n  // A-F\n  return charCode - 55;\n}\n\nexport function hexToBinary(hexStr: string): Uint8Array {\n  const buf = new Uint8Array(hexStr.length / 2);\n  let offset = 0;\n\n  for (let i = 0; i < hexStr.length; i += 2) {\n    const hi = intValue(hexStr.charCodeAt(i));\n    const lo = intValue(hexStr.charCodeAt(i + 1));\n    buf[offset++] = (hi << 4) | lo;\n  }\n\n  return buf;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { hexToBinary } from '../../common/hex-to-binary';\n\nexport function hexToBase64(hexStr: string): string {\n  return Buffer.from(hexToBinary(hexStr)).toString('base64');\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IdGenerator } from '../../trace/IdGenerator';\nconst SPAN_ID_BYTES = 8;\nconst TRACE_ID_BYTES = 16;\n\n/**\n * @deprecated Use the one defined in @opentelemetry/sdk-trace-base instead.\n */\nexport class RandomIdGenerator implements IdGenerator {\n  /**\n   * Returns a random 16-byte trace ID formatted/encoded as a 32 lowercase hex\n   * characters corresponding to 128 bits.\n   */\n  generateTraceId = getIdGenerator(TRACE_ID_BYTES);\n\n  /**\n   * Returns a random 8-byte span ID formatted/encoded as a 16 lowercase hex\n   * characters corresponding to 64 bits.\n   */\n  generateSpanId = getIdGenerator(SPAN_ID_BYTES);\n}\n\nconst SHARED_BUFFER = Buffer.allocUnsafe(TRACE_ID_BYTES);\nfunction getIdGenerator(bytes: number): () => string {\n  return function generateId() {\n    for (let i = 0; i < bytes / 4; i++) {\n      // unsigned right shift drops decimal part of the number\n      // it is required because if a number between 2**32 and 2**32 - 1 is generated, an out of range error is thrown by writeUInt32BE\n      SHARED_BUFFER.writeUInt32BE((Math.random() * 2 ** 32) >>> 0, i * 4);\n    }\n\n    // If buffer is all 0, set the last byte to 1 to guarantee a valid w3c id is generated\n    for (let i = 0; i < bytes; i++) {\n      if (SHARED_BUFFER[i] > 0) {\n        break;\n      } else if (i === bytes - 1) {\n        SHARED_BUFFER[bytes - 1] = 1;\n      }\n    }\n\n    return SHARED_BUFFER.toString('hex', 0, bytes);\n  };\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { performance } from 'perf_hooks';\n\nexport const otperformance = performance;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const VERSION = '1.25.1';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { VERSION } from '../../version';\nimport {\n  SEMRESATTRS_TELEMETRY_SDK_NAME,\n  SEMRESATTRS_PROCESS_RUNTIME_NAME,\n  SEMRESATTRS_TELEMETRY_SDK_LANGUAGE,\n  TELEMETRYSDKLANGUAGEVALUES_NODEJS,\n  SEMRESATTRS_TELEMETRY_SDK_VERSION,\n} from '@opentelemetry/semantic-conventions';\n\n/** Constants describing the SDK in use */\nexport const SDK_INFO = {\n  [SEMRESATTRS_TELEMETRY_SDK_NAME]: 'opentelemetry',\n  [SEMRESATTRS_PROCESS_RUNTIME_NAME]: 'node',\n  [SEMRESATTRS_TELEMETRY_SDK_LANGUAGE]: TELEMETRYSDKLANGUAGEVALUES_NODEJS,\n  [SEMRESATTRS_TELEMETRY_SDK_VERSION]: VERSION,\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport function unrefTimer(timer: NodeJS.Timer): void {\n  timer.unref();\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport { getEnvWithoutDefaults, getEnv } from './environment';\nexport * from './globalThis';\nexport * from './hex-to-base64';\nexport * from './RandomIdGenerator';\nexport * from './performance';\nexport * from './sdk-info';\nexport * from './timer-util';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport * from './node';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as api from '@opentelemetry/api';\nimport { otperformance as performance } from '../platform';\nimport { TimeOriginLegacy } from './types';\n\nconst NANOSECOND_DIGITS = 9;\nconst NANOSECOND_DIGITS_IN_MILLIS = 6;\nconst MILLISECONDS_TO_NANOSECONDS = Math.pow(10, NANOSECOND_DIGITS_IN_MILLIS);\nconst SECOND_TO_NANOSECONDS = Math.pow(10, NANOSECOND_DIGITS);\n\n/**\n * Converts a number of milliseconds from epoch to HrTime([seconds, remainder in nanoseconds]).\n * @param epochMillis\n */\nexport function millisToHrTime(epochMillis: number): api.HrTime {\n  const epochSeconds = epochMillis / 1000;\n  // Decimals only.\n  const seconds = Math.trunc(epochSeconds);\n  // Round sub-nanosecond accuracy to nanosecond.\n  const nanos = Math.round((epochMillis % 1000) * MILLISECONDS_TO_NANOSECONDS);\n  return [seconds, nanos];\n}\n\nexport function getTimeOrigin(): number {\n  let timeOrigin = performance.timeOrigin;\n  if (typeof timeOrigin !== 'number') {\n    const perf: TimeOriginLegacy = performance as unknown as TimeOriginLegacy;\n    timeOrigin = perf.timing && perf.timing.fetchStart;\n  }\n  return timeOrigin;\n}\n\n/**\n * Returns an hrtime calculated via performance component.\n * @param performanceNow\n */\nexport function hrTime(performanceNow?: number): api.HrTime {\n  const timeOrigin = millisToHrTime(getTimeOrigin());\n  const now = millisToHrTime(\n    typeof performanceNow === 'number' ? performanceNow : performance.now()\n  );\n\n  return addHrTimes(timeOrigin, now);\n}\n\n/**\n *\n * Converts a TimeInput to an HrTime, defaults to _hrtime().\n * @param time\n */\nexport function timeInputToHrTime(time: api.TimeInput): api.HrTime {\n  // process.hrtime\n  if (isTimeInputHrTime(time)) {\n    return time as api.HrTime;\n  } else if (typeof time === 'number') {\n    // Must be a performance.now() if it's smaller than process start time.\n    if (time < getTimeOrigin()) {\n      return hrTime(time);\n    } else {\n      // epoch milliseconds or performance.timeOrigin\n      return millisToHrTime(time);\n    }\n  } else if (time instanceof Date) {\n    return millisToHrTime(time.getTime());\n  } else {\n    throw TypeError('Invalid input type');\n  }\n}\n\n/**\n * Returns a duration of two hrTime.\n * @param startTime\n * @param endTime\n */\nexport function hrTimeDuration(\n  startTime: api.HrTime,\n  endTime: api.HrTime\n): api.HrTime {\n  let seconds = endTime[0] - startTime[0];\n  let nanos = endTime[1] - startTime[1];\n\n  // overflow\n  if (nanos < 0) {\n    seconds -= 1;\n    // negate\n    nanos += SECOND_TO_NANOSECONDS;\n  }\n\n  return [seconds, nanos];\n}\n\n/**\n * Convert hrTime to timestamp, for example \"2019-05-14T17:00:00.000123456Z\"\n * @param time\n */\nexport function hrTimeToTimeStamp(time: api.HrTime): string {\n  const precision = NANOSECOND_DIGITS;\n  const tmp = `${'0'.repeat(precision)}${time[1]}Z`;\n  const nanoString = tmp.substr(tmp.length - precision - 1);\n  const date = new Date(time[0] * 1000).toISOString();\n  return date.replace('000Z', nanoString);\n}\n\n/**\n * Convert hrTime to nanoseconds.\n * @param time\n */\nexport function hrTimeToNanoseconds(time: api.HrTime): number {\n  return time[0] * SECOND_TO_NANOSECONDS + time[1];\n}\n\n/**\n * Convert hrTime to milliseconds.\n * @param time\n */\nexport function hrTimeToMilliseconds(time: api.HrTime): number {\n  return time[0] * 1e3 + time[1] / 1e6;\n}\n\n/**\n * Convert hrTime to microseconds.\n * @param time\n */\nexport function hrTimeToMicroseconds(time: api.HrTime): number {\n  return time[0] * 1e6 + time[1] / 1e3;\n}\n\n/**\n * check if time is HrTime\n * @param value\n */\nexport function isTimeInputHrTime(value: unknown): value is api.HrTime {\n  return (\n    Array.isArray(value) &&\n    value.length === 2 &&\n    typeof value[0] === 'number' &&\n    typeof value[1] === 'number'\n  );\n}\n\n/**\n * check if input value is a correct types.TimeInput\n * @param value\n */\nexport function isTimeInput(\n  value: unknown\n): value is api.HrTime | number | Date {\n  return (\n    isTimeInputHrTime(value) ||\n    typeof value === 'number' ||\n    value instanceof Date\n  );\n}\n\n/**\n * Given 2 HrTime formatted times, return their sum as an HrTime.\n */\nexport function addHrTimes(time1: api.HrTime, time2: api.HrTime): api.HrTime {\n  const out = [time1[0] + time2[0], time1[1] + time2[1]] as api.HrTime;\n\n  // Nanoseconds\n  if (out[1] >= SECOND_TO_NANOSECONDS) {\n    out[1] -= SECOND_TO_NANOSECONDS;\n    out[0] += 1;\n  }\n\n  return out;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Exception } from '@opentelemetry/api';\n\n/**\n * This interface defines a fallback to read a timeOrigin when it is not available on performance.timeOrigin,\n * this happens for example on Safari Mac\n * then the timeOrigin is taken from fetchStart - which is the closest to timeOrigin\n */\nexport interface TimeOriginLegacy {\n  timing: {\n    fetchStart: number;\n  };\n}\n\n/**\n * This interface defines the params that are be added to the wrapped function\n * using the \"shimmer.wrap\"\n */\nexport interface ShimWrapped extends Function {\n  __wrapped: boolean;\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  __unwrap: Function;\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  __original: Function;\n}\n\n/**\n * An instrumentation library consists of the name and optional version\n * used to obtain a tracer or meter from a provider. This metadata is made\n * available on ReadableSpan and MetricRecord for use by the export pipeline.\n * @deprecated Use {@link InstrumentationScope} instead.\n */\nexport interface InstrumentationLibrary {\n  readonly name: string;\n  readonly version?: string;\n  readonly schemaUrl?: string;\n}\n\n/**\n * An instrumentation scope consists of the name and optional version\n * used to obtain a tracer or meter from a provider. This metadata is made\n * available on ReadableSpan and MetricRecord for use by the export pipeline.\n */\nexport interface InstrumentationScope {\n  readonly name: string;\n  readonly version?: string;\n  readonly schemaUrl?: string;\n}\n\n/** Defines an error handler function */\nexport type ErrorHandler = (ex: Exception) => void;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface ExportResult {\n  code: ExportResultCode;\n  error?: Error;\n}\n\nexport enum ExportResultCode {\n  SUCCESS,\n  FAILED,\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Context,\n  TextMapGetter,\n  TextMapPropagator,\n  diag,\n  TextMapSetter,\n} from '@opentelemetry/api';\n\n/** Configuration object for composite propagator */\nexport interface CompositePropagatorConfig {\n  /**\n   * List of propagators to run. Propagators run in the\n   * list order. If a propagator later in the list writes the same context\n   * key as a propagator earlier in the list, the later on will \"win\".\n   */\n  propagators?: TextMapPropagator[];\n}\n\n/** Combines multiple propagators into a single propagator. */\nexport class CompositePropagator implements TextMapPropagator {\n  private readonly _propagators: TextMapPropagator[];\n  private readonly _fields: string[];\n\n  /**\n   * Construct a composite propagator from a list of propagators.\n   *\n   * @param [config] Configuration object for composite propagator\n   */\n  constructor(config: CompositePropagatorConfig = {}) {\n    this._propagators = config.propagators ?? [];\n\n    this._fields = Array.from(\n      new Set(\n        this._propagators\n          // older propagators may not have fields function, null check to be sure\n          .map(p => (typeof p.fields === 'function' ? p.fields() : []))\n          .reduce((x, y) => x.concat(y), [])\n      )\n    );\n  }\n\n  /**\n   * Run each of the configured propagators with the given context and carrier.\n   * Propagators are run in the order they are configured, so if multiple\n   * propagators write the same carrier key, the propagator later in the list\n   * will \"win\".\n   *\n   * @param context Context to inject\n   * @param carrier Carrier into which context will be injected\n   */\n  inject(context: Context, carrier: unknown, setter: TextMapSetter): void {\n    for (const propagator of this._propagators) {\n      try {\n        propagator.inject(context, carrier, setter);\n      } catch (err) {\n        diag.warn(\n          `Failed to inject with ${propagator.constructor.name}. Err: ${err.message}`\n        );\n      }\n    }\n  }\n\n  /**\n   * Run each of the configured propagators with the given context and carrier.\n   * Propagators are run in the order they are configured, so if multiple\n   * propagators write the same context key, the propagator later in the list\n   * will \"win\".\n   *\n   * @param context Context to add values to\n   * @param carrier Carrier from which to extract context\n   */\n  extract(context: Context, carrier: unknown, getter: TextMapGetter): Context {\n    return this._propagators.reduce((ctx, propagator) => {\n      try {\n        return propagator.extract(ctx, carrier, getter);\n      } catch (err) {\n        diag.warn(\n          `Failed to inject with ${propagator.constructor.name}. Err: ${err.message}`\n        );\n      }\n      return ctx;\n    }, context);\n  }\n\n  fields(): string[] {\n    // return a new array so our fields cannot be modified\n    return this._fields.slice();\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst VALID_KEY_CHAR_RANGE = '[_0-9a-z-*/]';\nconst VALID_KEY = `[a-z]${VALID_KEY_CHAR_RANGE}{0,255}`;\nconst VALID_VENDOR_KEY = `[a-z0-9]${VALID_KEY_CHAR_RANGE}{0,240}@[a-z]${VALID_KEY_CHAR_RANGE}{0,13}`;\nconst VALID_KEY_REGEX = new RegExp(`^(?:${VALID_KEY}|${VALID_VENDOR_KEY})$`);\nconst VALID_VALUE_BASE_REGEX = /^[ -~]{0,255}[!-~]$/;\nconst INVALID_VALUE_COMMA_EQUAL_REGEX = /,|=/;\n\n/**\n * Key is opaque string up to 256 characters printable. It MUST begin with a\n * lowercase letter, and can only contain lowercase letters a-z, digits 0-9,\n * underscores _, dashes -, asterisks *, and forward slashes /.\n * For multi-tenant vendor scenarios, an at sign (@) can be used to prefix the\n * vendor name. Vendors SHOULD set the tenant ID at the beginning of the key.\n * see https://www.w3.org/TR/trace-context/#key\n */\nexport function validateKey(key: string): boolean {\n  return VALID_KEY_REGEX.test(key);\n}\n\n/**\n * Value is opaque string up to 256 characters printable ASCII RFC0020\n * characters (i.e., the range 0x20 to 0x7E) except comma , and =.\n */\nexport function validateValue(value: string): boolean {\n  return (\n    VALID_VALUE_BASE_REGEX.test(value) &&\n    !INVALID_VALUE_COMMA_EQUAL_REGEX.test(value)\n  );\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as api from '@opentelemetry/api';\nimport { validateKey, validateValue } from '../internal/validators';\n\nconst MAX_TRACE_STATE_ITEMS = 32;\nconst MAX_TRACE_STATE_LEN = 512;\nconst LIST_MEMBERS_SEPARATOR = ',';\nconst LIST_MEMBER_KEY_VALUE_SPLITTER = '=';\n\n/**\n * TraceState must be a class and not a simple object type because of the spec\n * requirement (https://www.w3.org/TR/trace-context/#tracestate-field).\n *\n * Here is the list of allowed mutations:\n * - New key-value pair should be added into the beginning of the list\n * - The value of any key can be updated. Modified keys MUST be moved to the\n * beginning of the list.\n */\nexport class TraceState implements api.TraceState {\n  private _internalState: Map<string, string> = new Map();\n\n  constructor(rawTraceState?: string) {\n    if (rawTraceState) this._parse(rawTraceState);\n  }\n\n  set(key: string, value: string): TraceState {\n    // TODO: Benchmark the different approaches(map vs list) and\n    // use the faster one.\n    const traceState = this._clone();\n    if (traceState._internalState.has(key)) {\n      traceState._internalState.delete(key);\n    }\n    traceState._internalState.set(key, value);\n    return traceState;\n  }\n\n  unset(key: string): TraceState {\n    const traceState = this._clone();\n    traceState._internalState.delete(key);\n    return traceState;\n  }\n\n  get(key: string): string | undefined {\n    return this._internalState.get(key);\n  }\n\n  serialize(): string {\n    return this._keys()\n      .reduce((agg: string[], key) => {\n        agg.push(key + LIST_MEMBER_KEY_VALUE_SPLITTER + this.get(key));\n        return agg;\n      }, [])\n      .join(LIST_MEMBERS_SEPARATOR);\n  }\n\n  private _parse(rawTraceState: string) {\n    if (rawTraceState.length > MAX_TRACE_STATE_LEN) return;\n    this._internalState = rawTraceState\n      .split(LIST_MEMBERS_SEPARATOR)\n      .reverse() // Store in reverse so new keys (.set(...)) will be placed at the beginning\n      .reduce((agg: Map<string, string>, part: string) => {\n        const listMember = part.trim(); // Optional Whitespace (OWS) handling\n        const i = listMember.indexOf(LIST_MEMBER_KEY_VALUE_SPLITTER);\n        if (i !== -1) {\n          const key = listMember.slice(0, i);\n          const value = listMember.slice(i + 1, part.length);\n          if (validateKey(key) && validateValue(value)) {\n            agg.set(key, value);\n          } else {\n            // TODO: Consider to add warning log\n          }\n        }\n        return agg;\n      }, new Map());\n\n    // Because of the reverse() requirement, trunc must be done after map is created\n    if (this._internalState.size > MAX_TRACE_STATE_ITEMS) {\n      this._internalState = new Map(\n        Array.from(this._internalState.entries())\n          .reverse() // Use reverse same as original tracestate parse chain\n          .slice(0, MAX_TRACE_STATE_ITEMS)\n      );\n    }\n  }\n\n  private _keys(): string[] {\n    return Array.from(this._internalState.keys()).reverse();\n  }\n\n  private _clone(): TraceState {\n    const traceState = new TraceState();\n    traceState._internalState = new Map(this._internalState);\n    return traceState;\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Context,\n  isSpanContextValid,\n  SpanContext,\n  TextMapGetter,\n  TextMapPropagator,\n  TextMapSetter,\n  trace,\n  TraceFlags,\n} from '@opentelemetry/api';\nimport { isTracingSuppressed } from './suppress-tracing';\nimport { TraceState } from './TraceState';\n\nexport const TRACE_PARENT_HEADER = 'traceparent';\nexport const TRACE_STATE_HEADER = 'tracestate';\n\nconst VERSION = '00';\nconst VERSION_PART = '(?!ff)[\\\\da-f]{2}';\nconst TRACE_ID_PART = '(?![0]{32})[\\\\da-f]{32}';\nconst PARENT_ID_PART = '(?![0]{16})[\\\\da-f]{16}';\nconst FLAGS_PART = '[\\\\da-f]{2}';\nconst TRACE_PARENT_REGEX = new RegExp(\n  `^\\\\s?(${VERSION_PART})-(${TRACE_ID_PART})-(${PARENT_ID_PART})-(${FLAGS_PART})(-.*)?\\\\s?$`\n);\n\n/**\n * Parses information from the [traceparent] span tag and converts it into {@link SpanContext}\n * @param traceParent - A meta property that comes from server.\n *     It should be dynamically generated server side to have the server's request trace Id,\n *     a parent span Id that was set on the server's request span,\n *     and the trace flags to indicate the server's sampling decision\n *     (01 = sampled, 00 = not sampled).\n *     for example: '{version}-{traceId}-{spanId}-{sampleDecision}'\n *     For more information see {@link https://www.w3.org/TR/trace-context/}\n */\nexport function parseTraceParent(traceParent: string): SpanContext | null {\n  const match = TRACE_PARENT_REGEX.exec(traceParent);\n  if (!match) return null;\n\n  // According to the specification the implementation should be compatible\n  // with future versions. If there are more parts, we only reject it if it's using version 00\n  // See https://www.w3.org/TR/trace-context/#versioning-of-traceparent\n  if (match[1] === '00' && match[5]) return null;\n\n  return {\n    traceId: match[2],\n    spanId: match[3],\n    traceFlags: parseInt(match[4], 16),\n  };\n}\n\n/**\n * Propagates {@link SpanContext} through Trace Context format propagation.\n *\n * Based on the Trace Context specification:\n * https://www.w3.org/TR/trace-context/\n */\nexport class W3CTraceContextPropagator implements TextMapPropagator {\n  inject(context: Context, carrier: unknown, setter: TextMapSetter): void {\n    const spanContext = trace.getSpanContext(context);\n    if (\n      !spanContext ||\n      isTracingSuppressed(context) ||\n      !isSpanContextValid(spanContext)\n    )\n      return;\n\n    const traceParent = `${VERSION}-${spanContext.traceId}-${\n      spanContext.spanId\n    }-0${Number(spanContext.traceFlags || TraceFlags.NONE).toString(16)}`;\n\n    setter.set(carrier, TRACE_PARENT_HEADER, traceParent);\n    if (spanContext.traceState) {\n      setter.set(\n        carrier,\n        TRACE_STATE_HEADER,\n        spanContext.traceState.serialize()\n      );\n    }\n  }\n\n  extract(context: Context, carrier: unknown, getter: TextMapGetter): Context {\n    const traceParentHeader = getter.get(carrier, TRACE_PARENT_HEADER);\n    if (!traceParentHeader) return context;\n    const traceParent = Array.isArray(traceParentHeader)\n      ? traceParentHeader[0]\n      : traceParentHeader;\n    if (typeof traceParent !== 'string') return context;\n    const spanContext = parseTraceParent(traceParent);\n    if (!spanContext) return context;\n\n    spanContext.isRemote = true;\n\n    const traceStateHeader = getter.get(carrier, TRACE_STATE_HEADER);\n    if (traceStateHeader) {\n      // If more than one `tracestate` header is found, we merge them into a\n      // single header.\n      const state = Array.isArray(traceStateHeader)\n        ? traceStateHeader.join(',')\n        : traceStateHeader;\n      spanContext.traceState = new TraceState(\n        typeof state === 'string' ? state : undefined\n      );\n    }\n    return trace.setSpanContext(context, spanContext);\n  }\n\n  fields(): string[] {\n    return [TRACE_PARENT_HEADER, TRACE_STATE_HEADER];\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @deprecated Use the one defined in @opentelemetry/sdk-trace-base instead.\n * IdGenerator provides an interface for generating Trace Id and Span Id.\n */\nexport interface IdGenerator {\n  /** Returns a trace ID composed of 32 lowercase hex characters. */\n  generateTraceId(): string;\n  /** Returns a span ID composed of 16 lowercase hex characters. */\n  generateSpanId(): string;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Context, createContextKey, Span } from '@opentelemetry/api';\n\nconst RPC_METADATA_KEY = createContextKey(\n  'OpenTelemetry SDK Context Key RPC_METADATA'\n);\n\nexport enum RPCType {\n  HTTP = 'http',\n}\n\ntype HTTPMetadata = {\n  type: RPCType.HTTP;\n  route?: string;\n  span: Span;\n};\n\n/**\n * Allows for future rpc metadata to be used with this mechanism\n */\nexport type RPCMetadata = HTTPMetadata;\n\nexport function setRPCMetadata(context: Context, meta: RPCMetadata): Context {\n  return context.setValue(RPC_METADATA_KEY, meta);\n}\n\nexport function deleteRPCMetadata(context: Context): Context {\n  return context.deleteValue(RPC_METADATA_KEY);\n}\n\nexport function getRPCMetadata(context: Context): RPCMetadata | undefined {\n  return context.getValue(RPC_METADATA_KEY) as RPCMetadata | undefined;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Sampler, SamplingDecision, SamplingResult } from '@opentelemetry/api';\n\n/**\n * @deprecated Use the one defined in @opentelemetry/sdk-trace-base instead.\n * Sampler that samples no traces.\n */\nexport class AlwaysOffSampler implements Sampler {\n  shouldSample(): SamplingResult {\n    return {\n      decision: SamplingDecision.NOT_RECORD,\n    };\n  }\n\n  toString(): string {\n    return 'AlwaysOffSampler';\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Sampler, SamplingDecision, SamplingResult } from '@opentelemetry/api';\n\n/**\n * @deprecated Use the one defined in @opentelemetry/sdk-trace-base instead.\n * Sampler that samples all traces.\n */\nexport class AlwaysOnSampler implements Sampler {\n  shouldSample(): SamplingResult {\n    return {\n      decision: SamplingDecision.RECORD_AND_SAMPLED,\n    };\n  }\n\n  toString(): string {\n    return 'AlwaysOnSampler';\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Context,\n  isSpanContextValid,\n  Link,\n  Sampler,\n  SamplingResult,\n  SpanAttributes,\n  SpanKind,\n  TraceFlags,\n  trace,\n} from '@opentelemetry/api';\nimport { globalErrorHandler } from '../../common/global-error-handler';\nimport { AlwaysOffSampler } from './AlwaysOffSampler';\nimport { AlwaysOnSampler } from './AlwaysOnSampler';\n\n/**\n * @deprecated Use the one defined in @opentelemetry/sdk-trace-base instead.\n * A composite sampler that either respects the parent span's sampling decision\n * or delegates to `delegateSampler` for root spans.\n */\nexport class ParentBasedSampler implements Sampler {\n  private _root: Sampler;\n  private _remoteParentSampled: Sampler;\n  private _remoteParentNotSampled: Sampler;\n  private _localParentSampled: Sampler;\n  private _localParentNotSampled: Sampler;\n\n  constructor(config: ParentBasedSamplerConfig) {\n    this._root = config.root;\n\n    if (!this._root) {\n      globalErrorHandler(\n        new Error('ParentBasedSampler must have a root sampler configured')\n      );\n      this._root = new AlwaysOnSampler();\n    }\n\n    this._remoteParentSampled =\n      config.remoteParentSampled ?? new AlwaysOnSampler();\n    this._remoteParentNotSampled =\n      config.remoteParentNotSampled ?? new AlwaysOffSampler();\n    this._localParentSampled =\n      config.localParentSampled ?? new AlwaysOnSampler();\n    this._localParentNotSampled =\n      config.localParentNotSampled ?? new AlwaysOffSampler();\n  }\n\n  shouldSample(\n    context: Context,\n    traceId: string,\n    spanName: string,\n    spanKind: SpanKind,\n    attributes: SpanAttributes,\n    links: Link[]\n  ): SamplingResult {\n    const parentContext = trace.getSpanContext(context);\n\n    if (!parentContext || !isSpanContextValid(parentContext)) {\n      return this._root.shouldSample(\n        context,\n        traceId,\n        spanName,\n        spanKind,\n        attributes,\n        links\n      );\n    }\n\n    if (parentContext.isRemote) {\n      if (parentContext.traceFlags & TraceFlags.SAMPLED) {\n        return this._remoteParentSampled.shouldSample(\n          context,\n          traceId,\n          spanName,\n          spanKind,\n          attributes,\n          links\n        );\n      }\n      return this._remoteParentNotSampled.shouldSample(\n        context,\n        traceId,\n        spanName,\n        spanKind,\n        attributes,\n        links\n      );\n    }\n\n    if (parentContext.traceFlags & TraceFlags.SAMPLED) {\n      return this._localParentSampled.shouldSample(\n        context,\n        traceId,\n        spanName,\n        spanKind,\n        attributes,\n        links\n      );\n    }\n\n    return this._localParentNotSampled.shouldSample(\n      context,\n      traceId,\n      spanName,\n      spanKind,\n      attributes,\n      links\n    );\n  }\n\n  toString(): string {\n    return `ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`;\n  }\n}\n\ninterface ParentBasedSamplerConfig {\n  /** Sampler called for spans with no parent */\n  root: Sampler;\n  /** Sampler called for spans with a remote parent which was sampled. Default AlwaysOn */\n  remoteParentSampled?: Sampler;\n  /** Sampler called for spans with a remote parent which was not sampled. Default AlwaysOff */\n  remoteParentNotSampled?: Sampler;\n  /** Sampler called for spans with a local parent which was sampled. Default AlwaysOn */\n  localParentSampled?: Sampler;\n  /** Sampler called for spans with a local parent which was not sampled. Default AlwaysOff */\n  localParentNotSampled?: Sampler;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Sampler,\n  SamplingDecision,\n  SamplingResult,\n  isValidTraceId,\n} from '@opentelemetry/api';\n\n/**\n * @deprecated Use the one defined in @opentelemetry/sdk-trace-base instead.\n * Sampler that samples a given fraction of traces based of trace id deterministically.\n */\nexport class TraceIdRatioBasedSampler implements Sampler {\n  private _upperBound: number;\n\n  constructor(private readonly _ratio: number = 0) {\n    this._ratio = this._normalize(_ratio);\n    this._upperBound = Math.floor(this._ratio * 0xffffffff);\n  }\n\n  shouldSample(context: unknown, traceId: string): SamplingResult {\n    return {\n      decision:\n        isValidTraceId(traceId) && this._accumulate(traceId) < this._upperBound\n          ? SamplingDecision.RECORD_AND_SAMPLED\n          : SamplingDecision.NOT_RECORD,\n    };\n  }\n\n  toString(): string {\n    return `TraceIdRatioBased{${this._ratio}}`;\n  }\n\n  private _normalize(ratio: number): number {\n    if (typeof ratio !== 'number' || isNaN(ratio)) return 0;\n    return ratio >= 1 ? 1 : ratio <= 0 ? 0 : ratio;\n  }\n\n  private _accumulate(traceId: string): number {\n    let accumulation = 0;\n    for (let i = 0; i < traceId.length / 8; i++) {\n      const pos = i * 8;\n      const part = parseInt(traceId.slice(pos, pos + 8), 16);\n      accumulation = (accumulation ^ part) >>> 0;\n    }\n    return accumulation;\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/**\n * based on lodash in order to support esm builds without esModuleInterop.\n * lodash is using MIT License.\n **/\n\nconst objectTag = '[object Object]';\nconst nullTag = '[object Null]';\nconst undefinedTag = '[object Undefined]';\nconst funcProto = Function.prototype;\nconst funcToString = funcProto.toString;\nconst objectCtorString = funcToString.call(Object);\nconst getPrototype = overArg(Object.getPrototypeOf, Object);\nconst objectProto = Object.prototype;\nconst hasOwnProperty = objectProto.hasOwnProperty;\nconst symToStringTag = Symbol ? Symbol.toStringTag : undefined;\nconst nativeObjectToString = objectProto.toString;\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func: Function, transform: any): any {\n  return function (arg: any) {\n    return func(transform(arg));\n  };\n}\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nexport function isPlainObject(value: any) {\n  if (!isObjectLike(value) || baseGetTag(value) !== objectTag) {\n    return false;\n  }\n  const proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  const Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return (\n    typeof Ctor == 'function' &&\n    Ctor instanceof Ctor &&\n    funcToString.call(Ctor) === objectCtorString\n  );\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value: any) {\n  return value != null && typeof value == 'object';\n}\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value: any) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return symToStringTag && symToStringTag in Object(value)\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value: any) {\n  const isOwn = hasOwnProperty.call(value, symToStringTag as any),\n    tag = value[symToStringTag as any];\n  let unmasked = false;\n\n  try {\n    value[symToStringTag as any] = undefined;\n    unmasked = true;\n  } catch (e) {\n    // silence\n  }\n\n  const result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag as any] = tag;\n    } else {\n      delete value[symToStringTag as any];\n    }\n  }\n  return result;\n}\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value: any) {\n  return nativeObjectToString.call(value);\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport { isPlainObject } from './lodash.merge';\n\nconst MAX_LEVEL = 20;\n\ninterface ObjectInto {\n  obj: any;\n  key: string;\n}\n\n/**\n * Merges objects together\n * @param args - objects / values to be merged\n */\nexport function merge(...args: any[]): any {\n  let result: any = args.shift();\n  const objects: WeakMap<any, ObjectInto[]> | undefined = new WeakMap<\n    any,\n    ObjectInto[]\n  >();\n  while (args.length > 0) {\n    result = mergeTwoObjects(result, args.shift(), 0, objects);\n  }\n\n  return result;\n}\n\nfunction takeValue(value: any): any {\n  if (isArray(value)) {\n    return value.slice();\n  }\n  return value;\n}\n\n/**\n * Merges two objects\n * @param one - first object\n * @param two - second object\n * @param level - current deep level\n * @param objects - objects holder that has been already referenced - to prevent\n * cyclic dependency\n */\nfunction mergeTwoObjects(\n  one: any,\n  two: any,\n  level = 0,\n  objects: WeakMap<any, ObjectInto[]>\n): any {\n  let result: any;\n  if (level > MAX_LEVEL) {\n    return undefined;\n  }\n  level++;\n  if (isPrimitive(one) || isPrimitive(two) || isFunction(two)) {\n    result = takeValue(two);\n  } else if (isArray(one)) {\n    result = one.slice();\n    if (isArray(two)) {\n      for (let i = 0, j = two.length; i < j; i++) {\n        result.push(takeValue(two[i]));\n      }\n    } else if (isObject(two)) {\n      const keys = Object.keys(two);\n      for (let i = 0, j = keys.length; i < j; i++) {\n        const key = keys[i];\n        result[key] = takeValue(two[key]);\n      }\n    }\n  } else if (isObject(one)) {\n    if (isObject(two)) {\n      if (!shouldMerge(one, two)) {\n        return two;\n      }\n      result = Object.assign({}, one);\n      const keys = Object.keys(two);\n\n      for (let i = 0, j = keys.length; i < j; i++) {\n        const key = keys[i];\n        const twoValue = two[key];\n\n        if (isPrimitive(twoValue)) {\n          if (typeof twoValue === 'undefined') {\n            delete result[key];\n          } else {\n            // result[key] = takeValue(twoValue);\n            result[key] = twoValue;\n          }\n        } else {\n          const obj1 = result[key];\n          const obj2 = twoValue;\n\n          if (\n            wasObjectReferenced(one, key, objects) ||\n            wasObjectReferenced(two, key, objects)\n          ) {\n            delete result[key];\n          } else {\n            if (isObject(obj1) && isObject(obj2)) {\n              const arr1 = objects.get(obj1) || [];\n              const arr2 = objects.get(obj2) || [];\n              arr1.push({ obj: one, key });\n              arr2.push({ obj: two, key });\n              objects.set(obj1, arr1);\n              objects.set(obj2, arr2);\n            }\n\n            result[key] = mergeTwoObjects(\n              result[key],\n              twoValue,\n              level,\n              objects\n            );\n          }\n        }\n      }\n    } else {\n      result = two;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Function to check if object has been already reference\n * @param obj\n * @param key\n * @param objects\n */\nfunction wasObjectReferenced(\n  obj: any,\n  key: string,\n  objects: WeakMap<any, ObjectInto[]>\n): boolean {\n  const arr = objects.get(obj[key]) || [];\n  for (let i = 0, j = arr.length; i < j; i++) {\n    const info = arr[i];\n    if (info.key === key && info.obj === obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isArray(value: any): boolean {\n  return Array.isArray(value);\n}\n\nfunction isFunction(value: any): boolean {\n  return typeof value === 'function';\n}\n\nfunction isObject(value: any): boolean {\n  return (\n    !isPrimitive(value) &&\n    !isArray(value) &&\n    !isFunction(value) &&\n    typeof value === 'object'\n  );\n}\n\nfunction isPrimitive(value: any): boolean {\n  return (\n    typeof value === 'string' ||\n    typeof value === 'number' ||\n    typeof value === 'boolean' ||\n    typeof value === 'undefined' ||\n    value instanceof Date ||\n    value instanceof RegExp ||\n    value === null\n  );\n}\n\nfunction shouldMerge(one: any, two: any): boolean {\n  if (!isPlainObject(one) || !isPlainObject(two)) {\n    return false;\n  }\n\n  return true;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Error that is thrown on timeouts.\n */\nexport class TimeoutError extends Error {\n  constructor(message?: string) {\n    super(message);\n\n    // manually adjust prototype to retain `instanceof` functionality when targeting ES5, see:\n    // https://github.com/Microsoft/TypeScript-wiki/blob/main/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n    Object.setPrototypeOf(this, TimeoutError.prototype);\n  }\n}\n\n/**\n * Adds a timeout to a promise and rejects if the specified timeout has elapsed. Also rejects if the specified promise\n * rejects, and resolves if the specified promise resolves.\n *\n * <p> NOTE: this operation will continue even after it throws a {@link TimeoutError}.\n *\n * @param promise promise to use with timeout.\n * @param timeout the timeout in milliseconds until the returned promise is rejected.\n */\nexport function callWithTimeout<T>(\n  promise: Promise<T>,\n  timeout: number\n): Promise<T> {\n  let timeoutHandle: ReturnType<typeof setTimeout>;\n\n  const timeoutPromise = new Promise<never>(function timeoutFunction(\n    _resolve,\n    reject\n  ) {\n    timeoutHandle = setTimeout(function timeoutHandler() {\n      reject(new TimeoutError('Operation timed out.'));\n    }, timeout);\n  });\n\n  return Promise.race([promise, timeoutPromise]).then(\n    result => {\n      clearTimeout(timeoutHandle);\n      return result;\n    },\n    reason => {\n      clearTimeout(timeoutHandle);\n      throw reason;\n    }\n  );\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport function urlMatches(url: string, urlToMatch: string | RegExp): boolean {\n  if (typeof urlToMatch === 'string') {\n    return url === urlToMatch;\n  } else {\n    return !!url.match(urlToMatch);\n  }\n}\n/**\n * Check if {@param url} should be ignored when comparing against {@param ignoredUrls}\n * @param url\n * @param ignoredUrls\n */\nexport function isUrlIgnored(\n  url: string,\n  ignoredUrls?: Array<string | RegExp>\n): boolean {\n  if (!ignoredUrls) {\n    return false;\n  }\n\n  for (const ignoreUrl of ignoredUrls) {\n    if (urlMatches(url, ignoreUrl)) {\n      return true;\n    }\n  }\n  return false;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ShimWrapped } from '../common/types';\n\n/**\n * Checks if certain function has been already wrapped\n * @param func\n */\nexport function isWrapped(func: unknown): func is ShimWrapped {\n  return (\n    typeof func === 'function' &&\n    typeof (func as ShimWrapped).__original === 'function' &&\n    typeof (func as ShimWrapped).__unwrap === 'function' &&\n    (func as ShimWrapped).__wrapped === true\n  );\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport class Deferred<T> {\n  private _promise: Promise<T>;\n  private _resolve!: (val: T) => void;\n  private _reject!: (error: unknown) => void;\n  constructor() {\n    this._promise = new Promise((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n  }\n\n  get promise() {\n    return this._promise;\n  }\n\n  resolve(val: T) {\n    this._resolve(val);\n  }\n\n  reject(err: unknown) {\n    this._reject(err);\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Deferred } from './promise';\n\n/**\n * Bind the callback and only invoke the callback once regardless how many times `BindOnceFuture.call` is invoked.\n */\nexport class BindOnceFuture<\n  R,\n  This = unknown,\n  T extends (this: This, ...args: unknown[]) => R = () => R,\n> {\n  private _isCalled = false;\n  private _deferred = new Deferred<R>();\n  constructor(\n    private _callback: T,\n    private _that: This\n  ) {}\n\n  get isCalled() {\n    return this._isCalled;\n  }\n\n  get promise() {\n    return this._deferred.promise;\n  }\n\n  call(...args: Parameters<T>): Promise<R> {\n    if (!this._isCalled) {\n      this._isCalled = true;\n      try {\n        Promise.resolve(this._callback.call(this._that, ...args)).then(\n          val => this._deferred.resolve(val),\n          err => this._deferred.reject(err)\n        );\n      } catch (err) {\n        this._deferred.reject(err);\n      }\n    }\n    return this._deferred.promise;\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { context } from '@opentelemetry/api';\nimport { ExportResult } from '../ExportResult';\nimport { suppressTracing } from '../trace/suppress-tracing';\n\nexport interface Exporter<T> {\n  export(arg: T, resultCallback: (result: ExportResult) => void): void;\n}\n\n/**\n * @internal\n * Shared functionality used by Exporters while exporting data, including suppression of Traces.\n */\nexport function _export<T>(\n  exporter: Exporter<T>,\n  arg: T\n): Promise<ExportResult> {\n  return new Promise(resolve => {\n    // prevent downstream exporter calls from generating spans\n    context.with(suppressTracing(context.active()), () => {\n      exporter.export(arg, (result: ExportResult) => {\n        resolve(result);\n      });\n    });\n  });\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './baggage/propagation/W3CBaggagePropagator';\nexport * from './common/anchored-clock';\nexport * from './common/attributes';\nexport * from './common/global-error-handler';\nexport * from './common/logging-error-handler';\nexport * from './common/time';\nexport * from './common/types';\nexport * from './common/hex-to-binary';\nexport * from './ExportResult';\nexport * as baggageUtils from './baggage/utils';\nexport * from './platform';\nexport * from './propagation/composite';\nexport * from './trace/W3CTraceContextPropagator';\nexport * from './trace/IdGenerator';\nexport * from './trace/rpc-metadata';\nexport * from './trace/sampler/AlwaysOffSampler';\nexport * from './trace/sampler/AlwaysOnSampler';\nexport * from './trace/sampler/ParentBasedSampler';\nexport * from './trace/sampler/TraceIdRatioBasedSampler';\nexport * from './trace/suppress-tracing';\nexport * from './trace/TraceState';\nexport * from './utils/environment';\nexport * from './utils/merge';\nexport * from './utils/sampling';\nexport * from './utils/timeout';\nexport * from './utils/url';\nexport * from './utils/wrap';\nexport * from './utils/callback';\nexport * from './version';\nimport { _export } from './internal/exporter';\nexport const internal = {\n  _export,\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/http.md\n */\nexport enum AttributeNames {\n  HTTP_ERROR_NAME = 'http.error_name',\n  HTTP_ERROR_MESSAGE = 'http.error_message',\n  HTTP_STATUS_TEXT = 'http.status_text',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  MetricAttributes,\n  SpanAttributes,\n  SpanStatusCode,\n  Span,\n  context,\n  SpanKind,\n} from '@opentelemetry/api';\nimport {\n  NETTRANSPORTVALUES_IP_TCP,\n  NETTRANSPORTVALUES_IP_UDP,\n  SEMATTRS_HTTP_CLIENT_IP,\n  SEMATTRS_HTTP_FLAVOR,\n  SEMATTRS_HTTP_HOST,\n  SEMATTRS_HTTP_METHOD,\n  SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH,\n  SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED,\n  SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH,\n  SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED,\n  SEMATTRS_HTTP_ROUTE,\n  SEMATTRS_HTTP_SCHEME,\n  SEMATTRS_HTTP_SERVER_NAME,\n  SEMATTRS_HTTP_STATUS_CODE,\n  SEMATTRS_HTTP_TARGET,\n  SEMATTRS_HTTP_URL,\n  SEMATTRS_HTTP_USER_AGENT,\n  SEMATTRS_NET_HOST_IP,\n  SEMATTRS_NET_HOST_NAME,\n  SEMATTRS_NET_HOST_PORT,\n  SEMATTRS_NET_PEER_IP,\n  SEMATTRS_NET_PEER_NAME,\n  SEMATTRS_NET_PEER_PORT,\n  SEMATTRS_NET_TRANSPORT,\n} from '@opentelemetry/semantic-conventions';\nimport {\n  IncomingHttpHeaders,\n  IncomingMessage,\n  OutgoingHttpHeaders,\n  RequestOptions,\n  ServerResponse,\n} from 'http';\nimport { getRPCMetadata, RPCType } from '@opentelemetry/core';\nimport * as url from 'url';\nimport { AttributeNames } from './enums/AttributeNames';\nimport { Err, IgnoreMatcher, ParsedRequestOptions } from './types';\n\n/**\n * Get an absolute url\n */\nexport const getAbsoluteUrl = (\n  requestUrl: ParsedRequestOptions | null,\n  headers: IncomingHttpHeaders | OutgoingHttpHeaders,\n  fallbackProtocol = 'http:'\n): string => {\n  const reqUrlObject = requestUrl || {};\n  const protocol = reqUrlObject.protocol || fallbackProtocol;\n  const port = (reqUrlObject.port || '').toString();\n  const path = reqUrlObject.path || '/';\n  let host =\n    reqUrlObject.host || reqUrlObject.hostname || headers.host || 'localhost';\n\n  // if there is no port in host and there is a port\n  // it should be displayed if it's not 80 and 443 (default ports)\n  if (\n    (host as string).indexOf(':') === -1 &&\n    port &&\n    port !== '80' &&\n    port !== '443'\n  ) {\n    host += `:${port}`;\n  }\n\n  return `${protocol}//${host}${path}`;\n};\n\n/**\n * Parse status code from HTTP response. [More details](https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/data-http.md#status)\n */\nexport const parseResponseStatus = (\n  kind: SpanKind,\n  statusCode?: number\n): SpanStatusCode => {\n  const upperBound = kind === SpanKind.CLIENT ? 400 : 500;\n  // 1xx, 2xx, 3xx are OK on client and server\n  // 4xx is OK on server\n  if (statusCode && statusCode >= 100 && statusCode < upperBound) {\n    return SpanStatusCode.UNSET;\n  }\n\n  // All other codes are error\n  return SpanStatusCode.ERROR;\n};\n\n/**\n * Check whether the given obj match pattern\n * @param constant e.g URL of request\n * @param pattern Match pattern\n */\nexport const satisfiesPattern = (\n  constant: string,\n  pattern: IgnoreMatcher\n): boolean => {\n  if (typeof pattern === 'string') {\n    return pattern === constant;\n  } else if (pattern instanceof RegExp) {\n    return pattern.test(constant);\n  } else if (typeof pattern === 'function') {\n    return pattern(constant);\n  } else {\n    throw new TypeError('Pattern is in unsupported datatype');\n  }\n};\n\n/**\n * Check whether the given request is ignored by configuration\n * It will not re-throw exceptions from `list` provided by the client\n * @param constant e.g URL of request\n * @param [list] List of ignore patterns\n * @param [onException] callback for doing something when an exception has\n *     occurred\n */\nexport const isIgnored = (\n  constant: string,\n  list?: IgnoreMatcher[],\n  onException?: (error: unknown) => void\n): boolean => {\n  if (!list) {\n    // No ignored urls - trace everything\n    return false;\n  }\n  // Try/catch outside the loop for failing fast\n  try {\n    for (const pattern of list) {\n      if (satisfiesPattern(constant, pattern)) {\n        return true;\n      }\n    }\n  } catch (e) {\n    if (onException) {\n      onException(e);\n    }\n  }\n\n  return false;\n};\n\n/**\n * Sets the span with the error passed in params\n * @param {Span} span the span that need to be set\n * @param {Error} error error that will be set to span\n */\nexport const setSpanWithError = (span: Span, error: Err): void => {\n  const message = error.message;\n\n  span.setAttribute(AttributeNames.HTTP_ERROR_NAME, error.name);\n  span.setAttribute(AttributeNames.HTTP_ERROR_MESSAGE, message);\n  span.setStatus({ code: SpanStatusCode.ERROR, message });\n  span.recordException(error);\n};\n\n/**\n * Adds attributes for request content-length and content-encoding HTTP headers\n * @param { IncomingMessage } Request object whose headers will be analyzed\n * @param { SpanAttributes } SpanAttributes object to be modified\n */\nexport const setRequestContentLengthAttribute = (\n  request: IncomingMessage,\n  attributes: SpanAttributes\n): void => {\n  const length = getContentLength(request.headers);\n  if (length === null) return;\n\n  if (isCompressed(request.headers)) {\n    attributes[SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH] = length;\n  } else {\n    attributes[SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED] = length;\n  }\n};\n\n/**\n * Adds attributes for response content-length and content-encoding HTTP headers\n * @param { IncomingMessage } Response object whose headers will be analyzed\n * @param { SpanAttributes } SpanAttributes object to be modified\n */\nexport const setResponseContentLengthAttribute = (\n  response: IncomingMessage,\n  attributes: SpanAttributes\n): void => {\n  const length = getContentLength(response.headers);\n  if (length === null) return;\n\n  if (isCompressed(response.headers)) {\n    attributes[SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH] = length;\n  } else {\n    attributes[SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED] = length;\n  }\n};\n\nfunction getContentLength(\n  headers: OutgoingHttpHeaders | IncomingHttpHeaders\n): number | null {\n  const contentLengthHeader = headers['content-length'];\n  if (contentLengthHeader === undefined) return null;\n\n  const contentLength = parseInt(contentLengthHeader as string, 10);\n  if (isNaN(contentLength)) return null;\n\n  return contentLength;\n}\n\nexport const isCompressed = (\n  headers: OutgoingHttpHeaders | IncomingHttpHeaders\n): boolean => {\n  const encoding = headers['content-encoding'];\n\n  return !!encoding && encoding !== 'identity';\n};\n\n/**\n * Makes sure options is an url object\n * return an object with default value and parsed options\n * @param options original options for the request\n * @param [extraOptions] additional options for the request\n */\nexport const getRequestInfo = (\n  options: url.URL | RequestOptions | string,\n  extraOptions?: RequestOptions\n): {\n  origin: string;\n  pathname: string;\n  method: string;\n  optionsParsed: RequestOptions;\n} => {\n  let pathname = '/';\n  let origin = '';\n  let optionsParsed: RequestOptions;\n  if (typeof options === 'string') {\n    optionsParsed = url.parse(options);\n    pathname = (optionsParsed as url.UrlWithStringQuery).pathname || '/';\n    origin = `${optionsParsed.protocol || 'http:'}//${optionsParsed.host}`;\n    if (extraOptions !== undefined) {\n      Object.assign(optionsParsed, extraOptions);\n    }\n  } else if (options instanceof url.URL) {\n    optionsParsed = {\n      protocol: options.protocol,\n      hostname:\n        typeof options.hostname === 'string' && options.hostname.startsWith('[')\n          ? options.hostname.slice(1, -1)\n          : options.hostname,\n      path: `${options.pathname || ''}${options.search || ''}`,\n    };\n    if (options.port !== '') {\n      optionsParsed.port = Number(options.port);\n    }\n    if (options.username || options.password) {\n      optionsParsed.auth = `${options.username}:${options.password}`;\n    }\n    pathname = options.pathname;\n    origin = options.origin;\n    if (extraOptions !== undefined) {\n      Object.assign(optionsParsed, extraOptions);\n    }\n  } else {\n    optionsParsed = Object.assign(\n      { protocol: options.host ? 'http:' : undefined },\n      options\n    );\n    pathname = (options as url.URL).pathname;\n    if (!pathname && optionsParsed.path) {\n      pathname = url.parse(optionsParsed.path).pathname || '/';\n    }\n    const hostname =\n      optionsParsed.host ||\n      (optionsParsed.port != null\n        ? `${optionsParsed.hostname}${optionsParsed.port}`\n        : optionsParsed.hostname);\n    origin = `${optionsParsed.protocol || 'http:'}//${hostname}`;\n  }\n\n  // some packages return method in lowercase..\n  // ensure upperCase for consistency\n  const method = optionsParsed.method\n    ? optionsParsed.method.toUpperCase()\n    : 'GET';\n\n  return { origin, pathname, method, optionsParsed };\n};\n\n/**\n * Makes sure options is of type string or object\n * @param options for the request\n */\nexport const isValidOptionsType = (options: unknown): boolean => {\n  if (!options) {\n    return false;\n  }\n\n  const type = typeof options;\n  return type === 'string' || (type === 'object' && !Array.isArray(options));\n};\n\nexport const extractHostnameAndPort = (\n  requestOptions: Pick<\n    ParsedRequestOptions,\n    'hostname' | 'host' | 'port' | 'protocol'\n  >\n): { hostname: string; port: number | string } => {\n  if (requestOptions.hostname && requestOptions.port) {\n    return { hostname: requestOptions.hostname, port: requestOptions.port };\n  }\n  const matches = requestOptions.host?.match(/^([^:/ ]+)(:\\d{1,5})?/) || null;\n  const hostname =\n    requestOptions.hostname || (matches === null ? 'localhost' : matches[1]);\n  let port = requestOptions.port;\n  if (!port) {\n    if (matches && matches[2]) {\n      // remove the leading \":\". The extracted port would be something like \":8080\"\n      port = matches[2].substring(1);\n    } else {\n      port = requestOptions.protocol === 'https:' ? '443' : '80';\n    }\n  }\n  return { hostname, port };\n};\n\n/**\n * Returns outgoing request attributes scoped to the options passed to the request\n * @param {ParsedRequestOptions} requestOptions the same options used to make the request\n * @param {{ component: string, hostname: string, hookAttributes?: SpanAttributes }} options used to pass data needed to create attributes\n */\nexport const getOutgoingRequestAttributes = (\n  requestOptions: ParsedRequestOptions,\n  options: {\n    component: string;\n    hostname: string;\n    port: string | number;\n    hookAttributes?: SpanAttributes;\n  }\n): SpanAttributes => {\n  const hostname = options.hostname;\n  const port = options.port;\n  const requestMethod = requestOptions.method;\n  const method = requestMethod ? requestMethod.toUpperCase() : 'GET';\n  const headers = requestOptions.headers || {};\n  const userAgent = headers['user-agent'];\n  const attributes: SpanAttributes = {\n    [SEMATTRS_HTTP_URL]: getAbsoluteUrl(\n      requestOptions,\n      headers,\n      `${options.component}:`\n    ),\n    [SEMATTRS_HTTP_METHOD]: method,\n    [SEMATTRS_HTTP_TARGET]: requestOptions.path || '/',\n    [SEMATTRS_NET_PEER_NAME]: hostname,\n    [SEMATTRS_HTTP_HOST]: headers.host ?? `${hostname}:${port}`,\n  };\n\n  if (userAgent !== undefined) {\n    attributes[SEMATTRS_HTTP_USER_AGENT] = userAgent;\n  }\n  return Object.assign(attributes, options.hookAttributes);\n};\n\n/**\n * Returns outgoing request Metric attributes scoped to the request data\n * @param {SpanAttributes} spanAttributes the span attributes\n */\nexport const getOutgoingRequestMetricAttributes = (\n  spanAttributes: SpanAttributes\n): MetricAttributes => {\n  const metricAttributes: MetricAttributes = {};\n  metricAttributes[SEMATTRS_HTTP_METHOD] = spanAttributes[SEMATTRS_HTTP_METHOD];\n  metricAttributes[SEMATTRS_NET_PEER_NAME] =\n    spanAttributes[SEMATTRS_NET_PEER_NAME];\n  //TODO: http.url attribute, it should substitute any parameters to avoid high cardinality.\n  return metricAttributes;\n};\n\n/**\n * Returns attributes related to the kind of HTTP protocol used\n * @param {string} [kind] Kind of HTTP protocol used: \"1.0\", \"1.1\", \"2\", \"SPDY\" or \"QUIC\".\n */\nexport const setAttributesFromHttpKind = (\n  kind: string | undefined,\n  attributes: SpanAttributes\n): void => {\n  if (kind) {\n    attributes[SEMATTRS_HTTP_FLAVOR] = kind;\n    if (kind.toUpperCase() !== 'QUIC') {\n      attributes[SEMATTRS_NET_TRANSPORT] = NETTRANSPORTVALUES_IP_TCP;\n    } else {\n      attributes[SEMATTRS_NET_TRANSPORT] = NETTRANSPORTVALUES_IP_UDP;\n    }\n  }\n};\n\n/**\n * Returns outgoing request attributes scoped to the response data\n * @param {IncomingMessage} response the response object\n * @param {{ hostname: string }} options used to pass data needed to create attributes\n */\nexport const getOutgoingRequestAttributesOnResponse = (\n  response: IncomingMessage\n): SpanAttributes => {\n  const { statusCode, statusMessage, httpVersion, socket } = response;\n  const attributes: SpanAttributes = {};\n  if (socket) {\n    const { remoteAddress, remotePort } = socket;\n    attributes[SEMATTRS_NET_PEER_IP] = remoteAddress;\n    attributes[SEMATTRS_NET_PEER_PORT] = remotePort;\n  }\n  setResponseContentLengthAttribute(response, attributes);\n\n  if (statusCode) {\n    attributes[SEMATTRS_HTTP_STATUS_CODE] = statusCode;\n    attributes[AttributeNames.HTTP_STATUS_TEXT] = (\n      statusMessage || ''\n    ).toUpperCase();\n  }\n\n  setAttributesFromHttpKind(httpVersion, attributes);\n  return attributes;\n};\n\n/**\n * Returns outgoing request Metric attributes scoped to the response data\n * @param {SpanAttributes} spanAttributes the span attributes\n */\nexport const getOutgoingRequestMetricAttributesOnResponse = (\n  spanAttributes: SpanAttributes\n): MetricAttributes => {\n  const metricAttributes: MetricAttributes = {};\n  metricAttributes[SEMATTRS_NET_PEER_PORT] =\n    spanAttributes[SEMATTRS_NET_PEER_PORT];\n  metricAttributes[SEMATTRS_HTTP_STATUS_CODE] =\n    spanAttributes[SEMATTRS_HTTP_STATUS_CODE];\n  metricAttributes[SEMATTRS_HTTP_FLAVOR] = spanAttributes[SEMATTRS_HTTP_FLAVOR];\n  return metricAttributes;\n};\n\n/**\n * Returns incoming request attributes scoped to the request data\n * @param {IncomingMessage} request the request object\n * @param {{ component: string, serverName?: string, hookAttributes?: SpanAttributes }} options used to pass data needed to create attributes\n */\nexport const getIncomingRequestAttributes = (\n  request: IncomingMessage,\n  options: {\n    component: string;\n    serverName?: string;\n    hookAttributes?: SpanAttributes;\n  }\n): SpanAttributes => {\n  const headers = request.headers;\n  const userAgent = headers['user-agent'];\n  const ips = headers['x-forwarded-for'];\n  const method = request.method || 'GET';\n  const httpVersion = request.httpVersion;\n  const requestUrl = request.url ? url.parse(request.url) : null;\n  const host = requestUrl?.host || headers.host;\n  const hostname =\n    requestUrl?.hostname ||\n    host?.replace(/^(.*)(:[0-9]{1,5})/, '$1') ||\n    'localhost';\n  const serverName = options.serverName;\n  const attributes: SpanAttributes = {\n    [SEMATTRS_HTTP_URL]: getAbsoluteUrl(\n      requestUrl,\n      headers,\n      `${options.component}:`\n    ),\n    [SEMATTRS_HTTP_HOST]: host,\n    [SEMATTRS_NET_HOST_NAME]: hostname,\n    [SEMATTRS_HTTP_METHOD]: method,\n    [SEMATTRS_HTTP_SCHEME]: options.component,\n  };\n\n  if (typeof ips === 'string') {\n    attributes[SEMATTRS_HTTP_CLIENT_IP] = ips.split(',')[0];\n  }\n\n  if (typeof serverName === 'string') {\n    attributes[SEMATTRS_HTTP_SERVER_NAME] = serverName;\n  }\n\n  if (requestUrl) {\n    attributes[SEMATTRS_HTTP_TARGET] = requestUrl.path || '/';\n  }\n\n  if (userAgent !== undefined) {\n    attributes[SEMATTRS_HTTP_USER_AGENT] = userAgent;\n  }\n  setRequestContentLengthAttribute(request, attributes);\n  setAttributesFromHttpKind(httpVersion, attributes);\n  return Object.assign(attributes, options.hookAttributes);\n};\n\n/**\n * Returns incoming request Metric attributes scoped to the request data\n * @param {SpanAttributes} spanAttributes the span attributes\n * @param {{ component: string }} options used to pass data needed to create attributes\n */\nexport const getIncomingRequestMetricAttributes = (\n  spanAttributes: SpanAttributes\n): MetricAttributes => {\n  const metricAttributes: MetricAttributes = {};\n  metricAttributes[SEMATTRS_HTTP_SCHEME] = spanAttributes[SEMATTRS_HTTP_SCHEME];\n  metricAttributes[SEMATTRS_HTTP_METHOD] = spanAttributes[SEMATTRS_HTTP_METHOD];\n  metricAttributes[SEMATTRS_NET_HOST_NAME] =\n    spanAttributes[SEMATTRS_NET_HOST_NAME];\n  metricAttributes[SEMATTRS_HTTP_FLAVOR] = spanAttributes[SEMATTRS_HTTP_FLAVOR];\n  //TODO: http.target attribute, it should substitute any parameters to avoid high cardinality.\n  return metricAttributes;\n};\n\n/**\n * Returns incoming request attributes scoped to the response data\n * @param {(ServerResponse & { socket: Socket; })} response the response object\n */\nexport const getIncomingRequestAttributesOnResponse = (\n  request: IncomingMessage,\n  response: ServerResponse\n): SpanAttributes => {\n  // take socket from the request,\n  // since it may be detached from the response object in keep-alive mode\n  const { socket } = request;\n  const { statusCode, statusMessage } = response;\n\n  const rpcMetadata = getRPCMetadata(context.active());\n  const attributes: SpanAttributes = {};\n  if (socket) {\n    const { localAddress, localPort, remoteAddress, remotePort } = socket;\n    attributes[SEMATTRS_NET_HOST_IP] = localAddress;\n    attributes[SEMATTRS_NET_HOST_PORT] = localPort;\n    attributes[SEMATTRS_NET_PEER_IP] = remoteAddress;\n    attributes[SEMATTRS_NET_PEER_PORT] = remotePort;\n  }\n  attributes[SEMATTRS_HTTP_STATUS_CODE] = statusCode;\n  attributes[AttributeNames.HTTP_STATUS_TEXT] = (\n    statusMessage || ''\n  ).toUpperCase();\n\n  if (rpcMetadata?.type === RPCType.HTTP && rpcMetadata.route !== undefined) {\n    attributes[SEMATTRS_HTTP_ROUTE] = rpcMetadata.route;\n  }\n  return attributes;\n};\n\n/**\n * Returns incoming request Metric attributes scoped to the request data\n * @param {SpanAttributes} spanAttributes the span attributes\n */\nexport const getIncomingRequestMetricAttributesOnResponse = (\n  spanAttributes: SpanAttributes\n): MetricAttributes => {\n  const metricAttributes: MetricAttributes = {};\n  metricAttributes[SEMATTRS_HTTP_STATUS_CODE] =\n    spanAttributes[SEMATTRS_HTTP_STATUS_CODE];\n  metricAttributes[SEMATTRS_NET_HOST_PORT] =\n    spanAttributes[SEMATTRS_NET_HOST_PORT];\n  if (spanAttributes[SEMATTRS_HTTP_ROUTE] !== undefined) {\n    metricAttributes[SEMATTRS_HTTP_ROUTE] = spanAttributes[SEMATTRS_HTTP_ROUTE];\n  }\n  return metricAttributes;\n};\n\nexport function headerCapture(type: 'request' | 'response', headers: string[]) {\n  const normalizedHeaders = new Map<string, string>();\n  for (let i = 0, len = headers.length; i < len; i++) {\n    const capturedHeader = headers[i].toLowerCase();\n    normalizedHeaders.set(capturedHeader, capturedHeader.replace(/-/g, '_'));\n  }\n\n  return (\n    span: Span,\n    getHeader: (key: string) => undefined | string | string[] | number\n  ) => {\n    for (const capturedHeader of normalizedHeaders.keys()) {\n      const value = getHeader(capturedHeader);\n\n      if (value === undefined) {\n        continue;\n      }\n\n      const normalizedHeader = normalizedHeaders.get(capturedHeader);\n      const key = `http.${type}.header.${normalizedHeader}`;\n\n      if (typeof value === 'string') {\n        span.setAttribute(key, [value]);\n      } else if (Array.isArray(value)) {\n        span.setAttribute(key, value);\n      } else {\n        span.setAttribute(key, [value]);\n      }\n    }\n  };\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const VERSION = '0.52.1';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LogRecord } from './LogRecord';\n\nexport interface Logger {\n  /**\n   * Emit a log record. This method should only be used by log appenders.\n   *\n   * @param logRecord\n   */\n  emit(logRecord: LogRecord): void;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Logger } from './Logger';\nimport { LoggerOptions } from './LoggerOptions';\n\n/**\n * A registry for creating named {@link Logger}s.\n */\nexport interface LoggerProvider {\n  /**\n   * Returns a Logger, creating one if one with the given name, version, and\n   * schemaUrl pair is not already created.\n   *\n   * @param name The name of the logger or instrumentation library.\n   * @param version The version of the logger or instrumentation library.\n   * @param options The options of the logger or instrumentation library.\n   * @returns Logger A Logger with the given name and version\n   */\n  getLogger(name: string, version?: string, options?: LoggerOptions): Logger;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Context, TimeInput } from '@opentelemetry/api';\nimport { AnyValue, AnyValueMap } from './AnyValue';\n\nexport type LogBody = AnyValue;\nexport type LogAttributes = AnyValueMap;\n\nexport enum SeverityNumber {\n  UNSPECIFIED = 0,\n  TRACE = 1,\n  TRACE2 = 2,\n  TRACE3 = 3,\n  TRACE4 = 4,\n  DEBUG = 5,\n  DEBUG2 = 6,\n  DEBUG3 = 7,\n  DEBUG4 = 8,\n  INFO = 9,\n  INFO2 = 10,\n  INFO3 = 11,\n  INFO4 = 12,\n  WARN = 13,\n  WARN2 = 14,\n  WARN3 = 15,\n  WARN4 = 16,\n  ERROR = 17,\n  ERROR2 = 18,\n  ERROR3 = 19,\n  ERROR4 = 20,\n  FATAL = 21,\n  FATAL2 = 22,\n  FATAL3 = 23,\n  FATAL4 = 24,\n}\n\nexport interface LogRecord {\n  /**\n   * The time when the log record occurred as UNIX Epoch time in nanoseconds.\n   */\n  timestamp?: TimeInput;\n\n  /**\n   * Time when the event was observed by the collection system.\n   */\n  observedTimestamp?: TimeInput;\n\n  /**\n   * Numerical value of the severity.\n   */\n  severityNumber?: SeverityNumber;\n\n  /**\n   * The severity text.\n   */\n  severityText?: string;\n\n  /**\n   * A value containing the body of the log record.\n   */\n  body?: LogBody;\n\n  /**\n   * Attributes that define the log record.\n   */\n  attributes?: LogAttributes;\n\n  /**\n   * The Context associated with the LogRecord.\n   */\n  context?: Context;\n}\n","export {};\n//# sourceMappingURL=LoggerOptions.js.map","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AttributeValue } from '@opentelemetry/api';\n\n/**\n * AnyValueMap is a map from string to AnyValue (attribute value or a nested map)\n */\nexport interface AnyValueMap {\n  [attributeKey: string]: AnyValue | undefined;\n}\n\n/**\n * AnyValue is a either an attribute value or a map of AnyValue(s)\n */\nexport type AnyValue = AttributeValue | AnyValueMap;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Logger } from './types/Logger';\nimport { LogRecord } from './types/LogRecord';\n\nexport class NoopLogger implements Logger {\n  emit(_logRecord: LogRecord): void {}\n}\n\nexport const NOOP_LOGGER = new NoopLogger();\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LoggerProvider } from './types/LoggerProvider';\nimport { Logger } from './types/Logger';\nimport { LoggerOptions } from './types/LoggerOptions';\nimport { NoopLogger } from './NoopLogger';\n\nexport class NoopLoggerProvider implements LoggerProvider {\n  getLogger(\n    _name: string,\n    _version?: string | undefined,\n    _options?: LoggerOptions | undefined\n  ): Logger {\n    return new NoopLogger();\n  }\n}\n\nexport const NOOP_LOGGER_PROVIDER = new NoopLoggerProvider();\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** only globals that common to node and browsers are allowed */\n// eslint-disable-next-line node/no-unsupported-features/es-builtins\nexport const _globalThis = typeof globalThis === 'object' ? globalThis : global;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './globalThis';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './node';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LoggerProvider } from '../types/LoggerProvider';\nimport { _globalThis } from '../platform';\n\nexport const GLOBAL_LOGS_API_KEY = Symbol.for('io.opentelemetry.js.api.logs');\n\ntype Get<T> = (version: number) => T;\ntype OtelGlobal = Partial<{\n  [GLOBAL_LOGS_API_KEY]: Get<LoggerProvider>;\n}>;\n\nexport const _global = _globalThis as OtelGlobal;\n\n/**\n * Make a function which accepts a version integer and returns the instance of an API if the version\n * is compatible, or a fallback version (usually NOOP) if it is not.\n *\n * @param requiredVersion Backwards compatibility version which is required to return the instance\n * @param instance Instance which should be returned if the required version is compatible\n * @param fallback Fallback instance, usually NOOP, which will be returned if the required version is not compatible\n */\nexport function makeGetter<T>(\n  requiredVersion: number,\n  instance: T,\n  fallback: T\n): Get<T> {\n  return (version: number): T =>\n    version === requiredVersion ? instance : fallback;\n}\n\n/**\n * A number which should be incremented each time a backwards incompatible\n * change is made to the API. This number is used when an API package\n * attempts to access the global API to ensure it is getting a compatible\n * version. If the global API is not compatible with the API package\n * attempting to get it, a NOOP API implementation will be returned.\n */\nexport const API_BACKWARDS_COMPATIBILITY_VERSION = 1;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  API_BACKWARDS_COMPATIBILITY_VERSION,\n  GLOBAL_LOGS_API_KEY,\n  _global,\n  makeGetter,\n} from '../internal/global-utils';\nimport { LoggerProvider } from '../types/LoggerProvider';\nimport { NOOP_LOGGER_PROVIDER } from '../NoopLoggerProvider';\nimport { Logger } from '../types/Logger';\nimport { LoggerOptions } from '../types/LoggerOptions';\n\nexport class LogsAPI {\n  private static _instance?: LogsAPI;\n\n  private constructor() {}\n\n  public static getInstance(): LogsAPI {\n    if (!this._instance) {\n      this._instance = new LogsAPI();\n    }\n\n    return this._instance;\n  }\n\n  public setGlobalLoggerProvider(provider: LoggerProvider): LoggerProvider {\n    if (_global[GLOBAL_LOGS_API_KEY]) {\n      return this.getLoggerProvider();\n    }\n\n    _global[GLOBAL_LOGS_API_KEY] = makeGetter<LoggerProvider>(\n      API_BACKWARDS_COMPATIBILITY_VERSION,\n      provider,\n      NOOP_LOGGER_PROVIDER\n    );\n\n    return provider;\n  }\n\n  /**\n   * Returns the global logger provider.\n   *\n   * @returns LoggerProvider\n   */\n  public getLoggerProvider(): LoggerProvider {\n    return (\n      _global[GLOBAL_LOGS_API_KEY]?.(API_BACKWARDS_COMPATIBILITY_VERSION) ??\n      NOOP_LOGGER_PROVIDER\n    );\n  }\n\n  /**\n   * Returns a logger from the global logger provider.\n   *\n   * @returns Logger\n   */\n  public getLogger(\n    name: string,\n    version?: string,\n    options?: LoggerOptions\n  ): Logger {\n    return this.getLoggerProvider().getLogger(name, version, options);\n  }\n\n  /** Remove the global logger provider */\n  public disable(): void {\n    delete _global[GLOBAL_LOGS_API_KEY];\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './types/Logger';\nexport * from './types/LoggerProvider';\nexport * from './types/LogRecord';\nexport * from './types/LoggerOptions';\nexport * from './types/AnyValue';\nexport * from './NoopLogger';\nexport * from './NoopLoggerProvider';\n\nimport { LogsAPI } from './api/logs';\nexport const logs = LogsAPI.getInstance();\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TracerProvider, MeterProvider } from '@opentelemetry/api';\nimport { Instrumentation } from './types';\nimport { LoggerProvider } from '@opentelemetry/api-logs';\n\n/**\n * Enable instrumentations\n * @param instrumentations\n * @param tracerProvider\n * @param meterProvider\n */\nexport function enableInstrumentations(\n  instrumentations: Instrumentation[],\n  tracerProvider?: TracerProvider,\n  meterProvider?: MeterProvider,\n  loggerProvider?: LoggerProvider\n): void {\n  for (let i = 0, j = instrumentations.length; i < j; i++) {\n    const instrumentation = instrumentations[i];\n    if (tracerProvider) {\n      instrumentation.setTracerProvider(tracerProvider);\n    }\n    if (meterProvider) {\n      instrumentation.setMeterProvider(meterProvider);\n    }\n    if (loggerProvider && instrumentation.setLoggerProvider) {\n      instrumentation.setLoggerProvider(loggerProvider);\n    }\n    // instrumentations have been already enabled during creation\n    // so enable only if user prevented that by setting enabled to false\n    // this is to prevent double enabling but when calling register all\n    // instrumentations should be now enabled\n    if (!instrumentation.getConfig().enabled) {\n      instrumentation.enable();\n    }\n  }\n}\n\n/**\n * Disable instrumentations\n * @param instrumentations\n */\nexport function disableInstrumentations(\n  instrumentations: Instrumentation[]\n): void {\n  instrumentations.forEach(instrumentation => instrumentation.disable());\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { trace, metrics } from '@opentelemetry/api';\nimport { logs } from '@opentelemetry/api-logs';\nimport {\n  disableInstrumentations,\n  enableInstrumentations,\n} from './autoLoaderUtils';\nimport { AutoLoaderOptions } from './types_internal';\n\n/**\n * It will register instrumentations and plugins\n * @param options\n * @return returns function to unload instrumentation and plugins that were\n *   registered\n */\nexport function registerInstrumentations(\n  options: AutoLoaderOptions\n): () => void {\n  const tracerProvider = options.tracerProvider || trace.getTracerProvider();\n  const meterProvider = options.meterProvider || metrics.getMeterProvider();\n  const loggerProvider = options.loggerProvider || logs.getLoggerProvider();\n  const instrumentations = options.instrumentations?.flat() ?? [];\n\n  enableInstrumentations(\n    instrumentations,\n    tracerProvider,\n    meterProvider,\n    loggerProvider\n  );\n\n  return () => {\n    disableInstrumentations(instrumentations);\n  };\n}\n","'use strict'\n\nfunction isFunction (funktion) {\n  return typeof funktion === 'function'\n}\n\n// Default to complaining loudly when things don't go according to plan.\nvar logger = console.error.bind(console)\n\n// Sets a property on an object, preserving its enumerability.\n// This function assumes that the property is already writable.\nfunction defineProperty (obj, name, value) {\n  var enumerable = !!obj[name] && obj.propertyIsEnumerable(name)\n  Object.defineProperty(obj, name, {\n    configurable: true,\n    enumerable: enumerable,\n    writable: true,\n    value: value\n  })\n}\n\n// Keep initialization idempotent.\nfunction shimmer (options) {\n  if (options && options.logger) {\n    if (!isFunction(options.logger)) logger(\"new logger isn't a function, not replacing\")\n    else logger = options.logger\n  }\n}\n\nfunction wrap (nodule, name, wrapper) {\n  if (!nodule || !nodule[name]) {\n    logger('no original function ' + name + ' to wrap')\n    return\n  }\n\n  if (!wrapper) {\n    logger('no wrapper function')\n    logger((new Error()).stack)\n    return\n  }\n\n  if (!isFunction(nodule[name]) || !isFunction(wrapper)) {\n    logger('original object and wrapper must be functions')\n    return\n  }\n\n  var original = nodule[name]\n  var wrapped = wrapper(original, name)\n\n  defineProperty(wrapped, '__original', original)\n  defineProperty(wrapped, '__unwrap', function () {\n    if (nodule[name] === wrapped) defineProperty(nodule, name, original)\n  })\n  defineProperty(wrapped, '__wrapped', true)\n\n  defineProperty(nodule, name, wrapped)\n  return wrapped\n}\n\nfunction massWrap (nodules, names, wrapper) {\n  if (!nodules) {\n    logger('must provide one or more modules to patch')\n    logger((new Error()).stack)\n    return\n  } else if (!Array.isArray(nodules)) {\n    nodules = [nodules]\n  }\n\n  if (!(names && Array.isArray(names))) {\n    logger('must provide one or more functions to wrap on modules')\n    return\n  }\n\n  nodules.forEach(function (nodule) {\n    names.forEach(function (name) {\n      wrap(nodule, name, wrapper)\n    })\n  })\n}\n\nfunction unwrap (nodule, name) {\n  if (!nodule || !nodule[name]) {\n    logger('no function to unwrap.')\n    logger((new Error()).stack)\n    return\n  }\n\n  if (!nodule[name].__unwrap) {\n    logger('no original to unwrap to -- has ' + name + ' already been unwrapped?')\n  } else {\n    return nodule[name].__unwrap()\n  }\n}\n\nfunction massUnwrap (nodules, names) {\n  if (!nodules) {\n    logger('must provide one or more modules to patch')\n    logger((new Error()).stack)\n    return\n  } else if (!Array.isArray(nodules)) {\n    nodules = [nodules]\n  }\n\n  if (!(names && Array.isArray(names))) {\n    logger('must provide one or more functions to unwrap on modules')\n    return\n  }\n\n  nodules.forEach(function (nodule) {\n    names.forEach(function (name) {\n      unwrap(nodule, name)\n    })\n  })\n}\n\nshimmer.wrap = wrap\nshimmer.massWrap = massWrap\nshimmer.unwrap = unwrap\nshimmer.massUnwrap = massUnwrap\n\nmodule.exports = shimmer\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  diag,\n  DiagLogger,\n  metrics,\n  Meter,\n  MeterProvider,\n  trace,\n  Tracer,\n  TracerProvider,\n  Span,\n} from '@opentelemetry/api';\nimport { Logger, LoggerProvider, logs } from '@opentelemetry/api-logs';\nimport * as shimmer from 'shimmer';\nimport {\n  InstrumentationModuleDefinition,\n  Instrumentation,\n  InstrumentationConfig,\n  SpanCustomizationHook,\n} from './types';\n\n/**\n * Base abstract internal class for instrumenting node and web plugins\n */\nexport abstract class InstrumentationAbstract<\n  ConfigType extends InstrumentationConfig = InstrumentationConfig,\n> implements Instrumentation<ConfigType>\n{\n  protected _config: ConfigType;\n\n  private _tracer: Tracer;\n  private _meter: Meter;\n  private _logger: Logger;\n  protected _diag: DiagLogger;\n\n  constructor(\n    public readonly instrumentationName: string,\n    public readonly instrumentationVersion: string,\n    config: ConfigType\n  ) {\n    // copy config first level properties to ensure they are immutable.\n    // nested properties are not copied, thus are mutable from the outside.\n    this._config = {\n      enabled: true,\n      ...config,\n    };\n\n    this._diag = diag.createComponentLogger({\n      namespace: instrumentationName,\n    });\n\n    this._tracer = trace.getTracer(instrumentationName, instrumentationVersion);\n    this._meter = metrics.getMeter(instrumentationName, instrumentationVersion);\n    this._logger = logs.getLogger(instrumentationName, instrumentationVersion);\n    this._updateMetricInstruments();\n  }\n\n  /* Api to wrap instrumented method */\n  protected _wrap = shimmer.wrap;\n  /* Api to unwrap instrumented methods */\n  protected _unwrap = shimmer.unwrap;\n  /* Api to mass wrap instrumented method */\n  protected _massWrap = shimmer.massWrap;\n  /* Api to mass unwrap instrumented methods */\n  protected _massUnwrap = shimmer.massUnwrap;\n\n  /* Returns meter */\n  protected get meter(): Meter {\n    return this._meter;\n  }\n\n  /**\n   * Sets MeterProvider to this plugin\n   * @param meterProvider\n   */\n  public setMeterProvider(meterProvider: MeterProvider): void {\n    this._meter = meterProvider.getMeter(\n      this.instrumentationName,\n      this.instrumentationVersion\n    );\n\n    this._updateMetricInstruments();\n  }\n\n  /* Returns logger */\n  protected get logger(): Logger {\n    return this._logger;\n  }\n\n  /**\n   * Sets LoggerProvider to this plugin\n   * @param loggerProvider\n   */\n  public setLoggerProvider(loggerProvider: LoggerProvider): void {\n    this._logger = loggerProvider.getLogger(\n      this.instrumentationName,\n      this.instrumentationVersion\n    );\n  }\n\n  /**\n   * @experimental\n   *\n   * Get module definitions defined by {@link init}.\n   * This can be used for experimental compile-time instrumentation.\n   *\n   * @returns an array of {@link InstrumentationModuleDefinition}\n   */\n  public getModuleDefinitions(): InstrumentationModuleDefinition[] {\n    const initResult = this.init() ?? [];\n    if (!Array.isArray(initResult)) {\n      return [initResult];\n    }\n\n    return initResult;\n  }\n\n  /**\n   * Sets the new metric instruments with the current Meter.\n   */\n  protected _updateMetricInstruments(): void {\n    return;\n  }\n\n  /* Returns InstrumentationConfig */\n  public getConfig(): ConfigType {\n    return this._config;\n  }\n\n  /**\n   * Sets InstrumentationConfig to this plugin\n   * @param InstrumentationConfig\n   */\n  public setConfig(config: ConfigType): void {\n    // copy config first level properties to ensure they are immutable.\n    // nested properties are not copied, thus are mutable from the outside.\n    this._config = { ...config };\n  }\n\n  /**\n   * Sets TraceProvider to this plugin\n   * @param tracerProvider\n   */\n  public setTracerProvider(tracerProvider: TracerProvider): void {\n    this._tracer = tracerProvider.getTracer(\n      this.instrumentationName,\n      this.instrumentationVersion\n    );\n  }\n\n  /* Returns tracer */\n  protected get tracer(): Tracer {\n    return this._tracer;\n  }\n\n  /* Disable plugin */\n  public abstract enable(): void;\n\n  /* Enable plugin */\n  public abstract disable(): void;\n\n  /**\n   * Init method in which plugin should define _modules and patches for\n   * methods.\n   */\n  protected abstract init():\n    | InstrumentationModuleDefinition\n    | InstrumentationModuleDefinition[]\n    | void;\n\n  /**\n   * Execute span customization hook, if configured, and log any errors.\n   * Any semantics of the trigger and info are defined by the specific instrumentation.\n   * @param hookHandler The optional hook handler which the user has configured via instrumentation config\n   * @param triggerName The name of the trigger for executing the hook for logging purposes\n   * @param span The span to which the hook should be applied\n   * @param info The info object to be passed to the hook, with useful data the hook may use\n   */\n  protected _runSpanCustomizationHook<SpanCustomizationInfoType>(\n    hookHandler: SpanCustomizationHook<SpanCustomizationInfoType> | undefined,\n    triggerName: string,\n    span: Span,\n    info: SpanCustomizationInfoType\n  ) {\n    if (!hookHandler) {\n      return;\n    }\n\n    try {\n      hookHandler(span, info);\n    } catch (e) {\n      this._diag.error(\n        `Error running span customization hook due to exception in handler`,\n        { triggerName },\n        e\n      );\n    }\n  }\n}\n","'use strict';\n\nvar os = require('os');\n\n// adapted from https://github.com/sindresorhus/os-homedir/blob/11e089f4754db38bb535e5a8416320c4446e8cfd/index.js\n\nmodule.exports = os.homedir || function homedir() {\n    var home = process.env.HOME;\n    var user = process.env.LOGNAME || process.env.USER || process.env.LNAME || process.env.USERNAME;\n\n    if (process.platform === 'win32') {\n        return process.env.USERPROFILE || process.env.HOMEDRIVE + process.env.HOMEPATH || home || null;\n    }\n\n    if (process.platform === 'darwin') {\n        return home || (user ? '/Users/' + user : null);\n    }\n\n    if (process.platform === 'linux') {\n        return home || (process.getuid() === 0 ? '/root' : (user ? '/home/' + user : null)); // eslint-disable-line no-extra-parens\n    }\n\n    return home || null;\n};\n","module.exports = function () {\n    // see https://code.google.com/p/v8/wiki/JavaScriptStackTraceApi\n    var origPrepareStackTrace = Error.prepareStackTrace;\n    Error.prepareStackTrace = function (_, stack) { return stack; };\n    var stack = (new Error()).stack;\n    Error.prepareStackTrace = origPrepareStackTrace;\n    return stack[2].getFileName();\n};\n","'use strict';\n\nvar isWindows = process.platform === 'win32';\n\n// Regex to split a windows path into into [dir, root, basename, name, ext]\nvar splitWindowsRe =\n    /^(((?:[a-zA-Z]:|[\\\\\\/]{2}[^\\\\\\/]+[\\\\\\/]+[^\\\\\\/]+)?[\\\\\\/]?)(?:[^\\\\\\/]*[\\\\\\/])*)((\\.{1,2}|[^\\\\\\/]+?|)(\\.[^.\\/\\\\]*|))[\\\\\\/]*$/;\n\nvar win32 = {};\n\nfunction win32SplitPath(filename) {\n  return splitWindowsRe.exec(filename).slice(1);\n}\n\nwin32.parse = function(pathString) {\n  if (typeof pathString !== 'string') {\n    throw new TypeError(\n        \"Parameter 'pathString' must be a string, not \" + typeof pathString\n    );\n  }\n  var allParts = win32SplitPath(pathString);\n  if (!allParts || allParts.length !== 5) {\n    throw new TypeError(\"Invalid path '\" + pathString + \"'\");\n  }\n  return {\n    root: allParts[1],\n    dir: allParts[0] === allParts[1] ? allParts[0] : allParts[0].slice(0, -1),\n    base: allParts[2],\n    ext: allParts[4],\n    name: allParts[3]\n  };\n};\n\n\n\n// Split a filename into [dir, root, basename, name, ext], unix version\n// 'root' is just a slash, or nothing.\nvar splitPathRe =\n    /^((\\/?)(?:[^\\/]*\\/)*)((\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))[\\/]*$/;\nvar posix = {};\n\n\nfunction posixSplitPath(filename) {\n  return splitPathRe.exec(filename).slice(1);\n}\n\n\nposix.parse = function(pathString) {\n  if (typeof pathString !== 'string') {\n    throw new TypeError(\n        \"Parameter 'pathString' must be a string, not \" + typeof pathString\n    );\n  }\n  var allParts = posixSplitPath(pathString);\n  if (!allParts || allParts.length !== 5) {\n    throw new TypeError(\"Invalid path '\" + pathString + \"'\");\n  }\n  \n  return {\n    root: allParts[1],\n    dir: allParts[0].slice(0, -1),\n    base: allParts[2],\n    ext: allParts[4],\n    name: allParts[3],\n  };\n};\n\n\nif (isWindows)\n  module.exports = win32.parse;\nelse /* posix */\n  module.exports = posix.parse;\n\nmodule.exports.posix = posix.parse;\nmodule.exports.win32 = win32.parse;\n","var path = require('path');\nvar parse = path.parse || require('path-parse'); // eslint-disable-line global-require\n\nvar getNodeModulesDirs = function getNodeModulesDirs(absoluteStart, modules) {\n    var prefix = '/';\n    if ((/^([A-Za-z]:)/).test(absoluteStart)) {\n        prefix = '';\n    } else if ((/^\\\\\\\\/).test(absoluteStart)) {\n        prefix = '\\\\\\\\';\n    }\n\n    var paths = [absoluteStart];\n    var parsed = parse(absoluteStart);\n    while (parsed.dir !== paths[paths.length - 1]) {\n        paths.push(parsed.dir);\n        parsed = parse(parsed.dir);\n    }\n\n    return paths.reduce(function (dirs, aPath) {\n        return dirs.concat(modules.map(function (moduleDir) {\n            return path.resolve(prefix, aPath, moduleDir);\n        }));\n    }, []);\n};\n\nmodule.exports = function nodeModulesPaths(start, opts, request) {\n    var modules = opts && opts.moduleDirectory\n        ? [].concat(opts.moduleDirectory)\n        : ['node_modules'];\n\n    if (opts && typeof opts.paths === 'function') {\n        return opts.paths(\n            request,\n            start,\n            function () { return getNodeModulesDirs(start, modules); },\n            opts\n        );\n    }\n\n    var dirs = getNodeModulesDirs(start, modules);\n    return opts && opts.paths ? dirs.concat(opts.paths) : dirs;\n};\n","// Info: this file has been generated by Yarn with the approval of the\n// `resolve` maintainers. Bugs caused by a code located here should be\n// opened against the Yarn repository.\n\nconst path = require(`path`);\n\nmodule.exports = function (_, opts) {\n  opts = opts || {};\n\n  if (opts.forceNodeResolution || !process.versions.pnp)\n    return opts;\n\n  // It would be nice if we could throw, but that would break the transparent\n  // compatibility with packages that use `resolve` today (such as Gulp). Since\n  // it's the whole point of this patch, we don't.\n  //\n  // if (opts.packageIterator || opts.paths)\n  //   throw new Error(`The \"packageIterator\" and \"paths\" options cannot be used in PnP environments. Set \"forceNodeResolution: true\" if absolutely needed, or branch on process.versions.pnp otherwise.`);\n\n  const {findPnpApi} = require(`module`);\n\n  const runPnpResolution = (request, basedir) => {\n    // Extract the name of the package being requested (1=package name, 2=internal path)\n    const parts = request.match(/^((?:@[^/]+\\/)?[^/]+)(\\/.*)?/);\n    if (!parts)\n      throw new Error(`Assertion failed: Expected the \"resolve\" package to call the \"paths\" callback with package names only (got \"${request}\")`);\n\n    // Make sure that basedir ends with a slash\n    if (basedir.charAt(basedir.length - 1) !== `/`)\n      basedir = path.join(basedir, `/`);\n\n    const api = findPnpApi(basedir);\n    if (api === null)\n      return undefined;\n\n    // This is guaranteed to return the path to the \"package.json\" file from the given package\n    let manifestPath;\n    try {\n      manifestPath = api.resolveToUnqualified(`${parts[1]}/package.json`, basedir, {considerBuiltins: false});\n    } catch (err) {\n      return null;\n    }\n\n    if (manifestPath === null)\n      throw new Error(`Assertion failed: The resolution thinks that \"${parts[1]}\" is a Node builtin`);\n\n    // Strip the package.json to get the package folder\n    const packagePath = path.dirname(manifestPath);\n\n    // Attach the internal path to the resolved package directory\n    const unqualifiedPath = typeof parts[2] !== `undefined`\n      ? path.join(packagePath, parts[2])\n      : packagePath;\n\n    return {packagePath, unqualifiedPath};\n  };\n\n  const runPnpResolutionOnArray = (request, paths) => {\n    for (let i = 0; i < paths.length; i++) {\n      const resolution = runPnpResolution(request, paths[i]);\n      if (resolution || i === paths.length - 1) {\n        return resolution;\n      }\n    }\n\n    return null;\n  };\n\n  const originalPaths = Array.isArray(opts.paths) ? opts.paths : [];\n\n  const packageIterator = (request, basedir, getCandidates, opts) => {\n    const pathsToTest = [basedir].concat(originalPaths);\n    const resolution = runPnpResolutionOnArray(request, pathsToTest);\n    if (resolution == null)\n      return getCandidates();\n\n    return [resolution.unqualifiedPath];\n  };\n\n  const paths = (request, basedir, getNodeModulePaths, opts) => {\n    const pathsToTest = [basedir].concat(originalPaths);\n    const resolution = runPnpResolutionOnArray(request, pathsToTest);\n    if (resolution == null)\n      return getNodeModulePaths().concat(originalPaths);\n\n    // Stip the local named folder\n    let nodeModules = path.dirname(resolution.packagePath);\n\n    // Strip the scope named folder if needed\n    if (request.match(/^@[^/]+\\//))\n      nodeModules = path.dirname(nodeModules);\n\n    return [nodeModules];\n  };\n\n  // We need to keep track whether we're in `packageIterator` or not so that\n  // the code is compatible with both `resolve` 1.9+ and `resolve` 1.15+\n  let isInsideIterator = false;\n\n  if (!opts.__skipPackageIterator) {\n    opts.packageIterator = function (request, basedir, getCandidates, opts) {\n      isInsideIterator = true;\n      try {\n        return packageIterator(request, basedir, getCandidates, opts);\n      } finally {\n        isInsideIterator = false;\n      }\n    };\n  }\n\n  opts.paths = function (request, basedir, getNodeModulePaths, opts) {\n    if (isInsideIterator)\n      return getNodeModulePaths().concat(originalPaths);\n\n    return paths(request, basedir, getNodeModulePaths, opts);\n  };\n\n  return opts;\n};\n","'use strict';\n\n/* eslint no-invalid-this: 1 */\n\nvar ERROR_MESSAGE = 'Function.prototype.bind called on incompatible ';\nvar toStr = Object.prototype.toString;\nvar max = Math.max;\nvar funcType = '[object Function]';\n\nvar concatty = function concatty(a, b) {\n    var arr = [];\n\n    for (var i = 0; i < a.length; i += 1) {\n        arr[i] = a[i];\n    }\n    for (var j = 0; j < b.length; j += 1) {\n        arr[j + a.length] = b[j];\n    }\n\n    return arr;\n};\n\nvar slicy = function slicy(arrLike, offset) {\n    var arr = [];\n    for (var i = offset || 0, j = 0; i < arrLike.length; i += 1, j += 1) {\n        arr[j] = arrLike[i];\n    }\n    return arr;\n};\n\nvar joiny = function (arr, joiner) {\n    var str = '';\n    for (var i = 0; i < arr.length; i += 1) {\n        str += arr[i];\n        if (i + 1 < arr.length) {\n            str += joiner;\n        }\n    }\n    return str;\n};\n\nmodule.exports = function bind(that) {\n    var target = this;\n    if (typeof target !== 'function' || toStr.apply(target) !== funcType) {\n        throw new TypeError(ERROR_MESSAGE + target);\n    }\n    var args = slicy(arguments, 1);\n\n    var bound;\n    var binder = function () {\n        if (this instanceof bound) {\n            var result = target.apply(\n                this,\n                concatty(args, arguments)\n            );\n            if (Object(result) === result) {\n                return result;\n            }\n            return this;\n        }\n        return target.apply(\n            that,\n            concatty(args, arguments)\n        );\n\n    };\n\n    var boundLength = max(0, target.length - args.length);\n    var boundArgs = [];\n    for (var i = 0; i < boundLength; i++) {\n        boundArgs[i] = '$' + i;\n    }\n\n    bound = Function('binder', 'return function (' + joiny(boundArgs, ',') + '){ return binder.apply(this,arguments); }')(binder);\n\n    if (target.prototype) {\n        var Empty = function Empty() {};\n        Empty.prototype = target.prototype;\n        bound.prototype = new Empty();\n        Empty.prototype = null;\n    }\n\n    return bound;\n};\n","'use strict';\n\nvar implementation = require('./implementation');\n\nmodule.exports = Function.prototype.bind || implementation;\n","'use strict';\n\nvar call = Function.prototype.call;\nvar $hasOwn = Object.prototype.hasOwnProperty;\nvar bind = require('function-bind');\n\n/** @type {import('.')} */\nmodule.exports = bind.call(call, $hasOwn);\n","{\n\t\"assert\": true,\n\t\"node:assert\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"assert/strict\": \">= 15\",\n\t\"node:assert/strict\": \">= 16\",\n\t\"async_hooks\": \">= 8\",\n\t\"node:async_hooks\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"buffer_ieee754\": \">= 0.5 && < 0.9.7\",\n\t\"buffer\": true,\n\t\"node:buffer\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"child_process\": true,\n\t\"node:child_process\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"cluster\": \">= 0.5\",\n\t\"node:cluster\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"console\": true,\n\t\"node:console\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"constants\": true,\n\t\"node:constants\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"crypto\": true,\n\t\"node:crypto\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_debug_agent\": \">= 1 && < 8\",\n\t\"_debugger\": \"< 8\",\n\t\"dgram\": true,\n\t\"node:dgram\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"diagnostics_channel\": [\">= 14.17 && < 15\", \">= 15.1\"],\n\t\"node:diagnostics_channel\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"dns\": true,\n\t\"node:dns\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"dns/promises\": \">= 15\",\n\t\"node:dns/promises\": \">= 16\",\n\t\"domain\": \">= 0.7.12\",\n\t\"node:domain\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"events\": true,\n\t\"node:events\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"freelist\": \"< 6\",\n\t\"fs\": true,\n\t\"node:fs\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"fs/promises\": [\">= 10 && < 10.1\", \">= 14\"],\n\t\"node:fs/promises\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_agent\": \">= 0.11.1\",\n\t\"node:_http_agent\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_client\": \">= 0.11.1\",\n\t\"node:_http_client\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_common\": \">= 0.11.1\",\n\t\"node:_http_common\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_incoming\": \">= 0.11.1\",\n\t\"node:_http_incoming\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_outgoing\": \">= 0.11.1\",\n\t\"node:_http_outgoing\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_server\": \">= 0.11.1\",\n\t\"node:_http_server\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"http\": true,\n\t\"node:http\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"http2\": \">= 8.8\",\n\t\"node:http2\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"https\": true,\n\t\"node:https\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"inspector\": \">= 8\",\n\t\"node:inspector\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"inspector/promises\": [\">= 19\"],\n\t\"node:inspector/promises\": [\">= 19\"],\n\t\"_linklist\": \"< 8\",\n\t\"module\": true,\n\t\"node:module\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"net\": true,\n\t\"node:net\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"node-inspect/lib/_inspect\": \">= 7.6 && < 12\",\n\t\"node-inspect/lib/internal/inspect_client\": \">= 7.6 && < 12\",\n\t\"node-inspect/lib/internal/inspect_repl\": \">= 7.6 && < 12\",\n\t\"os\": true,\n\t\"node:os\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"path\": true,\n\t\"node:path\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"path/posix\": \">= 15.3\",\n\t\"node:path/posix\": \">= 16\",\n\t\"path/win32\": \">= 15.3\",\n\t\"node:path/win32\": \">= 16\",\n\t\"perf_hooks\": \">= 8.5\",\n\t\"node:perf_hooks\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"process\": \">= 1\",\n\t\"node:process\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"punycode\": \">= 0.5\",\n\t\"node:punycode\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"querystring\": true,\n\t\"node:querystring\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"readline\": true,\n\t\"node:readline\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"readline/promises\": \">= 17\",\n\t\"node:readline/promises\": \">= 17\",\n\t\"repl\": true,\n\t\"node:repl\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"smalloc\": \">= 0.11.5 && < 3\",\n\t\"_stream_duplex\": \">= 0.9.4\",\n\t\"node:_stream_duplex\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_transform\": \">= 0.9.4\",\n\t\"node:_stream_transform\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_wrap\": \">= 1.4.1\",\n\t\"node:_stream_wrap\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_passthrough\": \">= 0.9.4\",\n\t\"node:_stream_passthrough\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_readable\": \">= 0.9.4\",\n\t\"node:_stream_readable\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_writable\": \">= 0.9.4\",\n\t\"node:_stream_writable\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"stream\": true,\n\t\"node:stream\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"stream/consumers\": \">= 16.7\",\n\t\"node:stream/consumers\": \">= 16.7\",\n\t\"stream/promises\": \">= 15\",\n\t\"node:stream/promises\": \">= 16\",\n\t\"stream/web\": \">= 16.5\",\n\t\"node:stream/web\": \">= 16.5\",\n\t\"string_decoder\": true,\n\t\"node:string_decoder\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"sys\": [\">= 0.4 && < 0.7\", \">= 0.8\"],\n\t\"node:sys\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"test/reporters\": \">= 19.9 && < 20.2\",\n\t\"node:test/reporters\": [\">= 18.17 && < 19\", \">= 19.9\", \">= 20\"],\n\t\"test/mock_loader\": \">= 22.3\",\n\t\"node:test/mock_loader\": \">= 22.3\",\n\t\"node:test\": [\">= 16.17 && < 17\", \">= 18\"],\n\t\"timers\": true,\n\t\"node:timers\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"timers/promises\": \">= 15\",\n\t\"node:timers/promises\": \">= 16\",\n\t\"_tls_common\": \">= 0.11.13\",\n\t\"node:_tls_common\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_tls_legacy\": \">= 0.11.3 && < 10\",\n\t\"_tls_wrap\": \">= 0.11.3\",\n\t\"node:_tls_wrap\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"tls\": true,\n\t\"node:tls\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"trace_events\": \">= 10\",\n\t\"node:trace_events\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"tty\": true,\n\t\"node:tty\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"url\": true,\n\t\"node:url\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"util\": true,\n\t\"node:util\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"util/types\": \">= 15.3\",\n\t\"node:util/types\": \">= 16\",\n\t\"v8/tools/arguments\": \">= 10 && < 12\",\n\t\"v8/tools/codemap\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/consarray\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/csvparser\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/logreader\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/profile_view\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/splaytree\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8\": \">= 1\",\n\t\"node:v8\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"vm\": true,\n\t\"node:vm\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"wasi\": [\">= 13.4 && < 13.5\", \">= 18.17 && < 19\", \">= 20\"],\n\t\"node:wasi\": [\">= 18.17 && < 19\", \">= 20\"],\n\t\"worker_threads\": \">= 11.7\",\n\t\"node:worker_threads\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"zlib\": \">= 0.5\",\n\t\"node:zlib\": [\">= 14.18 && < 15\", \">= 16\"]\n}\n","'use strict';\n\nvar hasOwn = require('hasown');\n\nfunction specifierIncluded(current, specifier) {\n\tvar nodeParts = current.split('.');\n\tvar parts = specifier.split(' ');\n\tvar op = parts.length > 1 ? parts[0] : '=';\n\tvar versionParts = (parts.length > 1 ? parts[1] : parts[0]).split('.');\n\n\tfor (var i = 0; i < 3; ++i) {\n\t\tvar cur = parseInt(nodeParts[i] || 0, 10);\n\t\tvar ver = parseInt(versionParts[i] || 0, 10);\n\t\tif (cur === ver) {\n\t\t\tcontinue; // eslint-disable-line no-restricted-syntax, no-continue\n\t\t}\n\t\tif (op === '<') {\n\t\t\treturn cur < ver;\n\t\t}\n\t\tif (op === '>=') {\n\t\t\treturn cur >= ver;\n\t\t}\n\t\treturn false;\n\t}\n\treturn op === '>=';\n}\n\nfunction matchesRange(current, range) {\n\tvar specifiers = range.split(/ ?&& ?/);\n\tif (specifiers.length === 0) {\n\t\treturn false;\n\t}\n\tfor (var i = 0; i < specifiers.length; ++i) {\n\t\tif (!specifierIncluded(current, specifiers[i])) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n\nfunction versionIncluded(nodeVersion, specifierValue) {\n\tif (typeof specifierValue === 'boolean') {\n\t\treturn specifierValue;\n\t}\n\n\tvar current = typeof nodeVersion === 'undefined'\n\t\t? process.versions && process.versions.node\n\t\t: nodeVersion;\n\n\tif (typeof current !== 'string') {\n\t\tthrow new TypeError(typeof nodeVersion === 'undefined' ? 'Unable to determine current node version' : 'If provided, a valid node version is required');\n\t}\n\n\tif (specifierValue && typeof specifierValue === 'object') {\n\t\tfor (var i = 0; i < specifierValue.length; ++i) {\n\t\t\tif (matchesRange(current, specifierValue[i])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\treturn matchesRange(current, specifierValue);\n}\n\nvar data = require('./core.json');\n\nmodule.exports = function isCore(x, nodeVersion) {\n\treturn hasOwn(data, x) && versionIncluded(nodeVersion, data[x]);\n};\n","var fs = require('fs');\nvar getHomedir = require('./homedir');\nvar path = require('path');\nvar caller = require('./caller');\nvar nodeModulesPaths = require('./node-modules-paths');\nvar normalizeOptions = require('./normalize-options');\nvar isCore = require('is-core-module');\n\nvar realpathFS = process.platform !== 'win32' && fs.realpath && typeof fs.realpath.native === 'function' ? fs.realpath.native : fs.realpath;\n\nvar homedir = getHomedir();\nvar defaultPaths = function () {\n    return [\n        path.join(homedir, '.node_modules'),\n        path.join(homedir, '.node_libraries')\n    ];\n};\n\nvar defaultIsFile = function isFile(file, cb) {\n    fs.stat(file, function (err, stat) {\n        if (!err) {\n            return cb(null, stat.isFile() || stat.isFIFO());\n        }\n        if (err.code === 'ENOENT' || err.code === 'ENOTDIR') return cb(null, false);\n        return cb(err);\n    });\n};\n\nvar defaultIsDir = function isDirectory(dir, cb) {\n    fs.stat(dir, function (err, stat) {\n        if (!err) {\n            return cb(null, stat.isDirectory());\n        }\n        if (err.code === 'ENOENT' || err.code === 'ENOTDIR') return cb(null, false);\n        return cb(err);\n    });\n};\n\nvar defaultRealpath = function realpath(x, cb) {\n    realpathFS(x, function (realpathErr, realPath) {\n        if (realpathErr && realpathErr.code !== 'ENOENT') cb(realpathErr);\n        else cb(null, realpathErr ? x : realPath);\n    });\n};\n\nvar maybeRealpath = function maybeRealpath(realpath, x, opts, cb) {\n    if (opts && opts.preserveSymlinks === false) {\n        realpath(x, cb);\n    } else {\n        cb(null, x);\n    }\n};\n\nvar defaultReadPackage = function defaultReadPackage(readFile, pkgfile, cb) {\n    readFile(pkgfile, function (readFileErr, body) {\n        if (readFileErr) cb(readFileErr);\n        else {\n            try {\n                var pkg = JSON.parse(body);\n                cb(null, pkg);\n            } catch (jsonErr) {\n                cb(null);\n            }\n        }\n    });\n};\n\nvar getPackageCandidates = function getPackageCandidates(x, start, opts) {\n    var dirs = nodeModulesPaths(start, opts, x);\n    for (var i = 0; i < dirs.length; i++) {\n        dirs[i] = path.join(dirs[i], x);\n    }\n    return dirs;\n};\n\nmodule.exports = function resolve(x, options, callback) {\n    var cb = callback;\n    var opts = options;\n    if (typeof options === 'function') {\n        cb = opts;\n        opts = {};\n    }\n    if (typeof x !== 'string') {\n        var err = new TypeError('Path must be a string.');\n        return process.nextTick(function () {\n            cb(err);\n        });\n    }\n\n    opts = normalizeOptions(x, opts);\n\n    var isFile = opts.isFile || defaultIsFile;\n    var isDirectory = opts.isDirectory || defaultIsDir;\n    var readFile = opts.readFile || fs.readFile;\n    var realpath = opts.realpath || defaultRealpath;\n    var readPackage = opts.readPackage || defaultReadPackage;\n    if (opts.readFile && opts.readPackage) {\n        var conflictErr = new TypeError('`readFile` and `readPackage` are mutually exclusive.');\n        return process.nextTick(function () {\n            cb(conflictErr);\n        });\n    }\n    var packageIterator = opts.packageIterator;\n\n    var extensions = opts.extensions || ['.js'];\n    var includeCoreModules = opts.includeCoreModules !== false;\n    var basedir = opts.basedir || path.dirname(caller());\n    var parent = opts.filename || basedir;\n\n    opts.paths = opts.paths || defaultPaths();\n\n    // ensure that `basedir` is an absolute path at this point, resolving against the process' current working directory\n    var absoluteStart = path.resolve(basedir);\n\n    maybeRealpath(\n        realpath,\n        absoluteStart,\n        opts,\n        function (err, realStart) {\n            if (err) cb(err);\n            else init(realStart);\n        }\n    );\n\n    var res;\n    function init(basedir) {\n        if ((/^(?:\\.\\.?(?:\\/|$)|\\/|([A-Za-z]:)?[/\\\\])/).test(x)) {\n            res = path.resolve(basedir, x);\n            if (x === '.' || x === '..' || x.slice(-1) === '/') res += '/';\n            if ((/\\/$/).test(x) && res === basedir) {\n                loadAsDirectory(res, opts.package, onfile);\n            } else loadAsFile(res, opts.package, onfile);\n        } else if (includeCoreModules && isCore(x)) {\n            return cb(null, x);\n        } else loadNodeModules(x, basedir, function (err, n, pkg) {\n            if (err) cb(err);\n            else if (n) {\n                return maybeRealpath(realpath, n, opts, function (err, realN) {\n                    if (err) {\n                        cb(err);\n                    } else {\n                        cb(null, realN, pkg);\n                    }\n                });\n            } else {\n                var moduleError = new Error(\"Cannot find module '\" + x + \"' from '\" + parent + \"'\");\n                moduleError.code = 'MODULE_NOT_FOUND';\n                cb(moduleError);\n            }\n        });\n    }\n\n    function onfile(err, m, pkg) {\n        if (err) cb(err);\n        else if (m) cb(null, m, pkg);\n        else loadAsDirectory(res, function (err, d, pkg) {\n            if (err) cb(err);\n            else if (d) {\n                maybeRealpath(realpath, d, opts, function (err, realD) {\n                    if (err) {\n                        cb(err);\n                    } else {\n                        cb(null, realD, pkg);\n                    }\n                });\n            } else {\n                var moduleError = new Error(\"Cannot find module '\" + x + \"' from '\" + parent + \"'\");\n                moduleError.code = 'MODULE_NOT_FOUND';\n                cb(moduleError);\n            }\n        });\n    }\n\n    function loadAsFile(x, thePackage, callback) {\n        var loadAsFilePackage = thePackage;\n        var cb = callback;\n        if (typeof loadAsFilePackage === 'function') {\n            cb = loadAsFilePackage;\n            loadAsFilePackage = undefined;\n        }\n\n        var exts = [''].concat(extensions);\n        load(exts, x, loadAsFilePackage);\n\n        function load(exts, x, loadPackage) {\n            if (exts.length === 0) return cb(null, undefined, loadPackage);\n            var file = x + exts[0];\n\n            var pkg = loadPackage;\n            if (pkg) onpkg(null, pkg);\n            else loadpkg(path.dirname(file), onpkg);\n\n            function onpkg(err, pkg_, dir) {\n                pkg = pkg_;\n                if (err) return cb(err);\n                if (dir && pkg && opts.pathFilter) {\n                    var rfile = path.relative(dir, file);\n                    var rel = rfile.slice(0, rfile.length - exts[0].length);\n                    var r = opts.pathFilter(pkg, x, rel);\n                    if (r) return load(\n                        [''].concat(extensions.slice()),\n                        path.resolve(dir, r),\n                        pkg\n                    );\n                }\n                isFile(file, onex);\n            }\n            function onex(err, ex) {\n                if (err) return cb(err);\n                if (ex) return cb(null, file, pkg);\n                load(exts.slice(1), x, pkg);\n            }\n        }\n    }\n\n    function loadpkg(dir, cb) {\n        if (dir === '' || dir === '/') return cb(null);\n        if (process.platform === 'win32' && (/^\\w:[/\\\\]*$/).test(dir)) {\n            return cb(null);\n        }\n        if ((/[/\\\\]node_modules[/\\\\]*$/).test(dir)) return cb(null);\n\n        maybeRealpath(realpath, dir, opts, function (unwrapErr, pkgdir) {\n            if (unwrapErr) return loadpkg(path.dirname(dir), cb);\n            var pkgfile = path.join(pkgdir, 'package.json');\n            isFile(pkgfile, function (err, ex) {\n                // on err, ex is false\n                if (!ex) return loadpkg(path.dirname(dir), cb);\n\n                readPackage(readFile, pkgfile, function (err, pkgParam) {\n                    if (err) cb(err);\n\n                    var pkg = pkgParam;\n\n                    if (pkg && opts.packageFilter) {\n                        pkg = opts.packageFilter(pkg, pkgfile);\n                    }\n                    cb(null, pkg, dir);\n                });\n            });\n        });\n    }\n\n    function loadAsDirectory(x, loadAsDirectoryPackage, callback) {\n        var cb = callback;\n        var fpkg = loadAsDirectoryPackage;\n        if (typeof fpkg === 'function') {\n            cb = fpkg;\n            fpkg = opts.package;\n        }\n\n        maybeRealpath(realpath, x, opts, function (unwrapErr, pkgdir) {\n            if (unwrapErr) return cb(unwrapErr);\n            var pkgfile = path.join(pkgdir, 'package.json');\n            isFile(pkgfile, function (err, ex) {\n                if (err) return cb(err);\n                if (!ex) return loadAsFile(path.join(x, 'index'), fpkg, cb);\n\n                readPackage(readFile, pkgfile, function (err, pkgParam) {\n                    if (err) return cb(err);\n\n                    var pkg = pkgParam;\n\n                    if (pkg && opts.packageFilter) {\n                        pkg = opts.packageFilter(pkg, pkgfile);\n                    }\n\n                    if (pkg && pkg.main) {\n                        if (typeof pkg.main !== 'string') {\n                            var mainError = new TypeError('package “' + pkg.name + '” `main` must be a string');\n                            mainError.code = 'INVALID_PACKAGE_MAIN';\n                            return cb(mainError);\n                        }\n                        if (pkg.main === '.' || pkg.main === './') {\n                            pkg.main = 'index';\n                        }\n                        loadAsFile(path.resolve(x, pkg.main), pkg, function (err, m, pkg) {\n                            if (err) return cb(err);\n                            if (m) return cb(null, m, pkg);\n                            if (!pkg) return loadAsFile(path.join(x, 'index'), pkg, cb);\n\n                            var dir = path.resolve(x, pkg.main);\n                            loadAsDirectory(dir, pkg, function (err, n, pkg) {\n                                if (err) return cb(err);\n                                if (n) return cb(null, n, pkg);\n                                loadAsFile(path.join(x, 'index'), pkg, cb);\n                            });\n                        });\n                        return;\n                    }\n\n                    loadAsFile(path.join(x, '/index'), pkg, cb);\n                });\n            });\n        });\n    }\n\n    function processDirs(cb, dirs) {\n        if (dirs.length === 0) return cb(null, undefined);\n        var dir = dirs[0];\n\n        isDirectory(path.dirname(dir), isdir);\n\n        function isdir(err, isdir) {\n            if (err) return cb(err);\n            if (!isdir) return processDirs(cb, dirs.slice(1));\n            loadAsFile(dir, opts.package, onfile);\n        }\n\n        function onfile(err, m, pkg) {\n            if (err) return cb(err);\n            if (m) return cb(null, m, pkg);\n            loadAsDirectory(dir, opts.package, ondir);\n        }\n\n        function ondir(err, n, pkg) {\n            if (err) return cb(err);\n            if (n) return cb(null, n, pkg);\n            processDirs(cb, dirs.slice(1));\n        }\n    }\n    function loadNodeModules(x, start, cb) {\n        var thunk = function () { return getPackageCandidates(x, start, opts); };\n        processDirs(\n            cb,\n            packageIterator ? packageIterator(x, start, thunk, opts) : thunk()\n        );\n    }\n};\n","{\n\t\"assert\": true,\n\t\"node:assert\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"assert/strict\": \">= 15\",\n\t\"node:assert/strict\": \">= 16\",\n\t\"async_hooks\": \">= 8\",\n\t\"node:async_hooks\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"buffer_ieee754\": \">= 0.5 && < 0.9.7\",\n\t\"buffer\": true,\n\t\"node:buffer\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"child_process\": true,\n\t\"node:child_process\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"cluster\": \">= 0.5\",\n\t\"node:cluster\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"console\": true,\n\t\"node:console\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"constants\": true,\n\t\"node:constants\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"crypto\": true,\n\t\"node:crypto\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_debug_agent\": \">= 1 && < 8\",\n\t\"_debugger\": \"< 8\",\n\t\"dgram\": true,\n\t\"node:dgram\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"diagnostics_channel\": [\">= 14.17 && < 15\", \">= 15.1\"],\n\t\"node:diagnostics_channel\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"dns\": true,\n\t\"node:dns\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"dns/promises\": \">= 15\",\n\t\"node:dns/promises\": \">= 16\",\n\t\"domain\": \">= 0.7.12\",\n\t\"node:domain\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"events\": true,\n\t\"node:events\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"freelist\": \"< 6\",\n\t\"fs\": true,\n\t\"node:fs\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"fs/promises\": [\">= 10 && < 10.1\", \">= 14\"],\n\t\"node:fs/promises\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_agent\": \">= 0.11.1\",\n\t\"node:_http_agent\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_client\": \">= 0.11.1\",\n\t\"node:_http_client\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_common\": \">= 0.11.1\",\n\t\"node:_http_common\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_incoming\": \">= 0.11.1\",\n\t\"node:_http_incoming\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_outgoing\": \">= 0.11.1\",\n\t\"node:_http_outgoing\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_http_server\": \">= 0.11.1\",\n\t\"node:_http_server\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"http\": true,\n\t\"node:http\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"http2\": \">= 8.8\",\n\t\"node:http2\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"https\": true,\n\t\"node:https\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"inspector\": \">= 8\",\n\t\"node:inspector\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"inspector/promises\": [\">= 19\"],\n\t\"node:inspector/promises\": [\">= 19\"],\n\t\"_linklist\": \"< 8\",\n\t\"module\": true,\n\t\"node:module\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"net\": true,\n\t\"node:net\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"node-inspect/lib/_inspect\": \">= 7.6 && < 12\",\n\t\"node-inspect/lib/internal/inspect_client\": \">= 7.6 && < 12\",\n\t\"node-inspect/lib/internal/inspect_repl\": \">= 7.6 && < 12\",\n\t\"os\": true,\n\t\"node:os\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"path\": true,\n\t\"node:path\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"path/posix\": \">= 15.3\",\n\t\"node:path/posix\": \">= 16\",\n\t\"path/win32\": \">= 15.3\",\n\t\"node:path/win32\": \">= 16\",\n\t\"perf_hooks\": \">= 8.5\",\n\t\"node:perf_hooks\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"process\": \">= 1\",\n\t\"node:process\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"punycode\": \">= 0.5\",\n\t\"node:punycode\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"querystring\": true,\n\t\"node:querystring\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"readline\": true,\n\t\"node:readline\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"readline/promises\": \">= 17\",\n\t\"node:readline/promises\": \">= 17\",\n\t\"repl\": true,\n\t\"node:repl\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"smalloc\": \">= 0.11.5 && < 3\",\n\t\"_stream_duplex\": \">= 0.9.4\",\n\t\"node:_stream_duplex\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_transform\": \">= 0.9.4\",\n\t\"node:_stream_transform\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_wrap\": \">= 1.4.1\",\n\t\"node:_stream_wrap\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_passthrough\": \">= 0.9.4\",\n\t\"node:_stream_passthrough\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_readable\": \">= 0.9.4\",\n\t\"node:_stream_readable\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_stream_writable\": \">= 0.9.4\",\n\t\"node:_stream_writable\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"stream\": true,\n\t\"node:stream\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"stream/consumers\": \">= 16.7\",\n\t\"node:stream/consumers\": \">= 16.7\",\n\t\"stream/promises\": \">= 15\",\n\t\"node:stream/promises\": \">= 16\",\n\t\"stream/web\": \">= 16.5\",\n\t\"node:stream/web\": \">= 16.5\",\n\t\"string_decoder\": true,\n\t\"node:string_decoder\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"sys\": [\">= 0.4 && < 0.7\", \">= 0.8\"],\n\t\"node:sys\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"test/reporters\": \">= 19.9 && < 20.2\",\n\t\"node:test/reporters\": [\">= 18.17 && < 19\", \">= 19.9\", \">= 20\"],\n\t\"node:test\": [\">= 16.17 && < 17\", \">= 18\"],\n\t\"timers\": true,\n\t\"node:timers\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"timers/promises\": \">= 15\",\n\t\"node:timers/promises\": \">= 16\",\n\t\"_tls_common\": \">= 0.11.13\",\n\t\"node:_tls_common\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"_tls_legacy\": \">= 0.11.3 && < 10\",\n\t\"_tls_wrap\": \">= 0.11.3\",\n\t\"node:_tls_wrap\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"tls\": true,\n\t\"node:tls\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"trace_events\": \">= 10\",\n\t\"node:trace_events\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"tty\": true,\n\t\"node:tty\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"url\": true,\n\t\"node:url\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"util\": true,\n\t\"node:util\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"util/types\": \">= 15.3\",\n\t\"node:util/types\": \">= 16\",\n\t\"v8/tools/arguments\": \">= 10 && < 12\",\n\t\"v8/tools/codemap\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/consarray\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/csvparser\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/logreader\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/profile_view\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8/tools/splaytree\": [\">= 4.4 && < 5\", \">= 5.2 && < 12\"],\n\t\"v8\": \">= 1\",\n\t\"node:v8\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"vm\": true,\n\t\"node:vm\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"wasi\": [\">= 13.4 && < 13.5\", \">= 18.17 && < 19\", \">= 20\"],\n\t\"node:wasi\": [\">= 18.17 && < 19\", \">= 20\"],\n\t\"worker_threads\": \">= 11.7\",\n\t\"node:worker_threads\": [\">= 14.18 && < 15\", \">= 16\"],\n\t\"zlib\": \">= 0.5\",\n\t\"node:zlib\": [\">= 14.18 && < 15\", \">= 16\"]\n}\n","'use strict';\n\nvar isCoreModule = require('is-core-module');\nvar data = require('./core.json');\n\nvar core = {};\nfor (var mod in data) { // eslint-disable-line no-restricted-syntax\n    if (Object.prototype.hasOwnProperty.call(data, mod)) {\n        core[mod] = isCoreModule(mod);\n    }\n}\nmodule.exports = core;\n","var isCoreModule = require('is-core-module');\n\nmodule.exports = function isCore(x) {\n    return isCoreModule(x);\n};\n","var isCore = require('is-core-module');\nvar fs = require('fs');\nvar path = require('path');\nvar getHomedir = require('./homedir');\nvar caller = require('./caller');\nvar nodeModulesPaths = require('./node-modules-paths');\nvar normalizeOptions = require('./normalize-options');\n\nvar realpathFS = process.platform !== 'win32' && fs.realpathSync && typeof fs.realpathSync.native === 'function' ? fs.realpathSync.native : fs.realpathSync;\n\nvar homedir = getHomedir();\nvar defaultPaths = function () {\n    return [\n        path.join(homedir, '.node_modules'),\n        path.join(homedir, '.node_libraries')\n    ];\n};\n\nvar defaultIsFile = function isFile(file) {\n    try {\n        var stat = fs.statSync(file, { throwIfNoEntry: false });\n    } catch (e) {\n        if (e && (e.code === 'ENOENT' || e.code === 'ENOTDIR')) return false;\n        throw e;\n    }\n    return !!stat && (stat.isFile() || stat.isFIFO());\n};\n\nvar defaultIsDir = function isDirectory(dir) {\n    try {\n        var stat = fs.statSync(dir, { throwIfNoEntry: false });\n    } catch (e) {\n        if (e && (e.code === 'ENOENT' || e.code === 'ENOTDIR')) return false;\n        throw e;\n    }\n    return !!stat && stat.isDirectory();\n};\n\nvar defaultRealpathSync = function realpathSync(x) {\n    try {\n        return realpathFS(x);\n    } catch (realpathErr) {\n        if (realpathErr.code !== 'ENOENT') {\n            throw realpathErr;\n        }\n    }\n    return x;\n};\n\nvar maybeRealpathSync = function maybeRealpathSync(realpathSync, x, opts) {\n    if (opts && opts.preserveSymlinks === false) {\n        return realpathSync(x);\n    }\n    return x;\n};\n\nvar defaultReadPackageSync = function defaultReadPackageSync(readFileSync, pkgfile) {\n    var body = readFileSync(pkgfile);\n    try {\n        var pkg = JSON.parse(body);\n        return pkg;\n    } catch (jsonErr) {}\n};\n\nvar getPackageCandidates = function getPackageCandidates(x, start, opts) {\n    var dirs = nodeModulesPaths(start, opts, x);\n    for (var i = 0; i < dirs.length; i++) {\n        dirs[i] = path.join(dirs[i], x);\n    }\n    return dirs;\n};\n\nmodule.exports = function resolveSync(x, options) {\n    if (typeof x !== 'string') {\n        throw new TypeError('Path must be a string.');\n    }\n    var opts = normalizeOptions(x, options);\n\n    var isFile = opts.isFile || defaultIsFile;\n    var readFileSync = opts.readFileSync || fs.readFileSync;\n    var isDirectory = opts.isDirectory || defaultIsDir;\n    var realpathSync = opts.realpathSync || defaultRealpathSync;\n    var readPackageSync = opts.readPackageSync || defaultReadPackageSync;\n    if (opts.readFileSync && opts.readPackageSync) {\n        throw new TypeError('`readFileSync` and `readPackageSync` are mutually exclusive.');\n    }\n    var packageIterator = opts.packageIterator;\n\n    var extensions = opts.extensions || ['.js'];\n    var includeCoreModules = opts.includeCoreModules !== false;\n    var basedir = opts.basedir || path.dirname(caller());\n    var parent = opts.filename || basedir;\n\n    opts.paths = opts.paths || defaultPaths();\n\n    // ensure that `basedir` is an absolute path at this point, resolving against the process' current working directory\n    var absoluteStart = maybeRealpathSync(realpathSync, path.resolve(basedir), opts);\n\n    if ((/^(?:\\.\\.?(?:\\/|$)|\\/|([A-Za-z]:)?[/\\\\])/).test(x)) {\n        var res = path.resolve(absoluteStart, x);\n        if (x === '.' || x === '..' || x.slice(-1) === '/') res += '/';\n        var m = loadAsFileSync(res) || loadAsDirectorySync(res);\n        if (m) return maybeRealpathSync(realpathSync, m, opts);\n    } else if (includeCoreModules && isCore(x)) {\n        return x;\n    } else {\n        var n = loadNodeModulesSync(x, absoluteStart);\n        if (n) return maybeRealpathSync(realpathSync, n, opts);\n    }\n\n    var err = new Error(\"Cannot find module '\" + x + \"' from '\" + parent + \"'\");\n    err.code = 'MODULE_NOT_FOUND';\n    throw err;\n\n    function loadAsFileSync(x) {\n        var pkg = loadpkg(path.dirname(x));\n\n        if (pkg && pkg.dir && pkg.pkg && opts.pathFilter) {\n            var rfile = path.relative(pkg.dir, x);\n            var r = opts.pathFilter(pkg.pkg, x, rfile);\n            if (r) {\n                x = path.resolve(pkg.dir, r); // eslint-disable-line no-param-reassign\n            }\n        }\n\n        if (isFile(x)) {\n            return x;\n        }\n\n        for (var i = 0; i < extensions.length; i++) {\n            var file = x + extensions[i];\n            if (isFile(file)) {\n                return file;\n            }\n        }\n    }\n\n    function loadpkg(dir) {\n        if (dir === '' || dir === '/') return;\n        if (process.platform === 'win32' && (/^\\w:[/\\\\]*$/).test(dir)) {\n            return;\n        }\n        if ((/[/\\\\]node_modules[/\\\\]*$/).test(dir)) return;\n\n        var pkgfile = path.join(maybeRealpathSync(realpathSync, dir, opts), 'package.json');\n\n        if (!isFile(pkgfile)) {\n            return loadpkg(path.dirname(dir));\n        }\n\n        var pkg = readPackageSync(readFileSync, pkgfile);\n\n        if (pkg && opts.packageFilter) {\n            // v2 will pass pkgfile\n            pkg = opts.packageFilter(pkg, /*pkgfile,*/ dir); // eslint-disable-line spaced-comment\n        }\n\n        return { pkg: pkg, dir: dir };\n    }\n\n    function loadAsDirectorySync(x) {\n        var pkgfile = path.join(maybeRealpathSync(realpathSync, x, opts), '/package.json');\n        if (isFile(pkgfile)) {\n            try {\n                var pkg = readPackageSync(readFileSync, pkgfile);\n            } catch (e) {}\n\n            if (pkg && opts.packageFilter) {\n                // v2 will pass pkgfile\n                pkg = opts.packageFilter(pkg, /*pkgfile,*/ x); // eslint-disable-line spaced-comment\n            }\n\n            if (pkg && pkg.main) {\n                if (typeof pkg.main !== 'string') {\n                    var mainError = new TypeError('package “' + pkg.name + '” `main` must be a string');\n                    mainError.code = 'INVALID_PACKAGE_MAIN';\n                    throw mainError;\n                }\n                if (pkg.main === '.' || pkg.main === './') {\n                    pkg.main = 'index';\n                }\n                try {\n                    var m = loadAsFileSync(path.resolve(x, pkg.main));\n                    if (m) return m;\n                    var n = loadAsDirectorySync(path.resolve(x, pkg.main));\n                    if (n) return n;\n                } catch (e) {}\n            }\n        }\n\n        return loadAsFileSync(path.join(x, '/index'));\n    }\n\n    function loadNodeModulesSync(x, start) {\n        var thunk = function () { return getPackageCandidates(x, start, opts); };\n        var dirs = packageIterator ? packageIterator(x, start, thunk, opts) : thunk();\n\n        for (var i = 0; i < dirs.length; i++) {\n            var dir = dirs[i];\n            if (isDirectory(path.dirname(dir))) {\n                var m = loadAsFileSync(dir);\n                if (m) return m;\n                var n = loadAsDirectorySync(dir);\n                if (n) return n;\n            }\n        }\n    }\n};\n","var async = require('./lib/async');\nasync.core = require('./lib/core');\nasync.isCore = require('./lib/is-core');\nasync.sync = require('./lib/sync');\n\nmodule.exports = async;\n","'use strict'\n\nvar path = require('path')\n\nmodule.exports = function (file) {\n  var segments = file.split(path.sep)\n  var index = segments.lastIndexOf('node_modules')\n  if (index === -1) return\n  if (!segments[index + 1]) return\n  var scoped = segments[index + 1][0] === '@'\n  var name = scoped ? segments[index + 1] + '/' + segments[index + 2] : segments[index + 1]\n  var offset = scoped ? 3 : 2\n  return {\n    name: name,\n    basedir: segments.slice(0, index + offset).join(path.sep),\n    path: segments.slice(index + offset).join(path.sep)\n  }\n}\n","{\n  \"name\": \"require-in-the-middle\",\n  \"version\": \"7.4.0\",\n  \"description\": \"Module to hook into the Node.js require function\",\n  \"main\": \"index.js\",\n  \"types\": \"types/index.d.ts\",\n  \"dependencies\": {\n    \"debug\": \"^4.3.5\",\n    \"module-details-from-path\": \"^1.0.3\",\n    \"resolve\": \"^1.22.8\"\n  },\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.9.0\",\n    \"@babel/preset-env\": \"^7.9.5\",\n    \"@babel/preset-typescript\": \"^7.9.0\",\n    \"@babel/register\": \"^7.9.0\",\n    \"ipp-printer\": \"^1.0.0\",\n    \"patterns\": \"^1.0.3\",\n    \"roundround\": \"^0.2.0\",\n    \"semver\": \"^6.3.0\",\n    \"standard\": \"^14.3.1\",\n    \"tape\": \"^4.11.0\"\n  },\n  \"scripts\": {\n    \"test\": \"npm run test:lint && npm run test:tape && npm run test:babel\",\n    \"test:lint\": \"standard\",\n    \"test:tape\": \"tape test/*.js\",\n    \"test:babel\": \"node test/babel/babel-register.js\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/elastic/require-in-the-middle.git\"\n  },\n  \"keywords\": [\n    \"require\",\n    \"hook\",\n    \"shim\",\n    \"shimmer\",\n    \"shimming\",\n    \"patch\",\n    \"monkey\",\n    \"monkeypatch\",\n    \"module\",\n    \"load\"\n  ],\n  \"files\": [\n    \"types\"\n  ],\n  \"author\": \"Thomas Watson Steen <w@tson.dk> (https://twitter.com/wa7son)\",\n  \"license\": \"MIT\",\n  \"bugs\": {\n    \"url\": \"https://github.com/elastic/require-in-the-middle/issues\"\n  },\n  \"homepage\": \"https://github.com/elastic/require-in-the-middle#readme\",\n  \"engines\": {\n    \"node\": \">=8.6.0\"\n  }\n}\n","'use strict'\n\nconst path = require('path')\nconst Module = require('module')\nconst resolve = require('resolve')\nconst debug = require('debug')('require-in-the-middle')\nconst moduleDetailsFromPath = require('module-details-from-path')\n\n// Using the default export is discouraged, but kept for backward compatibility.\n// Use this instead:\n//    const { Hook } = require('require-in-the-middle')\nmodule.exports = Hook\nmodule.exports.Hook = Hook\n\n/**\n * Is the given module a \"core\" module?\n * https://nodejs.org/api/modules.html#core-modules\n *\n * @type {(moduleName: string) => boolean}\n */\nlet isCore\nif (Module.isBuiltin) { // Added in node v18.6.0, v16.17.0\n  isCore = Module.isBuiltin\n} else {\n  const [major, minor] = process.versions.node.split('.').map(Number)\n  if (major === 8 && minor < 8) {\n    // For node versions `[8.0, 8.8)` the \"http2\" module was built-in but\n    // behind the `--expose-http2` flag. `resolve` only considers unflagged\n    // modules to be core: https://github.com/browserify/resolve/issues/139\n    // However, for `ExportsCache` to work for \"http2\" we need it to be\n    // considered core.\n    isCore = moduleName => {\n      if (moduleName === 'http2') {\n        return true\n      }\n      // Prefer `resolve.core` lookup to `resolve.isCore(moduleName)` because\n      // the latter is doing version range matches for every call.\n      return !!resolve.core[moduleName]\n    }\n  } else {\n    isCore = moduleName => {\n      // Prefer `resolve.core` lookup to `resolve.isCore(moduleName)` because\n      // the latter is doing version range matches for every call.\n      return !!resolve.core[moduleName]\n    }\n  }\n}\n\n// 'foo/bar.js' or 'foo/bar/index.js' => 'foo/bar'\nconst normalize = /([/\\\\]index)?(\\.js)?$/\n\n// Cache `onrequire`-patched exports for modules.\n//\n// Exports for built-in (a.k.a. \"core\") modules are stored in an internal Map.\n//\n// Exports for non-core modules are stored on a private field on the `Module`\n// object in `require.cache`. This allows users to delete from `require.cache`\n// to trigger a re-load (and re-run of the hook's `onrequire`) of a module the\n// next time it is required.\n// https://nodejs.org/docs/latest/api/all.html#all_modules_requirecache\n//\n// In some special cases -- e.g. some other `require()` hook swapping out\n// `Module._cache` like `@babel/register` -- a non-core module won't be in\n// `require.cache`. In that case this falls back to caching on the internal Map.\nclass ExportsCache {\n  constructor () {\n    this._localCache = new Map() // <module filename or id> -> <exports>\n    this._kRitmExports = Symbol('RitmExports')\n  }\n\n  has (filename, isBuiltin) {\n    if (this._localCache.has(filename)) {\n      return true\n    } else if (!isBuiltin) {\n      const mod = require.cache[filename]\n      return !!(mod && this._kRitmExports in mod)\n    } else {\n      return false\n    }\n  }\n\n  get (filename, isBuiltin) {\n    const cachedExports = this._localCache.get(filename)\n    if (cachedExports !== undefined) {\n      return cachedExports\n    } else if (!isBuiltin) {\n      const mod = require.cache[filename]\n      return (mod && mod[this._kRitmExports])\n    }\n  }\n\n  set (filename, exports, isBuiltin) {\n    if (isBuiltin) {\n      this._localCache.set(filename, exports)\n    } else if (filename in require.cache) {\n      require.cache[filename][this._kRitmExports] = exports\n    } else {\n      debug('non-core module is unexpectedly not in require.cache: \"%s\"', filename)\n      this._localCache.set(filename, exports)\n    }\n  }\n}\n\nfunction Hook (modules, options, onrequire) {\n  if ((this instanceof Hook) === false) return new Hook(modules, options, onrequire)\n  if (typeof modules === 'function') {\n    onrequire = modules\n    modules = null\n    options = null\n  } else if (typeof options === 'function') {\n    onrequire = options\n    options = null\n  }\n\n  if (typeof Module._resolveFilename !== 'function') {\n    console.error('Error: Expected Module._resolveFilename to be a function (was: %s) - aborting!', typeof Module._resolveFilename)\n    console.error('Please report this error as an issue related to Node.js %s at %s', process.version, require('./package.json').bugs.url)\n    return\n  }\n\n  this._cache = new ExportsCache()\n\n  this._unhooked = false\n  this._origRequire = Module.prototype.require\n\n  const self = this\n  const patching = new Set()\n  const internals = options ? options.internals === true : false\n  const hasWhitelist = Array.isArray(modules)\n\n  debug('registering require hook')\n\n  this._require = Module.prototype.require = function (id) {\n    if (self._unhooked === true) {\n      // if the patched require function could not be removed because\n      // someone else patched it after it was patched here, we just\n      // abort and pass the request onwards to the original require\n      debug('ignoring require call - module is soft-unhooked')\n      return self._origRequire.apply(this, arguments)\n    }\n\n    return patchedRequire.call(this, arguments, false)\n  }\n\n  if (typeof process.getBuiltinModule === 'function') {\n    this._origGetBuiltinModule = process.getBuiltinModule\n    this._getBuiltinModule = process.getBuiltinModule = function (id) {\n      if (self._unhooked === true) {\n        // if the patched process.getBuiltinModule function could not be removed because\n        // someone else patched it after it was patched here, we just abort and pass the\n        // request onwards to the original process.getBuiltinModule\n        debug('ignoring process.getBuiltinModule call - module is soft-unhooked')\n        return self._origGetBuiltinModule.apply(this, arguments)\n      }\n\n      return patchedRequire.call(this, arguments, true)\n    }\n  }\n\n  // Preserve the original require/process.getBuiltinModule arguments in `args`\n  function patchedRequire (args, coreOnly) {\n    const id = args[0]\n    const core = isCore(id)\n    let filename // the string used for caching\n    if (core) {\n      filename = id\n      // If this is a builtin module that can be identified both as 'foo' and\n      // 'node:foo', then prefer 'foo' as the caching key.\n      if (id.startsWith('node:')) {\n        const idWithoutPrefix = id.slice(5)\n        if (isCore(idWithoutPrefix)) {\n          filename = idWithoutPrefix\n        }\n      }\n    } else if (coreOnly) {\n      // `coreOnly` is `true` if this was a call to `process.getBuiltinModule`, in which case\n      // we don't want to return anything if the requested `id` isn't a core module. Falling\n      // back to default behaviour, which at the time of this wrting is simply returning `undefined`\n      debug('call to process.getBuiltinModule with unknown built-in id')\n      return self._origGetBuiltinModule.apply(this, args)\n    } else {\n      try {\n        filename = Module._resolveFilename(id, this)\n      } catch (resolveErr) {\n        // If someone *else* monkey-patches before this monkey-patch, then that\n        // code might expect `require(someId)` to get through so it can be\n        // handled, even if `someId` cannot be resolved to a filename. In this\n        // case, instead of throwing we defer to the underlying `require`.\n        //\n        // For example the Azure Functions Node.js worker module does this,\n        // where `@azure/functions-core` resolves to an internal object.\n        // https://github.com/Azure/azure-functions-nodejs-worker/blob/v3.5.2/src/setupCoreModule.ts#L46-L54\n        debug('Module._resolveFilename(\"%s\") threw %j, calling original Module.require', id, resolveErr.message)\n        return self._origRequire.apply(this, args)\n      }\n    }\n\n    let moduleName, basedir\n\n    debug('processing %s module require(\\'%s\\'): %s', core === true ? 'core' : 'non-core', id, filename)\n\n    // return known patched modules immediately\n    if (self._cache.has(filename, core) === true) {\n      debug('returning already patched cached module: %s', filename)\n      return self._cache.get(filename, core)\n    }\n\n    // Check if this module has a patcher in-progress already.\n    // Otherwise, mark this module as patching in-progress.\n    const isPatching = patching.has(filename)\n    if (isPatching === false) {\n      patching.add(filename)\n    }\n\n    const exports = coreOnly\n      ? self._origGetBuiltinModule.apply(this, args)\n      : self._origRequire.apply(this, args)\n\n    // If it's already patched, just return it as-is.\n    if (isPatching === true) {\n      debug('module is in the process of being patched already - ignoring: %s', filename)\n      return exports\n    }\n\n    // The module has already been loaded,\n    // so the patching mark can be cleaned up.\n    patching.delete(filename)\n\n    if (core === true) {\n      if (hasWhitelist === true && modules.includes(filename) === false) {\n        debug('ignoring core module not on whitelist: %s', filename)\n        return exports // abort if module name isn't on whitelist\n      }\n      moduleName = filename\n    } else if (hasWhitelist === true && modules.includes(filename)) {\n      // whitelist includes the absolute path to the file including extension\n      const parsedPath = path.parse(filename)\n      moduleName = parsedPath.name\n      basedir = parsedPath.dir\n    } else {\n      const stat = moduleDetailsFromPath(filename)\n      if (stat === undefined) {\n        debug('could not parse filename: %s', filename)\n        return exports // abort if filename could not be parsed\n      }\n      moduleName = stat.name\n      basedir = stat.basedir\n\n      // Ex: require('foo/lib/../bar.js')\n      // moduleName = 'foo'\n      // fullModuleName = 'foo/bar'\n      const fullModuleName = resolveModuleName(stat)\n\n      debug('resolved filename to module: %s (id: %s, resolved: %s, basedir: %s)', moduleName, id, fullModuleName, basedir)\n\n      let matchFound = false\n      if (hasWhitelist) {\n        if (!id.startsWith('.') && modules.includes(id)) {\n          // Not starting with '.' means `id` is identifying a module path,\n          // as opposed to a local file path. (Note: I'm not sure about\n          // absolute paths, but those are handled above.)\n          // If this `id` is in `modules`, then this could be a match to an\n          // package \"exports\" entry point that wouldn't otherwise match below.\n          moduleName = id\n          matchFound = true\n        }\n\n        // abort if module name isn't on whitelist\n        if (!modules.includes(moduleName) && !modules.includes(fullModuleName)) {\n          return exports\n        }\n\n        if (modules.includes(fullModuleName) && fullModuleName !== moduleName) {\n          // if we get to this point, it means that we're requiring a whitelisted sub-module\n          moduleName = fullModuleName\n          matchFound = true\n        }\n      }\n\n      if (!matchFound) {\n        // figure out if this is the main module file, or a file inside the module\n        let res\n        try {\n          res = resolve.sync(moduleName, { basedir })\n        } catch (e) {\n          debug('could not resolve module: %s', moduleName)\n          self._cache.set(filename, exports, core)\n          return exports // abort if module could not be resolved (e.g. no main in package.json and no index.js file)\n        }\n\n        if (res !== filename) {\n          // this is a module-internal file\n          if (internals === true) {\n            // use the module-relative path to the file, prefixed by original module name\n            moduleName = moduleName + path.sep + path.relative(basedir, filename)\n            debug('preparing to process require of internal file: %s', moduleName)\n          } else {\n            debug('ignoring require of non-main module file: %s', res)\n            self._cache.set(filename, exports, core)\n            return exports // abort if not main module file\n          }\n        }\n      }\n    }\n\n    // ensure that the cache entry is assigned a value before calling\n    // onrequire, in case calling onrequire requires the same module.\n    self._cache.set(filename, exports, core)\n    debug('calling require hook: %s', moduleName)\n    const patchedExports = onrequire(exports, moduleName, basedir)\n    self._cache.set(filename, patchedExports, core)\n\n    debug('returning module: %s', moduleName)\n    return patchedExports\n  }\n}\n\nHook.prototype.unhook = function () {\n  this._unhooked = true\n\n  if (this._require === Module.prototype.require) {\n    Module.prototype.require = this._origRequire\n    debug('require unhook successful')\n  } else {\n    debug('require unhook unsuccessful')\n  }\n\n  if (process.getBuiltinModule !== undefined) {\n    if (this._getBuiltinModule === process.getBuiltinModule) {\n      process.getBuiltinModule = this._origGetBuiltinModule\n      debug('process.getBuiltinModule unhook successful')\n    } else {\n      debug('process.getBuiltinModule unhook unsuccessful')\n    }\n  }\n}\n\nfunction resolveModuleName (stat) {\n  const normalizedPath = path.sep !== '/' ? stat.path.split(path.sep).join('/') : stat.path\n  return path.posix.join(stat.name, normalizedPath).replace(normalize, '')\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Hooked } from './RequireInTheMiddleSingleton';\n\nexport const ModuleNameSeparator = '/';\n\n/**\n * Node in a `ModuleNameTrie`\n */\nclass ModuleNameTrieNode {\n  hooks: Array<{ hook: Hooked; insertedId: number }> = [];\n  children: Map<string, ModuleNameTrieNode> = new Map();\n}\n\ntype ModuleNameTrieSearchOptions = {\n  /**\n   * Whether to return the results in insertion order\n   */\n  maintainInsertionOrder?: boolean;\n  /**\n   * Whether to return only full matches\n   */\n  fullOnly?: boolean;\n};\n\n/**\n * Trie containing nodes that represent a part of a module name (i.e. the parts separated by forward slash)\n */\nexport class ModuleNameTrie {\n  private _trie: ModuleNameTrieNode = new ModuleNameTrieNode();\n  private _counter: number = 0;\n\n  /**\n   * Insert a module hook into the trie\n   *\n   * @param {Hooked} hook Hook\n   */\n  insert(hook: Hooked) {\n    let trieNode = this._trie;\n\n    for (const moduleNamePart of hook.moduleName.split(ModuleNameSeparator)) {\n      let nextNode = trieNode.children.get(moduleNamePart);\n      if (!nextNode) {\n        nextNode = new ModuleNameTrieNode();\n        trieNode.children.set(moduleNamePart, nextNode);\n      }\n      trieNode = nextNode;\n    }\n    trieNode.hooks.push({ hook, insertedId: this._counter++ });\n  }\n\n  /**\n   * Search for matching hooks in the trie\n   *\n   * @param {string} moduleName Module name\n   * @param {boolean} maintainInsertionOrder Whether to return the results in insertion order\n   * @param {boolean} fullOnly Whether to return only full matches\n   * @returns {Hooked[]} Matching hooks\n   */\n  search(\n    moduleName: string,\n    { maintainInsertionOrder, fullOnly }: ModuleNameTrieSearchOptions = {}\n  ): Hooked[] {\n    let trieNode = this._trie;\n    const results: ModuleNameTrieNode['hooks'] = [];\n    let foundFull = true;\n\n    for (const moduleNamePart of moduleName.split(ModuleNameSeparator)) {\n      const nextNode = trieNode.children.get(moduleNamePart);\n      if (!nextNode) {\n        foundFull = false;\n        break;\n      }\n      if (!fullOnly) {\n        results.push(...nextNode.hooks);\n      }\n      trieNode = nextNode;\n    }\n\n    if (fullOnly && foundFull) {\n      results.push(...trieNode.hooks);\n    }\n\n    if (results.length === 0) {\n      return [];\n    }\n    if (results.length === 1) {\n      return [results[0].hook];\n    }\n    if (maintainInsertionOrder) {\n      results.sort((a, b) => a.insertedId - b.insertedId);\n    }\n    return results.map(({ hook }) => hook);\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { OnRequireFn } from 'require-in-the-middle';\nimport { Hook } from 'require-in-the-middle';\nimport * as path from 'path';\nimport { ModuleNameTrie, ModuleNameSeparator } from './ModuleNameTrie';\n\nexport type Hooked = {\n  moduleName: string;\n  onRequire: OnRequireFn;\n};\n\n/**\n * Whether Mocha is running in this process\n * Inspired by https://github.com/AndreasPizsa/detect-mocha\n *\n * @type {boolean}\n */\nconst isMocha = [\n  'afterEach',\n  'after',\n  'beforeEach',\n  'before',\n  'describe',\n  'it',\n].every(fn => {\n  // @ts-expect-error TS7053: Element implicitly has an 'any' type\n  return typeof global[fn] === 'function';\n});\n\n/**\n * Singleton class for `require-in-the-middle`\n * Allows instrumentation plugins to patch modules with only a single `require` patch\n * WARNING: Because this class will create its own `require-in-the-middle` (RITM) instance,\n * we should minimize the number of new instances of this class.\n * Multiple instances of `@opentelemetry/instrumentation` (e.g. multiple versions) in a single process\n * will result in multiple instances of RITM, which will have an impact\n * on the performance of instrumentation hooks being applied.\n */\nexport class RequireInTheMiddleSingleton {\n  private _moduleNameTrie: ModuleNameTrie = new ModuleNameTrie();\n  private static _instance?: RequireInTheMiddleSingleton;\n\n  private constructor() {\n    this._initialize();\n  }\n\n  private _initialize() {\n    new Hook(\n      // Intercept all `require` calls; we will filter the matching ones below\n      null,\n      { internals: true },\n      (exports, name, basedir) => {\n        // For internal files on Windows, `name` will use backslash as the path separator\n        const normalizedModuleName = normalizePathSeparators(name);\n\n        const matches = this._moduleNameTrie.search(normalizedModuleName, {\n          maintainInsertionOrder: true,\n          // For core modules (e.g. `fs`), do not match on sub-paths (e.g. `fs/promises').\n          // This matches the behavior of `require-in-the-middle`.\n          // `basedir` is always `undefined` for core modules.\n          fullOnly: basedir === undefined,\n        });\n\n        for (const { onRequire } of matches) {\n          exports = onRequire(exports, name, basedir);\n        }\n\n        return exports;\n      }\n    );\n  }\n\n  /**\n   * Register a hook with `require-in-the-middle`\n   *\n   * @param {string} moduleName Module name\n   * @param {OnRequireFn} onRequire Hook function\n   * @returns {Hooked} Registered hook\n   */\n  register(moduleName: string, onRequire: OnRequireFn): Hooked {\n    const hooked = { moduleName, onRequire };\n    this._moduleNameTrie.insert(hooked);\n    return hooked;\n  }\n\n  /**\n   * Get the `RequireInTheMiddleSingleton` singleton\n   *\n   * @returns {RequireInTheMiddleSingleton} Singleton of `RequireInTheMiddleSingleton`\n   */\n  static getInstance(): RequireInTheMiddleSingleton {\n    // Mocha runs all test suites in the same process\n    // This prevents test suites from sharing a singleton\n    if (isMocha) return new RequireInTheMiddleSingleton();\n\n    return (this._instance =\n      this._instance ?? new RequireInTheMiddleSingleton());\n  }\n}\n\n/**\n * Normalize the path separators to forward slash in a module name or path\n *\n * @param {string} moduleNameOrPath Module name or path\n * @returns {string} Normalized module name or path\n */\nfunction normalizePathSeparators(moduleNameOrPath: string): string {\n  return path.sep !== ModuleNameSeparator\n    ? moduleNameOrPath.split(path.sep).join(ModuleNameSeparator)\n    : moduleNameOrPath;\n}\n","// Unless explicitly stated otherwise all files in this repository are licensed under the Apache 2.0 License.\n//\n// This product includes software developed at Datadog (https://www.datadoghq.com/). Copyright 2021 Datadog, Inc.\n\nconst importHooks = [] // TODO should this be a Set?\nconst setters = new WeakMap()\nconst specifiers = new Map()\nconst toHook = []\n\nconst proxyHandler = {\n  set (target, name, value) {\n    return setters.get(target)[name](value)\n  },\n\n  defineProperty (target, property, descriptor) {\n    if ((!('value' in descriptor))) {\n      throw new Error('Getters/setters are not supported for exports property descriptors.')\n    }\n\n    return setters.get(target)[property](descriptor.value)\n  }\n}\n\nfunction register (name, namespace, set, specifier) {\n  specifiers.set(name, specifier)\n  setters.set(namespace, set)\n  const proxy = new Proxy(namespace, proxyHandler)\n  importHooks.forEach(hook => hook(name, proxy))\n  toHook.push([name, proxy])\n}\n\nexports.register = register\nexports.importHooks = importHooks\nexports.specifiers = specifiers\nexports.toHook = toHook\n","// Unless explicitly stated otherwise all files in this repository are licensed under the Apache 2.0 License.\n//\n// This product includes software developed at Datadog (https://www.datadoghq.com/). Copyright 2021 Datadog, Inc.\n\nconst path = require('path')\nconst parse = require('module-details-from-path')\nconst { fileURLToPath } = require('url')\n\nconst {\n  importHooks,\n  specifiers,\n  toHook\n} = require('./lib/register')\n\nfunction addHook (hook) {\n  importHooks.push(hook)\n  toHook.forEach(([name, namespace]) => hook(name, namespace))\n}\n\nfunction removeHook (hook) {\n  const index = importHooks.indexOf(hook)\n  if (index > -1) {\n    importHooks.splice(index, 1)\n  }\n}\n\nfunction callHookFn (hookFn, namespace, name, baseDir) {\n  const newDefault = hookFn(namespace, name, baseDir)\n  if (newDefault && newDefault !== namespace) {\n    namespace.default = newDefault\n  }\n}\n\nfunction Hook (modules, options, hookFn) {\n  if ((this instanceof Hook) === false) return new Hook(modules, options, hookFn)\n  if (typeof modules === 'function') {\n    hookFn = modules\n    modules = null\n    options = null\n  } else if (typeof options === 'function') {\n    hookFn = options\n    options = null\n  }\n  const internals = options ? options.internals === true : false\n\n  this._iitmHook = (name, namespace) => {\n    const filename = name\n    const isBuiltin = name.startsWith('node:')\n    let baseDir\n\n    if (isBuiltin) {\n      name = name.replace(/^node:/, '')\n    } else {\n      if (name.startsWith('file://')) {\n        try {\n          name = fileURLToPath(name)\n        } catch (e) {}\n      }\n      const details = parse(name)\n      if (details) {\n        name = details.name\n        baseDir = details.basedir\n      }\n    }\n\n    if (modules) {\n      for (const moduleName of modules) {\n        if (moduleName === name) {\n          if (baseDir) {\n            if (internals) {\n              name = name + path.sep + path.relative(baseDir, fileURLToPath(filename))\n            } else {\n              if (!baseDir.endsWith(specifiers.get(filename))) continue\n            }\n          }\n          callHookFn(hookFn, namespace, name, baseDir)\n        }\n      }\n    } else {\n      callHookFn(hookFn, namespace, name, baseDir)\n    }\n  }\n\n  addHook(this._iitmHook)\n}\n\nHook.prototype.unhook = function () {\n  removeHook(this._iitmHook)\n}\n\nmodule.exports = Hook\nmodule.exports.Hook = Hook\nmodule.exports.addHook = addHook\nmodule.exports.removeHook = removeHook\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ShimWrapped } from './types';\n\n/**\n * function to execute patched function and being able to catch errors\n * @param execute - function to be executed\n * @param onFinish - callback to run when execute finishes\n */\nexport function safeExecuteInTheMiddle<T>(\n  execute: () => T,\n  onFinish: (e: Error | undefined, result: T | undefined) => void,\n  preventThrowingError?: boolean\n): T {\n  let error: Error | undefined;\n  let result: T | undefined;\n  try {\n    result = execute();\n  } catch (e) {\n    error = e;\n  } finally {\n    onFinish(error, result);\n    if (error && !preventThrowingError) {\n      // eslint-disable-next-line no-unsafe-finally\n      throw error;\n    }\n    // eslint-disable-next-line no-unsafe-finally\n    return result as T;\n  }\n}\n\n/**\n * Async function to execute patched function and being able to catch errors\n * @param execute - function to be executed\n * @param onFinish - callback to run when execute finishes\n */\nexport async function safeExecuteInTheMiddleAsync<T>(\n  execute: () => T,\n  onFinish: (e: Error | undefined, result: T | undefined) => void,\n  preventThrowingError?: boolean\n): Promise<T> {\n  let error: Error | undefined;\n  let result: T | undefined;\n  try {\n    result = await execute();\n  } catch (e) {\n    error = e;\n  } finally {\n    onFinish(error, result);\n    if (error && !preventThrowingError) {\n      // eslint-disable-next-line no-unsafe-finally\n      throw error;\n    }\n    // eslint-disable-next-line no-unsafe-finally\n    return result as T;\n  }\n}\n/**\n * Checks if certain function has been already wrapped\n * @param func\n */\nexport function isWrapped(func: unknown): func is ShimWrapped {\n  return (\n    typeof func === 'function' &&\n    typeof (func as ShimWrapped).__original === 'function' &&\n    typeof (func as ShimWrapped).__unwrap === 'function' &&\n    (func as ShimWrapped).__wrapped === true\n  );\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as types from '../../types';\nimport * as path from 'path';\nimport { types as utilTypes } from 'util';\nimport { satisfies } from 'semver';\nimport { wrap, unwrap, massWrap, massUnwrap } from 'shimmer';\nimport { InstrumentationAbstract } from '../../instrumentation';\nimport {\n  RequireInTheMiddleSingleton,\n  Hooked,\n} from './RequireInTheMiddleSingleton';\nimport type { HookFn } from 'import-in-the-middle';\nimport { Hook as HookImport } from 'import-in-the-middle';\nimport {\n  InstrumentationConfig,\n  InstrumentationModuleDefinition,\n} from '../../types';\nimport { diag } from '@opentelemetry/api';\nimport type { OnRequireFn } from 'require-in-the-middle';\nimport { Hook as HookRequire } from 'require-in-the-middle';\nimport { readFileSync } from 'fs';\nimport { isWrapped } from '../../utils';\n\n/**\n * Base abstract class for instrumenting node plugins\n */\nexport abstract class InstrumentationBase<\n    ConfigType extends InstrumentationConfig = InstrumentationConfig,\n  >\n  extends InstrumentationAbstract<ConfigType>\n  implements types.Instrumentation<ConfigType>\n{\n  private _modules: InstrumentationModuleDefinition[];\n  private _hooks: (Hooked | HookRequire)[] = [];\n  private _requireInTheMiddleSingleton: RequireInTheMiddleSingleton =\n    RequireInTheMiddleSingleton.getInstance();\n  private _enabled = false;\n\n  constructor(\n    instrumentationName: string,\n    instrumentationVersion: string,\n    config: ConfigType\n  ) {\n    super(instrumentationName, instrumentationVersion, config);\n\n    let modules = this.init();\n\n    if (modules && !Array.isArray(modules)) {\n      modules = [modules];\n    }\n\n    this._modules = (modules as InstrumentationModuleDefinition[]) || [];\n\n    if (this._modules.length === 0) {\n      diag.debug(\n        'No modules instrumentation has been defined for ' +\n          `'${this.instrumentationName}@${this.instrumentationVersion}'` +\n          ', nothing will be patched'\n      );\n    }\n\n    if (this._config.enabled) {\n      this.enable();\n    }\n  }\n\n  protected override _wrap: typeof wrap = (moduleExports, name, wrapper) => {\n    if (isWrapped(moduleExports[name])) {\n      this._unwrap(moduleExports, name);\n    }\n    if (!utilTypes.isProxy(moduleExports)) {\n      return wrap(moduleExports, name, wrapper);\n    } else {\n      const wrapped = wrap(Object.assign({}, moduleExports), name, wrapper);\n\n      return Object.defineProperty(moduleExports, name, {\n        value: wrapped,\n      });\n    }\n  };\n\n  protected override _unwrap: typeof unwrap = (moduleExports, name) => {\n    if (!utilTypes.isProxy(moduleExports)) {\n      return unwrap(moduleExports, name);\n    } else {\n      return Object.defineProperty(moduleExports, name, {\n        value: moduleExports[name],\n      });\n    }\n  };\n\n  protected override _massWrap: typeof massWrap = (\n    moduleExportsArray,\n    names,\n    wrapper\n  ) => {\n    if (!moduleExportsArray) {\n      diag.error('must provide one or more modules to patch');\n      return;\n    } else if (!Array.isArray(moduleExportsArray)) {\n      moduleExportsArray = [moduleExportsArray];\n    }\n\n    if (!(names && Array.isArray(names))) {\n      diag.error('must provide one or more functions to wrap on modules');\n      return;\n    }\n\n    moduleExportsArray.forEach(moduleExports => {\n      names.forEach(name => {\n        this._wrap(moduleExports, name, wrapper);\n      });\n    });\n  };\n\n  protected override _massUnwrap: typeof massUnwrap = (\n    moduleExportsArray,\n    names\n  ) => {\n    if (!moduleExportsArray) {\n      diag.error('must provide one or more modules to patch');\n      return;\n    } else if (!Array.isArray(moduleExportsArray)) {\n      moduleExportsArray = [moduleExportsArray];\n    }\n\n    if (!(names && Array.isArray(names))) {\n      diag.error('must provide one or more functions to wrap on modules');\n      return;\n    }\n\n    moduleExportsArray.forEach(moduleExports => {\n      names.forEach(name => {\n        this._unwrap(moduleExports, name);\n      });\n    });\n  };\n\n  private _warnOnPreloadedModules(): void {\n    this._modules.forEach((module: InstrumentationModuleDefinition) => {\n      const { name } = module;\n      try {\n        const resolvedModule = require.resolve(name);\n        if (require.cache[resolvedModule]) {\n          // Module is already cached, which means the instrumentation hook might not work\n          this._diag.warn(\n            `Module ${name} has been loaded before ${this.instrumentationName} so it might not work, please initialize it before requiring ${name}`\n          );\n        }\n      } catch {\n        // Module isn't available, we can simply skip\n      }\n    });\n  }\n\n  private _extractPackageVersion(baseDir: string): string | undefined {\n    try {\n      const json = readFileSync(path.join(baseDir, 'package.json'), {\n        encoding: 'utf8',\n      });\n      const version = JSON.parse(json).version;\n      return typeof version === 'string' ? version : undefined;\n    } catch (error) {\n      diag.warn('Failed extracting version', baseDir);\n    }\n\n    return undefined;\n  }\n\n  private _onRequire<T>(\n    module: InstrumentationModuleDefinition,\n    exports: T,\n    name: string,\n    baseDir?: string | void\n  ): T {\n    if (!baseDir) {\n      if (typeof module.patch === 'function') {\n        module.moduleExports = exports;\n        if (this._enabled) {\n          this._diag.debug(\n            'Applying instrumentation patch for nodejs core module on require hook',\n            {\n              module: module.name,\n            }\n          );\n          return module.patch(exports);\n        }\n      }\n      return exports;\n    }\n\n    const version = this._extractPackageVersion(baseDir);\n    module.moduleVersion = version;\n    if (module.name === name) {\n      // main module\n      if (\n        isSupported(module.supportedVersions, version, module.includePrerelease)\n      ) {\n        if (typeof module.patch === 'function') {\n          module.moduleExports = exports;\n          if (this._enabled) {\n            this._diag.debug(\n              'Applying instrumentation patch for module on require hook',\n              {\n                module: module.name,\n                version: module.moduleVersion,\n                baseDir,\n              }\n            );\n            return module.patch(exports, module.moduleVersion);\n          }\n        }\n      }\n      return exports;\n    }\n    // internal file\n    const files = module.files ?? [];\n    const normalizedName = path.normalize(name);\n    const supportedFileInstrumentations = files\n      .filter(f => f.name === normalizedName)\n      .filter(f =>\n        isSupported(f.supportedVersions, version, module.includePrerelease)\n      );\n    return supportedFileInstrumentations.reduce<T>((patchedExports, file) => {\n      file.moduleExports = patchedExports;\n      if (this._enabled) {\n        this._diag.debug(\n          'Applying instrumentation patch for nodejs module file on require hook',\n          {\n            module: module.name,\n            version: module.moduleVersion,\n            fileName: file.name,\n            baseDir,\n          }\n        );\n\n        // patch signature is not typed, so we cast it assuming it's correct\n        return file.patch(patchedExports, module.moduleVersion) as T;\n      }\n      return patchedExports;\n    }, exports);\n  }\n\n  public enable(): void {\n    if (this._enabled) {\n      return;\n    }\n    this._enabled = true;\n\n    // already hooked, just call patch again\n    if (this._hooks.length > 0) {\n      for (const module of this._modules) {\n        if (typeof module.patch === 'function' && module.moduleExports) {\n          this._diag.debug(\n            'Applying instrumentation patch for nodejs module on instrumentation enabled',\n            {\n              module: module.name,\n              version: module.moduleVersion,\n            }\n          );\n          module.patch(module.moduleExports, module.moduleVersion);\n        }\n        for (const file of module.files) {\n          if (file.moduleExports) {\n            this._diag.debug(\n              'Applying instrumentation patch for nodejs module file on instrumentation enabled',\n              {\n                module: module.name,\n                version: module.moduleVersion,\n                fileName: file.name,\n              }\n            );\n            file.patch(file.moduleExports, module.moduleVersion);\n          }\n        }\n      }\n      return;\n    }\n\n    this._warnOnPreloadedModules();\n    for (const module of this._modules) {\n      const hookFn: HookFn = (exports, name, baseDir) => {\n        return this._onRequire<typeof exports>(module, exports, name, baseDir);\n      };\n      const onRequire: OnRequireFn = (exports, name, baseDir) => {\n        return this._onRequire<typeof exports>(module, exports, name, baseDir);\n      };\n\n      // `RequireInTheMiddleSingleton` does not support absolute paths.\n      // For an absolute paths, we must create a separate instance of the\n      // require-in-the-middle `Hook`.\n      const hook = path.isAbsolute(module.name)\n        ? new HookRequire([module.name], { internals: true }, onRequire)\n        : this._requireInTheMiddleSingleton.register(module.name, onRequire);\n\n      this._hooks.push(hook);\n      const esmHook = new HookImport(\n        [module.name],\n        { internals: false },\n        <HookFn>hookFn\n      );\n      this._hooks.push(esmHook);\n    }\n  }\n\n  public disable(): void {\n    if (!this._enabled) {\n      return;\n    }\n    this._enabled = false;\n\n    for (const module of this._modules) {\n      if (typeof module.unpatch === 'function' && module.moduleExports) {\n        this._diag.debug(\n          'Removing instrumentation patch for nodejs module on instrumentation disabled',\n          {\n            module: module.name,\n            version: module.moduleVersion,\n          }\n        );\n        module.unpatch(module.moduleExports, module.moduleVersion);\n      }\n      for (const file of module.files) {\n        if (file.moduleExports) {\n          this._diag.debug(\n            'Removing instrumentation patch for nodejs module file on instrumentation disabled',\n            {\n              module: module.name,\n              version: module.moduleVersion,\n              fileName: file.name,\n            }\n          );\n          file.unpatch(file.moduleExports, module.moduleVersion);\n        }\n      }\n    }\n  }\n\n  public isEnabled(): boolean {\n    return this._enabled;\n  }\n}\n\nfunction isSupported(\n  supportedVersions: string[],\n  version?: string,\n  includePrerelease?: boolean\n): boolean {\n  if (typeof version === 'undefined') {\n    // If we don't have the version, accept the wildcard case only\n    return supportedVersions.includes('*');\n  }\n\n  return supportedVersions.some(supportedVersion => {\n    return satisfies(version, supportedVersion, { includePrerelease });\n  });\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport { normalize } from 'path';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport { InstrumentationBase } from './instrumentation';\nexport { normalize } from './normalize';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport { InstrumentationBase, normalize } from './node';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  InstrumentationModuleDefinition,\n  InstrumentationModuleFile,\n} from './types';\n\nexport class InstrumentationNodeModuleDefinition\n  implements InstrumentationModuleDefinition\n{\n  files: InstrumentationModuleFile[];\n  constructor(\n    public name: string,\n    public supportedVersions: string[],\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public patch?: (exports: any, moduleVersion?: string) => any,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public unpatch?: (exports: any, moduleVersion?: string) => void,\n    files?: InstrumentationModuleFile[]\n  ) {\n    this.files = files || [];\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InstrumentationModuleFile } from './types';\nimport { normalize } from './platform/index';\n\nexport class InstrumentationNodeModuleFile\n  implements InstrumentationModuleFile\n{\n  public name: string;\n  constructor(\n    name: string,\n    public supportedVersions: string[],\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public patch: (moduleExports: any, moduleVersion?: string) => any,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public unpatch: (moduleExports?: any, moduleVersion?: string) => void\n  ) {\n    this.name = normalize(name);\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TracerProvider, MeterProvider, Span } from '@opentelemetry/api';\nimport { LoggerProvider } from '@opentelemetry/api-logs';\n\n/** Interface Instrumentation to apply patch. */\nexport interface Instrumentation<\n  ConfigType extends InstrumentationConfig = InstrumentationConfig,\n> {\n  /** Instrumentation Name  */\n  instrumentationName: string;\n\n  /** Instrumentation Version  */\n  instrumentationVersion: string;\n\n  /**\n   * Instrumentation Description - please describe all useful information\n   * as Instrumentation might patch different version of different modules,\n   * or support different browsers etc.\n   */\n  instrumentationDescription?: string;\n\n  /** Method to disable the instrumentation  */\n  disable(): void;\n\n  /** Method to enable the instrumentation  */\n  enable(): void;\n\n  /** Method to set tracer provider  */\n  setTracerProvider(tracerProvider: TracerProvider): void;\n\n  /** Method to set meter provider  */\n  setMeterProvider(meterProvider: MeterProvider): void;\n\n  /** Method to set logger provider  */\n  setLoggerProvider?(loggerProvider: LoggerProvider): void;\n\n  /** Method to set instrumentation config  */\n  setConfig(config: ConfigType): void;\n\n  /** Method to get instrumentation config  */\n  getConfig(): ConfigType;\n}\n\n/**\n * Base interface for configuration options common to all instrumentations.\n * This interface can be extended by individual instrumentations to include\n * additional configuration options specific to that instrumentation.\n * All configuration options must be optional.\n */\nexport interface InstrumentationConfig {\n  /**\n   * Whether to enable the plugin.\n   * @default true\n   */\n  enabled?: boolean;\n}\n\n/**\n * This interface defines the params that are be added to the wrapped function\n * using the \"shimmer.wrap\"\n */\nexport interface ShimWrapped extends Function {\n  __wrapped: boolean;\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  __unwrap: Function;\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  __original: Function;\n}\n\nexport interface InstrumentationModuleFile {\n  /** Name of file to be patched with relative path */\n  name: string;\n\n  moduleExports?: unknown;\n\n  /** Supported versions for the file.\n   *\n   * A module version is supported if one of the supportedVersions in the array satisfies the module version.\n   * The syntax of the version is checked with the `satisfies` function of \"The semantic versioner for npm\", see\n   * [`semver` package](https://www.npmjs.com/package/semver)\n   * If the version is not supported, we won't apply instrumentation patch.\n   * If omitted, all versions of the module will be patched.\n   *\n   * It is recommended to always specify a range that is bound to a major version, to avoid breaking changes.\n   * New major versions should be reviewed and tested before being added to the supportedVersions array.\n   *\n   * Example: ['>=1.2.3 <3']\n   */\n  supportedVersions: string[];\n\n  /** Method to patch the instrumentation  */\n  patch(moduleExports: unknown, moduleVersion?: string): unknown;\n\n  /** Method to unpatch the instrumentation  */\n  unpatch(moduleExports?: unknown, moduleVersion?: string): void;\n}\n\nexport interface InstrumentationModuleDefinition {\n  /** Module name or path  */\n  name: string;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  moduleExports?: any;\n\n  /** Instrumented module version */\n  moduleVersion?: string;\n\n  /** Supported version of module.\n   *\n   * A module version is supported if one of the supportedVersions in the array satisfies the module version.\n   * The syntax of the version is checked with the `satisfies` function of \"The semantic versioner for npm\", see\n   * [`semver` package](https://www.npmjs.com/package/semver)\n   * If the version is not supported, we won't apply instrumentation patch (see `enable` method).\n   * If omitted, all versions of the module will be patched.\n   *\n   * It is recommended to always specify a range that is bound to a major version, to avoid breaking changes.\n   * New major versions should be reviewed and tested before being added to the supportedVersions array.\n   *\n   * Example: ['>=1.2.3 <3']\n   */\n  supportedVersions: string[];\n\n  /** Module internal files to be patched  */\n  files: InstrumentationModuleFile[];\n\n  /** If set to true, the includePrerelease check will be included when calling semver.satisfies */\n  includePrerelease?: boolean;\n\n  /** Method to patch the instrumentation  */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  patch?: (moduleExports: any, moduleVersion?: string) => any;\n\n  /** Method to unpatch the instrumentation  */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  unpatch?: (moduleExports: any, moduleVersion?: string) => void;\n}\n\n/**\n * SpanCustomizationHook is a common way for instrumentations to expose extension points\n * where users can add custom behavior to a span based on info object passed to the hook at different times of the span lifecycle.\n * This is an advanced feature, commonly used to add additional or non-spec-compliant attributes to the span,\n * capture payloads, modify the span in some way, or carry some other side effect.\n *\n * The hook is registered with the instrumentation specific config by implementing an handler function with this signature,\n * and if the hook is present, it will be called with the span and the event information\n * when the event is emitted.\n *\n * When and under what conditions the hook is called and what data is passed\n * in the info argument, is specific to each instrumentation and life-cycle event\n * and should be documented where it is used.\n *\n * Instrumentation may define multiple hooks, for different spans, or different span life-cycle events.\n */\nexport type SpanCustomizationHook<SpanCustomizationInfoType> = (\n  span: Span,\n  info: SpanCustomizationInfoType\n) => void;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TracerProvider, MeterProvider } from '@opentelemetry/api';\nimport { Instrumentation } from './types';\nimport { LoggerProvider } from '@opentelemetry/api-logs';\n\nexport interface AutoLoaderResult {\n  instrumentations: Instrumentation[];\n}\n\nexport interface AutoLoaderOptions {\n  instrumentations?: (Instrumentation | Instrumentation[])[];\n  tracerProvider?: TracerProvider;\n  meterProvider?: MeterProvider;\n  loggerProvider?: LoggerProvider;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport { registerInstrumentations } from './autoLoader';\nexport { InstrumentationBase } from './platform/index';\nexport { InstrumentationNodeModuleDefinition } from './instrumentationNodeModuleDefinition';\nexport { InstrumentationNodeModuleFile } from './instrumentationNodeModuleFile';\nexport * from './types';\nexport * from './types_internal';\nexport * from './utils';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  context,\n  HrTime,\n  INVALID_SPAN_CONTEXT,\n  propagation,\n  ROOT_CONTEXT,\n  Span,\n  SpanKind,\n  SpanOptions,\n  SpanStatus,\n  SpanStatusCode,\n  trace,\n  Histogram,\n  MetricAttributes,\n  ValueType,\n} from '@opentelemetry/api';\nimport {\n  hrTime,\n  hrTimeDuration,\n  hrTimeToMilliseconds,\n  suppressTracing,\n} from '@opentelemetry/core';\nimport type * as http from 'http';\nimport type * as https from 'https';\nimport { Socket } from 'net';\nimport * as semver from 'semver';\nimport * as url from 'url';\nimport {\n  Err,\n  Func,\n  Http,\n  HttpInstrumentationConfig,\n  HttpRequestArgs,\n  Https,\n} from './types';\nimport * as utils from './utils';\nimport { VERSION } from './version';\nimport {\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\nimport { RPCMetadata, RPCType, setRPCMetadata } from '@opentelemetry/core';\nimport { errorMonitor } from 'events';\nimport { SEMATTRS_HTTP_ROUTE } from '@opentelemetry/semantic-conventions';\n\n/**\n * Http instrumentation instrumentation for Opentelemetry\n */\nexport class HttpInstrumentation extends InstrumentationBase<HttpInstrumentationConfig> {\n  /** keep track on spans not ended */\n  private readonly _spanNotEnded: WeakSet<Span> = new WeakSet<Span>();\n  private _headerCapture;\n  private _httpServerDurationHistogram!: Histogram;\n  private _httpClientDurationHistogram!: Histogram;\n\n  constructor(config: HttpInstrumentationConfig = {}) {\n    super('@opentelemetry/instrumentation-http', VERSION, config);\n    this._headerCapture = this._createHeaderCapture();\n  }\n\n  protected override _updateMetricInstruments() {\n    this._httpServerDurationHistogram = this.meter.createHistogram(\n      'http.server.duration',\n      {\n        description: 'Measures the duration of inbound HTTP requests.',\n        unit: 'ms',\n        valueType: ValueType.DOUBLE,\n      }\n    );\n    this._httpClientDurationHistogram = this.meter.createHistogram(\n      'http.client.duration',\n      {\n        description: 'Measures the duration of outbound HTTP requests.',\n        unit: 'ms',\n        valueType: ValueType.DOUBLE,\n      }\n    );\n  }\n\n  override setConfig(config: HttpInstrumentationConfig = {}): void {\n    super.setConfig(config);\n    this._headerCapture = this._createHeaderCapture();\n  }\n\n  init(): [\n    InstrumentationNodeModuleDefinition,\n    InstrumentationNodeModuleDefinition,\n  ] {\n    return [this._getHttpsInstrumentation(), this._getHttpInstrumentation()];\n  }\n\n  private _getHttpInstrumentation() {\n    return new InstrumentationNodeModuleDefinition(\n      'http',\n      ['*'],\n      (moduleExports: Http): Http => {\n        this._wrap(\n          moduleExports,\n          'request',\n          this._getPatchOutgoingRequestFunction('http')\n        );\n        this._wrap(\n          moduleExports,\n          'get',\n          this._getPatchOutgoingGetFunction(moduleExports.request)\n        );\n        this._wrap(\n          moduleExports.Server.prototype,\n          'emit',\n          this._getPatchIncomingRequestFunction('http')\n        );\n        return moduleExports;\n      },\n      (moduleExports: Http) => {\n        if (moduleExports === undefined) return;\n\n        this._unwrap(moduleExports, 'request');\n        this._unwrap(moduleExports, 'get');\n        this._unwrap(moduleExports.Server.prototype, 'emit');\n      }\n    );\n  }\n\n  private _getHttpsInstrumentation() {\n    return new InstrumentationNodeModuleDefinition(\n      'https',\n      ['*'],\n      (moduleExports: Https): Https => {\n        this._wrap(\n          moduleExports,\n          'request',\n          this._getPatchHttpsOutgoingRequestFunction('https')\n        );\n        this._wrap(\n          moduleExports,\n          'get',\n          this._getPatchHttpsOutgoingGetFunction(moduleExports.request)\n        );\n        this._wrap(\n          moduleExports.Server.prototype,\n          'emit',\n          this._getPatchIncomingRequestFunction('https')\n        );\n        return moduleExports;\n      },\n      (moduleExports: Https) => {\n        if (moduleExports === undefined) return;\n\n        this._unwrap(moduleExports, 'request');\n        this._unwrap(moduleExports, 'get');\n        this._unwrap(moduleExports.Server.prototype, 'emit');\n      }\n    );\n  }\n\n  /**\n   * Creates spans for incoming requests, restoring spans' context if applied.\n   */\n  protected _getPatchIncomingRequestFunction(component: 'http' | 'https') {\n    return (\n      original: (event: string, ...args: unknown[]) => boolean\n    ): ((this: unknown, event: string, ...args: unknown[]) => boolean) => {\n      return this._incomingRequestFunction(component, original);\n    };\n  }\n\n  /**\n   * Creates spans for outgoing requests, sending spans' context for distributed\n   * tracing.\n   */\n  protected _getPatchOutgoingRequestFunction(component: 'http' | 'https') {\n    return (original: Func<http.ClientRequest>): Func<http.ClientRequest> => {\n      return this._outgoingRequestFunction(component, original);\n    };\n  }\n\n  protected _getPatchOutgoingGetFunction(\n    clientRequest: (\n      options: http.RequestOptions | string | url.URL,\n      ...args: HttpRequestArgs\n    ) => http.ClientRequest\n  ) {\n    return (_original: Func<http.ClientRequest>): Func<http.ClientRequest> => {\n      // Re-implement http.get. This needs to be done (instead of using\n      // getPatchOutgoingRequestFunction to patch it) because we need to\n      // set the trace context header before the returned http.ClientRequest is\n      // ended. The Node.js docs state that the only differences between\n      // request and get are that (1) get defaults to the HTTP GET method and\n      // (2) the returned request object is ended immediately. The former is\n      // already true (at least in supported Node versions up to v10), so we\n      // simply follow the latter. Ref:\n      // https://nodejs.org/dist/latest/docs/api/http.html#http_http_get_options_callback\n      // https://github.com/googleapis/cloud-trace-nodejs/blob/master/src/instrumentations/instrumentation-http.ts#L198\n      return function outgoingGetRequest<\n        T extends http.RequestOptions | string | url.URL,\n      >(options: T, ...args: HttpRequestArgs): http.ClientRequest {\n        const req = clientRequest(options, ...args);\n        req.end();\n        return req;\n      };\n    };\n  }\n\n  /** Patches HTTPS outgoing requests */\n  private _getPatchHttpsOutgoingRequestFunction(component: 'http' | 'https') {\n    return (original: Func<http.ClientRequest>): Func<http.ClientRequest> => {\n      const instrumentation = this;\n      return function httpsOutgoingRequest(\n        // eslint-disable-next-line node/no-unsupported-features/node-builtins\n        options: https.RequestOptions | string | URL,\n        ...args: HttpRequestArgs\n      ): http.ClientRequest {\n        // Makes sure options will have default HTTPS parameters\n        if (\n          component === 'https' &&\n          typeof options === 'object' &&\n          options?.constructor?.name !== 'URL'\n        ) {\n          options = Object.assign({}, options);\n          instrumentation._setDefaultOptions(options);\n        }\n        return instrumentation._getPatchOutgoingRequestFunction(component)(\n          original\n        )(options, ...args);\n      };\n    };\n  }\n\n  private _setDefaultOptions(options: https.RequestOptions) {\n    options.protocol = options.protocol || 'https:';\n    options.port = options.port || 443;\n  }\n\n  /** Patches HTTPS outgoing get requests */\n  private _getPatchHttpsOutgoingGetFunction(\n    clientRequest: (\n      // eslint-disable-next-line node/no-unsupported-features/node-builtins\n      options: http.RequestOptions | string | URL,\n      ...args: HttpRequestArgs\n    ) => http.ClientRequest\n  ) {\n    return (original: Func<http.ClientRequest>): Func<http.ClientRequest> => {\n      const instrumentation = this;\n      return function httpsOutgoingRequest(\n        // eslint-disable-next-line node/no-unsupported-features/node-builtins\n        options: https.RequestOptions | string | URL,\n        ...args: HttpRequestArgs\n      ): http.ClientRequest {\n        return instrumentation._getPatchOutgoingGetFunction(clientRequest)(\n          original\n        )(options, ...args);\n      };\n    };\n  }\n\n  /**\n   * Attach event listeners to a client request to end span and add span attributes.\n   *\n   * @param request The original request object.\n   * @param span representing the current operation\n   * @param startTime representing the start time of the request to calculate duration in Metric\n   * @param metricAttributes metric attributes\n   */\n  private _traceClientRequest(\n    request: http.ClientRequest,\n    span: Span,\n    startTime: HrTime,\n    metricAttributes: MetricAttributes\n  ): http.ClientRequest {\n    if (this.getConfig().requestHook) {\n      this._callRequestHook(span, request);\n    }\n\n    /**\n     * Determines if the request has errored or the response has ended/errored.\n     */\n    let responseFinished = false;\n\n    /*\n     * User 'response' event listeners can be added before our listener,\n     * force our listener to be the first, so response emitter is bound\n     * before any user listeners are added to it.\n     */\n    request.prependListener(\n      'response',\n      (response: http.IncomingMessage & { aborted?: boolean }) => {\n        this._diag.debug('outgoingRequest on response()');\n        if (request.listenerCount('response') <= 1) {\n          response.resume();\n        }\n        const responseAttributes =\n          utils.getOutgoingRequestAttributesOnResponse(response);\n        span.setAttributes(responseAttributes);\n        metricAttributes = Object.assign(\n          metricAttributes,\n          utils.getOutgoingRequestMetricAttributesOnResponse(responseAttributes)\n        );\n\n        if (this.getConfig().responseHook) {\n          this._callResponseHook(span, response);\n        }\n\n        this._headerCapture.client.captureRequestHeaders(span, header =>\n          request.getHeader(header)\n        );\n        this._headerCapture.client.captureResponseHeaders(\n          span,\n          header => response.headers[header]\n        );\n\n        context.bind(context.active(), response);\n\n        const endHandler = () => {\n          this._diag.debug('outgoingRequest on end()');\n          if (responseFinished) {\n            return;\n          }\n          responseFinished = true;\n          let status: SpanStatus;\n\n          if (response.aborted && !response.complete) {\n            status = { code: SpanStatusCode.ERROR };\n          } else {\n            status = {\n              code: utils.parseResponseStatus(\n                SpanKind.CLIENT,\n                response.statusCode\n              ),\n            };\n          }\n\n          span.setStatus(status);\n\n          if (this.getConfig().applyCustomAttributesOnSpan) {\n            safeExecuteInTheMiddle(\n              () =>\n                this.getConfig().applyCustomAttributesOnSpan!(\n                  span,\n                  request,\n                  response\n                ),\n              () => {},\n              true\n            );\n          }\n\n          this._closeHttpSpan(\n            span,\n            SpanKind.CLIENT,\n            startTime,\n            metricAttributes\n          );\n        };\n\n        response.on('end', endHandler);\n        // See https://github.com/open-telemetry/opentelemetry-js/pull/3625#issuecomment-1475673533\n        if (semver.lt(process.version, '16.0.0')) {\n          response.on('close', endHandler);\n        }\n        response.on(errorMonitor, (error: Err) => {\n          this._diag.debug('outgoingRequest on error()', error);\n          if (responseFinished) {\n            return;\n          }\n          responseFinished = true;\n          utils.setSpanWithError(span, error);\n          span.setStatus({\n            code: SpanStatusCode.ERROR,\n            message: error.message,\n          });\n          this._closeHttpSpan(\n            span,\n            SpanKind.CLIENT,\n            startTime,\n            metricAttributes\n          );\n        });\n      }\n    );\n    request.on('close', () => {\n      this._diag.debug('outgoingRequest on request close()');\n      if (request.aborted || responseFinished) {\n        return;\n      }\n      responseFinished = true;\n      this._closeHttpSpan(span, SpanKind.CLIENT, startTime, metricAttributes);\n    });\n    request.on(errorMonitor, (error: Err) => {\n      this._diag.debug('outgoingRequest on request error()', error);\n      if (responseFinished) {\n        return;\n      }\n      responseFinished = true;\n      utils.setSpanWithError(span, error);\n      this._closeHttpSpan(span, SpanKind.CLIENT, startTime, metricAttributes);\n    });\n\n    this._diag.debug('http.ClientRequest return request');\n    return request;\n  }\n\n  private _incomingRequestFunction(\n    component: 'http' | 'https',\n    original: (event: string, ...args: unknown[]) => boolean\n  ) {\n    const instrumentation = this;\n    return function incomingRequest(\n      this: unknown,\n      event: string,\n      ...args: unknown[]\n    ): boolean {\n      // Only traces request events\n      if (event !== 'request') {\n        return original.apply(this, [event, ...args]);\n      }\n\n      const request = args[0] as http.IncomingMessage;\n      const response = args[1] as http.ServerResponse & { socket: Socket };\n      const pathname = request.url\n        ? url.parse(request.url).pathname || '/'\n        : '/';\n      const method = request.method || 'GET';\n\n      instrumentation._diag.debug(\n        `${component} instrumentation incomingRequest`\n      );\n\n      if (\n        utils.isIgnored(\n          pathname,\n          instrumentation.getConfig().ignoreIncomingPaths,\n          (e: unknown) =>\n            instrumentation._diag.error('caught ignoreIncomingPaths error: ', e)\n        ) ||\n        safeExecuteInTheMiddle(\n          () =>\n            instrumentation.getConfig().ignoreIncomingRequestHook?.(request),\n          (e: unknown) => {\n            if (e != null) {\n              instrumentation._diag.error(\n                'caught ignoreIncomingRequestHook error: ',\n                e\n              );\n            }\n          },\n          true\n        )\n      ) {\n        return context.with(suppressTracing(context.active()), () => {\n          context.bind(context.active(), request);\n          context.bind(context.active(), response);\n          return original.apply(this, [event, ...args]);\n        });\n      }\n\n      const headers = request.headers;\n\n      const spanAttributes = utils.getIncomingRequestAttributes(request, {\n        component: component,\n        serverName: instrumentation.getConfig().serverName,\n        hookAttributes: instrumentation._callStartSpanHook(\n          request,\n          instrumentation.getConfig().startIncomingSpanHook\n        ),\n      });\n\n      const spanOptions: SpanOptions = {\n        kind: SpanKind.SERVER,\n        attributes: spanAttributes,\n      };\n\n      const startTime = hrTime();\n      const metricAttributes =\n        utils.getIncomingRequestMetricAttributes(spanAttributes);\n\n      const ctx = propagation.extract(ROOT_CONTEXT, headers);\n      const span = instrumentation._startHttpSpan(method, spanOptions, ctx);\n      const rpcMetadata: RPCMetadata = {\n        type: RPCType.HTTP,\n        span,\n      };\n\n      return context.with(\n        setRPCMetadata(trace.setSpan(ctx, span), rpcMetadata),\n        () => {\n          context.bind(context.active(), request);\n          context.bind(context.active(), response);\n\n          if (instrumentation.getConfig().requestHook) {\n            instrumentation._callRequestHook(span, request);\n          }\n          if (instrumentation.getConfig().responseHook) {\n            instrumentation._callResponseHook(span, response);\n          }\n\n          instrumentation._headerCapture.server.captureRequestHeaders(\n            span,\n            header => request.headers[header]\n          );\n\n          // After 'error', no further events other than 'close' should be emitted.\n          let hasError = false;\n          response.on('close', () => {\n            if (hasError) {\n              return;\n            }\n            instrumentation._onServerResponseFinish(\n              request,\n              response,\n              span,\n              metricAttributes,\n              startTime\n            );\n          });\n          response.on(errorMonitor, (err: Err) => {\n            hasError = true;\n            instrumentation._onServerResponseError(\n              span,\n              metricAttributes,\n              startTime,\n              err\n            );\n          });\n\n          return safeExecuteInTheMiddle(\n            () => original.apply(this, [event, ...args]),\n            error => {\n              if (error) {\n                utils.setSpanWithError(span, error);\n                instrumentation._closeHttpSpan(\n                  span,\n                  SpanKind.SERVER,\n                  startTime,\n                  metricAttributes\n                );\n                throw error;\n              }\n            }\n          );\n        }\n      );\n    };\n  }\n\n  private _outgoingRequestFunction(\n    component: 'http' | 'https',\n    original: Func<http.ClientRequest>\n  ): Func<http.ClientRequest> {\n    const instrumentation = this;\n    return function outgoingRequest(\n      this: unknown,\n      options: url.URL | http.RequestOptions | string,\n      ...args: unknown[]\n    ): http.ClientRequest {\n      if (!utils.isValidOptionsType(options)) {\n        return original.apply(this, [options, ...args]);\n      }\n      const extraOptions =\n        typeof args[0] === 'object' &&\n        (typeof options === 'string' || options instanceof url.URL)\n          ? (args.shift() as http.RequestOptions)\n          : undefined;\n      const { origin, pathname, method, optionsParsed } = utils.getRequestInfo(\n        options,\n        extraOptions\n      );\n      /**\n       * Node 8's https module directly call the http one so to avoid creating\n       * 2 span for the same request we need to check that the protocol is correct\n       * See: https://github.com/nodejs/node/blob/v8.17.0/lib/https.js#L245\n       */\n      if (\n        component === 'http' &&\n        semver.lt(process.version, '9.0.0') &&\n        optionsParsed.protocol === 'https:'\n      ) {\n        return original.apply(this, [optionsParsed, ...args]);\n      }\n\n      if (\n        utils.isIgnored(\n          origin + pathname,\n          instrumentation.getConfig().ignoreOutgoingUrls,\n          (e: unknown) =>\n            instrumentation._diag.error('caught ignoreOutgoingUrls error: ', e)\n        ) ||\n        safeExecuteInTheMiddle(\n          () =>\n            instrumentation\n              .getConfig()\n              .ignoreOutgoingRequestHook?.(optionsParsed),\n          (e: unknown) => {\n            if (e != null) {\n              instrumentation._diag.error(\n                'caught ignoreOutgoingRequestHook error: ',\n                e\n              );\n            }\n          },\n          true\n        )\n      ) {\n        return original.apply(this, [optionsParsed, ...args]);\n      }\n\n      const { hostname, port } = utils.extractHostnameAndPort(optionsParsed);\n\n      const attributes = utils.getOutgoingRequestAttributes(optionsParsed, {\n        component,\n        port,\n        hostname,\n        hookAttributes: instrumentation._callStartSpanHook(\n          optionsParsed,\n          instrumentation.getConfig().startOutgoingSpanHook\n        ),\n      });\n\n      const startTime = hrTime();\n      const metricAttributes: MetricAttributes =\n        utils.getOutgoingRequestMetricAttributes(attributes);\n\n      const spanOptions: SpanOptions = {\n        kind: SpanKind.CLIENT,\n        attributes,\n      };\n      const span = instrumentation._startHttpSpan(method, spanOptions);\n\n      const parentContext = context.active();\n      const requestContext = trace.setSpan(parentContext, span);\n\n      if (!optionsParsed.headers) {\n        optionsParsed.headers = {};\n      } else {\n        // Make a copy of the headers object to avoid mutating an object the\n        // caller might have a reference to.\n        optionsParsed.headers = Object.assign({}, optionsParsed.headers);\n      }\n      propagation.inject(requestContext, optionsParsed.headers);\n\n      return context.with(requestContext, () => {\n        /*\n         * The response callback is registered before ClientRequest is bound,\n         * thus it is needed to bind it before the function call.\n         */\n        const cb = args[args.length - 1];\n        if (typeof cb === 'function') {\n          args[args.length - 1] = context.bind(parentContext, cb);\n        }\n\n        const request: http.ClientRequest = safeExecuteInTheMiddle(\n          () => original.apply(this, [optionsParsed, ...args]),\n          error => {\n            if (error) {\n              utils.setSpanWithError(span, error);\n              instrumentation._closeHttpSpan(\n                span,\n                SpanKind.CLIENT,\n                startTime,\n                metricAttributes\n              );\n              throw error;\n            }\n          }\n        );\n\n        instrumentation._diag.debug(\n          `${component} instrumentation outgoingRequest`\n        );\n        context.bind(parentContext, request);\n        return instrumentation._traceClientRequest(\n          request,\n          span,\n          startTime,\n          metricAttributes\n        );\n      });\n    };\n  }\n\n  private _onServerResponseFinish(\n    request: http.IncomingMessage,\n    response: http.ServerResponse,\n    span: Span,\n    metricAttributes: MetricAttributes,\n    startTime: HrTime\n  ) {\n    const attributes = utils.getIncomingRequestAttributesOnResponse(\n      request,\n      response\n    );\n    metricAttributes = Object.assign(\n      metricAttributes,\n      utils.getIncomingRequestMetricAttributesOnResponse(attributes)\n    );\n\n    this._headerCapture.server.captureResponseHeaders(span, header =>\n      response.getHeader(header)\n    );\n\n    span.setAttributes(attributes).setStatus({\n      code: utils.parseResponseStatus(SpanKind.SERVER, response.statusCode),\n    });\n\n    const route = attributes[SEMATTRS_HTTP_ROUTE];\n    if (route) {\n      span.updateName(`${request.method || 'GET'} ${route}`);\n    }\n\n    if (this.getConfig().applyCustomAttributesOnSpan) {\n      safeExecuteInTheMiddle(\n        () =>\n          this.getConfig().applyCustomAttributesOnSpan!(\n            span,\n            request,\n            response\n          ),\n        () => {},\n        true\n      );\n    }\n\n    this._closeHttpSpan(span, SpanKind.SERVER, startTime, metricAttributes);\n  }\n\n  private _onServerResponseError(\n    span: Span,\n    metricAttributes: MetricAttributes,\n    startTime: HrTime,\n    error: Err\n  ) {\n    utils.setSpanWithError(span, error);\n    this._closeHttpSpan(span, SpanKind.SERVER, startTime, metricAttributes);\n  }\n\n  private _startHttpSpan(\n    name: string,\n    options: SpanOptions,\n    ctx = context.active()\n  ) {\n    /*\n     * If a parent is required but not present, we use a `NoopSpan` to still\n     * propagate context without recording it.\n     */\n    const requireParent =\n      options.kind === SpanKind.CLIENT\n        ? this.getConfig().requireParentforOutgoingSpans\n        : this.getConfig().requireParentforIncomingSpans;\n\n    let span: Span;\n    const currentSpan = trace.getSpan(ctx);\n\n    if (requireParent === true && currentSpan === undefined) {\n      span = trace.wrapSpanContext(INVALID_SPAN_CONTEXT);\n    } else if (requireParent === true && currentSpan?.spanContext().isRemote) {\n      span = currentSpan;\n    } else {\n      span = this.tracer.startSpan(name, options, ctx);\n    }\n    this._spanNotEnded.add(span);\n    return span;\n  }\n\n  private _closeHttpSpan(\n    span: Span,\n    spanKind: SpanKind,\n    startTime: HrTime,\n    metricAttributes: MetricAttributes\n  ) {\n    if (!this._spanNotEnded.has(span)) {\n      return;\n    }\n\n    span.end();\n    this._spanNotEnded.delete(span);\n\n    // Record metrics\n    const duration = hrTimeToMilliseconds(hrTimeDuration(startTime, hrTime()));\n    if (spanKind === SpanKind.SERVER) {\n      this._httpServerDurationHistogram.record(duration, metricAttributes);\n    } else if (spanKind === SpanKind.CLIENT) {\n      this._httpClientDurationHistogram.record(duration, metricAttributes);\n    }\n  }\n\n  private _callResponseHook(\n    span: Span,\n    response: http.IncomingMessage | http.ServerResponse\n  ) {\n    safeExecuteInTheMiddle(\n      () => this.getConfig().responseHook!(span, response),\n      () => {},\n      true\n    );\n  }\n\n  private _callRequestHook(\n    span: Span,\n    request: http.ClientRequest | http.IncomingMessage\n  ) {\n    safeExecuteInTheMiddle(\n      () => this.getConfig().requestHook!(span, request),\n      () => {},\n      true\n    );\n  }\n\n  private _callStartSpanHook(\n    request: http.IncomingMessage | http.RequestOptions,\n    hookFunc: Function | undefined\n  ) {\n    if (typeof hookFunc === 'function') {\n      return safeExecuteInTheMiddle(\n        () => hookFunc(request),\n        () => {},\n        true\n      );\n    }\n  }\n\n  private _createHeaderCapture() {\n    const config = this.getConfig();\n\n    return {\n      client: {\n        captureRequestHeaders: utils.headerCapture(\n          'request',\n          config.headersToSpanAttributes?.client?.requestHeaders ?? []\n        ),\n        captureResponseHeaders: utils.headerCapture(\n          'response',\n          config.headersToSpanAttributes?.client?.responseHeaders ?? []\n        ),\n      },\n      server: {\n        captureRequestHeaders: utils.headerCapture(\n          'request',\n          config.headersToSpanAttributes?.server?.requestHeaders ?? []\n        ),\n        captureResponseHeaders: utils.headerCapture(\n          'response',\n          config.headersToSpanAttributes?.server?.responseHeaders ?? []\n        ),\n      },\n    };\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './http';\nexport * from './types';\nexport * from './utils';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport enum ExpressLayerType {\n  ROUTER = 'router',\n  MIDDLEWARE = 'middleware',\n  REQUEST_HANDLER = 'request_handler',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport enum AttributeNames {\n  EXPRESS_TYPE = 'express.type',\n  EXPRESS_NAME = 'express.name',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Request } from 'express';\nimport { Attributes } from '@opentelemetry/api';\n\n/**\n * This symbol is used to mark express layer as being already instrumented\n * since its possible to use a given layer multiple times (ex: middlewares)\n */\nexport const kLayerPatched: unique symbol = Symbol('express-layer-patched');\n\n/**\n * This const define where on the `request` object the Instrumentation will mount the\n * current stack of express layer.\n *\n * It is necessary because express doesn't store the different layers\n * (ie: middleware, router etc) that it called to get to the current layer.\n * Given that, the only way to know the route of a given layer is to\n * store the path of where each previous layer has been mounted.\n *\n * ex: bodyParser > auth middleware > /users router > get /:id\n *  in this case the stack would be: [\"/users\", \"/:id\"]\n *\n * ex2: bodyParser > /api router > /v1 router > /users router > get /:id\n *  stack: [\"/api\", \"/v1\", \"/users\", \":id\"]\n *\n */\nexport const _LAYERS_STORE_PROPERTY = '__ot_middlewares';\n\nexport type PatchedRequest = {\n  [_LAYERS_STORE_PROPERTY]?: string[];\n} & Request;\nexport type PathParams = string | RegExp | Array<string | RegExp>;\n\n// https://github.com/expressjs/express/blob/main/lib/router/index.js#L53\nexport type ExpressRouter = {\n  params: { [key: string]: string };\n  _params: string[];\n  caseSensitive: boolean;\n  mergeParams: boolean;\n  strict: boolean;\n  stack: ExpressLayer[];\n};\n\n// https://github.com/expressjs/express/blob/main/lib/router/layer.js#L33\nexport type ExpressLayer = {\n  handle: Function & Record<string, any>;\n  [kLayerPatched]?: boolean;\n  name: string;\n  params: { [key: string]: string };\n  path: string;\n  regexp: RegExp;\n};\n\nexport type LayerMetadata = {\n  attributes: Attributes;\n  name: string;\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Attributes } from '@opentelemetry/api';\nimport {\n  IgnoreMatcher,\n  ExpressInstrumentationConfig,\n  LayerPathSegment,\n} from './types';\nimport { ExpressLayerType } from './enums/ExpressLayerType';\nimport { AttributeNames } from './enums/AttributeNames';\nimport {\n  ExpressLayer,\n  PatchedRequest,\n  _LAYERS_STORE_PROPERTY,\n} from './internal-types';\n\n/**\n * Store layers path in the request to be able to construct route later\n * @param request The request where\n * @param [value] the value to push into the array\n */\nexport const storeLayerPath = (request: PatchedRequest, value?: string) => {\n  if (Array.isArray(request[_LAYERS_STORE_PROPERTY]) === false) {\n    Object.defineProperty(request, _LAYERS_STORE_PROPERTY, {\n      enumerable: false,\n      value: [],\n    });\n  }\n  if (value === undefined) return;\n  (request[_LAYERS_STORE_PROPERTY] as string[]).push(value);\n};\n\n/**\n * Parse express layer context to retrieve a name and attributes.\n * @param layer Express layer\n * @param [layerPath] if present, the path on which the layer has been mounted\n */\nexport const getLayerMetadata = (\n  layer: ExpressLayer,\n  layerPath?: string\n): {\n  attributes: Attributes;\n  name: string;\n} => {\n  if (layer.name === 'router') {\n    return {\n      attributes: {\n        [AttributeNames.EXPRESS_NAME]: layerPath,\n        [AttributeNames.EXPRESS_TYPE]: ExpressLayerType.ROUTER,\n      },\n      name: `router - ${layerPath}`,\n    };\n  } else if (layer.name === 'bound dispatch') {\n    return {\n      attributes: {\n        [AttributeNames.EXPRESS_NAME]: layerPath ?? 'request handler',\n        [AttributeNames.EXPRESS_TYPE]: ExpressLayerType.REQUEST_HANDLER,\n      },\n      name: `request handler${layer.path ? ` - ${layerPath}` : ''}`,\n    };\n  } else {\n    return {\n      attributes: {\n        [AttributeNames.EXPRESS_NAME]: layer.name,\n        [AttributeNames.EXPRESS_TYPE]: ExpressLayerType.MIDDLEWARE,\n      },\n      name: `middleware - ${layer.name}`,\n    };\n  }\n};\n\n/**\n * Check whether the given obj match pattern\n * @param constant e.g URL of request\n * @param obj obj to inspect\n * @param pattern Match pattern\n */\nconst satisfiesPattern = (\n  constant: string,\n  pattern: IgnoreMatcher\n): boolean => {\n  if (typeof pattern === 'string') {\n    return pattern === constant;\n  } else if (pattern instanceof RegExp) {\n    return pattern.test(constant);\n  } else if (typeof pattern === 'function') {\n    return pattern(constant);\n  } else {\n    throw new TypeError('Pattern is in unsupported datatype');\n  }\n};\n\n/**\n * Check whether the given request is ignored by configuration\n * It will not re-throw exceptions from `list` provided by the client\n * @param constant e.g URL of request\n * @param [list] List of ignore patterns\n * @param [onException] callback for doing something when an exception has\n *     occurred\n */\nexport const isLayerIgnored = (\n  name: string,\n  type: ExpressLayerType,\n  config?: ExpressInstrumentationConfig\n): boolean => {\n  if (\n    Array.isArray(config?.ignoreLayersType) &&\n    config?.ignoreLayersType?.includes(type)\n  ) {\n    return true;\n  }\n  if (Array.isArray(config?.ignoreLayers) === false) return false;\n  try {\n    for (const pattern of config!.ignoreLayers!) {\n      if (satisfiesPattern(name, pattern)) {\n        return true;\n      }\n    }\n  } catch (e) {\n    /* catch block*/\n  }\n\n  return false;\n};\n\n/**\n * Converts a user-provided error value into an error and error message pair\n *\n * @param error - User-provided error value\n * @returns Both an Error or string representation of the value and an error message\n */\nexport const asErrorAndMessage = (\n  error: unknown\n): [error: string | Error, message: string] =>\n  error instanceof Error\n    ? [error, error.message]\n    : [String(error), String(error)];\n\n/**\n * Extracts the layer path from the route arguments\n *\n * @param args - Arguments of the route\n * @returns The layer path\n */\nexport const getLayerPath = (\n  args: [LayerPathSegment | LayerPathSegment[], ...unknown[]]\n): string | undefined => {\n  if (Array.isArray(args[0])) {\n    return args[0].map(arg => extractLayerPathSegment(arg) || '').join(',');\n  }\n\n  return extractLayerPathSegment(args[0]);\n};\n\nconst extractLayerPathSegment = (arg: LayerPathSegment) => {\n  if (typeof arg === 'string') {\n    return arg;\n  }\n\n  if (arg instanceof RegExp || typeof arg === 'number') {\n    return arg.toString();\n  }\n\n  return;\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.41.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-express';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getRPCMetadata, RPCType } from '@opentelemetry/core';\nimport {\n  trace,\n  context,\n  diag,\n  Attributes,\n  SpanStatusCode,\n} from '@opentelemetry/api';\nimport type * as express from 'express';\nimport { ExpressInstrumentationConfig, ExpressRequestInfo } from './types';\nimport { ExpressLayerType } from './enums/ExpressLayerType';\nimport { AttributeNames } from './enums/AttributeNames';\nimport {\n  asErrorAndMessage,\n  getLayerMetadata,\n  getLayerPath,\n  isLayerIgnored,\n  storeLayerPath,\n} from './utils';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport {\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  isWrapped,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\nimport { SEMATTRS_HTTP_ROUTE } from '@opentelemetry/semantic-conventions';\nimport {\n  ExpressLayer,\n  ExpressRouter,\n  kLayerPatched,\n  PatchedRequest,\n  _LAYERS_STORE_PROPERTY,\n} from './internal-types';\n\n/** Express instrumentation for OpenTelemetry */\nexport class ExpressInstrumentation extends InstrumentationBase {\n  constructor(config: ExpressInstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  override setConfig(config: ExpressInstrumentationConfig = {}) {\n    this._config = Object.assign({}, config);\n  }\n\n  override getConfig(): ExpressInstrumentationConfig {\n    return this._config as ExpressInstrumentationConfig;\n  }\n\n  init() {\n    return [\n      new InstrumentationNodeModuleDefinition(\n        'express',\n        ['>=4.0.0 <5'],\n        moduleExports => {\n          const routerProto = moduleExports.Router as unknown as express.Router;\n          // patch express.Router.route\n          if (isWrapped(routerProto.route)) {\n            this._unwrap(routerProto, 'route');\n          }\n          this._wrap(routerProto, 'route', this._getRoutePatch());\n          // patch express.Router.use\n          if (isWrapped(routerProto.use)) {\n            this._unwrap(routerProto, 'use');\n          }\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          this._wrap(routerProto, 'use', this._getRouterUsePatch() as any);\n          // patch express.Application.use\n          if (isWrapped(moduleExports.application.use)) {\n            this._unwrap(moduleExports.application, 'use');\n          }\n          this._wrap(\n            moduleExports.application,\n            'use',\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            this._getAppUsePatch() as any\n          );\n          return moduleExports;\n        },\n        moduleExports => {\n          if (moduleExports === undefined) return;\n          const routerProto = moduleExports.Router as unknown as express.Router;\n          this._unwrap(routerProto, 'route');\n          this._unwrap(routerProto, 'use');\n          this._unwrap(moduleExports.application, 'use');\n        }\n      ),\n    ];\n  }\n\n  /**\n   * Get the patch for Router.route function\n   */\n  private _getRoutePatch() {\n    const instrumentation = this;\n    return function (original: express.Router['route']) {\n      return function route_trace(\n        this: ExpressRouter,\n        ...args: Parameters<typeof original>\n      ) {\n        const route = original.apply(this, args);\n        const layer = this.stack[this.stack.length - 1] as ExpressLayer;\n        instrumentation._applyPatch(layer, getLayerPath(args));\n        return route;\n      };\n    };\n  }\n\n  /**\n   * Get the patch for Router.use function\n   */\n  private _getRouterUsePatch() {\n    const instrumentation = this;\n    return function (original: express.Router['use']) {\n      return function use(\n        this: express.Application,\n        ...args: Parameters<typeof original>\n      ) {\n        const route = original.apply(this, args);\n        const layer = this.stack[this.stack.length - 1] as ExpressLayer;\n        instrumentation._applyPatch(layer, getLayerPath(args));\n        return route;\n      };\n    };\n  }\n\n  /**\n   * Get the patch for Application.use function\n   */\n  private _getAppUsePatch() {\n    const instrumentation = this;\n    return function (original: express.Application['use']) {\n      return function use(\n        this: { _router: ExpressRouter },\n        ...args: Parameters<typeof original>\n      ) {\n        const route = original.apply(this, args);\n        const layer = this._router.stack[this._router.stack.length - 1];\n        instrumentation._applyPatch(layer, getLayerPath(args));\n        return route;\n      };\n    };\n  }\n\n  /** Patch each express layer to create span and propagate context */\n  private _applyPatch(\n    this: ExpressInstrumentation,\n    layer: ExpressLayer,\n    layerPath?: string\n  ) {\n    const instrumentation = this;\n    // avoid patching multiple times the same layer\n    if (layer[kLayerPatched] === true) return;\n    layer[kLayerPatched] = true;\n\n    this._wrap(layer, 'handle', original => {\n      // TODO: instrument error handlers\n      if (original.length === 4) return original;\n\n      const patched = function (\n        this: ExpressLayer,\n        req: PatchedRequest,\n        res: express.Response\n      ) {\n        storeLayerPath(req, layerPath);\n        const route = (req[_LAYERS_STORE_PROPERTY] as string[])\n          .filter(path => path !== '/' && path !== '/*')\n          .join('')\n          // remove duplicate slashes to normalize route\n          .replace(/\\/{2,}/g, '/');\n\n        const attributes: Attributes = {\n          [SEMATTRS_HTTP_ROUTE]: route.length > 0 ? route : '/',\n        };\n        const metadata = getLayerMetadata(layer, layerPath);\n        const type = metadata.attributes[\n          AttributeNames.EXPRESS_TYPE\n        ] as ExpressLayerType;\n\n        const rpcMetadata = getRPCMetadata(context.active());\n        if (rpcMetadata?.type === RPCType.HTTP) {\n          rpcMetadata.route = route || '/';\n        }\n\n        // verify against the config if the layer should be ignored\n        if (isLayerIgnored(metadata.name, type, instrumentation._config)) {\n          if (type === ExpressLayerType.MIDDLEWARE) {\n            (req[_LAYERS_STORE_PROPERTY] as string[]).pop();\n          }\n          return original.apply(this, arguments);\n        }\n\n        if (trace.getSpan(context.active()) === undefined) {\n          return original.apply(this, arguments);\n        }\n\n        const spanName = instrumentation._getSpanName(\n          {\n            request: req,\n            layerType: type,\n            route,\n          },\n          metadata.name\n        );\n        const span = instrumentation.tracer.startSpan(spanName, {\n          attributes: Object.assign(attributes, metadata.attributes),\n        });\n\n        if (instrumentation.getConfig().requestHook) {\n          safeExecuteInTheMiddle(\n            () =>\n              instrumentation.getConfig().requestHook!(span, {\n                request: req,\n                layerType: type,\n                route,\n              }),\n            e => {\n              if (e) {\n                diag.error('express instrumentation: request hook failed', e);\n              }\n            },\n            true\n          );\n        }\n\n        let spanHasEnded = false;\n        if (\n          metadata.attributes[AttributeNames.EXPRESS_TYPE] !==\n          ExpressLayerType.MIDDLEWARE\n        ) {\n          span.end();\n          spanHasEnded = true;\n        }\n        // listener for response.on('finish')\n        const onResponseFinish = () => {\n          if (spanHasEnded === false) {\n            spanHasEnded = true;\n            span.end();\n          }\n        };\n\n        // verify we have a callback\n        const args = Array.from(arguments);\n        const callbackIdx = args.findIndex(arg => typeof arg === 'function');\n        if (callbackIdx >= 0) {\n          arguments[callbackIdx] = function () {\n            // express considers anything but an empty value, \"route\" or \"router\"\n            // passed to its callback to be an error\n            const maybeError = arguments[0];\n            const isError = ![undefined, null, 'route', 'router'].includes(\n              maybeError\n            );\n            if (!spanHasEnded && isError) {\n              const [error, message] = asErrorAndMessage(maybeError);\n              span.recordException(error);\n              span.setStatus({\n                code: SpanStatusCode.ERROR,\n                message,\n              });\n            }\n\n            if (spanHasEnded === false) {\n              spanHasEnded = true;\n              req.res?.removeListener('finish', onResponseFinish);\n              span.end();\n            }\n            if (!(req.route && isError)) {\n              (req[_LAYERS_STORE_PROPERTY] as string[]).pop();\n            }\n            const callback = args[callbackIdx] as Function;\n            return callback.apply(this, arguments);\n          };\n        }\n\n        try {\n          return original.apply(this, arguments);\n        } catch (anyError) {\n          const [error, message] = asErrorAndMessage(anyError);\n          span.recordException(error);\n          span.setStatus({\n            code: SpanStatusCode.ERROR,\n            message,\n          });\n          throw anyError;\n        } finally {\n          /**\n           * At this point if the callback wasn't called, that means either the\n           * layer is asynchronous (so it will call the callback later on) or that\n           * the layer directly end the http response, so we'll hook into the \"finish\"\n           * event to handle the later case.\n           */\n          if (!spanHasEnded) {\n            res.once('finish', onResponseFinish);\n          }\n        }\n      };\n\n      // `handle` isn't just a regular function in some cases. It also contains\n      // some properties holding metadata and state so we need to proxy them\n      // through through patched function\n      // ref: https://github.com/open-telemetry/opentelemetry-js-contrib/issues/1950\n      Object.keys(original).forEach(key => {\n        Object.defineProperty(patched, key, {\n          get() {\n            return original[key];\n          },\n          set(value) {\n            original[key] = value;\n          },\n        });\n      });\n\n      return patched;\n    });\n  }\n\n  _getSpanName(info: ExpressRequestInfo, defaultName: string) {\n    const hook = this.getConfig().spanNameHook;\n\n    if (!(hook instanceof Function)) {\n      return defaultName;\n    }\n\n    try {\n      return hook(info, defaultName) ?? defaultName;\n    } catch (err) {\n      diag.error(\n        'express instrumentation: error calling span name rewrite hook',\n        err\n      );\n      return defaultName;\n    }\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './enums/ExpressLayerType';\nexport * from './enums/AttributeNames';\nexport * from './types';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum AttributeNames {\n  FASTIFY_NAME = 'fastify.name',\n  FASTIFY_TYPE = 'fastify.type',\n  HOOK_NAME = 'hook.name',\n  PLUGIN_NAME = 'plugin.name',\n}\n\nexport enum FastifyTypes {\n  MIDDLEWARE = 'middleware',\n  REQUEST_HANDLER = 'request_handler',\n}\n\nexport enum FastifyNames {\n  MIDDLEWARE = 'middleware',\n  REQUEST_HANDLER = 'request handler',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const spanRequestSymbol = Symbol(\n  'opentelemetry.instrumentation.fastify.request_active_span'\n);\n\n// The instrumentation creates a span for invocations of lifecycle hook handlers\n// that take `(request, reply, ...[, done])` arguments. Currently this is all\n// lifecycle hooks except `onRequestAbort`.\n// https://fastify.dev/docs/latest/Reference/Hooks\nexport const hooksNamesToWrap = new Set([\n  'onTimeout',\n  'onRequest',\n  'preParsing',\n  'preValidation',\n  'preSerialization',\n  'preHandler',\n  'onSend',\n  'onResponse',\n  'onError',\n]);\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Attributes, Span, SpanStatusCode, Tracer } from '@opentelemetry/api';\nimport { spanRequestSymbol } from './constants';\n\nimport type { PluginFastifyReply } from './internal-types';\n\n/**\n * Starts Span\n * @param reply - reply function\n * @param tracer - tracer\n * @param spanName - span name\n * @param spanAttributes - span attributes\n */\nexport function startSpan(\n  reply: PluginFastifyReply,\n  tracer: Tracer,\n  spanName: string,\n  spanAttributes: Attributes = {}\n) {\n  const span = tracer.startSpan(spanName, { attributes: spanAttributes });\n\n  const spans: Span[] = reply[spanRequestSymbol] || [];\n  spans.push(span);\n\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n  Object.defineProperty(reply, spanRequestSymbol, {\n    enumerable: false,\n    configurable: true,\n    value: spans,\n  });\n\n  return span;\n}\n\n/**\n * Ends span\n * @param reply - reply function\n * @param err - error\n */\nexport function endSpan(reply: PluginFastifyReply, err?: any) {\n  const spans = reply[spanRequestSymbol] || [];\n  // there is no active span, or it has already ended\n  if (!spans.length) {\n    return;\n  }\n  spans.forEach(span => {\n    if (err) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: err.message,\n      });\n      span.recordException(err);\n    }\n    span.end();\n  });\n  delete reply[spanRequestSymbol];\n}\n\n// @TODO after approve add this to instrumentation package and replace usage\n// when it will be released\n\n/**\n * This function handles the missing case from instrumentation package when\n * execute can either return a promise or void. And using async is not an\n * option as it is producing unwanted side effects.\n * @param execute - function to be executed\n * @param onFinish - function called when function executed\n * @param preventThrowingError - prevent to throw error when execute\n * function fails\n */\nexport function safeExecuteInTheMiddleMaybePromise<T>(\n  execute: () => Promise<T>,\n  onFinish: (e: unknown, result?: T) => void,\n  preventThrowingError?: boolean\n): Promise<T>;\nexport function safeExecuteInTheMiddleMaybePromise<T>(\n  execute: () => T,\n  onFinish: (e: unknown, result?: T) => void,\n  preventThrowingError?: boolean\n): T;\nexport function safeExecuteInTheMiddleMaybePromise<T>(\n  execute: () => T | Promise<T>,\n  onFinish: (e: unknown, result?: T) => void,\n  preventThrowingError?: boolean\n): T | Promise<T> | undefined {\n  let error: unknown;\n  let result: T | Promise<T> | undefined = undefined;\n  try {\n    result = execute();\n\n    if (isPromise(result)) {\n      result.then(\n        res => onFinish(undefined, res),\n        err => onFinish(err)\n      );\n    }\n  } catch (e) {\n    error = e;\n  } finally {\n    if (!isPromise(result)) {\n      onFinish(error, result);\n      if (error && !preventThrowingError) {\n        // eslint-disable-next-line no-unsafe-finally\n        throw error;\n      }\n    }\n    // eslint-disable-next-line no-unsafe-finally\n    return result;\n  }\n}\n\nfunction isPromise<T>(val: T | Promise<T>): val is Promise<T> {\n  return (\n    (typeof val === 'object' &&\n      val &&\n      typeof Object.getOwnPropertyDescriptor(val, 'then')?.value ===\n        'function') ||\n    false\n  );\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.38.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-fastify';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { context, Attributes, SpanStatusCode, trace } from '@opentelemetry/api';\nimport { getRPCMetadata, RPCType } from '@opentelemetry/core';\nimport {\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\nimport { SEMATTRS_HTTP_ROUTE } from '@opentelemetry/semantic-conventions';\nimport type {\n  HookHandlerDoneFunction,\n  FastifyInstance,\n  FastifyRequest,\n  FastifyReply,\n} from 'fastify';\nimport { hooksNamesToWrap } from './constants';\nimport {\n  AttributeNames,\n  FastifyNames,\n  FastifyTypes,\n} from './enums/AttributeNames';\nimport type { HandlerOriginal, PluginFastifyReply } from './internal-types';\nimport type { FastifyInstrumentationConfig } from './types';\nimport {\n  endSpan,\n  safeExecuteInTheMiddleMaybePromise,\n  startSpan,\n} from './utils';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\n\nexport const ANONYMOUS_NAME = 'anonymous';\n\n/** Fastify instrumentation for OpenTelemetry */\nexport class FastifyInstrumentation extends InstrumentationBase {\n  constructor(config: FastifyInstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  override setConfig(config: FastifyInstrumentationConfig = {}) {\n    this._config = Object.assign({}, config);\n  }\n\n  override getConfig(): FastifyInstrumentationConfig {\n    return this._config as FastifyInstrumentationConfig;\n  }\n\n  init() {\n    return [\n      new InstrumentationNodeModuleDefinition(\n        'fastify',\n        ['>=3.0.0 <5'],\n        moduleExports => {\n          return this._patchConstructor(moduleExports);\n        }\n      ),\n    ];\n  }\n\n  private _hookOnRequest() {\n    const instrumentation = this;\n    return function onRequest(\n      request: FastifyRequest,\n      reply: FastifyReply,\n      done: HookHandlerDoneFunction\n    ) {\n      if (!instrumentation.isEnabled()) {\n        return done();\n      }\n      instrumentation._wrap(reply, 'send', instrumentation._patchSend());\n\n      const anyRequest = request as any;\n\n      const rpcMetadata = getRPCMetadata(context.active());\n      const routeName = anyRequest.routeOptions\n        ? anyRequest.routeOptions.url // since fastify@4.10.0\n        : request.routerPath;\n      if (routeName && rpcMetadata?.type === RPCType.HTTP) {\n        rpcMetadata.route = routeName;\n      }\n      done();\n    };\n  }\n\n  private _wrapHandler(\n    pluginName: string,\n    hookName: string,\n    original: (...args: unknown[]) => Promise<unknown>,\n    syncFunctionWithDone: boolean\n  ): () => Promise<unknown> {\n    const instrumentation = this;\n    this._diag.debug('Patching fastify route.handler function');\n\n    return function (this: any, ...args: unknown[]): Promise<unknown> {\n      if (!instrumentation.isEnabled()) {\n        return original.apply(this, args);\n      }\n\n      const name = original.name || pluginName || ANONYMOUS_NAME;\n      const spanName = `${FastifyNames.MIDDLEWARE} - ${name}`;\n\n      const reply = args[1] as PluginFastifyReply;\n\n      const span = startSpan(reply, instrumentation.tracer, spanName, {\n        [AttributeNames.FASTIFY_TYPE]: FastifyTypes.MIDDLEWARE,\n        [AttributeNames.PLUGIN_NAME]: pluginName,\n        [AttributeNames.HOOK_NAME]: hookName,\n      });\n\n      const origDone =\n        syncFunctionWithDone &&\n        (args[args.length - 1] as HookHandlerDoneFunction);\n      if (origDone) {\n        args[args.length - 1] = function (\n          ...doneArgs: Parameters<HookHandlerDoneFunction>\n        ) {\n          endSpan(reply);\n          origDone.apply(this, doneArgs);\n        };\n      }\n\n      return context.with(trace.setSpan(context.active(), span), () => {\n        return safeExecuteInTheMiddleMaybePromise(\n          () => {\n            return original.apply(this, args);\n          },\n          err => {\n            if (err instanceof Error) {\n              span.setStatus({\n                code: SpanStatusCode.ERROR,\n                message: err.message,\n              });\n              span.recordException(err);\n            }\n            // async hooks should end the span as soon as the promise is resolved\n            if (!syncFunctionWithDone) {\n              endSpan(reply);\n            }\n          }\n        );\n      });\n    };\n  }\n\n  private _wrapAddHook(): (\n    original: FastifyInstance['addHook']\n  ) => () => FastifyInstance {\n    const instrumentation = this;\n    this._diag.debug('Patching fastify server.addHook function');\n\n    return function (\n      original: FastifyInstance['addHook']\n    ): () => FastifyInstance {\n      return function wrappedAddHook(this: any, ...args: any) {\n        const name = args[0] as string;\n        const handler = args[1] as HandlerOriginal;\n        const pluginName = this.pluginName;\n        if (!hooksNamesToWrap.has(name)) {\n          return original.apply(this, args);\n        }\n\n        const syncFunctionWithDone =\n          typeof args[args.length - 1] === 'function' &&\n          handler.constructor.name !== 'AsyncFunction';\n\n        return original.apply(this, [\n          name,\n          instrumentation._wrapHandler(\n            pluginName,\n            name,\n            handler,\n            syncFunctionWithDone\n          ),\n        ] as never);\n      };\n    };\n  }\n\n  private _patchConstructor(moduleExports: {\n    fastify: () => FastifyInstance;\n  }): () => FastifyInstance {\n    const instrumentation = this;\n\n    function fastify(this: FastifyInstance, ...args: any) {\n      const app: FastifyInstance = moduleExports.fastify.apply(this, args);\n      app.addHook('onRequest', instrumentation._hookOnRequest());\n      app.addHook('preHandler', instrumentation._hookPreHandler());\n\n      instrumentation._wrap(app, 'addHook', instrumentation._wrapAddHook());\n\n      return app;\n    }\n\n    fastify.fastify = fastify;\n    fastify.default = fastify;\n    return fastify;\n  }\n\n  private _patchSend() {\n    const instrumentation = this;\n    this._diag.debug('Patching fastify reply.send function');\n\n    return function patchSend(\n      original: () => FastifyReply\n    ): () => FastifyReply {\n      return function send(this: FastifyReply, ...args: any) {\n        const maybeError: any = args[0];\n\n        if (!instrumentation.isEnabled()) {\n          return original.apply(this, args);\n        }\n\n        return safeExecuteInTheMiddle<FastifyReply>(\n          () => {\n            return original.apply(this, args);\n          },\n          err => {\n            if (!err && maybeError instanceof Error) {\n              err = maybeError;\n            }\n            endSpan(this, err);\n          }\n        );\n      };\n    };\n  }\n\n  private _hookPreHandler() {\n    const instrumentation = this;\n    this._diag.debug('Patching fastify preHandler function');\n\n    return function preHandler(\n      this: any,\n      request: FastifyRequest,\n      reply: FastifyReply,\n      done: HookHandlerDoneFunction\n    ) {\n      if (!instrumentation.isEnabled()) {\n        return done();\n      }\n      const anyRequest = request as any;\n\n      const handler =\n        anyRequest.routeOptions?.handler || anyRequest.context?.handler;\n\n      const handlerName = handler?.name.startsWith('bound ')\n        ? handler.name.substr(6)\n        : handler?.name;\n      const spanName = `${FastifyNames.REQUEST_HANDLER} - ${\n        handlerName || this.pluginName || ANONYMOUS_NAME\n      }`;\n\n      const spanAttributes: Attributes = {\n        [AttributeNames.PLUGIN_NAME]: this.pluginName,\n        [AttributeNames.FASTIFY_TYPE]: FastifyTypes.REQUEST_HANDLER,\n        [SEMATTRS_HTTP_ROUTE]: anyRequest.routeOptions\n          ? anyRequest.routeOptions.url // since fastify@4.10.0\n          : request.routerPath,\n      };\n      if (handlerName) {\n        spanAttributes[AttributeNames.FASTIFY_NAME] = handlerName;\n      }\n      const span = startSpan(\n        reply,\n        instrumentation.tracer,\n        spanName,\n        spanAttributes\n      );\n\n      if (instrumentation.getConfig().requestHook) {\n        safeExecuteInTheMiddle(\n          () => instrumentation.getConfig().requestHook!(span, { request }),\n          e => {\n            if (e) {\n              instrumentation._diag.error('request hook failed', e);\n            }\n          },\n          true\n        );\n      }\n\n      return context.with(trace.setSpan(context.active(), span), () => {\n        done();\n      });\n    };\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './enums/AttributeNames';\nexport * from './types';\nexport * from './instrumentation';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum AllowedOperationTypes {\n  QUERY = 'query',\n  MUTATION = 'mutation',\n  SUBSCRIPTION = 'subscription',\n}\n\nexport enum TokenKind {\n  SOF = '<SOF>',\n  EOF = '<EOF>',\n  BANG = '!',\n  DOLLAR = '$',\n  AMP = '&',\n  PAREN_L = '(',\n  PAREN_R = ')',\n  SPREAD = '...',\n  COLON = ':',\n  EQUALS = '=',\n  AT = '@',\n  BRACKET_L = '[',\n  BRACKET_R = ']',\n  BRACE_L = '{',\n  PIPE = '|',\n  BRACE_R = '}',\n  NAME = 'Name',\n  INT = 'Int',\n  FLOAT = 'Float',\n  STRING = 'String',\n  BLOCK_STRING = 'BlockString',\n  COMMENT = 'Comment',\n}\n\nexport enum SpanNames {\n  EXECUTE = 'graphql.execute',\n  PARSE = 'graphql.parse',\n  RESOLVE = 'graphql.resolve',\n  VALIDATE = 'graphql.validate',\n  SCHEMA_VALIDATE = 'graphql.validateSchema',\n  SCHEMA_PARSE = 'graphql.parseSchema',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport enum AttributeNames {\n  SOURCE = 'graphql.source',\n  FIELD_NAME = 'graphql.field.name',\n  FIELD_PATH = 'graphql.field.path',\n  FIELD_TYPE = 'graphql.field.type',\n  OPERATION_TYPE = 'graphql.operation.type',\n  OPERATION_NAME = 'graphql.operation.name',\n  VARIABLES = 'graphql.variables.',\n  ERROR_VALIDATION_NAME = 'graphql.validation.error',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const OTEL_PATCHED_SYMBOL = Symbol.for('opentelemetry.patched');\n\nexport const OTEL_GRAPHQL_DATA_SYMBOL = Symbol.for(\n  'opentelemetry.graphql_data'\n);\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InstrumentationConfig } from '@opentelemetry/instrumentation';\nimport type * as graphqlTypes from 'graphql';\nimport type * as api from '@opentelemetry/api';\nimport type { PromiseOrValue } from 'graphql/jsutils/PromiseOrValue';\nimport type { DocumentNode } from 'graphql/language/ast';\nimport type {\n  GraphQLFieldResolver,\n  GraphQLTypeResolver,\n} from 'graphql/type/definition';\nimport { OTEL_GRAPHQL_DATA_SYMBOL, OTEL_PATCHED_SYMBOL } from './symbols';\nimport { GraphQLInstrumentationConfig } from './types';\n\nexport const OPERATION_NOT_SUPPORTED =\n  'Operation$operationName$not' + ' supported';\n\n/**\n * Merged and parsed config of default instrumentation config and GraphQL\n */\nexport type GraphQLInstrumentationParsedConfig =\n  Required<GraphQLInstrumentationConfig> & InstrumentationConfig;\n\nexport type executeFunctionWithObj = (\n  args: graphqlTypes.ExecutionArgs\n) => PromiseOrValue<graphqlTypes.ExecutionResult>;\n\nexport type executeArgumentsArray = [\n  graphqlTypes.GraphQLSchema,\n  graphqlTypes.DocumentNode,\n  any,\n  any,\n  Maybe<{ [key: string]: any }>,\n  Maybe<string>,\n  Maybe<graphqlTypes.GraphQLFieldResolver<any, any>>,\n  Maybe<graphqlTypes.GraphQLTypeResolver<any, any>>\n];\n\nexport type executeFunctionWithArgs = (\n  schema: graphqlTypes.GraphQLSchema,\n  document: graphqlTypes.DocumentNode,\n  rootValue?: any,\n  contextValue?: any,\n  variableValues?: Maybe<{ [key: string]: any }>,\n  operationName?: Maybe<string>,\n  fieldResolver?: Maybe<graphqlTypes.GraphQLFieldResolver<any, any>>,\n  typeResolver?: Maybe<graphqlTypes.GraphQLTypeResolver<any, any>>\n) => PromiseOrValue<graphqlTypes.ExecutionResult>;\n\nexport interface OtelExecutionArgs {\n  schema: graphqlTypes.GraphQLSchema;\n  document: DocumentNode & ObjectWithGraphQLData;\n  rootValue?: any;\n  contextValue?: any & ObjectWithGraphQLData;\n  variableValues?: Maybe<{ [key: string]: any }>;\n  operationName?: Maybe<string>;\n  fieldResolver?: Maybe<GraphQLFieldResolver<any, any> & OtelPatched>;\n  typeResolver?: Maybe<GraphQLTypeResolver<any, any>>;\n}\n\nexport type executeType = executeFunctionWithObj | executeFunctionWithArgs;\n\nexport type parseType = (\n  source: string | graphqlTypes.Source,\n  options?: graphqlTypes.ParseOptions\n) => graphqlTypes.DocumentNode;\n\nexport type validateType = (\n  schema: graphqlTypes.GraphQLSchema,\n  documentAST: graphqlTypes.DocumentNode,\n  rules?: ReadonlyArray<graphqlTypes.ValidationRule>,\n  options?: { maxErrors?: number },\n  typeInfo?: graphqlTypes.TypeInfo\n) => ReadonlyArray<graphqlTypes.GraphQLError>;\n\nexport interface GraphQLField {\n  parent: api.Span;\n  span: api.Span;\n  error: Error | null;\n}\n\ninterface OtelGraphQLData {\n  source?: any;\n  span: api.Span;\n  fields: { [key: string]: GraphQLField };\n}\n\nexport interface ObjectWithGraphQLData {\n  [OTEL_GRAPHQL_DATA_SYMBOL]?: OtelGraphQLData;\n}\n\nexport interface OtelPatched {\n  [OTEL_PATCHED_SYMBOL]?: boolean;\n}\n\nexport interface GraphQLPath {\n  prev: GraphQLPath | undefined;\n  key: string | number;\n  /**\n   * optional as it didn't exist yet in ver 14\n   */\n  typename?: string | undefined;\n}\n\n/**\n * Moving this type from ver 15 of graphql as it is nto available in ver. 14s\n * this way it can compile against ver 14.\n */\nexport type Maybe<T> = null | undefined | T;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as graphqlTypes from 'graphql';\nimport * as api from '@opentelemetry/api';\nimport { AllowedOperationTypes, SpanNames, TokenKind } from './enum';\nimport { AttributeNames } from './enums/AttributeNames';\nimport { OTEL_GRAPHQL_DATA_SYMBOL, OTEL_PATCHED_SYMBOL } from './symbols';\nimport {\n  GraphQLField,\n  GraphQLPath,\n  GraphQLInstrumentationParsedConfig,\n  ObjectWithGraphQLData,\n  OtelPatched,\n  Maybe,\n} from './internal-types';\nimport { GraphQLInstrumentationConfig } from './types';\n\nconst OPERATION_VALUES = Object.values(AllowedOperationTypes);\n\n// https://github.com/graphql/graphql-js/blob/main/src/jsutils/isPromise.ts\nexport const isPromise = (value: any): value is Promise<unknown> => {\n  return typeof value?.then === 'function';\n};\n\n// https://github.com/graphql/graphql-js/blob/main/src/jsutils/isObjectLike.ts\nconst isObjectLike = (value: unknown): value is { [key: string]: unknown } => {\n  return typeof value == 'object' && value !== null;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction addInputVariableAttribute(span: api.Span, key: string, variable: any) {\n  if (Array.isArray(variable)) {\n    variable.forEach((value, idx) => {\n      addInputVariableAttribute(span, `${key}.${idx}`, value);\n    });\n  } else if (variable instanceof Object) {\n    Object.entries(variable).forEach(([nestedKey, value]) => {\n      addInputVariableAttribute(span, `${key}.${nestedKey}`, value);\n    });\n  } else {\n    span.setAttribute(`${AttributeNames.VARIABLES}${String(key)}`, variable);\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function addInputVariableAttributes(\n  span: api.Span,\n  variableValues: { [key: string]: any }\n) {\n  Object.entries(variableValues).forEach(([key, value]) => {\n    addInputVariableAttribute(span, key, value);\n  });\n}\n\nexport function addSpanSource(\n  span: api.Span,\n  loc?: graphqlTypes.Location,\n  allowValues?: boolean,\n  start?: number,\n  end?: number\n): void {\n  const source = getSourceFromLocation(loc, allowValues, start, end);\n  span.setAttribute(AttributeNames.SOURCE, source);\n}\n\nfunction createFieldIfNotExists(\n  tracer: api.Tracer,\n  getConfig: () => GraphQLInstrumentationParsedConfig,\n  contextValue: any,\n  info: graphqlTypes.GraphQLResolveInfo,\n  path: string[]\n): {\n  field: any;\n  spanAdded: boolean;\n} {\n  let field = getField(contextValue, path);\n\n  let spanAdded = false;\n\n  if (!field) {\n    spanAdded = true;\n    const parent = getParentField(contextValue, path);\n\n    field = {\n      parent,\n      span: createResolverSpan(\n        tracer,\n        getConfig,\n        contextValue,\n        info,\n        path,\n        parent.span\n      ),\n      error: null,\n    };\n\n    addField(contextValue, path, field);\n  }\n\n  return { spanAdded, field };\n}\n\nfunction createResolverSpan(\n  tracer: api.Tracer,\n  getConfig: () => GraphQLInstrumentationParsedConfig,\n  contextValue: any,\n  info: graphqlTypes.GraphQLResolveInfo,\n  path: string[],\n  parentSpan?: api.Span\n): api.Span {\n  const attributes: api.SpanAttributes = {\n    [AttributeNames.FIELD_NAME]: info.fieldName,\n    [AttributeNames.FIELD_PATH]: path.join('.'),\n    [AttributeNames.FIELD_TYPE]: info.returnType.toString(),\n  };\n\n  const span = tracer.startSpan(\n    `${SpanNames.RESOLVE} ${attributes[AttributeNames.FIELD_PATH]}`,\n    {\n      attributes,\n    },\n    parentSpan ? api.trace.setSpan(api.context.active(), parentSpan) : undefined\n  );\n\n  const document = contextValue[OTEL_GRAPHQL_DATA_SYMBOL].source;\n  const fieldNode = info.fieldNodes.find(\n    fieldNode => fieldNode.kind === 'Field'\n  );\n\n  if (fieldNode) {\n    addSpanSource(\n      span,\n      document.loc,\n      getConfig().allowValues,\n      fieldNode.loc?.start,\n      fieldNode.loc?.end\n    );\n  }\n\n  return span;\n}\n\nexport function endSpan(span: api.Span, error?: Error): void {\n  if (error) {\n    span.recordException(error);\n  }\n  span.end();\n}\n\nexport function getOperation(\n  document: graphqlTypes.DocumentNode,\n  operationName?: Maybe<string>\n): graphqlTypes.DefinitionNode | undefined {\n  if (!document || !Array.isArray(document.definitions)) {\n    return undefined;\n  }\n\n  if (operationName) {\n    return document.definitions\n      .filter(\n        definition =>\n          OPERATION_VALUES.indexOf((definition as any)?.operation) !== -1\n      )\n      .find(definition => operationName === (definition as any)?.name?.value);\n  } else {\n    return document.definitions.find(\n      definition =>\n        OPERATION_VALUES.indexOf((definition as any)?.operation) !== -1\n    );\n  }\n}\n\nfunction addField(contextValue: any, path: string[], field: GraphQLField) {\n  return (contextValue[OTEL_GRAPHQL_DATA_SYMBOL].fields[path.join('.')] =\n    field);\n}\n\nfunction getField(contextValue: any, path: string[]) {\n  return contextValue[OTEL_GRAPHQL_DATA_SYMBOL].fields[path.join('.')];\n}\n\nfunction getParentField(contextValue: any, path: string[]) {\n  for (let i = path.length - 1; i > 0; i--) {\n    const field = getField(contextValue, path.slice(0, i));\n\n    if (field) {\n      return field;\n    }\n  }\n\n  return {\n    span: contextValue[OTEL_GRAPHQL_DATA_SYMBOL].span,\n  };\n}\n\nfunction pathToArray(mergeItems: boolean, path: GraphQLPath): string[] {\n  const flattened: string[] = [];\n  let curr: GraphQLPath | undefined = path;\n  while (curr) {\n    let key = curr.key;\n\n    if (mergeItems && typeof key === 'number') {\n      key = '*';\n    }\n    flattened.push(String(key));\n    curr = curr.prev;\n  }\n  return flattened.reverse();\n}\n\nfunction repeatBreak(i: number): string {\n  return repeatChar('\\n', i);\n}\n\nfunction repeatSpace(i: number): string {\n  return repeatChar(' ', i);\n}\n\nfunction repeatChar(char: string, to: number): string {\n  let text = '';\n  for (let i = 0; i < to; i++) {\n    text += char;\n  }\n  return text;\n}\n\nconst KindsToBeRemoved: string[] = [\n  TokenKind.FLOAT,\n  TokenKind.STRING,\n  TokenKind.INT,\n  TokenKind.BLOCK_STRING,\n];\n\nexport function getSourceFromLocation(\n  loc?: graphqlTypes.Location,\n  allowValues = false,\n  inputStart?: number,\n  inputEnd?: number\n): string {\n  let source = '';\n\n  if (loc?.startToken) {\n    const start = typeof inputStart === 'number' ? inputStart : loc.start;\n    const end = typeof inputEnd === 'number' ? inputEnd : loc.end;\n\n    let next: graphqlTypes.Token | null = loc.startToken.next;\n    let previousLine: number | undefined = 1;\n    while (next) {\n      if (next.start < start) {\n        next = next.next;\n        previousLine = next?.line;\n        continue;\n      }\n      if (next.end > end) {\n        next = next.next;\n        previousLine = next?.line;\n        continue;\n      }\n      let value = next.value || next.kind;\n      let space = '';\n      if (!allowValues && KindsToBeRemoved.indexOf(next.kind) >= 0) {\n        // value = repeatChar('*', value.length);\n        value = '*';\n      }\n      if (next.kind === TokenKind.STRING) {\n        value = `\"${value}\"`;\n      }\n      if (next.kind === TokenKind.EOF) {\n        value = '';\n      }\n      if (next.line > previousLine!) {\n        source += repeatBreak(next.line - previousLine!);\n        previousLine = next.line;\n        space = repeatSpace(next.column - 1);\n      } else {\n        if (next.line === next.prev?.line) {\n          space = repeatSpace(next.start - (next.prev?.end || 0));\n        }\n      }\n      source += space + value;\n      if (next) {\n        next = next.next!;\n      }\n    }\n  }\n\n  return source;\n}\n\nexport function wrapFields(\n  type: Maybe<graphqlTypes.GraphQLObjectType & OtelPatched>,\n  tracer: api.Tracer,\n  getConfig: () => GraphQLInstrumentationParsedConfig\n): void {\n  if (\n    !type ||\n    typeof type.getFields !== 'function' ||\n    type[OTEL_PATCHED_SYMBOL]\n  ) {\n    return;\n  }\n  const fields = type.getFields();\n\n  type[OTEL_PATCHED_SYMBOL] = true;\n\n  Object.keys(fields).forEach(key => {\n    const field = fields[key];\n\n    if (!field) {\n      return;\n    }\n\n    if (field.resolve) {\n      field.resolve = wrapFieldResolver(tracer, getConfig, field.resolve);\n    }\n\n    if (field.type) {\n      let unwrappedType: any = field.type;\n\n      while (unwrappedType.ofType) {\n        unwrappedType = unwrappedType.ofType;\n      }\n      wrapFields(unwrappedType, tracer, getConfig);\n    }\n  });\n}\n\nconst handleResolveSpanError = (\n  resolveSpan: api.Span,\n  err: any,\n  shouldEndSpan: boolean\n) => {\n  if (!shouldEndSpan) {\n    return;\n  }\n  resolveSpan.recordException(err);\n  resolveSpan.setStatus({\n    code: api.SpanStatusCode.ERROR,\n    message: err.message,\n  });\n  resolveSpan.end();\n};\n\nconst handleResolveSpanSuccess = (\n  resolveSpan: api.Span,\n  shouldEndSpan: boolean\n) => {\n  if (!shouldEndSpan) {\n    return;\n  }\n  resolveSpan.end();\n};\n\nexport function wrapFieldResolver<TSource = any, TContext = any, TArgs = any>(\n  tracer: api.Tracer,\n  getConfig: () => Required<GraphQLInstrumentationConfig>,\n  fieldResolver: Maybe<\n    graphqlTypes.GraphQLFieldResolver<TSource, TContext, TArgs> & OtelPatched\n  >,\n  isDefaultResolver = false\n): graphqlTypes.GraphQLFieldResolver<TSource, TContext, TArgs> & OtelPatched {\n  if (\n    (wrappedFieldResolver as OtelPatched)[OTEL_PATCHED_SYMBOL] ||\n    typeof fieldResolver !== 'function'\n  ) {\n    return fieldResolver!;\n  }\n\n  function wrappedFieldResolver(\n    this: graphqlTypes.GraphQLFieldResolver<TSource, TContext, TArgs>,\n    source: TSource,\n    args: TArgs,\n    contextValue: TContext & ObjectWithGraphQLData,\n    info: graphqlTypes.GraphQLResolveInfo\n  ) {\n    if (!fieldResolver) {\n      return undefined;\n    }\n    const config = getConfig();\n\n    // follows what graphql is doing to decide if this is a trivial resolver\n    // for which we don't need to create a resolve span\n    if (\n      config.ignoreTrivialResolveSpans &&\n      isDefaultResolver &&\n      (isObjectLike(source) || typeof source === 'function')\n    ) {\n      const property = (source as any)[info.fieldName];\n      // a function execution is not trivial and should be recorder.\n      // property which is not a function is just a value and we don't want a \"resolve\" span for it\n      if (typeof property !== 'function') {\n        return fieldResolver.call(this, source, args, contextValue, info);\n      }\n    }\n\n    if (!contextValue[OTEL_GRAPHQL_DATA_SYMBOL]) {\n      return fieldResolver.call(this, source, args, contextValue, info);\n    }\n    const path = pathToArray(config.mergeItems, info && info.path);\n    const depth = path.filter((item: any) => typeof item === 'string').length;\n\n    let field: any;\n    let shouldEndSpan = false;\n    if (config.depth >= 0 && config.depth < depth) {\n      field = getParentField(contextValue, path);\n    } else {\n      const newField = createFieldIfNotExists(\n        tracer,\n        getConfig,\n        contextValue,\n        info,\n        path\n      );\n      field = newField.field;\n      shouldEndSpan = newField.spanAdded;\n    }\n\n    return api.context.with(\n      api.trace.setSpan(api.context.active(), field.span),\n      () => {\n        try {\n          const res = fieldResolver.call(\n            this,\n            source,\n            args,\n            contextValue,\n            info\n          );\n          if (isPromise(res)) {\n            return res.then(\n              (r: any) => {\n                handleResolveSpanSuccess(field.span, shouldEndSpan);\n                return r;\n              },\n              (err: Error) => {\n                handleResolveSpanError(field.span, err, shouldEndSpan);\n                throw err;\n              }\n            );\n          } else {\n            handleResolveSpanSuccess(field.span, shouldEndSpan);\n            return res;\n          }\n        } catch (err: any) {\n          handleResolveSpanError(field.span, err, shouldEndSpan);\n          throw err;\n        }\n      }\n    );\n  }\n\n  (wrappedFieldResolver as OtelPatched)[OTEL_PATCHED_SYMBOL] = true;\n\n  return wrappedFieldResolver;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.42.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-graphql';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { context, trace } from '@opentelemetry/api';\nimport {\n  isWrapped,\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  InstrumentationNodeModuleFile,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\nimport type * as graphqlTypes from 'graphql';\nimport { SpanNames } from './enum';\nimport { AttributeNames } from './enums/AttributeNames';\nimport { OTEL_GRAPHQL_DATA_SYMBOL } from './symbols';\n\nimport {\n  executeFunctionWithObj,\n  executeArgumentsArray,\n  executeType,\n  parseType,\n  validateType,\n  GraphQLInstrumentationParsedConfig,\n  OtelExecutionArgs,\n  ObjectWithGraphQLData,\n  OPERATION_NOT_SUPPORTED,\n  Maybe,\n} from './internal-types';\nimport {\n  addInputVariableAttributes,\n  addSpanSource,\n  endSpan,\n  getOperation,\n  isPromise,\n  wrapFieldResolver,\n  wrapFields,\n} from './utils';\n\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport * as api from '@opentelemetry/api';\nimport type { PromiseOrValue } from 'graphql/jsutils/PromiseOrValue';\nimport { GraphQLInstrumentationConfig } from './types';\n\nconst DEFAULT_CONFIG: GraphQLInstrumentationConfig = {\n  mergeItems: false,\n  depth: -1,\n  allowValues: false,\n  ignoreResolveSpans: false,\n};\n\nconst supportedVersions = ['>=14.0.0 <17'];\n\nexport class GraphQLInstrumentation extends InstrumentationBase {\n  constructor(config: GraphQLInstrumentationConfig = {}) {\n    super(\n      PACKAGE_NAME,\n      PACKAGE_VERSION,\n      Object.assign({}, DEFAULT_CONFIG, config)\n    );\n  }\n\n  private _getConfig(): GraphQLInstrumentationParsedConfig {\n    return this._config as GraphQLInstrumentationParsedConfig;\n  }\n\n  override setConfig(config: GraphQLInstrumentationConfig = {}) {\n    this._config = Object.assign({}, DEFAULT_CONFIG, config);\n  }\n\n  protected init() {\n    const module = new InstrumentationNodeModuleDefinition(\n      'graphql',\n      supportedVersions\n    );\n    module.files.push(this._addPatchingExecute());\n    module.files.push(this._addPatchingParser());\n    module.files.push(this._addPatchingValidate());\n\n    return module;\n  }\n\n  private _addPatchingExecute(): InstrumentationNodeModuleFile {\n    return new InstrumentationNodeModuleFile(\n      'graphql/execution/execute.js',\n      supportedVersions,\n      // cannot make it work with appropriate type as execute function has 2\n      //types and/cannot import function but only types\n      (moduleExports: any) => {\n        if (isWrapped(moduleExports.execute)) {\n          this._unwrap(moduleExports, 'execute');\n        }\n        this._wrap(\n          moduleExports,\n          'execute',\n          this._patchExecute(moduleExports.defaultFieldResolver)\n        );\n        return moduleExports;\n      },\n      moduleExports => {\n        if (moduleExports) {\n          this._unwrap(moduleExports, 'execute');\n        }\n      }\n    );\n  }\n\n  private _addPatchingParser(): InstrumentationNodeModuleFile {\n    return new InstrumentationNodeModuleFile(\n      'graphql/language/parser.js',\n      supportedVersions,\n      (moduleExports: typeof graphqlTypes) => {\n        if (isWrapped(moduleExports.parse)) {\n          this._unwrap(moduleExports, 'parse');\n        }\n        this._wrap(moduleExports, 'parse', this._patchParse());\n        return moduleExports;\n      },\n      (moduleExports: typeof graphqlTypes) => {\n        if (moduleExports) {\n          this._unwrap(moduleExports, 'parse');\n        }\n      }\n    );\n  }\n\n  private _addPatchingValidate(): InstrumentationNodeModuleFile {\n    return new InstrumentationNodeModuleFile(\n      'graphql/validation/validate.js',\n      supportedVersions,\n      moduleExports => {\n        if (isWrapped(moduleExports.validate)) {\n          this._unwrap(moduleExports, 'validate');\n        }\n        this._wrap(moduleExports, 'validate', this._patchValidate());\n        return moduleExports;\n      },\n      moduleExports => {\n        if (moduleExports) {\n          this._unwrap(moduleExports, 'validate');\n        }\n      }\n    );\n  }\n\n  private _patchExecute(\n    defaultFieldResolved: graphqlTypes.GraphQLFieldResolver<any, any>\n  ): (original: executeType) => executeType {\n    const instrumentation = this;\n    return function execute(original) {\n      return function patchExecute(\n        this: executeType\n      ): PromiseOrValue<graphqlTypes.ExecutionResult> {\n        let processedArgs: OtelExecutionArgs;\n\n        // case when apollo server is used for example\n        if (arguments.length >= 2) {\n          const args = arguments as unknown as executeArgumentsArray;\n          processedArgs = instrumentation._wrapExecuteArgs(\n            args[0],\n            args[1],\n            args[2],\n            args[3],\n            args[4],\n            args[5],\n            args[6],\n            args[7],\n            defaultFieldResolved\n          );\n        } else {\n          const args = arguments[0] as graphqlTypes.ExecutionArgs;\n          processedArgs = instrumentation._wrapExecuteArgs(\n            args.schema,\n            args.document,\n            args.rootValue,\n            args.contextValue,\n            args.variableValues,\n            args.operationName,\n            args.fieldResolver,\n            args.typeResolver,\n            defaultFieldResolved\n          );\n        }\n\n        const operation = getOperation(\n          processedArgs.document,\n          processedArgs.operationName\n        );\n\n        const span = instrumentation._createExecuteSpan(\n          operation,\n          processedArgs\n        );\n\n        processedArgs.contextValue[OTEL_GRAPHQL_DATA_SYMBOL] = {\n          source: processedArgs.document\n            ? processedArgs.document ||\n              (processedArgs.document as ObjectWithGraphQLData)[\n                OTEL_GRAPHQL_DATA_SYMBOL\n              ]\n            : undefined,\n          span,\n          fields: {},\n        };\n\n        return context.with(trace.setSpan(context.active(), span), () => {\n          return safeExecuteInTheMiddle<\n            PromiseOrValue<graphqlTypes.ExecutionResult>\n          >(\n            () => {\n              return (original as executeFunctionWithObj).apply(this, [\n                processedArgs,\n              ]);\n            },\n            (err, result) => {\n              instrumentation._handleExecutionResult(span, err, result);\n            }\n          );\n        });\n      };\n    };\n  }\n\n  private _handleExecutionResult(\n    span: api.Span,\n    err?: Error,\n    result?: PromiseOrValue<graphqlTypes.ExecutionResult>\n  ) {\n    const config = this._getConfig();\n    if (result === undefined || err) {\n      endSpan(span, err);\n      return;\n    }\n\n    if (isPromise(result)) {\n      (result as Promise<graphqlTypes.ExecutionResult>).then(\n        resultData => {\n          if (typeof config.responseHook !== 'function') {\n            endSpan(span);\n            return;\n          }\n          this._executeResponseHook(span, resultData);\n        },\n        error => {\n          endSpan(span, error);\n        }\n      );\n    } else {\n      if (typeof config.responseHook !== 'function') {\n        endSpan(span);\n        return;\n      }\n      this._executeResponseHook(span, result as graphqlTypes.ExecutionResult);\n    }\n  }\n\n  private _executeResponseHook(\n    span: api.Span,\n    result: graphqlTypes.ExecutionResult\n  ) {\n    const config = this._getConfig();\n    safeExecuteInTheMiddle(\n      () => {\n        config.responseHook(span, result);\n      },\n      err => {\n        if (err) {\n          this._diag.error('Error running response hook', err);\n        }\n\n        endSpan(span, undefined);\n      },\n      true\n    );\n  }\n\n  private _patchParse(): (original: parseType) => parseType {\n    const instrumentation = this;\n    return function parse(original) {\n      return function patchParse(\n        this: parseType,\n        source: string | graphqlTypes.Source,\n        options?: graphqlTypes.ParseOptions\n      ): graphqlTypes.DocumentNode {\n        return instrumentation._parse(this, original, source, options);\n      };\n    };\n  }\n\n  private _patchValidate(): (original: validateType) => validateType {\n    const instrumentation = this;\n    return function validate(original: validateType) {\n      return function patchValidate(\n        this: validateType,\n        schema: graphqlTypes.GraphQLSchema,\n        documentAST: graphqlTypes.DocumentNode,\n        rules?: ReadonlyArray<graphqlTypes.ValidationRule>,\n        options?: { maxErrors?: number },\n        typeInfo?: graphqlTypes.TypeInfo\n      ): ReadonlyArray<graphqlTypes.GraphQLError> {\n        return instrumentation._validate(\n          this,\n          original,\n          schema,\n          documentAST,\n          rules,\n          typeInfo,\n          options\n        );\n      };\n    };\n  }\n\n  private _parse(\n    obj: parseType,\n    original: parseType,\n    source: string | graphqlTypes.Source,\n    options?: graphqlTypes.ParseOptions\n  ): graphqlTypes.DocumentNode {\n    const config = this._getConfig();\n    const span = this.tracer.startSpan(SpanNames.PARSE);\n\n    return context.with(trace.setSpan(context.active(), span), () => {\n      return safeExecuteInTheMiddle<\n        graphqlTypes.DocumentNode & ObjectWithGraphQLData\n      >(\n        () => {\n          return original.call(obj, source, options);\n        },\n        (err, result) => {\n          if (result) {\n            const operation = getOperation(result);\n            if (!operation) {\n              span.updateName(SpanNames.SCHEMA_PARSE);\n            } else if (result.loc) {\n              addSpanSource(span, result.loc, config.allowValues);\n            }\n          }\n          endSpan(span, err);\n        }\n      );\n    });\n  }\n\n  private _validate(\n    obj: validateType,\n    original: validateType,\n    schema: graphqlTypes.GraphQLSchema,\n    documentAST: graphqlTypes.DocumentNode,\n    rules?: ReadonlyArray<graphqlTypes.ValidationRule>,\n    typeInfo?: graphqlTypes.TypeInfo,\n    options?: { maxErrors?: number }\n  ): ReadonlyArray<graphqlTypes.GraphQLError> {\n    const span = this.tracer.startSpan(SpanNames.VALIDATE, {});\n\n    return context.with(trace.setSpan(context.active(), span), () => {\n      return safeExecuteInTheMiddle<ReadonlyArray<graphqlTypes.GraphQLError>>(\n        () => {\n          return original.call(\n            obj,\n            schema,\n            documentAST,\n            rules,\n            options,\n            typeInfo\n          );\n        },\n        (err, errors) => {\n          if (!documentAST.loc) {\n            span.updateName(SpanNames.SCHEMA_VALIDATE);\n          }\n          if (errors && errors.length) {\n            span.recordException({\n              name: AttributeNames.ERROR_VALIDATION_NAME,\n              message: JSON.stringify(errors),\n            });\n          }\n          endSpan(span, err);\n        }\n      );\n    });\n  }\n\n  private _createExecuteSpan(\n    operation: graphqlTypes.DefinitionNode | undefined,\n    processedArgs: graphqlTypes.ExecutionArgs\n  ): api.Span {\n    const config = this._getConfig();\n\n    const span = this.tracer.startSpan(SpanNames.EXECUTE, {});\n    if (operation) {\n      const { operation: operationType, name: nameNode } =\n        operation as graphqlTypes.OperationDefinitionNode;\n\n      span.setAttribute(AttributeNames.OPERATION_TYPE, operationType);\n\n      const operationName = nameNode?.value;\n\n      // https://opentelemetry.io/docs/reference/specification/trace/semantic_conventions/instrumentation/graphql/\n      // > The span name MUST be of the format <graphql.operation.type> <graphql.operation.name> provided that graphql.operation.type and graphql.operation.name are available.\n      // > If graphql.operation.name is not available, the span SHOULD be named <graphql.operation.type>.\n      if (operationName) {\n        span.setAttribute(AttributeNames.OPERATION_NAME, operationName);\n        span.updateName(`${operationType} ${operationName}`);\n      } else {\n        span.updateName(operationType);\n      }\n    } else {\n      let operationName = ' ';\n      if (processedArgs.operationName) {\n        operationName = ` \"${processedArgs.operationName}\" `;\n      }\n      operationName = OPERATION_NOT_SUPPORTED.replace(\n        '$operationName$',\n        operationName\n      );\n      span.setAttribute(AttributeNames.OPERATION_NAME, operationName);\n    }\n\n    if (processedArgs.document?.loc) {\n      addSpanSource(span, processedArgs.document.loc, config.allowValues);\n    }\n\n    if (processedArgs.variableValues && config.allowValues) {\n      addInputVariableAttributes(span, processedArgs.variableValues);\n    }\n\n    return span;\n  }\n\n  private _wrapExecuteArgs(\n    schema: graphqlTypes.GraphQLSchema,\n    document: graphqlTypes.DocumentNode,\n    rootValue: any,\n    contextValue: any,\n    variableValues: Maybe<{ [key: string]: any }>,\n    operationName: Maybe<string>,\n    fieldResolver: Maybe<graphqlTypes.GraphQLFieldResolver<any, any>>,\n    typeResolver: Maybe<graphqlTypes.GraphQLTypeResolver<any, any>>,\n    defaultFieldResolved: graphqlTypes.GraphQLFieldResolver<any, any>\n  ): OtelExecutionArgs {\n    if (!contextValue) {\n      contextValue = {};\n    }\n\n    if (\n      contextValue[OTEL_GRAPHQL_DATA_SYMBOL] ||\n      this._getConfig().ignoreResolveSpans\n    ) {\n      return {\n        schema,\n        document,\n        rootValue,\n        contextValue,\n        variableValues,\n        operationName,\n        fieldResolver,\n        typeResolver,\n      };\n    }\n\n    const isUsingDefaultResolver = fieldResolver == null;\n    // follows graphql implementation here:\n    // https://github.com/graphql/graphql-js/blob/0b7daed9811731362c71900e12e5ea0d1ecc7f1f/src/execution/execute.ts#L494\n    const fieldResolverForExecute = fieldResolver ?? defaultFieldResolved;\n    fieldResolver = wrapFieldResolver(\n      this.tracer,\n      this._getConfig.bind(this),\n      fieldResolverForExecute,\n      isUsingDefaultResolver\n    );\n\n    if (schema) {\n      wrapFields(\n        schema.getQueryType(),\n        this.tracer,\n        this._getConfig.bind(this)\n      );\n      wrapFields(\n        schema.getMutationType(),\n        this.tracer,\n        this._getConfig.bind(this)\n      );\n    }\n\n    return {\n      schema,\n      document,\n      rootValue,\n      contextValue,\n      variableValues,\n      operationName,\n      fieldResolver,\n      typeResolver,\n    };\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './types';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InstrumentationConfig } from '@opentelemetry/instrumentation';\nimport { Span } from '@opentelemetry/api';\n\nexport interface MongoDBInstrumentationExecutionResponseHook {\n  (span: Span, responseInfo: MongoResponseHookInformation): void;\n}\n\n/**\n * Function that can be used to serialize db.statement tag\n * @param cmd - MongoDB command object\n *\n * @returns serialized string that will be used as the db.statement attribute.\n */\nexport type DbStatementSerializer = (cmd: Record<string, unknown>) => string;\n\nexport interface MongoDBInstrumentationConfig extends InstrumentationConfig {\n  /**\n   * If true, additional information about query parameters and\n   * results will be attached (as `attributes`) to spans representing\n   * database operations.\n   */\n  enhancedDatabaseReporting?: boolean;\n\n  /**\n   * Hook that allows adding custom span attributes based on the data\n   * returned from MongoDB actions.\n   *\n   * @default undefined\n   */\n  responseHook?: MongoDBInstrumentationExecutionResponseHook;\n\n  /**\n   * Custom serializer function for the db.statement tag\n   */\n  dbStatementSerializer?: DbStatementSerializer;\n}\n\nexport type Func<T> = (...args: unknown[]) => T;\nexport type MongoInternalCommand = {\n  findandmodify: boolean;\n  createIndexes: boolean;\n  count: boolean;\n  aggregate: boolean;\n  ismaster: boolean;\n  indexes?: unknown[];\n  query?: Record<string, unknown>;\n  limit?: number;\n  q?: Record<string, unknown>;\n  u?: Record<string, unknown>;\n};\n\nexport type ServerSession = {\n  id: any;\n  lastUse: number;\n  txnNumber: number;\n  isDirty: boolean;\n};\n\nexport type CursorState = { cmd: MongoInternalCommand } & Record<\n  string,\n  unknown\n>;\n\nexport interface MongoResponseHookInformation {\n  data: CommandResult;\n}\n\n// https://github.com/mongodb/node-mongodb-native/blob/3.6/lib/core/connection/command_result.js\nexport type CommandResult = {\n  result?: unknown;\n  connection?: unknown;\n  message?: unknown;\n};\n\n// https://github.com/mongodb/node-mongodb-native/blob/3.6/lib/core/wireprotocol/index.js\nexport type WireProtocolInternal = {\n  insert: (\n    server: MongoInternalTopology,\n    ns: string,\n    ops: unknown[],\n    options: unknown | Function,\n    callback?: Function\n  ) => unknown;\n  update: (\n    server: MongoInternalTopology,\n    ns: string,\n    ops: unknown[],\n    options: unknown | Function,\n    callback?: Function\n  ) => unknown;\n  remove: (\n    server: MongoInternalTopology,\n    ns: string,\n    ops: unknown[],\n    options: unknown | Function,\n    callback?: Function\n  ) => unknown;\n  killCursors: (\n    server: MongoInternalTopology,\n    ns: string,\n    cursorState: CursorState,\n    callback: Function\n  ) => unknown;\n  getMore: (\n    server: MongoInternalTopology,\n    ns: string,\n    cursorState: CursorState,\n    batchSize: number,\n    options: unknown | Function,\n    callback?: Function\n  ) => unknown;\n  query: (\n    server: MongoInternalTopology,\n    ns: string,\n    cmd: MongoInternalCommand,\n    cursorState: CursorState,\n    options: unknown | Function,\n    callback?: Function\n  ) => unknown;\n  command: (\n    server: MongoInternalTopology,\n    ns: string,\n    cmd: MongoInternalCommand,\n    options: unknown | Function,\n    callback?: Function\n  ) => unknown;\n};\n\n// https://github.com/mongodb/node-mongodb-native/blob/3.6/lib/topologies/server.js#L172\n// https://github.com/mongodb/node-mongodb-native/blob/2.2/lib/server.js#L174\nexport type MongoInternalTopology = {\n  s?: {\n    // those are for mongodb@3\n    options?: {\n      host?: string;\n      port?: number;\n      servername?: string;\n    };\n    // those are for mongodb@2\n    host?: string;\n    port?: number;\n  };\n  // mongodb@3 with useUnifiedTopology option\n  description?: {\n    address?: string;\n  };\n};\n\nexport enum MongodbCommandType {\n  CREATE_INDEXES = 'createIndexes',\n  FIND_AND_MODIFY = 'findAndModify',\n  IS_MASTER = 'isMaster',\n  COUNT = 'count',\n  AGGREGATE = 'aggregate',\n  UNKNOWN = 'unknown',\n}\n\n// https://github.com/mongodb/js-bson/blob/main/src/bson.ts\nexport type Document = {\n  [key: string]: any;\n};\n\n// https://github.com/mongodb/node-mongodb-native/blob/v6.4.0/src/utils.ts#L281\nexport interface MongodbNamespace {\n  db: string;\n  collection?: string;\n}\n\nexport type V4Connection = {\n  command: Function;\n  // From version 6.4.0 the method does not expect a callback and returns a promise\n  // https://github.com/mongodb/node-mongodb-native/blob/v6.4.2/src/cmap/connection.ts\n  commandPromise(\n    ns: MongodbNamespace,\n    cmd: Document,\n    options: undefined | unknown,\n    // From v6.6.0 we have this new param which is a constructor function\n    // https://github.com/mongodb/node-mongodb-native/blob/v6.6.0/src/cmap/connection.ts#L588\n    responseType: undefined | unknown\n  ): Promise<any>;\n  // Earlier versions expect a callback param and return void\n  // https://github.com/mongodb/node-mongodb-native/blob/v4.2.2/src/cmap/connection.ts\n  commandCallback(\n    ns: MongodbNamespace,\n    cmd: Document,\n    options: undefined | unknown,\n    callback: any\n  ): void;\n};\n\n// https://github.com/mongodb/node-mongodb-native/blob/v4.2.2/src/cmap/connection_pool.ts\nexport type V4ConnectionPool = {\n  // Instrumentation just cares about carrying the async context so\n  // types of callback params are not needed\n  checkOut: (callback: (error: any, connection: any) => void) => void;\n};\n\nexport type V4Connect = {\n  connect: Function;\n  // From version 6.4.0 the method does not expect a callback and returns a promise\n  // https://github.com/mongodb/node-mongodb-native/blob/v6.4.0/src/cmap/connect.ts\n  connectPromise: (options: any) => Promise<any>;\n  // Earlier versions expect a callback param and return void\n  // https://github.com/mongodb/node-mongodb-native/blob/v4.2.2/src/cmap/connect.ts\n  connectCallback: (options: any, callback: any) => void;\n};\n\n// https://github.com/mongodb/node-mongodb-native/blob/v4.2.2/src/sessions.ts\nexport type V4Session = {\n  acquire: () => ServerSession;\n  release: (session: ServerSession) => void;\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.46.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-mongodb';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  context,\n  trace,\n  Span,\n  SpanKind,\n  SpanStatusCode,\n} from '@opentelemetry/api';\nimport {\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  InstrumentationNodeModuleFile,\n  isWrapped,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\nimport {\n  DBSYSTEMVALUES_MONGODB,\n  SEMATTRS_DB_CONNECTION_STRING,\n  SEMATTRS_DB_MONGODB_COLLECTION,\n  SEMATTRS_DB_NAME,\n  SEMATTRS_DB_OPERATION,\n  SEMATTRS_DB_STATEMENT,\n  SEMATTRS_DB_SYSTEM,\n  SEMATTRS_NET_PEER_NAME,\n  SEMATTRS_NET_PEER_PORT,\n} from '@opentelemetry/semantic-conventions';\nimport { MongoDBInstrumentationConfig, CommandResult } from './types';\nimport {\n  CursorState,\n  ServerSession,\n  MongodbCommandType,\n  MongoInternalCommand,\n  MongodbNamespace,\n  MongoInternalTopology,\n  WireProtocolInternal,\n  V4Connection,\n  V4ConnectionPool,\n} from './internal-types';\nimport { V4Connect, V4Session } from './internal-types';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport { UpDownCounter } from '@opentelemetry/api';\n\n/** mongodb instrumentation plugin for OpenTelemetry */\nexport class MongoDBInstrumentation extends InstrumentationBase {\n  private _connectionsUsage!: UpDownCounter;\n  private _poolName!: string;\n\n  protected override _config!: MongoDBInstrumentationConfig;\n\n  constructor(config: MongoDBInstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  override _updateMetricInstruments() {\n    this._connectionsUsage = this.meter.createUpDownCounter(\n      'db.client.connections.usage',\n      {\n        description:\n          'The number of connections that are currently in state described by the state attribute.',\n        unit: '{connection}',\n      }\n    );\n  }\n\n  init() {\n    const {\n      v3PatchConnection: v3PatchConnection,\n      v3UnpatchConnection: v3UnpatchConnection,\n    } = this._getV3ConnectionPatches();\n\n    const { v4PatchConnect, v4UnpatchConnect } = this._getV4ConnectPatches();\n    const {\n      v4PatchConnectionCallback,\n      v4PatchConnectionPromise,\n      v4UnpatchConnection,\n    } = this._getV4ConnectionPatches();\n    const { v4PatchConnectionPool, v4UnpatchConnectionPool } =\n      this._getV4ConnectionPoolPatches();\n    const { v4PatchSessions, v4UnpatchSessions } = this._getV4SessionsPatches();\n\n    return [\n      new InstrumentationNodeModuleDefinition(\n        'mongodb',\n        ['>=3.3.0 <4'],\n        undefined,\n        undefined,\n        [\n          new InstrumentationNodeModuleFile(\n            'mongodb/lib/core/wireprotocol/index.js',\n            ['>=3.3.0 <4'],\n            v3PatchConnection,\n            v3UnpatchConnection\n          ),\n        ]\n      ),\n      new InstrumentationNodeModuleDefinition(\n        'mongodb',\n        ['>=4.0.0 <7'],\n        undefined,\n        undefined,\n        [\n          new InstrumentationNodeModuleFile(\n            'mongodb/lib/cmap/connection.js',\n            ['>=4.0.0 <6.4'],\n            v4PatchConnectionCallback,\n            v4UnpatchConnection\n          ),\n          new InstrumentationNodeModuleFile(\n            'mongodb/lib/cmap/connection.js',\n            ['>=6.4.0 <7'],\n            v4PatchConnectionPromise,\n            v4UnpatchConnection\n          ),\n          new InstrumentationNodeModuleFile(\n            'mongodb/lib/cmap/connection_pool.js',\n            ['>=4.0.0 <6.4'],\n            v4PatchConnectionPool,\n            v4UnpatchConnectionPool\n          ),\n          new InstrumentationNodeModuleFile(\n            'mongodb/lib/cmap/connect.js',\n            ['>=4.0.0 <7'],\n            v4PatchConnect,\n            v4UnpatchConnect\n          ),\n          new InstrumentationNodeModuleFile(\n            'mongodb/lib/sessions.js',\n            ['>=4.0.0 <7'],\n            v4PatchSessions,\n            v4UnpatchSessions\n          ),\n        ]\n      ),\n    ];\n  }\n\n  private _getV3ConnectionPatches<T extends WireProtocolInternal>() {\n    return {\n      v3PatchConnection: (moduleExports: T) => {\n        // patch insert operation\n        if (isWrapped(moduleExports.insert)) {\n          this._unwrap(moduleExports, 'insert');\n        }\n        this._wrap(\n          moduleExports,\n          'insert',\n          this._getV3PatchOperation('insert')\n        );\n        // patch remove operation\n        if (isWrapped(moduleExports.remove)) {\n          this._unwrap(moduleExports, 'remove');\n        }\n        this._wrap(\n          moduleExports,\n          'remove',\n          this._getV3PatchOperation('remove')\n        );\n        // patch update operation\n        if (isWrapped(moduleExports.update)) {\n          this._unwrap(moduleExports, 'update');\n        }\n        this._wrap(\n          moduleExports,\n          'update',\n          this._getV3PatchOperation('update')\n        );\n        // patch other command\n        if (isWrapped(moduleExports.command)) {\n          this._unwrap(moduleExports, 'command');\n        }\n        this._wrap(moduleExports, 'command', this._getV3PatchCommand());\n        // patch query\n        if (isWrapped(moduleExports.query)) {\n          this._unwrap(moduleExports, 'query');\n        }\n        this._wrap(moduleExports, 'query', this._getV3PatchFind());\n        // patch get more operation on cursor\n        if (isWrapped(moduleExports.getMore)) {\n          this._unwrap(moduleExports, 'getMore');\n        }\n        this._wrap(moduleExports, 'getMore', this._getV3PatchCursor());\n        return moduleExports;\n      },\n      v3UnpatchConnection: (moduleExports?: T) => {\n        if (moduleExports === undefined) return;\n        this._unwrap(moduleExports, 'insert');\n        this._unwrap(moduleExports, 'remove');\n        this._unwrap(moduleExports, 'update');\n        this._unwrap(moduleExports, 'command');\n        this._unwrap(moduleExports, 'query');\n        this._unwrap(moduleExports, 'getMore');\n      },\n    };\n  }\n\n  private _getV4SessionsPatches<T extends V4Session>() {\n    return {\n      v4PatchSessions: (moduleExports: any) => {\n        if (isWrapped(moduleExports.acquire)) {\n          this._unwrap(moduleExports, 'acquire');\n        }\n        this._wrap(\n          moduleExports.ServerSessionPool.prototype,\n          'acquire',\n          this._getV4AcquireCommand()\n        );\n\n        if (isWrapped(moduleExports.release)) {\n          this._unwrap(moduleExports, 'release');\n        }\n        this._wrap(\n          moduleExports.ServerSessionPool.prototype,\n          'release',\n          this._getV4ReleaseCommand()\n        );\n        return moduleExports;\n      },\n      v4UnpatchSessions: (moduleExports?: T) => {\n        if (moduleExports === undefined) return;\n        if (isWrapped(moduleExports.acquire)) {\n          this._unwrap(moduleExports, 'acquire');\n        }\n        if (isWrapped(moduleExports.release)) {\n          this._unwrap(moduleExports, 'release');\n        }\n      },\n    };\n  }\n\n  private _getV4AcquireCommand() {\n    const instrumentation = this;\n    return (original: V4Session['acquire']) => {\n      return function patchAcquire(this: any) {\n        const nSessionsBeforeAcquire = this.sessions.length;\n        const session = original.call(this);\n        const nSessionsAfterAcquire = this.sessions.length;\n\n        if (nSessionsBeforeAcquire === nSessionsAfterAcquire) {\n          //no session in the pool. a new session was created and used\n          instrumentation._connectionsUsage.add(1, {\n            state: 'used',\n            'pool.name': instrumentation._poolName,\n          });\n        } else if (nSessionsBeforeAcquire - 1 === nSessionsAfterAcquire) {\n          //a session was already in the pool. remove it from the pool and use it.\n          instrumentation._connectionsUsage.add(-1, {\n            state: 'idle',\n            'pool.name': instrumentation._poolName,\n          });\n          instrumentation._connectionsUsage.add(1, {\n            state: 'used',\n            'pool.name': instrumentation._poolName,\n          });\n        }\n        return session;\n      };\n    };\n  }\n\n  private _getV4ReleaseCommand() {\n    const instrumentation = this;\n    return (original: V4Session['release']) => {\n      return function patchRelease(this: any, session: ServerSession) {\n        const cmdPromise = original.call(this, session);\n\n        instrumentation._connectionsUsage.add(-1, {\n          state: 'used',\n          'pool.name': instrumentation._poolName,\n        });\n        instrumentation._connectionsUsage.add(1, {\n          state: 'idle',\n          'pool.name': instrumentation._poolName,\n        });\n        return cmdPromise;\n      };\n    };\n  }\n\n  private _getV4ConnectionPoolPatches<T extends V4ConnectionPool>() {\n    return {\n      v4PatchConnectionPool: (moduleExports: any) => {\n        const poolPrototype = moduleExports.ConnectionPool.prototype;\n\n        if (isWrapped(poolPrototype.checkOut)) {\n          this._unwrap(poolPrototype, 'checkOut');\n        }\n\n        this._wrap(\n          poolPrototype,\n          'checkOut',\n          this._getV4ConnectionPoolCheckOut()\n        );\n        return moduleExports;\n      },\n      v4UnpatchConnectionPool: (moduleExports?: any) => {\n        if (moduleExports === undefined) return;\n\n        this._unwrap(moduleExports.ConnectionPool.prototype, 'checkOut');\n      },\n    };\n  }\n\n  private _getV4ConnectPatches<T extends V4Connect>() {\n    return {\n      v4PatchConnect: (moduleExports: any) => {\n        if (isWrapped(moduleExports.connect)) {\n          this._unwrap(moduleExports, 'connect');\n        }\n\n        this._wrap(moduleExports, 'connect', this._getV4ConnectCommand());\n        return moduleExports;\n      },\n      v4UnpatchConnect: (moduleExports?: T) => {\n        if (moduleExports === undefined) return;\n\n        this._unwrap(moduleExports, 'connect');\n      },\n    };\n  }\n\n  // This patch will become unnecessary once\n  // https://jira.mongodb.org/browse/NODE-5639 is done.\n  private _getV4ConnectionPoolCheckOut() {\n    return (original: V4ConnectionPool['checkOut']) => {\n      return function patchedCheckout(this: unknown, callback: any) {\n        const patchedCallback = context.bind(context.active(), callback);\n        return original.call(this, patchedCallback);\n      };\n    };\n  }\n\n  private _getV4ConnectCommand() {\n    const instrumentation = this;\n\n    return (\n      original: V4Connect['connectCallback'] | V4Connect['connectPromise']\n    ) => {\n      return function patchedConnect(\n        this: unknown,\n        options: any,\n        callback: any\n      ) {\n        // from v6.4 `connect` method only accepts an options param and returns a promise\n        // with the connection\n        if (original.length === 1) {\n          const result = (original as V4Connect['connectPromise']).call(\n            this,\n            options\n          );\n          if (result && typeof result.then === 'function') {\n            result.then(\n              () => instrumentation.setPoolName(options),\n              // this handler is set to pass the lint rules\n              () => undefined\n            );\n          }\n          return result;\n        }\n\n        // Earlier versions expects a callback param and return void\n        const patchedCallback = function (err: any, conn: any) {\n          if (err || !conn) {\n            callback(err, conn);\n            return;\n          }\n          instrumentation.setPoolName(options);\n          callback(err, conn);\n        };\n\n        return (original as V4Connect['connectCallback']).call(\n          this,\n          options,\n          patchedCallback\n        );\n      };\n    };\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  private _getV4ConnectionPatches<T extends V4Connection>() {\n    return {\n      v4PatchConnectionCallback: (moduleExports: any) => {\n        // patch insert operation\n        if (isWrapped(moduleExports.Connection.prototype.command)) {\n          this._unwrap(moduleExports.Connection.prototype, 'command');\n        }\n\n        this._wrap(\n          moduleExports.Connection.prototype,\n          'command',\n          this._getV4PatchCommandCallback()\n        );\n        return moduleExports;\n      },\n      v4PatchConnectionPromise: (moduleExports: any) => {\n        // patch insert operation\n        if (isWrapped(moduleExports.Connection.prototype.command)) {\n          this._unwrap(moduleExports.Connection.prototype, 'command');\n        }\n\n        this._wrap(\n          moduleExports.Connection.prototype,\n          'command',\n          this._getV4PatchCommandPromise()\n        );\n        return moduleExports;\n      },\n      v4UnpatchConnection: (moduleExports?: any) => {\n        if (moduleExports === undefined) return;\n        this._unwrap(moduleExports.Connection.prototype, 'command');\n      },\n    };\n  }\n\n  /** Creates spans for common operations */\n  private _getV3PatchOperation(operationName: 'insert' | 'update' | 'remove') {\n    const instrumentation = this;\n    return (original: WireProtocolInternal[typeof operationName]) => {\n      return function patchedServerCommand(\n        this: unknown,\n        server: MongoInternalTopology,\n        ns: string,\n        ops: unknown[],\n        options: unknown | Function,\n        callback?: Function\n      ) {\n        const currentSpan = trace.getSpan(context.active());\n        const resultHandler =\n          typeof options === 'function' ? options : callback;\n        if (\n          !currentSpan ||\n          typeof resultHandler !== 'function' ||\n          typeof ops !== 'object'\n        ) {\n          if (typeof options === 'function') {\n            return original.call(this, server, ns, ops, options);\n          } else {\n            return original.call(this, server, ns, ops, options, callback);\n          }\n        }\n        const span = instrumentation.tracer.startSpan(\n          `mongodb.${operationName}`,\n          {\n            kind: SpanKind.CLIENT,\n          }\n        );\n\n        instrumentation._populateV3Attributes(\n          span,\n          ns,\n          server,\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          ops[0] as any,\n          operationName\n        );\n        const patchedCallback = instrumentation._patchEnd(span, resultHandler);\n        // handle when options is the callback to send the correct number of args\n        if (typeof options === 'function') {\n          return original.call(this, server, ns, ops, patchedCallback);\n        } else {\n          return original.call(this, server, ns, ops, options, patchedCallback);\n        }\n      };\n    };\n  }\n\n  /** Creates spans for command operation */\n  private _getV3PatchCommand() {\n    const instrumentation = this;\n    return (original: WireProtocolInternal['command']) => {\n      return function patchedServerCommand(\n        this: unknown,\n        server: MongoInternalTopology,\n        ns: string,\n        cmd: MongoInternalCommand,\n        options: unknown | Function,\n        callback?: Function\n      ) {\n        const currentSpan = trace.getSpan(context.active());\n        const resultHandler =\n          typeof options === 'function' ? options : callback;\n        if (\n          !currentSpan ||\n          typeof resultHandler !== 'function' ||\n          typeof cmd !== 'object'\n        ) {\n          if (typeof options === 'function') {\n            return original.call(this, server, ns, cmd, options);\n          } else {\n            return original.call(this, server, ns, cmd, options, callback);\n          }\n        }\n        const commandType = MongoDBInstrumentation._getCommandType(cmd);\n        const type =\n          commandType === MongodbCommandType.UNKNOWN ? 'command' : commandType;\n        const span = instrumentation.tracer.startSpan(`mongodb.${type}`, {\n          kind: SpanKind.CLIENT,\n        });\n        const operation =\n          commandType === MongodbCommandType.UNKNOWN ? undefined : commandType;\n        instrumentation._populateV3Attributes(span, ns, server, cmd, operation);\n        const patchedCallback = instrumentation._patchEnd(span, resultHandler);\n        // handle when options is the callback to send the correct number of args\n        if (typeof options === 'function') {\n          return original.call(this, server, ns, cmd, patchedCallback);\n        } else {\n          return original.call(this, server, ns, cmd, options, patchedCallback);\n        }\n      };\n    };\n  }\n\n  /** Creates spans for command operation */\n  private _getV4PatchCommandCallback() {\n    const instrumentation = this;\n    return (original: V4Connection['commandCallback']) => {\n      return function patchedV4ServerCommand(\n        this: any,\n        ns: MongodbNamespace,\n        cmd: any,\n        options: undefined | unknown,\n        callback: any\n      ) {\n        const currentSpan = trace.getSpan(context.active());\n        const resultHandler = callback;\n        const commandType = Object.keys(cmd)[0];\n\n        if (\n          typeof resultHandler !== 'function' ||\n          typeof cmd !== 'object' ||\n          cmd.ismaster ||\n          cmd.hello\n        ) {\n          return original.call(this, ns, cmd, options, callback);\n        }\n\n        let span = undefined;\n        if (currentSpan) {\n          span = instrumentation.tracer.startSpan(`mongodb.${commandType}`, {\n            kind: SpanKind.CLIENT,\n          });\n          instrumentation._populateV4Attributes(\n            span,\n            this,\n            ns,\n            cmd,\n            commandType\n          );\n        }\n        const patchedCallback = instrumentation._patchEnd(\n          span,\n          resultHandler,\n          this.id,\n          commandType\n        );\n\n        return original.call(this, ns, cmd, options, patchedCallback);\n      };\n    };\n  }\n\n  private _getV4PatchCommandPromise() {\n    const instrumentation = this;\n    return (original: V4Connection['commandPromise']) => {\n      return function patchedV4ServerCommand(\n        this: any,\n        ...args: Parameters<V4Connection['commandPromise']>\n      ) {\n        const [ns, cmd] = args;\n        const currentSpan = trace.getSpan(context.active());\n        const commandType = Object.keys(cmd)[0];\n        const resultHandler = () => undefined;\n\n        if (typeof cmd !== 'object' || cmd.ismaster || cmd.hello) {\n          return original.apply(this, args);\n        }\n\n        let span = undefined;\n        if (currentSpan) {\n          span = instrumentation.tracer.startSpan(`mongodb.${commandType}`, {\n            kind: SpanKind.CLIENT,\n          });\n          instrumentation._populateV4Attributes(\n            span,\n            this,\n            ns,\n            cmd,\n            commandType\n          );\n        }\n\n        const patchedCallback = instrumentation._patchEnd(\n          span,\n          resultHandler,\n          this.id,\n          commandType\n        );\n\n        const result = original.apply(this, args);\n        result.then(\n          (res: any) => patchedCallback(null, res),\n          (err: any) => patchedCallback(err)\n        );\n\n        return result;\n      };\n    };\n  }\n\n  /** Creates spans for find operation */\n  private _getV3PatchFind() {\n    const instrumentation = this;\n    return (original: WireProtocolInternal['query']) => {\n      return function patchedServerCommand(\n        this: unknown,\n        server: MongoInternalTopology,\n        ns: string,\n        cmd: MongoInternalCommand,\n        cursorState: CursorState,\n        options: unknown | Function,\n        callback?: Function\n      ) {\n        const currentSpan = trace.getSpan(context.active());\n        const resultHandler =\n          typeof options === 'function' ? options : callback;\n        if (\n          !currentSpan ||\n          typeof resultHandler !== 'function' ||\n          typeof cmd !== 'object'\n        ) {\n          if (typeof options === 'function') {\n            return original.call(this, server, ns, cmd, cursorState, options);\n          } else {\n            return original.call(\n              this,\n              server,\n              ns,\n              cmd,\n              cursorState,\n              options,\n              callback\n            );\n          }\n        }\n        const span = instrumentation.tracer.startSpan('mongodb.find', {\n          kind: SpanKind.CLIENT,\n        });\n        instrumentation._populateV3Attributes(span, ns, server, cmd, 'find');\n        const patchedCallback = instrumentation._patchEnd(span, resultHandler);\n        // handle when options is the callback to send the correct number of args\n        if (typeof options === 'function') {\n          return original.call(\n            this,\n            server,\n            ns,\n            cmd,\n            cursorState,\n            patchedCallback\n          );\n        } else {\n          return original.call(\n            this,\n            server,\n            ns,\n            cmd,\n            cursorState,\n            options,\n            patchedCallback\n          );\n        }\n      };\n    };\n  }\n\n  /** Creates spans for find operation */\n  private _getV3PatchCursor() {\n    const instrumentation = this;\n    return (original: WireProtocolInternal['getMore']) => {\n      return function patchedServerCommand(\n        this: unknown,\n        server: MongoInternalTopology,\n        ns: string,\n        cursorState: CursorState,\n        batchSize: number,\n        options: unknown | Function,\n        callback?: Function\n      ) {\n        const currentSpan = trace.getSpan(context.active());\n        const resultHandler =\n          typeof options === 'function' ? options : callback;\n        if (!currentSpan || typeof resultHandler !== 'function') {\n          if (typeof options === 'function') {\n            return original.call(\n              this,\n              server,\n              ns,\n              cursorState,\n              batchSize,\n              options\n            );\n          } else {\n            return original.call(\n              this,\n              server,\n              ns,\n              cursorState,\n              batchSize,\n              options,\n              callback\n            );\n          }\n        }\n        const span = instrumentation.tracer.startSpan('mongodb.getMore', {\n          kind: SpanKind.CLIENT,\n        });\n        instrumentation._populateV3Attributes(\n          span,\n          ns,\n          server,\n          cursorState.cmd,\n          'getMore'\n        );\n        const patchedCallback = instrumentation._patchEnd(span, resultHandler);\n        // handle when options is the callback to send the correct number of args\n        if (typeof options === 'function') {\n          return original.call(\n            this,\n            server,\n            ns,\n            cursorState,\n            batchSize,\n            patchedCallback\n          );\n        } else {\n          return original.call(\n            this,\n            server,\n            ns,\n            cursorState,\n            batchSize,\n            options,\n            patchedCallback\n          );\n        }\n      };\n    };\n  }\n\n  /**\n   * Get the mongodb command type from the object.\n   * @param command Internal mongodb command object\n   */\n  private static _getCommandType(\n    command: MongoInternalCommand\n  ): MongodbCommandType {\n    if (command.createIndexes !== undefined) {\n      return MongodbCommandType.CREATE_INDEXES;\n    } else if (command.findandmodify !== undefined) {\n      return MongodbCommandType.FIND_AND_MODIFY;\n    } else if (command.ismaster !== undefined) {\n      return MongodbCommandType.IS_MASTER;\n    } else if (command.count !== undefined) {\n      return MongodbCommandType.COUNT;\n    } else if (command.aggregate !== undefined) {\n      return MongodbCommandType.AGGREGATE;\n    } else {\n      return MongodbCommandType.UNKNOWN;\n    }\n  }\n\n  /**\n   * Populate span's attributes by fetching related metadata from the context\n   * @param span span to add attributes to\n   * @param connectionCtx mongodb internal connection context\n   * @param ns mongodb namespace\n   * @param command mongodb internal representation of a command\n   */\n  private _populateV4Attributes(\n    span: Span,\n    connectionCtx: any,\n    ns: MongodbNamespace,\n    command?: any,\n    operation?: string\n  ) {\n    let host, port: undefined | string;\n    if (connectionCtx) {\n      const hostParts =\n        typeof connectionCtx.address === 'string'\n          ? connectionCtx.address.split(':')\n          : '';\n      if (hostParts.length === 2) {\n        host = hostParts[0];\n        port = hostParts[1];\n      }\n    }\n    // capture parameters within the query as well if enhancedDatabaseReporting is enabled.\n    let commandObj: Record<string, unknown>;\n    if (command?.documents && command.documents[0]) {\n      commandObj = command.documents[0];\n    } else if (command?.cursors) {\n      commandObj = command.cursors;\n    } else {\n      commandObj = command;\n    }\n\n    this._addAllSpanAttributes(\n      span,\n      ns.db,\n      ns.collection,\n      host,\n      port,\n      commandObj,\n      operation\n    );\n  }\n\n  /**\n   * Populate span's attributes by fetching related metadata from the context\n   * @param span span to add attributes to\n   * @param ns mongodb namespace\n   * @param topology mongodb internal representation of the network topology\n   * @param command mongodb internal representation of a command\n   */\n  private _populateV3Attributes(\n    span: Span,\n    ns: string,\n    topology: MongoInternalTopology,\n    command?: MongoInternalCommand,\n    operation?: string | undefined\n  ) {\n    // add network attributes to determine the remote server\n    let host: undefined | string;\n    let port: undefined | string;\n    if (topology && topology.s) {\n      host = topology.s.options?.host ?? topology.s.host;\n      port = (topology.s.options?.port ?? topology.s.port)?.toString();\n      if (host == null || port == null) {\n        const address = topology.description?.address;\n        if (address) {\n          const addressSegments = address.split(':');\n          host = addressSegments[0];\n          port = addressSegments[1];\n        }\n      }\n    }\n\n    // The namespace is a combination of the database name and the name of the\n    // collection or index, like so: [database-name].[collection-or-index-name].\n    // It could be a string or an instance of MongoDBNamespace, as such we\n    // always coerce to a string to extract db and collection.\n    const [dbName, dbCollection] = ns.toString().split('.');\n    // capture parameters within the query as well if enhancedDatabaseReporting is enabled.\n    const commandObj = command?.query ?? command?.q ?? command;\n\n    this._addAllSpanAttributes(\n      span,\n      dbName,\n      dbCollection,\n      host,\n      port,\n      commandObj,\n      operation\n    );\n  }\n\n  private _addAllSpanAttributes(\n    span: Span,\n    dbName?: string,\n    dbCollection?: string,\n    host?: undefined | string,\n    port?: undefined | string,\n    commandObj?: any,\n    operation?: string | undefined\n  ) {\n    // add database related attributes\n    span.setAttributes({\n      [SEMATTRS_DB_SYSTEM]: DBSYSTEMVALUES_MONGODB,\n      [SEMATTRS_DB_NAME]: dbName,\n      [SEMATTRS_DB_MONGODB_COLLECTION]: dbCollection,\n      [SEMATTRS_DB_OPERATION]: operation,\n      [SEMATTRS_DB_CONNECTION_STRING]: `mongodb://${host}:${port}/${dbName}`,\n    });\n\n    if (host && port) {\n      span.setAttribute(SEMATTRS_NET_PEER_NAME, host);\n      const portNumber = parseInt(port, 10);\n      if (!isNaN(portNumber)) {\n        span.setAttribute(SEMATTRS_NET_PEER_PORT, portNumber);\n      }\n    }\n    if (!commandObj) return;\n    const dbStatementSerializer =\n      typeof this._config.dbStatementSerializer === 'function'\n        ? this._config.dbStatementSerializer\n        : this._defaultDbStatementSerializer.bind(this);\n\n    safeExecuteInTheMiddle(\n      () => {\n        const query = dbStatementSerializer(commandObj);\n        span.setAttribute(SEMATTRS_DB_STATEMENT, query);\n      },\n      err => {\n        if (err) {\n          this._diag.error('Error running dbStatementSerializer hook', err);\n        }\n      },\n      true\n    );\n  }\n\n  private _defaultDbStatementSerializer(commandObj: Record<string, unknown>) {\n    const enhancedDbReporting = !!this._config?.enhancedDatabaseReporting;\n    const resultObj = enhancedDbReporting\n      ? commandObj\n      : this._scrubStatement(commandObj);\n    return JSON.stringify(resultObj);\n  }\n\n  private _scrubStatement(value: unknown): unknown {\n    if (Array.isArray(value)) {\n      return value.map(element => this._scrubStatement(element));\n    }\n\n    if (typeof value === 'object' && value !== null) {\n      return Object.fromEntries(\n        Object.entries(value).map(([key, element]) => [\n          key,\n          this._scrubStatement(element),\n        ])\n      );\n    }\n\n    // A value like string or number, possible contains PII, scrub it\n    return '?';\n  }\n\n  /**\n   * Triggers the response hook in case it is defined.\n   * @param span The span to add the results to.\n   * @param result The command result\n   */\n  private _handleExecutionResult(span: Span, result: CommandResult) {\n    const config: MongoDBInstrumentationConfig = this.getConfig();\n    if (typeof config.responseHook === 'function') {\n      safeExecuteInTheMiddle(\n        () => {\n          config.responseHook!(span, { data: result });\n        },\n        err => {\n          if (err) {\n            this._diag.error('Error running response hook', err);\n          }\n        },\n        true\n      );\n    }\n  }\n\n  /**\n   * Ends a created span.\n   * @param span The created span to end.\n   * @param resultHandler A callback function.\n   * @param connectionId: The connection ID of the Command response.\n   */\n  private _patchEnd(\n    span: Span | undefined,\n    resultHandler: Function,\n    connectionId?: number,\n    commandType?: string\n  ): Function {\n    // mongodb is using \"tick\" when calling a callback, this way the context\n    // in final callback (resultHandler) is lost\n    const activeContext = context.active();\n    const instrumentation = this;\n    return function patchedEnd(this: {}, ...args: unknown[]) {\n      const error = args[0];\n      if (span) {\n        if (error instanceof Error) {\n          span?.setStatus({\n            code: SpanStatusCode.ERROR,\n            message: error.message,\n          });\n        } else {\n          const result = args[1] as CommandResult;\n          instrumentation._handleExecutionResult(span, result);\n        }\n        span.end();\n      }\n\n      return context.with(activeContext, () => {\n        if (commandType === 'endSessions') {\n          instrumentation._connectionsUsage.add(-1, {\n            state: 'idle',\n            'pool.name': instrumentation._poolName,\n          });\n        }\n        return resultHandler.apply(this, args);\n      });\n    };\n  }\n  private setPoolName(options: any) {\n    const host = options.hostAddress?.host;\n    const port = options.hostAddress?.port;\n    const database = options.dbName;\n    const poolName = `mongodb://${host}:${port}/${database}`;\n    this._poolName = poolName;\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InstrumentationConfig } from '@opentelemetry/instrumentation';\nimport { Span } from '@opentelemetry/api';\n\nexport interface MongoDBInstrumentationExecutionResponseHook {\n  (span: Span, responseInfo: MongoResponseHookInformation): void;\n}\n\n/**\n * Function that can be used to serialize db.statement tag\n * @param cmd - MongoDB command object\n *\n * @returns serialized string that will be used as the db.statement attribute.\n */\nexport type DbStatementSerializer = (cmd: Record<string, unknown>) => string;\n\nexport interface MongoDBInstrumentationConfig extends InstrumentationConfig {\n  /**\n   * If true, additional information about query parameters and\n   * results will be attached (as `attributes`) to spans representing\n   * database operations.\n   */\n  enhancedDatabaseReporting?: boolean;\n\n  /**\n   * Hook that allows adding custom span attributes based on the data\n   * returned from MongoDB actions.\n   *\n   * @default undefined\n   */\n  responseHook?: MongoDBInstrumentationExecutionResponseHook;\n\n  /**\n   * Custom serializer function for the db.statement tag\n   */\n  dbStatementSerializer?: DbStatementSerializer;\n}\n\nexport interface MongoResponseHookInformation {\n  data: CommandResult;\n}\n\n// https://github.com/mongodb/node-mongodb-native/blob/3.6/lib/core/connection/command_result.js\nexport type CommandResult = {\n  result?: unknown;\n  connection?: unknown;\n  message?: unknown;\n};\n\nexport enum MongodbCommandType {\n  CREATE_INDEXES = 'createIndexes',\n  FIND_AND_MODIFY = 'findAndModify',\n  IS_MASTER = 'isMaster',\n  COUNT = 'count',\n  UNKNOWN = 'unknown',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './types';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Attributes, SpanStatusCode, diag, Span } from '@opentelemetry/api';\nimport type { Collection } from 'mongoose';\nimport { MongooseResponseCustomAttributesFunction } from './types';\nimport { safeExecuteInTheMiddle } from '@opentelemetry/instrumentation';\nimport {\n  SEMATTRS_DB_MONGODB_COLLECTION,\n  SEMATTRS_DB_NAME,\n  SEMATTRS_DB_USER,\n  SEMATTRS_NET_PEER_NAME,\n  SEMATTRS_NET_PEER_PORT,\n} from '@opentelemetry/semantic-conventions';\n\nexport function getAttributesFromCollection(\n  collection: Collection\n): Attributes {\n  return {\n    [SEMATTRS_DB_MONGODB_COLLECTION]: collection.name,\n    [SEMATTRS_DB_NAME]: collection.conn.name,\n    [SEMATTRS_DB_USER]: collection.conn.user,\n    [SEMATTRS_NET_PEER_NAME]: collection.conn.host,\n    [SEMATTRS_NET_PEER_PORT]: collection.conn.port,\n  };\n}\n\nfunction setErrorStatus(span: Span, error: any = {}) {\n  span.recordException(error);\n\n  span.setStatus({\n    code: SpanStatusCode.ERROR,\n    message: `${error.message} ${\n      error.code ? `\\nMongoose Error Code: ${error.code}` : ''\n    }`,\n  });\n}\n\nfunction applyResponseHook(\n  span: Span,\n  response: any,\n  responseHook?: MongooseResponseCustomAttributesFunction,\n  moduleVersion: string | undefined = undefined\n) {\n  if (!responseHook) {\n    return;\n  }\n\n  safeExecuteInTheMiddle(\n    () => responseHook(span, { moduleVersion, response }),\n    e => {\n      if (e) {\n        diag.error('mongoose instrumentation: responseHook error', e);\n      }\n    },\n    true\n  );\n}\n\nexport function handlePromiseResponse(\n  execResponse: any,\n  span: Span,\n  responseHook?: MongooseResponseCustomAttributesFunction,\n  moduleVersion: string | undefined = undefined\n): any {\n  if (!(execResponse instanceof Promise)) {\n    applyResponseHook(span, execResponse, responseHook, moduleVersion);\n    span.end();\n    return execResponse;\n  }\n\n  return execResponse\n    .then(response => {\n      applyResponseHook(span, response, responseHook, moduleVersion);\n      return response;\n    })\n    .catch(err => {\n      setErrorStatus(span, err);\n      throw err;\n    })\n    .finally(() => span.end());\n}\n\nexport function handleCallbackResponse(\n  callback: Function,\n  exec: Function,\n  originalThis: any,\n  span: Span,\n  args: IArguments,\n  responseHook?: MongooseResponseCustomAttributesFunction,\n  moduleVersion: string | undefined = undefined\n) {\n  let callbackArgumentIndex = 0;\n  if (args.length === 2) {\n    callbackArgumentIndex = 1;\n  }\n\n  args[callbackArgumentIndex] = (err: Error, response: any): any => {\n    err\n      ? setErrorStatus(span, err)\n      : applyResponseHook(span, response, responseHook, moduleVersion);\n\n    span.end();\n    return callback!(err, response);\n  };\n\n  return exec.apply(originalThis, args);\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.40.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-mongoose';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { context, Span, trace, Attributes, SpanKind } from '@opentelemetry/api';\nimport { suppressTracing } from '@opentelemetry/core';\nimport type * as mongoose from 'mongoose';\nimport { MongooseInstrumentationConfig, SerializerPayload } from './types';\nimport {\n  handleCallbackResponse,\n  handlePromiseResponse,\n  getAttributesFromCollection,\n} from './utils';\nimport {\n  InstrumentationBase,\n  InstrumentationModuleDefinition,\n  InstrumentationNodeModuleDefinition,\n} from '@opentelemetry/instrumentation';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport {\n  SEMATTRS_DB_OPERATION,\n  SEMATTRS_DB_STATEMENT,\n  SEMATTRS_DB_SYSTEM,\n} from '@opentelemetry/semantic-conventions';\n\nconst contextCaptureFunctions = [\n  'remove',\n  'deleteOne',\n  'deleteMany',\n  'find',\n  'findOne',\n  'estimatedDocumentCount',\n  'countDocuments',\n  'count',\n  'distinct',\n  'where',\n  '$where',\n  'findOneAndUpdate',\n  'findOneAndDelete',\n  'findOneAndReplace',\n  'findOneAndRemove',\n];\n\n// when mongoose functions are called, we store the original call context\n// and then set it as the parent for the spans created by Query/Aggregate exec()\n// calls. this bypass the unlinked spans issue on thenables await operations.\nexport const _STORED_PARENT_SPAN: unique symbol = Symbol('stored-parent-span');\n\nexport class MongooseInstrumentation extends InstrumentationBase {\n  protected override _config!: MongooseInstrumentationConfig;\n\n  constructor(config: MongooseInstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  override setConfig(config: MongooseInstrumentationConfig = {}) {\n    this._config = Object.assign({}, config);\n  }\n\n  protected init(): InstrumentationModuleDefinition {\n    const module = new InstrumentationNodeModuleDefinition(\n      'mongoose',\n      ['>=5.9.7 <7'],\n      this.patch.bind(this),\n      this.unpatch.bind(this)\n    );\n    return module;\n  }\n\n  private patch(\n    moduleExports: typeof mongoose,\n    moduleVersion: string | undefined\n  ) {\n    this._wrap(\n      moduleExports.Model.prototype,\n      'save',\n      this.patchOnModelMethods('save', moduleVersion)\n    );\n    // mongoose applies this code on module require:\n    // Model.prototype.$save = Model.prototype.save;\n    // which captures the save function before it is patched.\n    // so we need to apply the same logic after instrumenting the save function.\n    moduleExports.Model.prototype.$save = moduleExports.Model.prototype.save;\n\n    this._wrap(\n      moduleExports.Model.prototype,\n      'remove',\n      this.patchOnModelMethods('remove', moduleVersion)\n    );\n    this._wrap(\n      moduleExports.Query.prototype,\n      'exec',\n      this.patchQueryExec(moduleVersion)\n    );\n    this._wrap(\n      moduleExports.Aggregate.prototype,\n      'exec',\n      this.patchAggregateExec(moduleVersion)\n    );\n\n    contextCaptureFunctions.forEach((funcName: string) => {\n      this._wrap(\n        moduleExports.Query.prototype,\n        funcName as any,\n        this.patchAndCaptureSpanContext(funcName)\n      );\n    });\n    this._wrap(moduleExports.Model, 'aggregate', this.patchModelAggregate());\n\n    return moduleExports;\n  }\n\n  private unpatch(moduleExports: typeof mongoose): void {\n    this._unwrap(moduleExports.Model.prototype, 'save');\n    // revert the patch for $save which we applied by aliasing it to patched `save`\n    moduleExports.Model.prototype.$save = moduleExports.Model.prototype.save;\n    this._unwrap(moduleExports.Model.prototype, 'remove');\n    this._unwrap(moduleExports.Query.prototype, 'exec');\n    this._unwrap(moduleExports.Aggregate.prototype, 'exec');\n\n    contextCaptureFunctions.forEach((funcName: string) => {\n      this._unwrap(moduleExports.Query.prototype, funcName as any);\n    });\n    this._unwrap(moduleExports.Model, 'aggregate');\n  }\n\n  private patchAggregateExec(moduleVersion: string | undefined) {\n    const self = this;\n    return (originalAggregate: Function) => {\n      return function exec(this: any, callback?: Function) {\n        if (\n          self._config.requireParentSpan &&\n          trace.getSpan(context.active()) === undefined\n        ) {\n          return originalAggregate.apply(this, arguments);\n        }\n\n        const parentSpan = this[_STORED_PARENT_SPAN];\n        const attributes: Attributes = {};\n        if (self._config.dbStatementSerializer) {\n          attributes[SEMATTRS_DB_STATEMENT] =\n            self._config.dbStatementSerializer('aggregate', {\n              options: this.options,\n              aggregatePipeline: this._pipeline,\n            });\n        }\n\n        const span = self._startSpan(\n          this._model.collection,\n          this._model?.modelName,\n          'aggregate',\n          attributes,\n          parentSpan\n        );\n\n        return self._handleResponse(\n          span,\n          originalAggregate,\n          this,\n          arguments,\n          callback,\n          moduleVersion\n        );\n      };\n    };\n  }\n\n  private patchQueryExec(moduleVersion: string | undefined) {\n    const self = this;\n    return (originalExec: Function) => {\n      return function exec(this: any, callback?: Function) {\n        if (\n          self._config.requireParentSpan &&\n          trace.getSpan(context.active()) === undefined\n        ) {\n          return originalExec.apply(this, arguments);\n        }\n\n        const parentSpan = this[_STORED_PARENT_SPAN];\n        const attributes: Attributes = {};\n        if (self._config.dbStatementSerializer) {\n          attributes[SEMATTRS_DB_STATEMENT] =\n            self._config.dbStatementSerializer(this.op, {\n              condition: this._conditions,\n              updates: this._update,\n              options: this.options,\n              fields: this._fields,\n            });\n        }\n        const span = self._startSpan(\n          this.mongooseCollection,\n          this.model.modelName,\n          this.op,\n          attributes,\n          parentSpan\n        );\n\n        return self._handleResponse(\n          span,\n          originalExec,\n          this,\n          arguments,\n          callback,\n          moduleVersion\n        );\n      };\n    };\n  }\n\n  private patchOnModelMethods(op: string, moduleVersion: string | undefined) {\n    const self = this;\n    return (originalOnModelFunction: Function) => {\n      return function method(this: any, options?: any, callback?: Function) {\n        if (\n          self._config.requireParentSpan &&\n          trace.getSpan(context.active()) === undefined\n        ) {\n          return originalOnModelFunction.apply(this, arguments);\n        }\n\n        const serializePayload: SerializerPayload = { document: this };\n        if (options && !(options instanceof Function)) {\n          serializePayload.options = options;\n        }\n        const attributes: Attributes = {};\n        if (self._config.dbStatementSerializer) {\n          attributes[SEMATTRS_DB_STATEMENT] =\n            self._config.dbStatementSerializer(op, serializePayload);\n        }\n        const span = self._startSpan(\n          this.constructor.collection,\n          this.constructor.modelName,\n          op,\n          attributes\n        );\n\n        if (options instanceof Function) {\n          callback = options;\n          options = undefined;\n        }\n\n        return self._handleResponse(\n          span,\n          originalOnModelFunction,\n          this,\n          arguments,\n          callback,\n          moduleVersion\n        );\n      };\n    };\n  }\n\n  // we want to capture the otel span on the object which is calling exec.\n  // in the special case of aggregate, we need have no function to path\n  // on the Aggregate object to capture the context on, so we patch\n  // the aggregate of Model, and set the context on the Aggregate object\n  private patchModelAggregate() {\n    const self = this;\n    return (original: Function) => {\n      return function captureSpanContext(this: any) {\n        const currentSpan = trace.getSpan(context.active());\n        const aggregate = self._callOriginalFunction(() =>\n          original.apply(this, arguments)\n        );\n        if (aggregate) aggregate[_STORED_PARENT_SPAN] = currentSpan;\n        return aggregate;\n      };\n    };\n  }\n\n  private patchAndCaptureSpanContext(funcName: string) {\n    const self = this;\n    return (original: Function) => {\n      return function captureSpanContext(this: any) {\n        this[_STORED_PARENT_SPAN] = trace.getSpan(context.active());\n        return self._callOriginalFunction(() =>\n          original.apply(this, arguments)\n        );\n      };\n    };\n  }\n\n  private _startSpan(\n    collection: mongoose.Collection,\n    modelName: string,\n    operation: string,\n    attributes: Attributes,\n    parentSpan?: Span\n  ): Span {\n    return this.tracer.startSpan(\n      `mongoose.${modelName}.${operation}`,\n      {\n        kind: SpanKind.CLIENT,\n        attributes: {\n          ...attributes,\n          ...getAttributesFromCollection(collection),\n          [SEMATTRS_DB_OPERATION]: operation,\n          [SEMATTRS_DB_SYSTEM]: 'mongoose',\n        },\n      },\n      parentSpan ? trace.setSpan(context.active(), parentSpan) : undefined\n    );\n  }\n\n  private _handleResponse(\n    span: Span,\n    exec: Function,\n    originalThis: any,\n    args: IArguments,\n    callback?: Function,\n    moduleVersion: string | undefined = undefined\n  ) {\n    const self = this;\n    if (callback instanceof Function) {\n      return self._callOriginalFunction(() =>\n        handleCallbackResponse(\n          callback,\n          exec,\n          originalThis,\n          span,\n          args,\n          self._config.responseHook,\n          moduleVersion\n        )\n      );\n    } else {\n      const response = self._callOriginalFunction(() =>\n        exec.apply(originalThis, args)\n      );\n      return handlePromiseResponse(\n        response,\n        span,\n        self._config.responseHook,\n        moduleVersion\n      );\n    }\n  }\n\n  private _callOriginalFunction<T>(originalFunction: (...args: any[]) => T): T {\n    if (this._config?.suppressInternalInstrumentation) {\n      return context.with(suppressTracing(context.active()), originalFunction);\n    } else {\n      return originalFunction();\n    }\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport * from './mongoose';\nexport * from './types';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Mysql specific attributes not covered by semantic conventions\nexport enum AttributeNames {\n  MYSQL_VALUES = 'db.mysql.values',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Attributes } from '@opentelemetry/api';\nimport {\n  SEMATTRS_DB_CONNECTION_STRING,\n  SEMATTRS_DB_NAME,\n  SEMATTRS_DB_USER,\n  SEMATTRS_NET_PEER_NAME,\n  SEMATTRS_NET_PEER_PORT,\n} from '@opentelemetry/semantic-conventions';\nimport type {\n  ConnectionConfig,\n  PoolActualConfig,\n  Query,\n  QueryOptions,\n} from 'mysql';\nimport type * as mysqlTypes from 'mysql';\n\n/**\n * Get an Attributes map from a mysql connection config object\n *\n * @param config ConnectionConfig\n */\nexport function getConnectionAttributes(\n  config: ConnectionConfig | PoolActualConfig\n): Attributes {\n  const { host, port, database, user } = getConfig(config);\n  const portNumber = parseInt(port, 10);\n  if (!isNaN(portNumber)) {\n    return {\n      [SEMATTRS_NET_PEER_NAME]: host,\n      [SEMATTRS_NET_PEER_PORT]: portNumber,\n      [SEMATTRS_DB_CONNECTION_STRING]: getJDBCString(host, port, database),\n      [SEMATTRS_DB_NAME]: database,\n      [SEMATTRS_DB_USER]: user,\n    };\n  }\n  return {\n    [SEMATTRS_NET_PEER_NAME]: host,\n    [SEMATTRS_DB_CONNECTION_STRING]: getJDBCString(host, port, database),\n    [SEMATTRS_DB_NAME]: database,\n    [SEMATTRS_DB_USER]: user,\n  };\n}\n\nfunction getConfig(config: any) {\n  const { host, port, database, user } =\n    (config && config.connectionConfig) || config || {};\n  return { host, port, database, user };\n}\n\nfunction getJDBCString(\n  host: string | undefined,\n  port: number | undefined,\n  database: string | undefined\n) {\n  let jdbcString = `jdbc:mysql://${host || 'localhost'}`;\n\n  if (typeof port === 'number') {\n    jdbcString += `:${port}`;\n  }\n\n  if (typeof database === 'string') {\n    jdbcString += `/${database}`;\n  }\n\n  return jdbcString;\n}\n\n/**\n * @returns the database statement being executed.\n */\nexport function getDbStatement(query: string | Query | QueryOptions): string {\n  if (typeof query === 'string') {\n    return query;\n  } else {\n    return query.sql;\n  }\n}\n\nexport function getDbValues(\n  query: string | Query | QueryOptions,\n  values?: any[]\n): string {\n  if (typeof query === 'string') {\n    return arrayStringifyHelper(values);\n  } else {\n    // According to https://github.com/mysqljs/mysql#performing-queries\n    // The values argument will override the values in the option object.\n    return arrayStringifyHelper(values || query.values);\n  }\n}\n\n/**\n * The span name SHOULD be set to a low cardinality value\n * representing the statement executed on the database.\n *\n * @returns SQL statement without variable arguments or SQL verb\n */\nexport function getSpanName(query: string | Query | QueryOptions): string {\n  if (typeof query === 'object') {\n    return query.sql;\n  }\n  return query.split(' ')[0];\n}\n\nexport function arrayStringifyHelper(arr: Array<unknown> | undefined): string {\n  if (arr) return `[${arr.toString()}]`;\n  return '';\n}\n\nexport function getPoolName(pool: mysqlTypes.Pool): string {\n  const c = pool.config.connectionConfig;\n  let poolName = '';\n  poolName += c.host ? `host: '${c.host}', ` : '';\n  poolName += c.port ? `port: ${c.port}, ` : '';\n  poolName += c.database ? `database: '${c.database}', ` : '';\n  poolName += c.user ? `user: '${c.user}'` : '';\n  if (!c.user) {\n    poolName = poolName.substring(0, poolName.length - 2); //omit last comma\n  }\n  return poolName.trim();\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.40.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-mysql';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  context,\n  Context,\n  trace,\n  Span,\n  SpanKind,\n  SpanStatusCode,\n} from '@opentelemetry/api';\nimport {\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  isWrapped,\n} from '@opentelemetry/instrumentation';\nimport {\n  DBSYSTEMVALUES_MYSQL,\n  SEMATTRS_DB_STATEMENT,\n  SEMATTRS_DB_SYSTEM,\n} from '@opentelemetry/semantic-conventions';\nimport type * as mysqlTypes from 'mysql';\nimport { AttributeNames } from './AttributeNames';\nimport { MySQLInstrumentationConfig } from './types';\nimport {\n  getConnectionAttributes,\n  getDbStatement,\n  getDbValues,\n  getSpanName,\n  getPoolName,\n} from './utils';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport { UpDownCounter, MeterProvider } from '@opentelemetry/api';\n\ntype getConnectionCallbackType = (\n  err: mysqlTypes.MysqlError,\n  connection: mysqlTypes.PoolConnection\n) => void;\n\nexport class MySQLInstrumentation extends InstrumentationBase {\n  static readonly COMMON_ATTRIBUTES = {\n    [SEMATTRS_DB_SYSTEM]: DBSYSTEMVALUES_MYSQL,\n  };\n  private _connectionsUsage!: UpDownCounter;\n\n  constructor(config: MySQLInstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n    this._setMetricInstruments();\n  }\n\n  override setMeterProvider(meterProvider: MeterProvider) {\n    super.setMeterProvider(meterProvider);\n    this._setMetricInstruments();\n  }\n\n  private _setMetricInstruments() {\n    this._connectionsUsage = this.meter.createUpDownCounter(\n      'db.client.connections.usage', //TODO:: use semantic convention\n      {\n        description:\n          'The number of connections that are currently in state described by the state attribute.',\n        unit: '{connection}',\n      }\n    );\n  }\n\n  protected init() {\n    return [\n      new InstrumentationNodeModuleDefinition(\n        'mysql',\n        ['>=2.0.0 <3'],\n        (moduleExports: typeof mysqlTypes) => {\n          if (isWrapped(moduleExports.createConnection)) {\n            this._unwrap(moduleExports, 'createConnection');\n          }\n          this._wrap(\n            moduleExports,\n            'createConnection',\n            this._patchCreateConnection() as any\n          );\n\n          if (isWrapped(moduleExports.createPool)) {\n            this._unwrap(moduleExports, 'createPool');\n          }\n          this._wrap(\n            moduleExports,\n            'createPool',\n            this._patchCreatePool() as any\n          );\n\n          if (isWrapped(moduleExports.createPoolCluster)) {\n            this._unwrap(moduleExports, 'createPoolCluster');\n          }\n          this._wrap(\n            moduleExports,\n            'createPoolCluster',\n            this._patchCreatePoolCluster() as any\n          );\n\n          return moduleExports;\n        },\n        (moduleExports: typeof mysqlTypes) => {\n          if (moduleExports === undefined) return;\n          this._unwrap(moduleExports, 'createConnection');\n          this._unwrap(moduleExports, 'createPool');\n          this._unwrap(moduleExports, 'createPoolCluster');\n        }\n      ),\n    ];\n  }\n\n  // global export function\n  private _patchCreateConnection() {\n    return (originalCreateConnection: Function) => {\n      const thisPlugin = this;\n\n      return function createConnection(\n        _connectionUri: string | mysqlTypes.ConnectionConfig\n      ) {\n        const originalResult = originalCreateConnection(...arguments);\n\n        // This is unwrapped on next call after unpatch\n        thisPlugin._wrap(\n          originalResult,\n          'query',\n          thisPlugin._patchQuery(originalResult) as any\n        );\n\n        return originalResult;\n      };\n    };\n  }\n\n  // global export function\n  private _patchCreatePool() {\n    return (originalCreatePool: Function) => {\n      const thisPlugin = this;\n      return function createPool(_config: string | mysqlTypes.PoolConfig) {\n        const pool = originalCreatePool(...arguments);\n\n        thisPlugin._wrap(pool, 'query', thisPlugin._patchQuery(pool));\n        thisPlugin._wrap(\n          pool,\n          'getConnection',\n          thisPlugin._patchGetConnection(pool)\n        );\n        thisPlugin._wrap(pool, 'end', thisPlugin._patchPoolEnd(pool));\n        thisPlugin._setPoolcallbacks(pool, thisPlugin, '');\n\n        return pool;\n      };\n    };\n  }\n  private _patchPoolEnd(pool: any) {\n    return (originalPoolEnd: Function) => {\n      const thisPlugin = this;\n      return function end(callback?: unknown) {\n        const nAll = (pool as any)._allConnections.length;\n        const nFree = (pool as any)._freeConnections.length;\n        const nUsed = nAll - nFree;\n        const poolName = getPoolName(pool);\n        thisPlugin._connectionsUsage.add(-nUsed, {\n          state: 'used',\n          name: poolName,\n        });\n        thisPlugin._connectionsUsage.add(-nFree, {\n          state: 'idle',\n          name: poolName,\n        });\n        originalPoolEnd.apply(pool, arguments);\n      };\n    };\n  }\n\n  // global export function\n  private _patchCreatePoolCluster() {\n    return (originalCreatePoolCluster: Function) => {\n      const thisPlugin = this;\n      return function createPool(_config: string | mysqlTypes.PoolConfig) {\n        const cluster = originalCreatePoolCluster(...arguments);\n\n        // This is unwrapped on next call after unpatch\n        thisPlugin._wrap(\n          cluster,\n          'getConnection',\n          thisPlugin._patchGetConnection(cluster)\n        );\n        thisPlugin._wrap(cluster, 'add', thisPlugin._patchAdd(cluster));\n\n        return cluster;\n      };\n    };\n  }\n  private _patchAdd(cluster: mysqlTypes.PoolCluster) {\n    return (originalAdd: Function) => {\n      const thisPlugin = this;\n      return function add(id: string, config: unknown) {\n        // Unwrap if unpatch has been called\n        if (!thisPlugin['_enabled']) {\n          thisPlugin._unwrap(cluster, 'add');\n          return originalAdd.apply(cluster, arguments);\n        }\n        originalAdd.apply(cluster, arguments);\n        const nodes = cluster['_nodes' as keyof mysqlTypes.PoolCluster] as any;\n        if (nodes) {\n          const nodeId =\n            typeof id === 'object'\n              ? 'CLUSTER::' + (cluster as any)._lastId\n              : String(id);\n\n          const pool = nodes[nodeId].pool;\n          thisPlugin._setPoolcallbacks(pool, thisPlugin, id);\n        }\n      };\n    };\n  }\n\n  // method on cluster or pool\n  private _patchGetConnection(pool: mysqlTypes.Pool | mysqlTypes.PoolCluster) {\n    return (originalGetConnection: Function) => {\n      const thisPlugin = this;\n\n      return function getConnection(\n        arg1?: unknown,\n        arg2?: unknown,\n        arg3?: unknown\n      ) {\n        // Unwrap if unpatch has been called\n        if (!thisPlugin['_enabled']) {\n          thisPlugin._unwrap(pool, 'getConnection');\n          return originalGetConnection.apply(pool, arguments);\n        }\n\n        if (arguments.length === 1 && typeof arg1 === 'function') {\n          const patchFn = thisPlugin._getConnectionCallbackPatchFn(\n            arg1 as getConnectionCallbackType\n          );\n          return originalGetConnection.call(pool, patchFn);\n        }\n        if (arguments.length === 2 && typeof arg2 === 'function') {\n          const patchFn = thisPlugin._getConnectionCallbackPatchFn(\n            arg2 as getConnectionCallbackType\n          );\n          return originalGetConnection.call(pool, arg1, patchFn);\n        }\n        if (arguments.length === 3 && typeof arg3 === 'function') {\n          const patchFn = thisPlugin._getConnectionCallbackPatchFn(\n            arg3 as getConnectionCallbackType\n          );\n          return originalGetConnection.call(pool, arg1, arg2, patchFn);\n        }\n\n        return originalGetConnection.apply(pool, arguments);\n      };\n    };\n  }\n\n  private _getConnectionCallbackPatchFn(cb: getConnectionCallbackType) {\n    const thisPlugin = this;\n    const activeContext = context.active();\n    return function (\n      this: any,\n      err: mysqlTypes.MysqlError,\n      connection: mysqlTypes.PoolConnection\n    ) {\n      if (connection) {\n        // this is the callback passed into a query\n        // no need to unwrap\n        if (!isWrapped(connection.query)) {\n          thisPlugin._wrap(\n            connection,\n            'query',\n            thisPlugin._patchQuery(connection)\n          );\n        }\n      }\n      if (typeof cb === 'function') {\n        context.with(activeContext, cb, this, err, connection);\n      }\n    };\n  }\n\n  private _patchQuery(connection: mysqlTypes.Connection | mysqlTypes.Pool) {\n    return (originalQuery: Function): mysqlTypes.QueryFunction => {\n      const thisPlugin = this;\n\n      return function query(\n        query: string | mysqlTypes.Query | mysqlTypes.QueryOptions,\n        _valuesOrCallback?: unknown[] | mysqlTypes.queryCallback,\n        _callback?: mysqlTypes.queryCallback\n      ) {\n        if (!thisPlugin['_enabled']) {\n          thisPlugin._unwrap(connection, 'query');\n          return originalQuery.apply(connection, arguments);\n        }\n\n        const span = thisPlugin.tracer.startSpan(getSpanName(query), {\n          kind: SpanKind.CLIENT,\n          attributes: {\n            ...MySQLInstrumentation.COMMON_ATTRIBUTES,\n            ...getConnectionAttributes(connection.config),\n          },\n        });\n\n        span.setAttribute(SEMATTRS_DB_STATEMENT, getDbStatement(query));\n\n        const instrumentationConfig: MySQLInstrumentationConfig =\n          thisPlugin.getConfig();\n\n        if (instrumentationConfig.enhancedDatabaseReporting) {\n          let values;\n\n          if (Array.isArray(_valuesOrCallback)) {\n            values = _valuesOrCallback;\n          } else if (arguments[2]) {\n            values = [_valuesOrCallback];\n          }\n\n          span.setAttribute(\n            AttributeNames.MYSQL_VALUES,\n            getDbValues(query, values)\n          );\n        }\n\n        const cbIndex = Array.from(arguments).findIndex(\n          arg => typeof arg === 'function'\n        );\n\n        const parentContext = context.active();\n\n        if (cbIndex === -1) {\n          const streamableQuery: mysqlTypes.Query = context.with(\n            trace.setSpan(context.active(), span),\n            () => {\n              return originalQuery.apply(connection, arguments);\n            }\n          );\n          context.bind(parentContext, streamableQuery);\n\n          return streamableQuery\n            .on('error', err =>\n              span.setStatus({\n                code: SpanStatusCode.ERROR,\n                message: err.message,\n              })\n            )\n            .on('end', () => {\n              span.end();\n            });\n        } else {\n          thisPlugin._wrap(\n            arguments,\n            cbIndex,\n            thisPlugin._patchCallbackQuery(span, parentContext)\n          );\n\n          return context.with(trace.setSpan(context.active(), span), () => {\n            return originalQuery.apply(connection, arguments);\n          });\n        }\n      };\n    };\n  }\n\n  private _patchCallbackQuery(span: Span, parentContext: Context) {\n    return (originalCallback: Function) => {\n      return function (\n        err: mysqlTypes.MysqlError | null,\n        results?: any,\n        fields?: mysqlTypes.FieldInfo[]\n      ) {\n        if (err) {\n          span.setStatus({\n            code: SpanStatusCode.ERROR,\n            message: err.message,\n          });\n        }\n        span.end();\n        return context.with(parentContext, () =>\n          originalCallback(...arguments)\n        );\n      };\n    };\n  }\n  private _setPoolcallbacks(\n    pool: mysqlTypes.Pool,\n    thisPlugin: MySQLInstrumentation,\n    id: string\n  ) {\n    //TODO:: use semantic convention\n    const poolName = id || getPoolName(pool);\n\n    pool.on('connection', connection => {\n      thisPlugin._connectionsUsage.add(1, {\n        state: 'idle',\n        name: poolName,\n      });\n    });\n\n    pool.on('acquire', connection => {\n      thisPlugin._connectionsUsage.add(-1, {\n        state: 'idle',\n        name: poolName,\n      });\n      thisPlugin._connectionsUsage.add(1, {\n        state: 'used',\n        name: poolName,\n      });\n    });\n\n    pool.on('release', connection => {\n      thisPlugin._connectionsUsage.add(-1, {\n        state: 'used',\n        name: poolName,\n      });\n      thisPlugin._connectionsUsage.add(1, {\n        state: 'idle',\n        name: poolName,\n      });\n    });\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './types';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  trace,\n  Span,\n  ROOT_CONTEXT,\n  defaultTextMapSetter,\n} from '@opentelemetry/api';\nimport { W3CTraceContextPropagator } from '@opentelemetry/core';\n\n// NOTE: This function currently is returning false-positives\n// in cases where comment characters appear in string literals\n// (\"SELECT '-- not a comment';\" would return true, although has no comment)\nfunction hasValidSqlComment(query: string): boolean {\n  const indexOpeningDashDashComment = query.indexOf('--');\n  if (indexOpeningDashDashComment >= 0) {\n    return true;\n  }\n\n  const indexOpeningSlashComment = query.indexOf('/*');\n  if (indexOpeningSlashComment < 0) {\n    return false;\n  }\n\n  const indexClosingSlashComment = query.indexOf('*/');\n  return indexOpeningDashDashComment < indexClosingSlashComment;\n}\n\n// sqlcommenter specification (https://google.github.io/sqlcommenter/spec/#value-serialization)\n// expects us to URL encode based on the RFC 3986 spec (https://en.wikipedia.org/wiki/Percent-encoding),\n// but encodeURIComponent does not handle some characters correctly (! ' ( ) *),\n// which means we need special handling for this\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent\nfunction fixedEncodeURIComponent(str: string) {\n  return encodeURIComponent(str).replace(\n    /[!'()*]/g,\n    c => `%${c.charCodeAt(0).toString(16).toUpperCase()}`\n  );\n}\n\nexport function addSqlCommenterComment(span: Span, query: string): string {\n  if (typeof query !== 'string' || query.length === 0) {\n    return query;\n  }\n\n  // As per sqlcommenter spec we shall not add a comment if there already is a comment\n  // in the query\n  if (hasValidSqlComment(query)) {\n    return query;\n  }\n\n  const propagator = new W3CTraceContextPropagator();\n  const headers: { [key: string]: string } = {};\n  propagator.inject(\n    trace.setSpan(ROOT_CONTEXT, span),\n    headers,\n    defaultTextMapSetter\n  );\n\n  // sqlcommenter spec requires keys in the comment to be sorted lexicographically\n  const sortedKeys = Object.keys(headers).sort();\n\n  if (sortedKeys.length === 0) {\n    return query;\n  }\n\n  const commentString = sortedKeys\n    .map(key => {\n      const encodedValue = fixedEncodeURIComponent(headers[key]);\n      return `${key}='${encodedValue}'`;\n    })\n    .join(',');\n\n  return `${query} /*${commentString}*/`;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Attributes } from '@opentelemetry/api';\nimport {\n  SEMATTRS_DB_CONNECTION_STRING,\n  SEMATTRS_DB_NAME,\n  SEMATTRS_DB_USER,\n  SEMATTRS_NET_PEER_NAME,\n  SEMATTRS_NET_PEER_PORT,\n} from '@opentelemetry/semantic-conventions';\n\n/*\n  Following types declare an expectation on mysql2 types and define a subset we\n  use in the instrumentation of the types actually defined in mysql2 package\n\n  We need to import them here so that the installing party of the instrumentation\n  doesn't have to absolutely install the mysql2 package as well - specially\n  important for auto-loaders and meta-packages.\n*/\ninterface QueryOptions {\n  sql: string;\n  values?: any | any[] | { [param: string]: any };\n}\n\ninterface Query {\n  sql: string;\n}\n\ninterface Config {\n  host?: string;\n  port?: number;\n  database?: string;\n  user?: string;\n  connectionConfig?: Config;\n}\n/**\n * Get an Attributes map from a mysql connection config object\n *\n * @param config ConnectionConfig\n */\nexport function getConnectionAttributes(config: Config): Attributes {\n  const { host, port, database, user } = getConfig(config);\n  const portNumber = parseInt(port, 10);\n  if (!isNaN(portNumber)) {\n    return {\n      [SEMATTRS_NET_PEER_NAME]: host,\n      [SEMATTRS_NET_PEER_PORT]: portNumber,\n      [SEMATTRS_DB_CONNECTION_STRING]: getJDBCString(host, port, database),\n      [SEMATTRS_DB_NAME]: database,\n      [SEMATTRS_DB_USER]: user,\n    };\n  }\n  return {\n    [SEMATTRS_NET_PEER_NAME]: host,\n    [SEMATTRS_DB_CONNECTION_STRING]: getJDBCString(host, port, database),\n    [SEMATTRS_DB_NAME]: database,\n    [SEMATTRS_DB_USER]: user,\n  };\n}\n\nfunction getConfig(config: any) {\n  const { host, port, database, user } =\n    (config && config.connectionConfig) || config || {};\n  return { host, port, database, user };\n}\n\nfunction getJDBCString(\n  host: string | undefined,\n  port: number | undefined,\n  database: string | undefined\n) {\n  let jdbcString = `jdbc:mysql://${host || 'localhost'}`;\n\n  if (typeof port === 'number') {\n    jdbcString += `:${port}`;\n  }\n\n  if (typeof database === 'string') {\n    jdbcString += `/${database}`;\n  }\n\n  return jdbcString;\n}\n\n/**\n * Conjures up the value for the db.statement attribute by formatting a SQL query.\n *\n * @returns the database statement being executed.\n */\nexport function getDbStatement(\n  query: string | Query | QueryOptions,\n  format: (\n    sql: string,\n    values: any[],\n    stringifyObjects?: boolean,\n    timeZone?: string\n  ) => string,\n  values?: any[]\n): string {\n  if (typeof query === 'string') {\n    return values ? format(query, values) : query;\n  } else {\n    // According to https://github.com/mysqljs/mysql#performing-queries\n    // The values argument will override the values in the option object.\n    return values || (query as QueryOptions).values\n      ? format(query.sql, values || (query as QueryOptions).values)\n      : query.sql;\n  }\n}\n\n/**\n * The span name SHOULD be set to a low cardinality value\n * representing the statement executed on the database.\n *\n * @returns SQL statement without variable arguments or SQL verb\n */\nexport function getSpanName(query: string | Query | QueryOptions): string {\n  const rawQuery = typeof query === 'object' ? query.sql : query;\n  // Extract the SQL verb\n  return rawQuery?.split(' ')?.[0];\n}\n\nexport const once = (fn: Function) => {\n  let called = false;\n  return (...args: unknown[]) => {\n    if (called) return;\n    called = true;\n    return fn(...args);\n  };\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.40.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-mysql2';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as api from '@opentelemetry/api';\nimport {\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  isWrapped,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\nimport {\n  DBSYSTEMVALUES_MYSQL,\n  SEMATTRS_DB_STATEMENT,\n  SEMATTRS_DB_SYSTEM,\n} from '@opentelemetry/semantic-conventions';\nimport { addSqlCommenterComment } from '@opentelemetry/sql-common';\nimport type * as mysqlTypes from 'mysql2';\nimport { MySQL2InstrumentationConfig } from './types';\nimport {\n  getConnectionAttributes,\n  getDbStatement,\n  getSpanName,\n  once,\n} from './utils';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\n\ntype formatType = typeof mysqlTypes.format;\n\nexport class MySQL2Instrumentation extends InstrumentationBase {\n  static readonly COMMON_ATTRIBUTES = {\n    [SEMATTRS_DB_SYSTEM]: DBSYSTEMVALUES_MYSQL,\n  };\n\n  constructor(config: MySQL2InstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  protected init() {\n    return [\n      new InstrumentationNodeModuleDefinition(\n        'mysql2',\n        ['>=1.4.2 <4'],\n        (moduleExports: any) => {\n          const ConnectionPrototype: mysqlTypes.Connection =\n            moduleExports.Connection.prototype;\n          if (isWrapped(ConnectionPrototype.query)) {\n            this._unwrap(ConnectionPrototype, 'query');\n          }\n          this._wrap(\n            ConnectionPrototype,\n            'query',\n            this._patchQuery(moduleExports.format, false) as any\n          );\n\n          if (isWrapped(ConnectionPrototype.execute)) {\n            this._unwrap(ConnectionPrototype, 'execute');\n          }\n          this._wrap(\n            ConnectionPrototype,\n            'execute',\n            this._patchQuery(moduleExports.format, true) as any\n          );\n\n          return moduleExports;\n        },\n        (moduleExports: any) => {\n          if (moduleExports === undefined) return;\n          const ConnectionPrototype: mysqlTypes.Connection =\n            moduleExports.Connection.prototype;\n          this._unwrap(ConnectionPrototype, 'query');\n          this._unwrap(ConnectionPrototype, 'execute');\n        }\n      ),\n    ];\n  }\n\n  private _patchQuery(format: formatType, isPrepared: boolean) {\n    return (originalQuery: Function): Function => {\n      const thisPlugin = this;\n      return function query(\n        this: mysqlTypes.Connection,\n        query: string | mysqlTypes.Query | mysqlTypes.QueryOptions,\n        _valuesOrCallback?: unknown[] | Function,\n        _callback?: Function\n      ) {\n        const thisPluginConfig: MySQL2InstrumentationConfig =\n          thisPlugin._config;\n\n        let values;\n        if (Array.isArray(_valuesOrCallback)) {\n          values = _valuesOrCallback;\n        } else if (arguments[2]) {\n          values = [_valuesOrCallback];\n        }\n\n        const span = thisPlugin.tracer.startSpan(getSpanName(query), {\n          kind: api.SpanKind.CLIENT,\n          attributes: {\n            ...MySQL2Instrumentation.COMMON_ATTRIBUTES,\n            ...getConnectionAttributes(this.config),\n            [SEMATTRS_DB_STATEMENT]: getDbStatement(query, format, values),\n          },\n        });\n\n        if (!isPrepared && thisPluginConfig.addSqlCommenterCommentToQueries) {\n          arguments[0] = query =\n            typeof query === 'string'\n              ? addSqlCommenterComment(span, query)\n              : Object.assign(query, {\n                  sql: addSqlCommenterComment(span, query.sql),\n                });\n        }\n\n        const endSpan = once((err?: any, results?: any) => {\n          if (err) {\n            span.setStatus({\n              code: api.SpanStatusCode.ERROR,\n              message: err.message,\n            });\n          } else {\n            if (typeof thisPluginConfig.responseHook === 'function') {\n              safeExecuteInTheMiddle(\n                () => {\n                  thisPluginConfig.responseHook!(span, {\n                    queryResults: results,\n                  });\n                },\n                err => {\n                  if (err) {\n                    thisPlugin._diag.warn('Failed executing responseHook', err);\n                  }\n                },\n                true\n              );\n            }\n          }\n\n          span.end();\n        });\n\n        if (arguments.length === 1) {\n          if (typeof (query as any).onResult === 'function') {\n            thisPlugin._wrap(\n              query as any,\n              'onResult',\n              thisPlugin._patchCallbackQuery(endSpan)\n            );\n          }\n\n          const streamableQuery: mysqlTypes.Query = originalQuery.apply(\n            this,\n            arguments\n          );\n\n          // `end` in mysql behaves similarly to `result` in mysql2.\n          streamableQuery\n            .once('error', err => {\n              endSpan(err);\n            })\n            .once('result', results => {\n              endSpan(undefined, results);\n            });\n\n          return streamableQuery;\n        }\n\n        if (typeof arguments[1] === 'function') {\n          thisPlugin._wrap(\n            arguments,\n            1,\n            thisPlugin._patchCallbackQuery(endSpan)\n          );\n        } else if (typeof arguments[2] === 'function') {\n          thisPlugin._wrap(\n            arguments,\n            2,\n            thisPlugin._patchCallbackQuery(endSpan)\n          );\n        }\n\n        return originalQuery.apply(this, arguments);\n      };\n    };\n  }\n\n  private _patchCallbackQuery(endSpan: Function) {\n    return (originalCallback: Function) => {\n      return function (\n        err: mysqlTypes.QueryError | null,\n        results?: any,\n        fields?: mysqlTypes.FieldPacket[]\n      ) {\n        endSpan(err, results);\n        return originalCallback(...arguments);\n      };\n    };\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './types';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Span, SpanStatusCode } from '@opentelemetry/api';\n\nexport const endSpan = (\n  span: Span,\n  err: NodeJS.ErrnoException | null | undefined\n) => {\n  if (err) {\n    span.recordException(err);\n    span.setStatus({\n      code: SpanStatusCode.ERROR,\n      message: err.message,\n    });\n  }\n  span.end();\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * List of regexes and the number of arguments that should be serialized for matching commands.\n * For example, HSET should serialize which key and field it's operating on, but not its value.\n * Setting the subset to -1 will serialize all arguments.\n * Commands without a match will have their first argument serialized.\n *\n * Refer to https://redis.io/commands/ for the full list.\n */\nconst serializationSubsets = [\n  {\n    regex: /^ECHO/i,\n    args: 0,\n  },\n  {\n    regex: /^(LPUSH|MSET|PFA|PUBLISH|RPUSH|SADD|SET|SPUBLISH|XADD|ZADD)/i,\n    args: 1,\n  },\n  {\n    regex: /^(HSET|HMSET|LSET|LINSERT)/i,\n    args: 2,\n  },\n  {\n    regex:\n      /^(ACL|BIT|B[LRZ]|CLIENT|CLUSTER|CONFIG|COMMAND|DECR|DEL|EVAL|EX|FUNCTION|GEO|GET|HINCR|HMGET|HSCAN|INCR|L[TRLM]|MEMORY|P[EFISTU]|RPOP|S[CDIMORSU]|XACK|X[CDGILPRT]|Z[CDILMPRS])/i,\n    args: -1,\n  },\n];\n\nexport type DbStatementSerializer = (\n  cmdName: string,\n  cmdArgs: Array<string | Buffer | number | any[]>\n) => string;\n\n/**\n * Given the redis command name and arguments, return a combination of the\n * command name + the allowed arguments according to `serializationSubsets`.\n * @param cmdName The redis command name\n * @param cmdArgs The redis command arguments\n * @returns a combination of the command name + args according to `serializationSubsets`.\n */\nexport const defaultDbStatementSerializer: DbStatementSerializer = (\n  cmdName,\n  cmdArgs\n) => {\n  if (Array.isArray(cmdArgs) && cmdArgs.length) {\n    const nArgsToSerialize =\n      serializationSubsets.find(({ regex }) => {\n        return regex.test(cmdName);\n      })?.args ?? 0;\n    const argsToSerialize =\n      nArgsToSerialize >= 0 ? cmdArgs.slice(0, nArgsToSerialize) : cmdArgs;\n    if (cmdArgs.length > argsToSerialize.length) {\n      argsToSerialize.push(\n        `[${cmdArgs.length - nArgsToSerialize} other arguments]`\n      );\n    }\n    return `${cmdName} ${argsToSerialize.join(' ')}`;\n  }\n  return cmdName;\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.42.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-ioredis';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { diag, trace, context, SpanKind } from '@opentelemetry/api';\nimport {\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  isWrapped,\n} from '@opentelemetry/instrumentation';\nimport { IORedisInstrumentationConfig } from './types';\nimport { IORedisCommand, RedisInterface } from './internal-types';\nimport {\n  DBSYSTEMVALUES_REDIS,\n  SEMATTRS_DB_CONNECTION_STRING,\n  SEMATTRS_DB_STATEMENT,\n  SEMATTRS_DB_SYSTEM,\n  SEMATTRS_NET_PEER_NAME,\n  SEMATTRS_NET_PEER_PORT,\n} from '@opentelemetry/semantic-conventions';\nimport { safeExecuteInTheMiddle } from '@opentelemetry/instrumentation';\nimport { endSpan } from './utils';\nimport { defaultDbStatementSerializer } from '@opentelemetry/redis-common';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\n\nconst DEFAULT_CONFIG: IORedisInstrumentationConfig = {\n  requireParentSpan: true,\n};\n\nexport class IORedisInstrumentation extends InstrumentationBase {\n  protected override _config!: IORedisInstrumentationConfig;\n\n  constructor(config: IORedisInstrumentationConfig = {}) {\n    super(\n      PACKAGE_NAME,\n      PACKAGE_VERSION,\n      Object.assign({}, DEFAULT_CONFIG, config)\n    );\n  }\n\n  init(): InstrumentationNodeModuleDefinition[] {\n    return [\n      new InstrumentationNodeModuleDefinition(\n        'ioredis',\n        ['>=2.0.0 <6'],\n        (module, moduleVersion?: string) => {\n          const moduleExports =\n            module[Symbol.toStringTag] === 'Module'\n              ? module.default // ESM\n              : module; // CommonJS\n          if (isWrapped(moduleExports.prototype.sendCommand)) {\n            this._unwrap(moduleExports.prototype, 'sendCommand');\n          }\n          this._wrap(\n            moduleExports.prototype,\n            'sendCommand',\n            this._patchSendCommand(moduleVersion)\n          );\n          if (isWrapped(moduleExports.prototype.connect)) {\n            this._unwrap(moduleExports.prototype, 'connect');\n          }\n          this._wrap(\n            moduleExports.prototype,\n            'connect',\n            this._patchConnection()\n          );\n          return module;\n        },\n        module => {\n          if (module === undefined) return;\n          const moduleExports =\n            module[Symbol.toStringTag] === 'Module'\n              ? module.default // ESM\n              : module; // CommonJS\n          this._unwrap(moduleExports.prototype, 'sendCommand');\n          this._unwrap(moduleExports.prototype, 'connect');\n        }\n      ),\n    ];\n  }\n\n  /**\n   * Patch send command internal to trace requests\n   */\n  private _patchSendCommand(moduleVersion?: string) {\n    return (original: Function) => {\n      return this._traceSendCommand(original, moduleVersion);\n    };\n  }\n\n  private _patchConnection() {\n    return (original: Function) => {\n      return this._traceConnection(original);\n    };\n  }\n\n  private _traceSendCommand(original: Function, moduleVersion?: string) {\n    const instrumentation = this;\n    return function (this: RedisInterface, cmd?: IORedisCommand) {\n      if (arguments.length < 1 || typeof cmd !== 'object') {\n        return original.apply(this, arguments);\n      }\n      const config =\n        instrumentation.getConfig() as IORedisInstrumentationConfig;\n      const dbStatementSerializer =\n        config?.dbStatementSerializer || defaultDbStatementSerializer;\n\n      const hasNoParentSpan = trace.getSpan(context.active()) === undefined;\n      if (config?.requireParentSpan === true && hasNoParentSpan) {\n        return original.apply(this, arguments);\n      }\n\n      const span = instrumentation.tracer.startSpan(cmd.name, {\n        kind: SpanKind.CLIENT,\n        attributes: {\n          [SEMATTRS_DB_SYSTEM]: DBSYSTEMVALUES_REDIS,\n          [SEMATTRS_DB_STATEMENT]: dbStatementSerializer(cmd.name, cmd.args),\n        },\n      });\n\n      if (config?.requestHook) {\n        safeExecuteInTheMiddle(\n          () =>\n            config?.requestHook!(span, {\n              moduleVersion,\n              cmdName: cmd.name,\n              cmdArgs: cmd.args,\n            }),\n          e => {\n            if (e) {\n              diag.error('ioredis instrumentation: request hook failed', e);\n            }\n          },\n          true\n        );\n      }\n\n      const { host, port } = this.options;\n\n      span.setAttributes({\n        [SEMATTRS_NET_PEER_NAME]: host,\n        [SEMATTRS_NET_PEER_PORT]: port,\n        [SEMATTRS_DB_CONNECTION_STRING]: `redis://${host}:${port}`,\n      });\n\n      try {\n        const result = original.apply(this, arguments);\n\n        const origResolve = cmd.resolve;\n        /* eslint-disable @typescript-eslint/no-explicit-any */\n        cmd.resolve = function (result: any) {\n          safeExecuteInTheMiddle(\n            () => config?.responseHook?.(span, cmd.name, cmd.args, result),\n            e => {\n              if (e) {\n                diag.error('ioredis instrumentation: response hook failed', e);\n              }\n            },\n            true\n          );\n\n          endSpan(span, null);\n          origResolve(result);\n        };\n\n        const origReject = cmd.reject;\n        cmd.reject = function (err: Error) {\n          endSpan(span, err);\n          origReject(err);\n        };\n\n        return result;\n      } catch (error: any) {\n        endSpan(span, error);\n        throw error;\n      }\n    };\n  }\n\n  private _traceConnection(original: Function) {\n    const instrumentation = this;\n    return function (this: RedisInterface) {\n      const config =\n        instrumentation.getConfig() as IORedisInstrumentationConfig;\n      const hasNoParentSpan = trace.getSpan(context.active()) === undefined;\n      if (config?.requireParentSpan === true && hasNoParentSpan) {\n        return original.apply(this, arguments);\n      }\n\n      const span = instrumentation.tracer.startSpan('connect', {\n        kind: SpanKind.CLIENT,\n        attributes: {\n          [SEMATTRS_DB_SYSTEM]: DBSYSTEMVALUES_REDIS,\n          [SEMATTRS_DB_STATEMENT]: 'connect',\n        },\n      });\n      const { host, port } = this.options;\n\n      span.setAttributes({\n        [SEMATTRS_NET_PEER_NAME]: host,\n        [SEMATTRS_NET_PEER_PORT]: port,\n        [SEMATTRS_DB_CONNECTION_STRING]: `redis://${host}:${port}`,\n      });\n      try {\n        const client = original.apply(this, arguments);\n        endSpan(span, null);\n        return client;\n      } catch (error: any) {\n        endSpan(span, error);\n        throw error;\n      }\n    };\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './types';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Attributes, DiagLogger } from '@opentelemetry/api';\nimport {\n  SEMATTRS_DB_SYSTEM,\n  SEMATTRS_DB_CONNECTION_STRING,\n  SEMATTRS_NET_PEER_NAME,\n  SEMATTRS_NET_PEER_PORT,\n  DBSYSTEMVALUES_REDIS,\n} from '@opentelemetry/semantic-conventions';\n\nexport function getClientAttributes(\n  diag: DiagLogger,\n  options: any\n): Attributes {\n  return {\n    [SEMATTRS_DB_SYSTEM]: DBSYSTEMVALUES_REDIS,\n    [SEMATTRS_NET_PEER_NAME]: options?.socket?.host,\n    [SEMATTRS_NET_PEER_PORT]: options?.socket?.port,\n    [SEMATTRS_DB_CONNECTION_STRING]:\n      removeCredentialsFromDBConnectionStringAttribute(diag, options?.url),\n  };\n}\n\n/**\n * removeCredentialsFromDBConnectionStringAttribute removes basic auth from url and user_pwd from query string\n *\n * Examples:\n *   redis://user:pass@localhost:6379/mydb => redis://localhost:6379/mydb\n *   redis://localhost:6379?db=mydb&user_pwd=pass => redis://localhost:6379?db=mydb\n */\nfunction removeCredentialsFromDBConnectionStringAttribute(\n  diag: DiagLogger,\n  url?: unknown\n): string | undefined {\n  if (typeof url !== 'string') {\n    return;\n  }\n\n  try {\n    const u = new URL(url);\n    u.searchParams.delete('user_pwd');\n    u.username = '';\n    u.password = '';\n    return u.href;\n  } catch (err) {\n    diag.error('failed to sanitize redis connection url', err);\n  }\n  return;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.41.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-redis-4';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  trace,\n  context,\n  SpanKind,\n  Span,\n  SpanStatusCode,\n} from '@opentelemetry/api';\nimport {\n  isWrapped,\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  InstrumentationNodeModuleFile,\n} from '@opentelemetry/instrumentation';\nimport { getClientAttributes } from './utils';\nimport { defaultDbStatementSerializer } from '@opentelemetry/redis-common';\nimport { RedisInstrumentationConfig } from './types';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport { SEMATTRS_DB_STATEMENT } from '@opentelemetry/semantic-conventions';\nimport type { MultiErrorReply } from './internal-types';\n\nconst OTEL_OPEN_SPANS = Symbol(\n  'opentelemetry.instrumentation.redis.open_spans'\n);\nconst MULTI_COMMAND_OPTIONS = Symbol(\n  'opentelemetry.instrumentation.redis.multi_command_options'\n);\n\ninterface MutliCommandInfo {\n  span: Span;\n  commandName: string;\n  commandArgs: Array<string | Buffer>;\n}\n\nconst DEFAULT_CONFIG: RedisInstrumentationConfig = {\n  requireParentSpan: false,\n};\n\nexport class RedisInstrumentation extends InstrumentationBase {\n  static readonly COMPONENT = 'redis';\n\n  protected override _config!: RedisInstrumentationConfig;\n\n  constructor(config: RedisInstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  override setConfig(config: RedisInstrumentationConfig = {}) {\n    this._config = Object.assign({}, DEFAULT_CONFIG, config);\n  }\n\n  protected init() {\n    // @node-redis/client is a new package introduced and consumed by 'redis 4.0.x'\n    // on redis@4.1.0 it was changed to @redis/client.\n    // we will instrument both packages\n    return [\n      this._getInstrumentationNodeModuleDefinition('@redis/client'),\n      this._getInstrumentationNodeModuleDefinition('@node-redis/client'),\n    ];\n  }\n\n  private _getInstrumentationNodeModuleDefinition(\n    basePackageName: string\n  ): InstrumentationNodeModuleDefinition {\n    const commanderModuleFile = new InstrumentationNodeModuleFile(\n      `${basePackageName}/dist/lib/commander.js`,\n      ['^1.0.0'],\n      (moduleExports: any, moduleVersion?: string) => {\n        const transformCommandArguments =\n          moduleExports.transformCommandArguments;\n        if (!transformCommandArguments) {\n          this._diag.error(\n            'internal instrumentation error, missing transformCommandArguments function'\n          );\n          return moduleExports;\n        }\n\n        // function name and signature changed in redis 4.1.0 from 'extendWithCommands' to 'attachCommands'\n        // the matching internal package names starts with 1.0.x (for redis 4.0.x)\n        const functionToPatch = moduleVersion?.startsWith('1.0.')\n          ? 'extendWithCommands'\n          : 'attachCommands';\n        // this is the function that extend a redis client with a list of commands.\n        // the function patches the commandExecutor to record a span\n        if (isWrapped(moduleExports?.[functionToPatch])) {\n          this._unwrap(moduleExports, functionToPatch);\n        }\n        this._wrap(\n          moduleExports,\n          functionToPatch,\n          this._getPatchExtendWithCommands(transformCommandArguments)\n        );\n\n        return moduleExports;\n      },\n      (moduleExports: any) => {\n        if (isWrapped(moduleExports?.extendWithCommands)) {\n          this._unwrap(moduleExports, 'extendWithCommands');\n        }\n        if (isWrapped(moduleExports?.attachCommands)) {\n          this._unwrap(moduleExports, 'attachCommands');\n        }\n      }\n    );\n\n    const multiCommanderModule = new InstrumentationNodeModuleFile(\n      `${basePackageName}/dist/lib/client/multi-command.js`,\n      ['^1.0.0'],\n      (moduleExports: any) => {\n        const redisClientMultiCommandPrototype =\n          moduleExports?.default?.prototype;\n\n        if (isWrapped(redisClientMultiCommandPrototype?.exec)) {\n          this._unwrap(redisClientMultiCommandPrototype, 'exec');\n        }\n        this._wrap(\n          redisClientMultiCommandPrototype,\n          'exec',\n          this._getPatchMultiCommandsExec()\n        );\n\n        if (isWrapped(redisClientMultiCommandPrototype?.addCommand)) {\n          this._unwrap(redisClientMultiCommandPrototype, 'addCommand');\n        }\n        this._wrap(\n          redisClientMultiCommandPrototype,\n          'addCommand',\n          this._getPatchMultiCommandsAddCommand()\n        );\n\n        return moduleExports;\n      },\n      (moduleExports: any) => {\n        const redisClientMultiCommandPrototype =\n          moduleExports?.default?.prototype;\n        if (isWrapped(redisClientMultiCommandPrototype?.exec)) {\n          this._unwrap(redisClientMultiCommandPrototype, 'exec');\n        }\n        if (isWrapped(redisClientMultiCommandPrototype?.addCommand)) {\n          this._unwrap(redisClientMultiCommandPrototype, 'addCommand');\n        }\n      }\n    );\n\n    const clientIndexModule = new InstrumentationNodeModuleFile(\n      `${basePackageName}/dist/lib/client/index.js`,\n      ['^1.0.0'],\n      (moduleExports: any) => {\n        const redisClientPrototype = moduleExports?.default?.prototype;\n\n        // In some @redis/client versions 'multi' is a method. In later\n        // versions, as of https://github.com/redis/node-redis/pull/2324,\n        // 'MULTI' is a method and 'multi' is a property defined in the\n        // constructor that points to 'MULTI', and therefore it will not\n        // be defined on the prototype.\n        if (redisClientPrototype?.multi) {\n          if (isWrapped(redisClientPrototype?.multi)) {\n            this._unwrap(redisClientPrototype, 'multi');\n          }\n          this._wrap(\n            redisClientPrototype,\n            'multi',\n            this._getPatchRedisClientMulti()\n          );\n        }\n        if (redisClientPrototype?.MULTI) {\n          if (isWrapped(redisClientPrototype?.MULTI)) {\n            this._unwrap(redisClientPrototype, 'MULTI');\n          }\n          this._wrap(\n            redisClientPrototype,\n            'MULTI',\n            this._getPatchRedisClientMulti()\n          );\n        }\n\n        if (isWrapped(redisClientPrototype?.sendCommand)) {\n          this._unwrap(redisClientPrototype, 'sendCommand');\n        }\n        this._wrap(\n          redisClientPrototype,\n          'sendCommand',\n          this._getPatchRedisClientSendCommand()\n        );\n\n        this._wrap(\n          redisClientPrototype,\n          'connect',\n          this._getPatchedClientConnect()\n        );\n\n        return moduleExports;\n      },\n      (moduleExports: any) => {\n        const redisClientPrototype = moduleExports?.default?.prototype;\n        if (isWrapped(redisClientPrototype?.multi)) {\n          this._unwrap(redisClientPrototype, 'multi');\n        }\n        if (isWrapped(redisClientPrototype?.MULTI)) {\n          this._unwrap(redisClientPrototype, 'MULTI');\n        }\n        if (isWrapped(redisClientPrototype?.sendCommand)) {\n          this._unwrap(redisClientPrototype, 'sendCommand');\n        }\n      }\n    );\n\n    return new InstrumentationNodeModuleDefinition(\n      basePackageName,\n      ['^1.0.0'],\n      (moduleExports: any) => {\n        return moduleExports;\n      },\n      () => {},\n      [commanderModuleFile, multiCommanderModule, clientIndexModule]\n    );\n  }\n\n  // serves both for redis 4.0.x where function name is extendWithCommands\n  // and redis ^4.1.0 where function name is attachCommands\n  private _getPatchExtendWithCommands(transformCommandArguments: Function) {\n    const plugin = this;\n    return function extendWithCommandsPatchWrapper(original: Function) {\n      return function extendWithCommandsPatch(this: any, config: any) {\n        if (config?.BaseClass?.name !== 'RedisClient') {\n          return original.apply(this, arguments);\n        }\n\n        const origExecutor = config.executor;\n        config.executor = function (\n          this: any,\n          command: any,\n          args: Array<string | Buffer>\n        ) {\n          const redisCommandArguments = transformCommandArguments(\n            command,\n            args\n          ).args;\n          return plugin._traceClientCommand(\n            origExecutor,\n            this,\n            arguments,\n            redisCommandArguments\n          );\n        };\n        return original.apply(this, arguments);\n      };\n    };\n  }\n\n  private _getPatchMultiCommandsExec() {\n    const plugin = this;\n    return function execPatchWrapper(original: Function) {\n      return function execPatch(this: any) {\n        const execRes = original.apply(this, arguments);\n        if (typeof execRes?.then !== 'function') {\n          plugin._diag.error(\n            'got non promise result when patching RedisClientMultiCommand.exec'\n          );\n          return execRes;\n        }\n\n        return execRes\n          .then((redisRes: unknown[]) => {\n            const openSpans = this[OTEL_OPEN_SPANS];\n            plugin._endSpansWithRedisReplies(openSpans, redisRes);\n            return redisRes;\n          })\n          .catch((err: Error) => {\n            const openSpans = this[OTEL_OPEN_SPANS];\n            if (!openSpans) {\n              plugin._diag.error(\n                'cannot find open spans to end for redis multi command'\n              );\n            } else {\n              const replies =\n                err.constructor.name === 'MultiErrorReply'\n                  ? (err as MultiErrorReply).replies\n                  : new Array(openSpans.length).fill(err);\n              plugin._endSpansWithRedisReplies(openSpans, replies);\n            }\n            return Promise.reject(err);\n          });\n      };\n    };\n  }\n\n  private _getPatchMultiCommandsAddCommand() {\n    const plugin = this;\n    return function addCommandWrapper(original: Function) {\n      return function addCommandPatch(this: any, args: Array<string | Buffer>) {\n        return plugin._traceClientCommand(original, this, arguments, args);\n      };\n    };\n  }\n\n  private _getPatchRedisClientMulti() {\n    return function multiPatchWrapper(original: Function) {\n      return function multiPatch(this: any) {\n        const multiRes = original.apply(this, arguments);\n        multiRes[MULTI_COMMAND_OPTIONS] = this.options;\n        return multiRes;\n      };\n    };\n  }\n\n  private _getPatchRedisClientSendCommand() {\n    const plugin = this;\n    return function sendCommandWrapper(original: Function) {\n      return function sendCommandPatch(\n        this: any,\n        args: Array<string | Buffer>\n      ) {\n        return plugin._traceClientCommand(original, this, arguments, args);\n      };\n    };\n  }\n\n  private _getPatchedClientConnect() {\n    const plugin = this;\n    return function connectWrapper(original: Function) {\n      return function patchedConnect(this: any): Promise<void> {\n        const options = this.options;\n\n        const attributes = getClientAttributes(this._diag, options);\n\n        const span = plugin.tracer.startSpan(\n          `${RedisInstrumentation.COMPONENT}-connect`,\n          {\n            kind: SpanKind.CLIENT,\n            attributes,\n          }\n        );\n\n        const res = context.with(trace.setSpan(context.active(), span), () => {\n          return original.apply(this);\n        });\n\n        return res\n          .then((result: unknown) => {\n            span.end();\n            return result;\n          })\n          .catch((error: Error) => {\n            span.recordException(error);\n            span.setStatus({\n              code: SpanStatusCode.ERROR,\n              message: error.message,\n            });\n            span.end();\n            return Promise.reject(error);\n          });\n      };\n    };\n  }\n\n  private _traceClientCommand(\n    origFunction: Function,\n    origThis: any,\n    origArguments: IArguments,\n    redisCommandArguments: Array<string | Buffer>\n  ) {\n    const hasNoParentSpan = trace.getSpan(context.active()) === undefined;\n    if (hasNoParentSpan && this._config?.requireParentSpan) {\n      return origFunction.apply(origThis, origArguments);\n    }\n\n    const clientOptions = origThis.options || origThis[MULTI_COMMAND_OPTIONS];\n\n    const commandName = redisCommandArguments[0] as string; // types also allows it to be a Buffer, but in practice it only string\n    const commandArgs = redisCommandArguments.slice(1);\n\n    const dbStatementSerializer =\n      this._config?.dbStatementSerializer || defaultDbStatementSerializer;\n\n    const attributes = getClientAttributes(this._diag, clientOptions);\n\n    try {\n      const dbStatement = dbStatementSerializer(commandName, commandArgs);\n      if (dbStatement != null) {\n        attributes[SEMATTRS_DB_STATEMENT] = dbStatement;\n      }\n    } catch (e) {\n      this._diag.error('dbStatementSerializer throw an exception', e, {\n        commandName,\n      });\n    }\n\n    const span = this.tracer.startSpan(\n      `${RedisInstrumentation.COMPONENT}-${commandName}`,\n      {\n        kind: SpanKind.CLIENT,\n        attributes,\n      }\n    );\n\n    const res = context.with(trace.setSpan(context.active(), span), () => {\n      return origFunction.apply(origThis, origArguments);\n    });\n    if (typeof res?.then === 'function') {\n      res.then(\n        (redisRes: unknown) => {\n          this._endSpanWithResponse(\n            span,\n            commandName,\n            commandArgs,\n            redisRes,\n            undefined\n          );\n        },\n        (err: any) => {\n          this._endSpanWithResponse(span, commandName, commandArgs, null, err);\n        }\n      );\n    } else {\n      const redisClientMultiCommand = res as {\n        [OTEL_OPEN_SPANS]?: Array<MutliCommandInfo>;\n      };\n      redisClientMultiCommand[OTEL_OPEN_SPANS] =\n        redisClientMultiCommand[OTEL_OPEN_SPANS] || [];\n      redisClientMultiCommand[OTEL_OPEN_SPANS]!.push({\n        span,\n        commandName,\n        commandArgs,\n      });\n    }\n    return res;\n  }\n\n  private _endSpansWithRedisReplies(\n    openSpans: Array<MutliCommandInfo>,\n    replies: unknown[]\n  ) {\n    if (!openSpans) {\n      return this._diag.error(\n        'cannot find open spans to end for redis multi command'\n      );\n    }\n    if (replies.length !== openSpans.length) {\n      return this._diag.error(\n        'number of multi command spans does not match response from redis'\n      );\n    }\n    for (let i = 0; i < openSpans.length; i++) {\n      const { span, commandName, commandArgs } = openSpans[i];\n      const currCommandRes = replies[i];\n      const [res, err] =\n        currCommandRes instanceof Error\n          ? [null, currCommandRes]\n          : [currCommandRes, undefined];\n      this._endSpanWithResponse(span, commandName, commandArgs, res, err);\n    }\n  }\n\n  private _endSpanWithResponse(\n    span: Span,\n    commandName: string,\n    commandArgs: Array<string | Buffer>,\n    response: unknown,\n    error: Error | undefined\n  ) {\n    if (!error && this._config.responseHook) {\n      try {\n        this._config.responseHook(span, commandName, commandArgs, response);\n      } catch (err) {\n        this._diag.error('responseHook throw an exception', err);\n      }\n    }\n    if (error) {\n      span.recordException(error);\n      span.setStatus({ code: SpanStatusCode.ERROR, message: error?.message });\n    }\n    span.end();\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './types';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.39.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-nestjs-core';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum AttributeNames {\n  VERSION = 'nestjs.version',\n  TYPE = 'nestjs.type',\n  MODULE = 'nestjs.module',\n  CONTROLLER = 'nestjs.controller',\n  CALLBACK = 'nestjs.callback',\n  PIPES = 'nestjs.pipes',\n  INTERCEPTORS = 'nestjs.interceptors',\n  GUARDS = 'nestjs.guards',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum NestType {\n  APP_CREATION = 'app_creation',\n  REQUEST_CONTEXT = 'request_context',\n  REQUEST_HANDLER = 'handler',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport { AttributeNames } from './AttributeNames';\nexport { NestType } from './NestType';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as api from '@opentelemetry/api';\nimport {\n  InstrumentationBase,\n  InstrumentationConfig,\n  InstrumentationNodeModuleDefinition,\n  InstrumentationNodeModuleFile,\n  isWrapped,\n} from '@opentelemetry/instrumentation';\nimport type { NestFactory } from '@nestjs/core/nest-factory.js';\nimport type { RouterExecutionContext } from '@nestjs/core/router/router-execution-context.js';\nimport type { Controller } from '@nestjs/common/interfaces';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport {\n  SEMATTRS_HTTP_METHOD,\n  SEMATTRS_HTTP_ROUTE,\n  SEMATTRS_HTTP_URL,\n} from '@opentelemetry/semantic-conventions';\nimport { AttributeNames, NestType } from './enums';\n\nconst supportedVersions = ['>=4.0.0 <11'];\n\nexport class NestInstrumentation extends InstrumentationBase {\n  static readonly COMPONENT = '@nestjs/core';\n  static readonly COMMON_ATTRIBUTES = {\n    component: NestInstrumentation.COMPONENT,\n  };\n\n  constructor(config: InstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  init() {\n    const module = new InstrumentationNodeModuleDefinition(\n      NestInstrumentation.COMPONENT,\n      supportedVersions\n    );\n\n    module.files.push(\n      this.getNestFactoryFileInstrumentation(supportedVersions),\n      this.getRouterExecutionContextFileInstrumentation(supportedVersions)\n    );\n\n    return module;\n  }\n\n  getNestFactoryFileInstrumentation(versions: string[]) {\n    return new InstrumentationNodeModuleFile(\n      '@nestjs/core/nest-factory.js',\n      versions,\n      (NestFactoryStatic: any, moduleVersion?: string) => {\n        this.ensureWrapped(\n          NestFactoryStatic.NestFactoryStatic.prototype,\n          'create',\n          createWrapNestFactoryCreate(this.tracer, moduleVersion)\n        );\n        return NestFactoryStatic;\n      },\n      (NestFactoryStatic: any) => {\n        this._unwrap(NestFactoryStatic.NestFactoryStatic.prototype, 'create');\n      }\n    );\n  }\n\n  getRouterExecutionContextFileInstrumentation(versions: string[]) {\n    return new InstrumentationNodeModuleFile(\n      '@nestjs/core/router/router-execution-context.js',\n      versions,\n      (RouterExecutionContext: any, moduleVersion?: string) => {\n        this.ensureWrapped(\n          RouterExecutionContext.RouterExecutionContext.prototype,\n          'create',\n          createWrapCreateHandler(this.tracer, moduleVersion)\n        );\n        return RouterExecutionContext;\n      },\n      (RouterExecutionContext: any) => {\n        this._unwrap(\n          RouterExecutionContext.RouterExecutionContext.prototype,\n          'create'\n        );\n      }\n    );\n  }\n\n  private ensureWrapped(\n    obj: any,\n    methodName: string,\n    wrapper: (original: any) => any\n  ) {\n    if (isWrapped(obj[methodName])) {\n      this._unwrap(obj, methodName);\n    }\n    this._wrap(obj, methodName, wrapper);\n  }\n}\n\nfunction createWrapNestFactoryCreate(\n  tracer: api.Tracer,\n  moduleVersion?: string\n) {\n  return function wrapCreate(original: typeof NestFactory.create) {\n    return function createWithTrace(\n      this: typeof NestFactory,\n      nestModule: any\n      /* serverOrOptions */\n    ) {\n      const span = tracer.startSpan('Create Nest App', {\n        attributes: {\n          ...NestInstrumentation.COMMON_ATTRIBUTES,\n          [AttributeNames.TYPE]: NestType.APP_CREATION,\n          [AttributeNames.VERSION]: moduleVersion,\n          [AttributeNames.MODULE]: nestModule.name,\n        },\n      });\n      const spanContext = api.trace.setSpan(api.context.active(), span);\n\n      return api.context.with(spanContext, async () => {\n        try {\n          return await original.apply(this, arguments as any);\n        } catch (e: any) {\n          throw addError(span, e);\n        } finally {\n          span.end();\n        }\n      });\n    };\n  };\n}\n\nfunction createWrapCreateHandler(tracer: api.Tracer, moduleVersion?: string) {\n  return function wrapCreateHandler(\n    original: RouterExecutionContext['create']\n  ) {\n    return function createHandlerWithTrace(\n      this: RouterExecutionContext,\n      instance: Controller,\n      callback: (...args: any[]) => unknown\n    ) {\n      arguments[1] = createWrapHandler(tracer, moduleVersion, callback);\n      const handler = original.apply(this, arguments as any);\n      const callbackName = callback.name;\n      const instanceName =\n        instance.constructor && instance.constructor.name\n          ? instance.constructor.name\n          : 'UnnamedInstance';\n      const spanName = callbackName\n        ? `${instanceName}.${callbackName}`\n        : instanceName;\n\n      return function (\n        this: any,\n        req: any,\n        res: any,\n        next: (...args: any[]) => unknown\n      ) {\n        const span = tracer.startSpan(spanName, {\n          attributes: {\n            ...NestInstrumentation.COMMON_ATTRIBUTES,\n            [AttributeNames.VERSION]: moduleVersion,\n            [AttributeNames.TYPE]: NestType.REQUEST_CONTEXT,\n            [SEMATTRS_HTTP_METHOD]: req.method,\n            [SEMATTRS_HTTP_URL]: req.originalUrl || req.url,\n            [SEMATTRS_HTTP_ROUTE]:\n              req.route?.path || req.routeOptions?.url || req.routerPath,\n            [AttributeNames.CONTROLLER]: instanceName,\n            [AttributeNames.CALLBACK]: callbackName,\n          },\n        });\n        const spanContext = api.trace.setSpan(api.context.active(), span);\n\n        return api.context.with(spanContext, async () => {\n          try {\n            return await handler.apply(this, arguments as any);\n          } catch (e: any) {\n            throw addError(span, e);\n          } finally {\n            span.end();\n          }\n        });\n      };\n    };\n  };\n}\n\nfunction createWrapHandler(\n  tracer: api.Tracer,\n  moduleVersion: string | undefined,\n  handler: Function\n) {\n  const spanName = handler.name || 'anonymous nest handler';\n  const options = {\n    attributes: {\n      ...NestInstrumentation.COMMON_ATTRIBUTES,\n      [AttributeNames.VERSION]: moduleVersion,\n      [AttributeNames.TYPE]: NestType.REQUEST_HANDLER,\n      [AttributeNames.CALLBACK]: handler.name,\n    },\n  };\n  const wrappedHandler = function (this: RouterExecutionContext) {\n    const span = tracer.startSpan(spanName, options);\n    const spanContext = api.trace.setSpan(api.context.active(), span);\n\n    return api.context.with(spanContext, async () => {\n      try {\n        return await handler.apply(this, arguments);\n      } catch (e: any) {\n        throw addError(span, e);\n      } finally {\n        span.end();\n      }\n    });\n  };\n\n  if (handler.name) {\n    Object.defineProperty(wrappedHandler, 'name', { value: handler.name });\n  }\n\n  // Get the current metadata and set onto the wrapper to ensure other decorators ( ie: NestJS EventPattern / RolesGuard )\n  // won't be affected by the use of this instrumentation\n  Reflect.getMetadataKeys(handler).forEach(metadataKey => {\n    Reflect.defineMetadata(\n      metadataKey,\n      Reflect.getMetadata(metadataKey, handler),\n      wrappedHandler\n    );\n  });\n  return wrappedHandler;\n}\n\nconst addError = (span: api.Span, error: Error) => {\n  span.recordException(error);\n  span.setStatus({ code: api.SpanStatusCode.ERROR, message: error.message });\n  return error;\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './enums/AttributeNames';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Postgresql specific attributes not covered by semantic conventions\nexport enum AttributeNames {\n  PG_VALUES = 'db.postgresql.values',\n  PG_PLAN = 'db.postgresql.plan',\n  IDLE_TIMEOUT_MILLIS = 'db.postgresql.idle.timeout.millis',\n  MAX_CLIENT = 'db.postgresql.max.client',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Contains span names produced by instrumentation\nexport enum SpanNames {\n  QUERY_PREFIX = 'pg.query',\n  CONNECT = 'pg.connect',\n  POOL_CONNECT = 'pg-pool.connect',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  context,\n  trace,\n  Span,\n  SpanStatusCode,\n  Tracer,\n  SpanKind,\n  diag,\n} from '@opentelemetry/api';\nimport { AttributeNames } from './enums/AttributeNames';\nimport {\n  SEMATTRS_DB_SYSTEM,\n  SEMATTRS_DB_NAME,\n  SEMATTRS_DB_CONNECTION_STRING,\n  SEMATTRS_NET_PEER_NAME,\n  SEMATTRS_NET_PEER_PORT,\n  SEMATTRS_DB_USER,\n  SEMATTRS_DB_STATEMENT,\n  DBSYSTEMVALUES_POSTGRESQL,\n} from '@opentelemetry/semantic-conventions';\nimport {\n  PgClientExtended,\n  PostgresCallback,\n  PgPoolCallback,\n  PgPoolExtended,\n  PgParsedConnectionParams,\n  PgPoolOptionsParams,\n} from './internal-types';\nimport { PgInstrumentationConfig } from './types';\nimport type * as pgTypes from 'pg';\nimport { safeExecuteInTheMiddle } from '@opentelemetry/instrumentation';\nimport { SpanNames } from './enums/SpanNames';\n\n/**\n * Helper function to get a low cardinality span name from whatever info we have\n * about the query.\n *\n * This is tricky, because we don't have most of the information (table name,\n * operation name, etc) the spec recommends using to build a low-cardinality\n * value w/o parsing. So, we use db.name and assume that, if the query's a named\n * prepared statement, those `name` values will be low cardinality. If we don't\n * have a named prepared statement, we try to parse an operation (despite the\n * spec's warnings).\n *\n * @params dbName The name of the db against which this query is being issued,\n *   which could be missing if no db name was given at the time that the\n *   connection was established.\n * @params queryConfig Information we have about the query being issued, typed\n *   to reflect only the validation we've actually done on the args to\n *   `client.query()`. This will be undefined if `client.query()` was called\n *   with invalid arguments.\n */\nexport function getQuerySpanName(\n  dbName: string | undefined,\n  queryConfig?: { text: string; name?: unknown }\n) {\n  // NB: when the query config is invalid, we omit the dbName too, so that\n  // someone (or some tool) reading the span name doesn't misinterpret the\n  // dbName as being a prepared statement or sql commit name.\n  if (!queryConfig) return SpanNames.QUERY_PREFIX;\n\n  // Either the name of a prepared statement; or an attempted parse\n  // of the SQL command, normalized to uppercase; or unknown.\n  const command =\n    typeof queryConfig.name === 'string' && queryConfig.name\n      ? queryConfig.name\n      : parseNormalizedOperationName(queryConfig.text);\n\n  return `${SpanNames.QUERY_PREFIX}:${command}${dbName ? ` ${dbName}` : ''}`;\n}\n\nfunction parseNormalizedOperationName(queryText: string) {\n  const indexOfFirstSpace = queryText.indexOf(' ');\n  let sqlCommand =\n    indexOfFirstSpace === -1\n      ? queryText\n      : queryText.slice(0, indexOfFirstSpace);\n  sqlCommand = sqlCommand.toUpperCase();\n\n  // Handle query text being \"COMMIT;\", which has an extra semicolon before the space.\n  return sqlCommand.endsWith(';') ? sqlCommand.slice(0, -1) : sqlCommand;\n}\n\nexport function getConnectionString(params: PgParsedConnectionParams) {\n  const host = params.host || 'localhost';\n  const port = params.port || 5432;\n  const database = params.database || '';\n  return `postgresql://${host}:${port}/${database}`;\n}\n\nfunction getPort(port: number | undefined): number | undefined {\n  // Port may be NaN as parseInt() is used on the value, passing null will result in NaN being parsed.\n  // https://github.com/brianc/node-postgres/blob/2a8efbee09a284be12748ed3962bc9b816965e36/packages/pg/lib/connection-parameters.js#L66\n  if (Number.isInteger(port)) {\n    return port;\n  }\n\n  // Unable to find the default used in pg code, so falling back to 'undefined'.\n  return undefined;\n}\n\nexport function getSemanticAttributesFromConnection(\n  params: PgParsedConnectionParams\n) {\n  return {\n    [SEMATTRS_DB_SYSTEM]: DBSYSTEMVALUES_POSTGRESQL,\n    [SEMATTRS_DB_NAME]: params.database, // required\n    [SEMATTRS_DB_CONNECTION_STRING]: getConnectionString(params), // required\n    [SEMATTRS_NET_PEER_NAME]: params.host, // required\n    [SEMATTRS_NET_PEER_PORT]: getPort(params.port),\n    [SEMATTRS_DB_USER]: params.user,\n  };\n}\n\nexport function getSemanticAttributesFromPool(params: PgPoolOptionsParams) {\n  return {\n    [SEMATTRS_DB_SYSTEM]: DBSYSTEMVALUES_POSTGRESQL,\n    [SEMATTRS_DB_NAME]: params.database, // required\n    [SEMATTRS_DB_CONNECTION_STRING]: getConnectionString(params), // required\n    [SEMATTRS_NET_PEER_NAME]: params.host, // required\n    [SEMATTRS_NET_PEER_PORT]: getPort(params.port),\n    [SEMATTRS_DB_USER]: params.user,\n    [AttributeNames.IDLE_TIMEOUT_MILLIS]: params.idleTimeoutMillis,\n    [AttributeNames.MAX_CLIENT]: params.maxClient,\n  };\n}\n\nexport function shouldSkipInstrumentation(\n  instrumentationConfig: PgInstrumentationConfig\n) {\n  return (\n    instrumentationConfig.requireParentSpan === true &&\n    trace.getSpan(context.active()) === undefined\n  );\n}\n\n// Create a span from our normalized queryConfig object,\n// or return a basic span if no queryConfig was given/could be created.\nexport function handleConfigQuery(\n  this: PgClientExtended,\n  tracer: Tracer,\n  instrumentationConfig: PgInstrumentationConfig,\n  queryConfig?: { text: string; values?: unknown; name?: unknown }\n) {\n  // Create child span.\n  const { connectionParameters } = this;\n  const dbName = connectionParameters.database;\n\n  const spanName = getQuerySpanName(dbName, queryConfig);\n  const span = tracer.startSpan(spanName, {\n    kind: SpanKind.CLIENT,\n    attributes: getSemanticAttributesFromConnection(connectionParameters),\n  });\n\n  if (!queryConfig) {\n    return span;\n  }\n\n  // Set attributes\n  if (queryConfig.text) {\n    span.setAttribute(SEMATTRS_DB_STATEMENT, queryConfig.text);\n  }\n\n  if (\n    instrumentationConfig.enhancedDatabaseReporting &&\n    Array.isArray(queryConfig.values)\n  ) {\n    try {\n      const convertedValues = queryConfig.values.map(value => {\n        if (value == null) {\n          return 'null';\n        } else if (value instanceof Buffer) {\n          return value.toString();\n        } else if (typeof value === 'object') {\n          if (typeof value.toPostgres === 'function') {\n            return value.toPostgres();\n          }\n          return JSON.stringify(value);\n        } else {\n          //string, number\n          return value.toString();\n        }\n      });\n      span.setAttribute(AttributeNames.PG_VALUES, convertedValues);\n    } catch (e) {\n      diag.error('failed to stringify ', queryConfig.values, e);\n    }\n  }\n\n  // Set plan name attribute, if present\n  if (typeof queryConfig.name === 'string') {\n    span.setAttribute(AttributeNames.PG_PLAN, queryConfig.name);\n  }\n\n  return span;\n}\n\nexport function handleExecutionResult(\n  config: PgInstrumentationConfig,\n  span: Span,\n  pgResult: pgTypes.QueryResult | pgTypes.QueryArrayResult | unknown\n) {\n  if (typeof config.responseHook === 'function') {\n    safeExecuteInTheMiddle(\n      () => {\n        config.responseHook!(span, {\n          data: pgResult as pgTypes.QueryResult | pgTypes.QueryArrayResult,\n        });\n      },\n      err => {\n        if (err) {\n          diag.error('Error running response hook', err);\n        }\n      },\n      true\n    );\n  }\n}\n\nexport function patchCallback(\n  instrumentationConfig: PgInstrumentationConfig,\n  span: Span,\n  cb: PostgresCallback\n): PostgresCallback {\n  return function patchedCallback(\n    this: PgClientExtended,\n    err: Error,\n    res: object\n  ) {\n    if (err) {\n      // span.recordException(err);\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: err.message,\n      });\n    } else {\n      handleExecutionResult(instrumentationConfig, span, res);\n    }\n\n    span.end();\n    cb.call(this, err, res);\n  };\n}\n\nexport function patchCallbackPGPool(\n  span: Span,\n  cb: PgPoolCallback\n): PgPoolCallback {\n  return function patchedCallback(\n    this: PgPoolExtended,\n    err: Error,\n    res: object,\n    done: any\n  ) {\n    if (err) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: err.message,\n      });\n    }\n    span.end();\n    cb.call(this, err, res, done);\n  };\n}\n\nexport function patchClientConnectCallback(span: Span, cb: Function): Function {\n  return function patchedClientConnectCallback(\n    this: pgTypes.Client,\n    err: Error\n  ) {\n    if (err) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: err.message,\n      });\n    }\n    span.end();\n    cb.apply(this, arguments);\n  };\n}\n\n/**\n * Attempt to get a message string from a thrown value, while being quite\n * defensive, to recognize the fact that, in JS, any kind of value (even\n * primitives) can be thrown.\n */\nexport function getErrorMessage(e: unknown) {\n  return typeof e === 'object' && e !== null && 'message' in e\n    ? String((e as { message?: unknown }).message)\n    : undefined;\n}\n\nexport function isObjectWithTextString(it: unknown): it is ObjectWithText {\n  return (\n    typeof it === 'object' &&\n    typeof (it as null | { text?: unknown })?.text === 'string'\n  );\n}\n\nexport type ObjectWithText = {\n  text: string;\n  [k: string]: unknown;\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.43.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-pg';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  isWrapped,\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\n\nimport {\n  context,\n  trace,\n  Span,\n  SpanStatusCode,\n  SpanKind,\n} from '@opentelemetry/api';\nimport type * as pgTypes from 'pg';\nimport type * as pgPoolTypes from 'pg-pool';\nimport {\n  PgClientConnect,\n  PgClientExtended,\n  PostgresCallback,\n  PgPoolExtended,\n  PgPoolCallback,\n} from './internal-types';\nimport { PgInstrumentationConfig } from './types';\nimport * as utils from './utils';\nimport { addSqlCommenterComment } from '@opentelemetry/sql-common';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport { SpanNames } from './enums/SpanNames';\n\nexport class PgInstrumentation extends InstrumentationBase {\n  constructor(config: PgInstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  protected init() {\n    const modulePG = new InstrumentationNodeModuleDefinition(\n      'pg',\n      ['>=8.0.0 <9'],\n      (module: any) => {\n        const moduleExports: typeof pgTypes =\n          module[Symbol.toStringTag] === 'Module'\n            ? module.default // ESM\n            : module; // CommonJS\n        if (isWrapped(moduleExports.Client.prototype.query)) {\n          this._unwrap(moduleExports.Client.prototype, 'query');\n        }\n\n        if (isWrapped(moduleExports.Client.prototype.connect)) {\n          this._unwrap(moduleExports.Client.prototype, 'connect');\n        }\n\n        this._wrap(\n          moduleExports.Client.prototype,\n          'query',\n          this._getClientQueryPatch() as any\n        );\n\n        this._wrap(\n          moduleExports.Client.prototype,\n          'connect',\n          this._getClientConnectPatch() as any\n        );\n\n        return module;\n      },\n      (module: any) => {\n        const moduleExports: typeof pgTypes =\n          module[Symbol.toStringTag] === 'Module'\n            ? module.default // ESM\n            : module; // CommonJS\n        if (isWrapped(moduleExports.Client.prototype.query)) {\n          this._unwrap(moduleExports.Client.prototype, 'query');\n        }\n      }\n    );\n\n    const modulePGPool = new InstrumentationNodeModuleDefinition(\n      'pg-pool',\n      ['>=2.0.0 <4'],\n      (moduleExports: typeof pgPoolTypes) => {\n        if (isWrapped(moduleExports.prototype.connect)) {\n          this._unwrap(moduleExports.prototype, 'connect');\n        }\n        this._wrap(\n          moduleExports.prototype,\n          'connect',\n          this._getPoolConnectPatch() as any\n        );\n        return moduleExports;\n      },\n      (moduleExports: typeof pgPoolTypes) => {\n        if (isWrapped(moduleExports.prototype.connect)) {\n          this._unwrap(moduleExports.prototype, 'connect');\n        }\n      }\n    );\n\n    return [modulePG, modulePGPool];\n  }\n\n  override setConfig(config: PgInstrumentationConfig = {}) {\n    this._config = Object.assign({}, config);\n  }\n\n  override getConfig(): PgInstrumentationConfig {\n    return this._config as PgInstrumentationConfig;\n  }\n\n  private _getClientConnectPatch() {\n    const plugin = this;\n    return (original: PgClientConnect) => {\n      return function connect(this: pgTypes.Client, callback?: Function) {\n        if (utils.shouldSkipInstrumentation(plugin.getConfig())) {\n          return original.call(this, callback);\n        }\n\n        const span = plugin.tracer.startSpan(SpanNames.CONNECT, {\n          kind: SpanKind.CLIENT,\n          attributes: utils.getSemanticAttributesFromConnection(this),\n        });\n\n        if (callback) {\n          const parentSpan = trace.getSpan(context.active());\n          callback = utils.patchClientConnectCallback(span, callback);\n          if (parentSpan) {\n            callback = context.bind(context.active(), callback);\n          }\n        }\n\n        const connectResult: unknown = context.with(\n          trace.setSpan(context.active(), span),\n          () => {\n            return original.call(this, callback);\n          }\n        );\n\n        return handleConnectResult(span, connectResult);\n      };\n    };\n  }\n\n  private _getClientQueryPatch() {\n    const plugin = this;\n    return (original: typeof pgTypes.Client.prototype.query) => {\n      this._diag.debug('Patching pg.Client.prototype.query');\n      return function query(this: PgClientExtended, ...args: unknown[]) {\n        if (utils.shouldSkipInstrumentation(plugin.getConfig())) {\n          return original.apply(this, args as never);\n        }\n\n        // client.query(text, cb?), client.query(text, values, cb?), and\n        // client.query(configObj, cb?) are all valid signatures. We construct\n        // a queryConfig obj from all (valid) signatures to build the span in a\n        // unified way. We verify that we at least have query text, and code\n        // defensively when dealing with `queryConfig` after that (to handle all\n        // the other invalid cases, like a non-array for values being provided).\n        // The type casts here reflect only what we've actually validated.\n        const arg0 = args[0];\n        const firstArgIsString = typeof arg0 === 'string';\n        const firstArgIsQueryObjectWithText =\n          utils.isObjectWithTextString(arg0);\n\n        // TODO: remove the `as ...` casts below when the TS version is upgraded.\n        // Newer TS versions will use the result of firstArgIsQueryObjectWithText\n        // to properly narrow arg0, but TS 4.3.5 does not.\n        const queryConfig = firstArgIsString\n          ? {\n              text: arg0 as string,\n              values: Array.isArray(args[1]) ? args[1] : undefined,\n            }\n          : firstArgIsQueryObjectWithText\n          ? (arg0 as utils.ObjectWithText)\n          : undefined;\n\n        const instrumentationConfig = plugin.getConfig();\n\n        const span = utils.handleConfigQuery.call(\n          this,\n          plugin.tracer,\n          instrumentationConfig,\n          queryConfig\n        );\n\n        // Modify query text w/ a tracing comment before invoking original for\n        // tracing, but only if args[0] has one of our expected shapes.\n        if (instrumentationConfig.addSqlCommenterCommentToQueries) {\n          args[0] = firstArgIsString\n            ? addSqlCommenterComment(span, arg0)\n            : firstArgIsQueryObjectWithText\n            ? {\n                ...arg0,\n                text: addSqlCommenterComment(span, arg0.text),\n              }\n            : args[0];\n        }\n\n        // Bind callback (if any) to parent span (if any)\n        if (args.length > 0) {\n          const parentSpan = trace.getSpan(context.active());\n          if (typeof args[args.length - 1] === 'function') {\n            // Patch ParameterQuery callback\n            args[args.length - 1] = utils.patchCallback(\n              instrumentationConfig,\n              span,\n              args[args.length - 1] as PostgresCallback // nb: not type safe.\n            );\n\n            // If a parent span exists, bind the callback\n            if (parentSpan) {\n              args[args.length - 1] = context.bind(\n                context.active(),\n                args[args.length - 1]\n              );\n            }\n          } else if (typeof queryConfig?.callback === 'function') {\n            // Patch ConfigQuery callback\n            let callback = utils.patchCallback(\n              plugin.getConfig(),\n              span,\n              queryConfig.callback as PostgresCallback // nb: not type safe.\n            );\n\n            // If a parent span existed, bind the callback\n            if (parentSpan) {\n              callback = context.bind(context.active(), callback);\n            }\n\n            (args[0] as { callback?: PostgresCallback }).callback = callback;\n          }\n        }\n\n        if (\n          typeof instrumentationConfig.requestHook === 'function' &&\n          queryConfig\n        ) {\n          safeExecuteInTheMiddle(\n            () => {\n              // pick keys to expose explicitly, so we're not leaking pg package\n              // internals that are subject to change\n              const { database, host, port, user } = this.connectionParameters;\n              const connection = { database, host, port, user };\n\n              instrumentationConfig.requestHook!(span, {\n                connection,\n                query: {\n                  text: queryConfig.text,\n                  // nb: if `client.query` is called with illegal arguments\n                  // (e.g., if `queryConfig.values` is passed explicitly, but a\n                  // non-array is given), then the type casts will be wrong. But\n                  // we leave it up to the queryHook to handle that, and we\n                  // catch and swallow any errors it throws. The other options\n                  // are all worse. E.g., we could leave `queryConfig.values`\n                  // and `queryConfig.name` as `unknown`, but then the hook body\n                  // would be forced to validate (or cast) them before using\n                  // them, which seems incredibly cumbersome given that these\n                  // casts will be correct 99.9% of the time -- and pg.query\n                  // will immediately throw during development in the other .1%\n                  // of cases. Alternatively, we could simply skip calling the\n                  // hook when `values` or `name` don't have the expected type,\n                  // but that would add unnecessary validation overhead to every\n                  // hook invocation and possibly be even more confusing/unexpected.\n                  values: queryConfig.values as unknown[],\n                  name: queryConfig.name as string | undefined,\n                },\n              });\n            },\n            err => {\n              if (err) {\n                plugin._diag.error('Error running query hook', err);\n              }\n            },\n            true\n          );\n        }\n\n        let result: unknown;\n        try {\n          result = original.apply(this, args as never);\n        } catch (e: unknown) {\n          // span.recordException(e);\n          span.setStatus({\n            code: SpanStatusCode.ERROR,\n            message: utils.getErrorMessage(e),\n          });\n          span.end();\n          throw e;\n        }\n\n        // Bind promise to parent span and end the span\n        if (result instanceof Promise) {\n          return result\n            .then((result: unknown) => {\n              // Return a pass-along promise which ends the span and then goes to user's orig resolvers\n              return new Promise(resolve => {\n                utils.handleExecutionResult(plugin.getConfig(), span, result);\n                span.end();\n                resolve(result);\n              });\n            })\n            .catch((error: Error) => {\n              return new Promise((_, reject) => {\n                span.setStatus({\n                  code: SpanStatusCode.ERROR,\n                  message: error.message,\n                });\n                span.end();\n                reject(error);\n              });\n            });\n        }\n\n        // else returns void\n        return result; // void\n      };\n    };\n  }\n\n  private _getPoolConnectPatch() {\n    const plugin = this;\n    return (originalConnect: typeof pgPoolTypes.prototype.connect) => {\n      return function connect(this: PgPoolExtended, callback?: PgPoolCallback) {\n        if (utils.shouldSkipInstrumentation(plugin.getConfig())) {\n          return originalConnect.call(this, callback as any);\n        }\n\n        // setup span\n        const span = plugin.tracer.startSpan(SpanNames.POOL_CONNECT, {\n          kind: SpanKind.CLIENT,\n          attributes: utils.getSemanticAttributesFromPool(this.options),\n        });\n\n        if (callback) {\n          const parentSpan = trace.getSpan(context.active());\n          callback = utils.patchCallbackPGPool(\n            span,\n            callback\n          ) as PgPoolCallback;\n          // If a parent span exists, bind the callback\n          if (parentSpan) {\n            callback = context.bind(context.active(), callback);\n          }\n        }\n\n        const connectResult: unknown = context.with(\n          trace.setSpan(context.active(), span),\n          () => {\n            return originalConnect.call(this, callback as any);\n          }\n        );\n\n        return handleConnectResult(span, connectResult);\n      };\n    };\n  }\n}\n\nfunction handleConnectResult(span: Span, connectResult: unknown) {\n  if (!(connectResult instanceof Promise)) {\n    return connectResult;\n  }\n\n  const connectResultPromise = connectResult as Promise<unknown>;\n  return context.bind(\n    context.active(),\n    connectResultPromise\n      .then(result => {\n        span.end();\n        return result;\n      })\n      .catch((error: unknown) => {\n        span.setStatus({\n          code: SpanStatusCode.ERROR,\n          message: utils.getErrorMessage(error),\n        });\n        span.end();\n        return Promise.reject(error);\n      })\n  );\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './types';\nexport * from './enums/AttributeNames';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.40.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-hapi';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type * as Hapi from '@hapi/hapi';\n\nexport const HapiComponentName = '@hapi/hapi';\n\n/**\n * This symbol is used to mark a Hapi route handler or server extension handler as\n * already patched, since its possible to use these handlers multiple times\n * i.e. when allowing multiple versions of one plugin, or when registering a plugin\n * multiple times on different servers.\n */\nexport const handlerPatched: unique symbol = Symbol('hapi-handler-patched');\n\nexport type HapiServerRouteInputMethod = (route: HapiServerRouteInput) => void;\n\nexport type HapiServerRouteInput =\n  | PatchableServerRoute\n  | PatchableServerRoute[];\n\nexport type PatchableServerRoute = Hapi.ServerRoute<any> & {\n  [handlerPatched]?: boolean;\n};\n\nexport type HapiPluginObject<T> = Hapi.ServerRegisterPluginObject<T>;\n\nexport type HapiPluginInput<T> =\n  | HapiPluginObject<T>\n  | Array<HapiPluginObject<T>>;\n\nexport type RegisterFunction<T> = (\n  plugin: HapiPluginInput<T>,\n  options?: Hapi.ServerRegisterOptions\n) => Promise<void>;\n\nexport type PatchableExtMethod = Hapi.Lifecycle.Method & {\n  [handlerPatched]?: boolean;\n};\n\nexport type ServerExtDirectInput = [\n  Hapi.ServerRequestExtType,\n  Hapi.Lifecycle.Method,\n  (Hapi.ServerExtOptions | undefined)?\n];\n\nexport const HapiLayerType = {\n  ROUTER: 'router',\n  PLUGIN: 'plugin',\n  EXT: 'server.ext',\n};\n\nexport const HapiLifecycleMethodNames = new Set([\n  'onPreAuth',\n  'onCredentials',\n  'onPostAuth',\n  'onPreHandler',\n  'onPostHandler',\n  'onPreResponse',\n  'onRequest',\n]);\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport enum AttributeNames {\n  HAPI_TYPE = 'hapi.type',\n  PLUGIN_NAME = 'hapi.plugin.name',\n  EXT_TYPE = 'server.ext.type',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SpanAttributes } from '@opentelemetry/api';\nimport {\n  SEMATTRS_HTTP_METHOD,\n  SEMATTRS_HTTP_ROUTE,\n} from '@opentelemetry/semantic-conventions';\nimport type * as Hapi from '@hapi/hapi';\nimport {\n  HapiLayerType,\n  HapiLifecycleMethodNames,\n  HapiPluginObject,\n  PatchableExtMethod,\n  ServerExtDirectInput,\n} from './internal-types';\nimport { AttributeNames } from './enums/AttributeNames';\n\nexport function getPluginName<T>(plugin: Hapi.Plugin<T>): string {\n  if ((plugin as Hapi.PluginNameVersion).name) {\n    return (plugin as Hapi.PluginNameVersion).name;\n  } else {\n    return (plugin as Hapi.PluginPackage).pkg.name;\n  }\n}\n\nexport const isLifecycleExtType = (\n  variableToCheck: unknown\n): variableToCheck is Hapi.ServerRequestExtType => {\n  return (\n    typeof variableToCheck === 'string' &&\n    HapiLifecycleMethodNames.has(variableToCheck)\n  );\n};\n\nexport const isLifecycleExtEventObj = (\n  variableToCheck: unknown\n): variableToCheck is Hapi.ServerExtEventsRequestObject => {\n  const event = (variableToCheck as Hapi.ServerExtEventsRequestObject)?.type;\n  return event !== undefined && isLifecycleExtType(event);\n};\n\nexport const isDirectExtInput = (\n  variableToCheck: unknown\n): variableToCheck is ServerExtDirectInput => {\n  return (\n    Array.isArray(variableToCheck) &&\n    variableToCheck.length <= 3 &&\n    isLifecycleExtType(variableToCheck[0]) &&\n    typeof variableToCheck[1] === 'function'\n  );\n};\n\nexport const isPatchableExtMethod = (\n  variableToCheck: PatchableExtMethod | PatchableExtMethod[]\n): variableToCheck is PatchableExtMethod => {\n  return !Array.isArray(variableToCheck);\n};\n\nexport const getRouteMetadata = (\n  route: Hapi.ServerRoute,\n  pluginName?: string\n): {\n  attributes: SpanAttributes;\n  name: string;\n} => {\n  if (pluginName) {\n    return {\n      attributes: {\n        [SEMATTRS_HTTP_ROUTE]: route.path,\n        [SEMATTRS_HTTP_METHOD]: route.method,\n        [AttributeNames.HAPI_TYPE]: HapiLayerType.PLUGIN,\n        [AttributeNames.PLUGIN_NAME]: pluginName,\n      },\n      name: `${pluginName}: route - ${route.path}`,\n    };\n  }\n  return {\n    attributes: {\n      [SEMATTRS_HTTP_ROUTE]: route.path,\n      [SEMATTRS_HTTP_METHOD]: route.method,\n      [AttributeNames.HAPI_TYPE]: HapiLayerType.ROUTER,\n    },\n    name: `route - ${route.path}`,\n  };\n};\n\nexport const getExtMetadata = (\n  extPoint: Hapi.ServerRequestExtType,\n  pluginName?: string\n): {\n  attributes: SpanAttributes;\n  name: string;\n} => {\n  if (pluginName) {\n    return {\n      attributes: {\n        [AttributeNames.EXT_TYPE]: extPoint,\n        [AttributeNames.HAPI_TYPE]: HapiLayerType.EXT,\n        [AttributeNames.PLUGIN_NAME]: pluginName,\n      },\n      name: `${pluginName}: ext - ${extPoint}`,\n    };\n  }\n  return {\n    attributes: {\n      [AttributeNames.EXT_TYPE]: extPoint,\n      [AttributeNames.HAPI_TYPE]: HapiLayerType.EXT,\n    },\n    name: `ext - ${extPoint}`,\n  };\n};\n\nexport const getPluginFromInput = <T>(\n  pluginObj: HapiPluginObject<T>\n): Hapi.Plugin<T, void> => {\n  if ('plugin' in pluginObj) {\n    if ('plugin' in pluginObj.plugin) {\n      return pluginObj.plugin.plugin;\n    }\n    return pluginObj.plugin;\n  }\n  return pluginObj;\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as api from '@opentelemetry/api';\nimport { getRPCMetadata, RPCType } from '@opentelemetry/core';\nimport {\n  InstrumentationBase,\n  InstrumentationConfig,\n  InstrumentationNodeModuleDefinition,\n  isWrapped,\n} from '@opentelemetry/instrumentation';\n\nimport type * as Hapi from '@hapi/hapi';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport {\n  HapiComponentName,\n  HapiServerRouteInput,\n  handlerPatched,\n  PatchableServerRoute,\n  HapiServerRouteInputMethod,\n  HapiPluginInput,\n  RegisterFunction,\n  PatchableExtMethod,\n  ServerExtDirectInput,\n} from './internal-types';\nimport {\n  getRouteMetadata,\n  getPluginName,\n  isLifecycleExtType,\n  isLifecycleExtEventObj,\n  getExtMetadata,\n  isDirectExtInput,\n  isPatchableExtMethod,\n  getPluginFromInput,\n} from './utils';\n\n/** Hapi instrumentation for OpenTelemetry */\nexport class HapiInstrumentation extends InstrumentationBase {\n  constructor(config: InstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  protected init() {\n    return new InstrumentationNodeModuleDefinition(\n      HapiComponentName,\n      ['>=17.0.0 <22'],\n      (module: any) => {\n        const moduleExports: typeof Hapi =\n          module[Symbol.toStringTag] === 'Module' ? module.default : module;\n        if (!isWrapped(moduleExports.server)) {\n          this._wrap(\n            moduleExports,\n            'server',\n            this._getServerPatch.bind(this) as any\n          );\n        }\n\n        if (!isWrapped(moduleExports.Server)) {\n          this._wrap(\n            moduleExports,\n            'Server',\n            this._getServerPatch.bind(this) as any\n          );\n        }\n        return moduleExports;\n      },\n      (module: any) => {\n        const moduleExports: typeof Hapi =\n          module[Symbol.toStringTag] === 'Module' ? module.default : module;\n        this._massUnwrap([moduleExports], ['server', 'Server']);\n      }\n    );\n  }\n\n  /**\n   * Patches the Hapi.server and Hapi.Server functions in order to instrument\n   * the server.route, server.ext, and server.register functions via calls to the\n   * @function _getServerRoutePatch, @function _getServerExtPatch, and\n   * @function _getServerRegisterPatch functions\n   * @param original - the original Hapi Server creation function\n   */\n  private _getServerPatch(\n    original: (options?: Hapi.ServerOptions) => Hapi.Server\n  ) {\n    const instrumentation: HapiInstrumentation = this;\n    const self = this;\n    return function server(this: Hapi.Server, opts?: Hapi.ServerOptions) {\n      const newServer: Hapi.Server = original.apply(this, [opts]);\n\n      self._wrap(newServer, 'route', originalRouter => {\n        return instrumentation._getServerRoutePatch.bind(instrumentation)(\n          originalRouter\n        );\n      });\n\n      // Casting as any is necessary here due to multiple overloads on the Hapi.ext\n      // function, which requires supporting a variety of different parameters\n      // as extension inputs\n      self._wrap(newServer, 'ext', originalExtHandler => {\n        return instrumentation._getServerExtPatch.bind(instrumentation)(\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          originalExtHandler as any\n        );\n      });\n\n      // Casting as any is necessary here due to multiple overloads on the Hapi.Server.register\n      // function, which requires supporting a variety of different types of Plugin inputs\n      self._wrap(\n        newServer,\n        'register',\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        instrumentation._getServerRegisterPatch.bind(instrumentation) as any\n      );\n      return newServer;\n    };\n  }\n\n  /**\n   * Patches the plugin register function used by the Hapi Server. This function\n   * goes through each plugin that is being registered and adds instrumentation\n   * via a call to the @function _wrapRegisterHandler function.\n   * @param {RegisterFunction<T>} original - the original register function which\n   * registers each plugin on the server\n   */\n  private _getServerRegisterPatch<T>(\n    original: RegisterFunction<T>\n  ): RegisterFunction<T> {\n    const instrumentation: HapiInstrumentation = this;\n    return function register(\n      this: Hapi.Server,\n      pluginInput: HapiPluginInput<T>,\n      options?: Hapi.ServerRegisterOptions\n    ) {\n      if (Array.isArray(pluginInput)) {\n        for (const pluginObj of pluginInput) {\n          const plugin = getPluginFromInput(pluginObj);\n          instrumentation._wrapRegisterHandler(plugin);\n        }\n      } else {\n        const plugin = getPluginFromInput(pluginInput);\n        instrumentation._wrapRegisterHandler(plugin);\n      }\n      return original.apply(this, [pluginInput, options]);\n    };\n  }\n\n  /**\n   * Patches the Server.ext function which adds extension methods to the specified\n   * point along the request lifecycle. This function accepts the full range of\n   * accepted input into the standard Hapi `server.ext` function. For each extension,\n   * it adds instrumentation to the handler via a call to the @function _wrapExtMethods\n   * function.\n   * @param original - the original ext function which adds the extension method to the server\n   * @param {string} [pluginName] - if present, represents the name of the plugin responsible\n   * for adding this server extension. Else, signifies that the extension was added directly\n   */\n  private _getServerExtPatch(\n    original: (...args: unknown[]) => unknown,\n    pluginName?: string\n  ) {\n    const instrumentation: HapiInstrumentation = this;\n\n    return function ext(\n      this: ThisParameterType<typeof original>,\n      ...args: Parameters<typeof original>\n    ) {\n      if (Array.isArray(args[0])) {\n        const eventsList:\n          | Hapi.ServerExtEventsObject[]\n          | Hapi.ServerExtEventsRequestObject[] = args[0];\n        for (let i = 0; i < eventsList.length; i++) {\n          const eventObj = eventsList[i];\n          if (isLifecycleExtType(eventObj.type)) {\n            const lifecycleEventObj =\n              eventObj as Hapi.ServerExtEventsRequestObject;\n            const handler = instrumentation._wrapExtMethods(\n              lifecycleEventObj.method,\n              eventObj.type,\n              pluginName\n            );\n            lifecycleEventObj.method = handler;\n            eventsList[i] = lifecycleEventObj;\n          }\n        }\n        return original.apply(this, args);\n      } else if (isDirectExtInput(args)) {\n        const extInput: ServerExtDirectInput = args;\n        const method: PatchableExtMethod = extInput[1];\n        const handler = instrumentation._wrapExtMethods(\n          method,\n          extInput[0],\n          pluginName\n        );\n        return original.apply(this, [extInput[0], handler, extInput[2]]);\n      } else if (isLifecycleExtEventObj(args[0])) {\n        const lifecycleEventObj = args[0];\n        const handler = instrumentation._wrapExtMethods(\n          lifecycleEventObj.method,\n          lifecycleEventObj.type,\n          pluginName\n        );\n        lifecycleEventObj.method = handler;\n        return original.call(this, lifecycleEventObj);\n      }\n      return original.apply(this, args);\n    };\n  }\n\n  /**\n   * Patches the Server.route function. This function accepts either one or an array\n   * of Hapi.ServerRoute objects and adds instrumentation on each route via a call to\n   * the @function _wrapRouteHandler function.\n   * @param {HapiServerRouteInputMethod} original - the original route function which adds\n   * the route to the server\n   * @param {string} [pluginName] - if present, represents the name of the plugin responsible\n   * for adding this server route. Else, signifies that the route was added directly\n   */\n  private _getServerRoutePatch(\n    original: HapiServerRouteInputMethod,\n    pluginName?: string\n  ) {\n    const instrumentation: HapiInstrumentation = this;\n    return function route(\n      this: Hapi.Server,\n      route: HapiServerRouteInput\n    ): void {\n      if (Array.isArray(route)) {\n        for (let i = 0; i < route.length; i++) {\n          const newRoute = instrumentation._wrapRouteHandler.call(\n            instrumentation,\n            route[i],\n            pluginName\n          );\n          route[i] = newRoute;\n        }\n      } else {\n        route = instrumentation._wrapRouteHandler.call(\n          instrumentation,\n          route,\n          pluginName\n        );\n      }\n      return original.apply(this, [route]);\n    };\n  }\n\n  /**\n   * Wraps newly registered plugins to add instrumentation to the plugin's clone of\n   * the original server. Specifically, wraps the server.route and server.ext functions\n   * via calls to @function _getServerRoutePatch and @function _getServerExtPatch\n   * @param {Hapi.Plugin<T>} plugin - the new plugin which is being instrumented\n   */\n  private _wrapRegisterHandler<T>(plugin: Hapi.Plugin<T>): void {\n    const instrumentation: HapiInstrumentation = this;\n    const pluginName = getPluginName(plugin);\n    const oldHandler = plugin.register;\n    const self = this;\n    const newRegisterHandler = function (server: Hapi.Server, options: T) {\n      self._wrap(server, 'route', original => {\n        return instrumentation._getServerRoutePatch.bind(instrumentation)(\n          original,\n          pluginName\n        );\n      });\n\n      // Casting as any is necessary here due to multiple overloads on the Hapi.ext\n      // function, which requires supporting a variety of different parameters\n      // as extension inputs\n      self._wrap(server, 'ext', originalExtHandler => {\n        return instrumentation._getServerExtPatch.bind(instrumentation)(\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          originalExtHandler as any,\n          pluginName\n        );\n      });\n      return oldHandler(server, options);\n    };\n    plugin.register = newRegisterHandler;\n  }\n\n  /**\n   * Wraps request extension methods to add instrumentation to each new extension handler.\n   * Patches each individual extension in order to create the\n   * span and propagate context. It does not create spans when there is no parent span.\n   * @param {PatchableExtMethod | PatchableExtMethod[]} method - the request extension\n   * handler which is being instrumented\n   * @param {Hapi.ServerRequestExtType} extPoint - the point in the Hapi request lifecycle\n   * which this extension targets\n   * @param {string} [pluginName] - if present, represents the name of the plugin responsible\n   * for adding this server route. Else, signifies that the route was added directly\n   */\n  private _wrapExtMethods<T extends PatchableExtMethod | PatchableExtMethod[]>(\n    method: T,\n    extPoint: Hapi.ServerRequestExtType,\n    pluginName?: string\n  ): T {\n    const instrumentation: HapiInstrumentation = this;\n    if (method instanceof Array) {\n      for (let i = 0; i < method.length; i++) {\n        method[i] = instrumentation._wrapExtMethods(\n          method[i],\n          extPoint\n        ) as PatchableExtMethod;\n      }\n      return method;\n    } else if (isPatchableExtMethod(method)) {\n      if (method[handlerPatched] === true) return method;\n      method[handlerPatched] = true;\n\n      const newHandler: PatchableExtMethod = async function (\n        ...params: Parameters<Hapi.Lifecycle.Method>\n      ) {\n        if (api.trace.getSpan(api.context.active()) === undefined) {\n          return await method.apply(this, params);\n        }\n        const metadata = getExtMetadata(extPoint, pluginName);\n        const span = instrumentation.tracer.startSpan(metadata.name, {\n          attributes: metadata.attributes,\n        });\n        try {\n          return await api.context.with<\n            Parameters<Hapi.Lifecycle.Method>,\n            Hapi.Lifecycle.Method\n          >(\n            api.trace.setSpan(api.context.active(), span),\n            method,\n            undefined,\n            ...params\n          );\n        } catch (err: any) {\n          span.recordException(err);\n          span.setStatus({\n            code: api.SpanStatusCode.ERROR,\n            message: err.message,\n          });\n          throw err;\n        } finally {\n          span.end();\n        }\n      };\n      return newHandler as T;\n    }\n    return method;\n  }\n\n  /**\n   * Patches each individual route handler method in order to create the\n   * span and propagate context. It does not create spans when there is no parent span.\n   * @param {PatchableServerRoute} route - the route handler which is being instrumented\n   * @param {string} [pluginName] - if present, represents the name of the plugin responsible\n   * for adding this server route. Else, signifies that the route was added directly\n   */\n  private _wrapRouteHandler(\n    route: PatchableServerRoute,\n    pluginName?: string\n  ): PatchableServerRoute {\n    const instrumentation: HapiInstrumentation = this;\n    if (route[handlerPatched] === true) return route;\n    route[handlerPatched] = true;\n\n    const wrapHandler: (\n      oldHandler: Hapi.Lifecycle.Method\n    ) => Hapi.Lifecycle.Method = oldHandler => {\n      return async function (...params: Parameters<Hapi.Lifecycle.Method>) {\n        if (api.trace.getSpan(api.context.active()) === undefined) {\n          return await oldHandler.call(this, ...params);\n        }\n        const rpcMetadata = getRPCMetadata(api.context.active());\n        if (rpcMetadata?.type === RPCType.HTTP) {\n          rpcMetadata.route = route.path;\n        }\n        const metadata = getRouteMetadata(route, pluginName);\n        const span = instrumentation.tracer.startSpan(metadata.name, {\n          attributes: metadata.attributes,\n        });\n        try {\n          return await api.context.with(\n            api.trace.setSpan(api.context.active(), span),\n            () => oldHandler.call(this, ...params)\n          );\n        } catch (err: any) {\n          span.recordException(err);\n          span.setStatus({\n            code: api.SpanStatusCode.ERROR,\n            message: err.message,\n          });\n          throw err;\n        } finally {\n          span.end();\n        }\n      };\n    };\n\n    if (typeof route.handler === 'function') {\n      route.handler = wrapHandler(route.handler as Hapi.Lifecycle.Method);\n    } else if (typeof route.options === 'function') {\n      const oldOptions = route.options;\n      route.options = function (server) {\n        const options = oldOptions(server);\n        if (typeof options.handler === 'function') {\n          options.handler = wrapHandler(\n            options.handler as Hapi.Lifecycle.Method\n          );\n        }\n        return options;\n      };\n    } else if (typeof route.options?.handler === 'function') {\n      route.options.handler = wrapHandler(\n        route.options.handler as Hapi.Lifecycle.Method\n      );\n    }\n    return route;\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './enums/AttributeNames';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Span } from '@opentelemetry/api';\nimport { InstrumentationConfig } from '@opentelemetry/instrumentation';\n\nexport enum KoaLayerType {\n  ROUTER = 'router',\n  MIDDLEWARE = 'middleware',\n}\n\n/**\n * Information about the current Koa middleware layer\n * The middleware layer type is any by default.\n * One can install koa types packages `@types/koa` and `@types/koa__router`\n * with compatible versions to the koa version used in the project\n * to get more specific types for the middleware layer property.\n *\n * Example use in a custom attribute function:\n * ```ts\n * import type { Middleware, ParameterizedContext, DefaultState } from 'koa';\n * import type { RouterParamContext } from '@koa/router';\n *\n * type KoaContext = ParameterizedContext<DefaultState, RouterParamContext>;\n * type KoaMiddleware = Middleware<DefaultState, KoaContext>;\n *\n * const koaConfig: KoaInstrumentationConfig<KoaContext, KoaMiddleware> = {\n *  requestHook: (span: Span, info: KoaRequestInfo<KoaContext, KoaMiddleware>) => {\n *   // custom typescript code that can access the typed into.middlewareLayer and info.context\n * }\n *\n */\nexport type KoaRequestInfo<KoaContextType = any, KoaMiddlewareType = any> = {\n  context: KoaContextType;\n  middlewareLayer: KoaMiddlewareType;\n  layerType: KoaLayerType;\n};\n\n/**\n * Function that can be used to add custom attributes to the current span\n * @param span - The Express middleware layer span.\n * @param context - The current KoaContext.\n */\nexport interface KoaRequestCustomAttributeFunction<\n  KoaContextType = any,\n  KoaMiddlewareType = any\n> {\n  (span: Span, info: KoaRequestInfo<KoaContextType, KoaMiddlewareType>): void;\n}\n\n/**\n * Options available for the Koa Instrumentation (see [documentation](https://github.com/open-telemetry/opentelemetry-js/tree/main/packages/opentelemetry-Instrumentation-koa#koa-Instrumentation-options))\n */\nexport interface KoaInstrumentationConfig<\n  KoaContextType = any,\n  KoaMiddlewareType = any\n> extends InstrumentationConfig {\n  /** Ignore specific layers based on their type */\n  ignoreLayersType?: KoaLayerType[];\n  /** Function for adding custom attributes to each middleware layer span */\n  requestHook?: KoaRequestCustomAttributeFunction<\n    KoaContextType,\n    KoaMiddlewareType\n  >;\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.42.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-koa';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport enum AttributeNames {\n  KOA_TYPE = 'koa.type',\n  KOA_NAME = 'koa.name',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { KoaLayerType, KoaInstrumentationConfig } from './types';\nimport { KoaContext, KoaMiddleware } from './internal-types';\nimport { AttributeNames } from './enums/AttributeNames';\nimport { Attributes } from '@opentelemetry/api';\nimport { SEMATTRS_HTTP_ROUTE } from '@opentelemetry/semantic-conventions';\n\nexport const getMiddlewareMetadata = (\n  context: KoaContext,\n  layer: KoaMiddleware,\n  isRouter: boolean,\n  layerPath?: string | RegExp\n): {\n  attributes: Attributes;\n  name: string;\n} => {\n  if (isRouter) {\n    return {\n      attributes: {\n        [AttributeNames.KOA_NAME]: layerPath?.toString(),\n        [AttributeNames.KOA_TYPE]: KoaLayerType.ROUTER,\n        [SEMATTRS_HTTP_ROUTE]: layerPath?.toString(),\n      },\n      name: context._matchedRouteName || `router - ${layerPath}`,\n    };\n  } else {\n    return {\n      attributes: {\n        [AttributeNames.KOA_NAME]: layer.name ?? 'middleware',\n        [AttributeNames.KOA_TYPE]: KoaLayerType.MIDDLEWARE,\n      },\n      name: `middleware - ${layer.name}`,\n    };\n  }\n};\n\n/**\n * Check whether the given request is ignored by configuration\n * @param [list] List of ignore patterns\n * @param [onException] callback for doing something when an exception has\n *     occurred\n */\nexport const isLayerIgnored = (\n  type: KoaLayerType,\n  config?: KoaInstrumentationConfig\n): boolean => {\n  return !!(\n    Array.isArray(config?.ignoreLayersType) &&\n    config?.ignoreLayersType?.includes(type)\n  );\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport type { Middleware, ParameterizedContext, DefaultState } from 'koa';\nimport type * as Router from '@koa/router';\n\nexport type KoaContext = ParameterizedContext<\n  DefaultState,\n  Router.RouterParamContext\n>;\nexport type KoaMiddleware = Middleware<DefaultState, KoaContext> & {\n  router?: Router;\n};\n\n/**\n * This symbol is used to mark a Koa layer as being already instrumented\n * since its possible to use a given layer multiple times (ex: middlewares)\n */\nexport const kLayerPatched: unique symbol = Symbol('koa-layer-patched');\n\nexport type KoaPatchedMiddleware = KoaMiddleware & {\n  [kLayerPatched]?: boolean;\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as api from '@opentelemetry/api';\nimport {\n  isWrapped,\n  InstrumentationBase,\n  InstrumentationNodeModuleDefinition,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\n\nimport type * as koa from 'koa';\nimport { KoaLayerType, KoaInstrumentationConfig } from './types';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport { getMiddlewareMetadata, isLayerIgnored } from './utils';\nimport { getRPCMetadata, RPCType } from '@opentelemetry/core';\nimport {\n  kLayerPatched,\n  KoaContext,\n  KoaMiddleware,\n  KoaPatchedMiddleware,\n} from './internal-types';\n\n/** Koa instrumentation for OpenTelemetry */\nexport class KoaInstrumentation extends InstrumentationBase {\n  constructor(config: KoaInstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  override setConfig(config: KoaInstrumentationConfig = {}) {\n    this._config = Object.assign({}, config);\n  }\n\n  override getConfig(): KoaInstrumentationConfig {\n    return this._config as KoaInstrumentationConfig;\n  }\n\n  protected init() {\n    return new InstrumentationNodeModuleDefinition(\n      'koa',\n      ['>=2.0.0 <3'],\n      (module: any) => {\n        const moduleExports: typeof koa =\n          module[Symbol.toStringTag] === 'Module'\n            ? module.default // ESM\n            : module; // CommonJS\n        if (moduleExports == null) {\n          return moduleExports;\n        }\n        if (isWrapped(moduleExports.prototype.use)) {\n          this._unwrap(moduleExports.prototype, 'use');\n        }\n        this._wrap(\n          moduleExports.prototype,\n          'use',\n          this._getKoaUsePatch.bind(this)\n        );\n        return module;\n      },\n      (module: any) => {\n        const moduleExports: typeof koa =\n          module[Symbol.toStringTag] === 'Module'\n            ? module.default // ESM\n            : module; // CommonJS\n        if (isWrapped(moduleExports.prototype.use)) {\n          this._unwrap(moduleExports.prototype, 'use');\n        }\n      }\n    );\n  }\n\n  /**\n   * Patches the Koa.use function in order to instrument each original\n   * middleware layer which is introduced\n   * @param {KoaMiddleware} middleware - the original middleware function\n   */\n  private _getKoaUsePatch(original: (middleware: KoaMiddleware) => koa) {\n    const plugin = this;\n    return function use(this: koa, middlewareFunction: KoaMiddleware) {\n      let patchedFunction: KoaMiddleware;\n      if (middlewareFunction.router) {\n        patchedFunction = plugin._patchRouterDispatch(middlewareFunction);\n      } else {\n        patchedFunction = plugin._patchLayer(middlewareFunction, false);\n      }\n      return original.apply(this, [patchedFunction]);\n    };\n  }\n\n  /**\n   * Patches the dispatch function used by @koa/router. This function\n   * goes through each routed middleware and adds instrumentation via a call\n   * to the @function _patchLayer function.\n   * @param {KoaMiddleware} dispatchLayer - the original dispatch function which dispatches\n   * routed middleware\n   */\n  private _patchRouterDispatch(dispatchLayer: KoaMiddleware): KoaMiddleware {\n    api.diag.debug('Patching @koa/router dispatch');\n\n    const router = dispatchLayer.router;\n\n    const routesStack = router?.stack ?? [];\n    for (const pathLayer of routesStack) {\n      const path = pathLayer.path;\n      const pathStack = pathLayer.stack;\n      for (let j = 0; j < pathStack.length; j++) {\n        const routedMiddleware: KoaMiddleware = pathStack[j];\n        pathStack[j] = this._patchLayer(routedMiddleware, true, path);\n      }\n    }\n\n    return dispatchLayer;\n  }\n\n  /**\n   * Patches each individual @param middlewareLayer function in order to create the\n   * span and propagate context. It does not create spans when there is no parent span.\n   * @param {KoaMiddleware} middlewareLayer - the original middleware function.\n   * @param {boolean} isRouter - tracks whether the original middleware function\n   * was dispatched by the router originally\n   * @param {string?} layerPath - if present, provides additional data from the\n   * router about the routed path which the middleware is attached to\n   */\n  private _patchLayer(\n    middlewareLayer: KoaPatchedMiddleware,\n    isRouter: boolean,\n    layerPath?: string | RegExp\n  ): KoaMiddleware {\n    const layerType = isRouter ? KoaLayerType.ROUTER : KoaLayerType.MIDDLEWARE;\n    // Skip patching layer if its ignored in the config\n    if (\n      middlewareLayer[kLayerPatched] === true ||\n      isLayerIgnored(layerType, this.getConfig())\n    )\n      return middlewareLayer;\n\n    if (\n      middlewareLayer.constructor.name === 'GeneratorFunction' ||\n      middlewareLayer.constructor.name === 'AsyncGeneratorFunction'\n    ) {\n      api.diag.debug('ignoring generator-based Koa middleware layer');\n      return middlewareLayer;\n    }\n\n    middlewareLayer[kLayerPatched] = true;\n\n    api.diag.debug('patching Koa middleware layer');\n    return async (context: KoaContext, next: koa.Next) => {\n      const parent = api.trace.getSpan(api.context.active());\n      if (parent === undefined) {\n        return middlewareLayer(context, next);\n      }\n      const metadata = getMiddlewareMetadata(\n        context,\n        middlewareLayer,\n        isRouter,\n        layerPath\n      );\n      const span = this.tracer.startSpan(metadata.name, {\n        attributes: metadata.attributes,\n      });\n\n      const rpcMetadata = getRPCMetadata(api.context.active());\n\n      if (rpcMetadata?.type === RPCType.HTTP && context._matchedRoute) {\n        rpcMetadata.route = context._matchedRoute.toString();\n      }\n\n      if (this.getConfig().requestHook) {\n        safeExecuteInTheMiddle(\n          () =>\n            this.getConfig().requestHook!(span, {\n              context,\n              middlewareLayer,\n              layerType,\n            }),\n          e => {\n            if (e) {\n              api.diag.error('koa instrumentation: request hook failed', e);\n            }\n          },\n          true\n        );\n      }\n\n      const newContext = api.trace.setSpan(api.context.active(), span);\n      return api.context.with(newContext, async () => {\n        try {\n          return await middlewareLayer(context, next);\n        } catch (err: any) {\n          span.recordException(err);\n          throw err;\n        } finally {\n          span.end();\n        }\n      });\n    };\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './instrumentation';\nexport * from './types';\nexport * from './enums/AttributeNames';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum AttributeNames {\n  CONNECT_TYPE = 'connect.type',\n  CONNECT_NAME = 'connect.name',\n}\n\nexport enum ConnectTypes {\n  MIDDLEWARE = 'middleware',\n  REQUEST_HANDLER = 'request_handler',\n}\n\nexport enum ConnectNames {\n  MIDDLEWARE = 'middleware',\n  REQUEST_HANDLER = 'request handler',\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// this is autogenerated file, see scripts/version-update.js\nexport const PACKAGE_VERSION = '0.38.0';\nexport const PACKAGE_NAME = '@opentelemetry/instrumentation-connect';\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { HandleFunction, IncomingMessage, Server } from 'connect';\n\nexport const _LAYERS_STORE_PROPERTY: unique symbol = Symbol(\n  'opentelemetry.instrumentation-connect.request-route-stack'\n);\n\nexport type UseArgs1 = [HandleFunction];\nexport type UseArgs2 = [string, HandleFunction];\nexport type UseArgs = UseArgs1 | UseArgs2;\nexport type Use = (...args: UseArgs) => Server;\nexport type PatchedRequest = {\n  [_LAYERS_STORE_PROPERTY]: string[];\n} & IncomingMessage;\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { diag } from '@opentelemetry/api';\nimport { _LAYERS_STORE_PROPERTY, PatchedRequest } from './internal-types';\n\nexport const addNewStackLayer = (request: PatchedRequest) => {\n  if (Array.isArray(request[_LAYERS_STORE_PROPERTY]) === false) {\n    Object.defineProperty(request, _LAYERS_STORE_PROPERTY, {\n      enumerable: false,\n      value: [],\n    });\n  }\n  request[_LAYERS_STORE_PROPERTY].push('/');\n\n  const stackLength = request[_LAYERS_STORE_PROPERTY].length;\n\n  return () => {\n    if (stackLength === request[_LAYERS_STORE_PROPERTY].length) {\n      request[_LAYERS_STORE_PROPERTY].pop();\n    } else {\n      diag.warn('Connect: Trying to pop the stack multiple time');\n    }\n  };\n};\n\nexport const replaceCurrentStackRoute = (\n  request: PatchedRequest,\n  newRoute?: string\n) => {\n  if (newRoute) {\n    request[_LAYERS_STORE_PROPERTY].splice(-1, 1, newRoute);\n  }\n};\n\n// generate route from existing stack on request object.\n// splash between stack layer will be deduped\n// [\"/first/\", \"/second\", \"/third/\"] => /first/second/third/\nexport const generateRoute = (request: PatchedRequest) => {\n  return request[_LAYERS_STORE_PROPERTY].reduce(\n    (acc, sub) => acc.replace(/\\/+$/, '') + sub\n  );\n};\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { context, Span, SpanOptions } from '@opentelemetry/api';\nimport { getRPCMetadata, RPCType } from '@opentelemetry/core';\nimport type { HandleFunction, NextFunction, Server } from 'connect';\nimport type { ServerResponse } from 'http';\nimport {\n  AttributeNames,\n  ConnectNames,\n  ConnectTypes,\n} from './enums/AttributeNames';\nimport { PatchedRequest, Use, UseArgs, UseArgs2 } from './internal-types';\nimport { PACKAGE_NAME, PACKAGE_VERSION } from './version';\nimport {\n  InstrumentationBase,\n  InstrumentationConfig,\n  InstrumentationNodeModuleDefinition,\n  isWrapped,\n} from '@opentelemetry/instrumentation';\nimport { SEMATTRS_HTTP_ROUTE } from '@opentelemetry/semantic-conventions';\nimport {\n  replaceCurrentStackRoute,\n  addNewStackLayer,\n  generateRoute,\n} from './utils';\n\nexport const ANONYMOUS_NAME = 'anonymous';\n\n/** Connect instrumentation for OpenTelemetry */\nexport class ConnectInstrumentation extends InstrumentationBase {\n  constructor(config: InstrumentationConfig = {}) {\n    super(PACKAGE_NAME, PACKAGE_VERSION, config);\n  }\n\n  init() {\n    return [\n      new InstrumentationNodeModuleDefinition(\n        'connect',\n        ['>=3.0.0 <4'],\n        moduleExports => {\n          return this._patchConstructor(moduleExports);\n        }\n      ),\n    ];\n  }\n\n  private _patchApp(patchedApp: Server) {\n    if (!isWrapped(patchedApp.use)) {\n      this._wrap(patchedApp, 'use', this._patchUse.bind(this));\n    }\n    if (!isWrapped(patchedApp.handle)) {\n      this._wrap(patchedApp, 'handle', this._patchHandle.bind(this));\n    }\n  }\n\n  private _patchConstructor(original: () => Server): () => Server {\n    const instrumentation = this;\n    return function (this: Server, ...args) {\n      const app = original.apply(this, args) as Server;\n      instrumentation._patchApp(app);\n      return app;\n    };\n  }\n\n  public _patchNext(next: NextFunction, finishSpan: () => void): NextFunction {\n    return function nextFunction(this: NextFunction, err?: any): void {\n      const result = next.apply(this, [err]);\n      finishSpan();\n      return result;\n    };\n  }\n\n  public _startSpan(routeName: string, middleWare: HandleFunction): Span {\n    let connectType: ConnectTypes;\n    let connectName: string;\n    let connectTypeName: string;\n    if (routeName) {\n      connectType = ConnectTypes.REQUEST_HANDLER;\n      connectTypeName = ConnectNames.REQUEST_HANDLER;\n      connectName = routeName;\n    } else {\n      connectType = ConnectTypes.MIDDLEWARE;\n      connectTypeName = ConnectNames.MIDDLEWARE;\n      connectName = middleWare.name || ANONYMOUS_NAME;\n    }\n    const spanName = `${connectTypeName} - ${connectName}`;\n    const options: SpanOptions = {\n      attributes: {\n        [SEMATTRS_HTTP_ROUTE]: routeName.length > 0 ? routeName : '/',\n        [AttributeNames.CONNECT_TYPE]: connectType,\n        [AttributeNames.CONNECT_NAME]: connectName,\n      },\n    };\n\n    return this.tracer.startSpan(spanName, options);\n  }\n\n  public _patchMiddleware(\n    routeName: string,\n    middleWare: HandleFunction\n  ): HandleFunction {\n    const instrumentation = this;\n    const isErrorMiddleware = middleWare.length === 4;\n\n    function patchedMiddleware(this: Use): void {\n      if (!instrumentation.isEnabled()) {\n        return (middleWare as any).apply(this, arguments);\n      }\n      const [reqArgIdx, resArgIdx, nextArgIdx] = isErrorMiddleware\n        ? [1, 2, 3]\n        : [0, 1, 2];\n      const req = arguments[reqArgIdx] as PatchedRequest;\n      const res = arguments[resArgIdx] as ServerResponse;\n      const next = arguments[nextArgIdx] as NextFunction;\n\n      replaceCurrentStackRoute(req, routeName);\n\n      const rpcMetadata = getRPCMetadata(context.active());\n      if (routeName && rpcMetadata?.type === RPCType.HTTP) {\n        rpcMetadata.route = generateRoute(req);\n      }\n\n      let spanName = '';\n      if (routeName) {\n        spanName = `request handler - ${routeName}`;\n      } else {\n        spanName = `middleware - ${middleWare.name || ANONYMOUS_NAME}`;\n      }\n      const span = instrumentation._startSpan(routeName, middleWare);\n      instrumentation._diag.debug('start span', spanName);\n      let spanFinished = false;\n\n      function finishSpan() {\n        if (!spanFinished) {\n          spanFinished = true;\n          instrumentation._diag.debug(`finishing span ${(span as any).name}`);\n          span.end();\n        } else {\n          instrumentation._diag.debug(\n            `span ${(span as any).name} - already finished`\n          );\n        }\n        res.removeListener('close', finishSpan);\n      }\n\n      res.addListener('close', finishSpan);\n      arguments[nextArgIdx] = instrumentation._patchNext(next, finishSpan);\n\n      return (middleWare as any).apply(this, arguments);\n    }\n\n    Object.defineProperty(patchedMiddleware, 'length', {\n      value: middleWare.length,\n      writable: false,\n      configurable: true,\n    });\n\n    return patchedMiddleware;\n  }\n\n  public _patchUse(original: Server['use']): Use {\n    const instrumentation = this;\n    return function (this: Server, ...args: UseArgs): Server {\n      const middleWare = args[args.length - 1] as HandleFunction;\n      const routeName = (args[args.length - 2] || '') as string;\n\n      args[args.length - 1] = instrumentation._patchMiddleware(\n        routeName,\n        middleWare\n      );\n\n      return original.apply(this, args as UseArgs2);\n    };\n  }\n\n  public _patchHandle(original: Server['handle']): Server['handle'] {\n    const instrumentation = this;\n    return function (this: Server): ReturnType<Server['handle']> {\n      const [reqIdx, outIdx] = [0, 2];\n      const req = arguments[reqIdx] as PatchedRequest;\n      const out = arguments[outIdx];\n      const completeStack = addNewStackLayer(req);\n\n      if (typeof out === 'function') {\n        arguments[outIdx] = instrumentation._patchOut(\n          out as NextFunction,\n          completeStack\n        );\n      }\n\n      return (original as any).apply(this, arguments);\n    };\n  }\n\n  public _patchOut(out: NextFunction, completeStack: () => void): NextFunction {\n    return function nextFunction(this: NextFunction, ...args: any[]): void {\n      completeStack();\n      return Reflect.apply(out, this, args);\n    };\n  }\n}\n","/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './enums/AttributeNames';\nexport * from './instrumentation';\n","import process from 'node:process';\nimport React from 'react';\nimport { renderErrorSync } from '@wix/cli-ui-kit';\nimport { writeCrashReport } from '@wix/cli-debug-log';\nimport { ErrorViewer } from './components/ErrorViewer.js';\nimport type { ErrorReporterOptions } from './error-reporter.js';\nimport { createErrorReporter } from './error-reporter.js';\nimport { collectUserFeedback } from './user-feedback.js';\n\nexport type ErrorHandlerFn = (args: { error: unknown; data?: unknown }) => void;\n\nexport function createErrorHandler({\n  debugOutputPath,\n  userFeedbackCachePath,\n  ...errorReporterOptions\n}: {\n  debugOutputPath: string;\n  userFeedbackCachePath?: string;\n} & ErrorReporterOptions) {\n  const errorReporter = createErrorReporter(errorReporterOptions);\n\n  const handler: ErrorHandlerFn = function ({ error, data }) {\n    const reportResult = errorReporter.reportError(error, { data });\n    renderErrorSync(<ErrorViewer error={error} />);\n    writeCrashReport(debugOutputPath, error);\n    process.exitCode = 1;\n\n    collectUserFeedback({\n      reportResult,\n      errorReporter,\n      cachePath: userFeedbackCachePath,\n    }).catch((e: unknown) => {\n      writeCrashReport(debugOutputPath, e);\n    });\n  };\n\n  const registerToProcessErrors = function () {\n    process.on('uncaughtException', (error) => {\n      handler({\n        error,\n        data: { mechanism: { handled: false, type: 'uncaughtException' } },\n      });\n    });\n\n    process.on('unhandledRejection', (error) => {\n      /**\n       * Temporary workaround for https://github.com/vitejs/vite/issues/14706\n       */\n      if (\n        error instanceof Error &&\n        error.message.startsWith('Build failed with') &&\n        error.stack?.includes('esbuild')\n      ) {\n        return;\n      }\n\n      handler({\n        error,\n        data: { mechanism: { handled: false, type: 'unhandledRejection' } },\n      });\n    });\n  };\n\n  return {\n    handler,\n    errorReporter,\n    registerToProcessErrors,\n  };\n}\n","import { dirname } from 'node:path';\nimport { appendFileSync, mkdirSync } from 'node:fs';\nimport React, { createContext, useContext, useCallback } from 'react';\nimport type { FC, ReactNode } from 'react';\nimport VError from 'verror';\nimport { extractHttpError, getHttpErrorInfo } from '@wix/cli-http-client';\n\nexport function writeCrashReport(reportPath: string, error: unknown) {\n  try {\n    let content = `----- CLI crash report at ${new Date().toISOString()}\\n`;\n    if (error instanceof Error) {\n      content += `Error Trace\\n`;\n      content += `${VError.fullStack(error)}\\n`;\n      content += `Error Info\\n`;\n      content += `${JSON.stringify(VError.info(error), null, 2)}\\n`;\n\n      const httpError = extractHttpError(error);\n      if (httpError) {\n        content += `Request Info\\n`;\n        content += `${JSON.stringify(getHttpErrorInfo(httpError), null, 2)}\\n`;\n      }\n    }\n    mkdirSync(dirname(reportPath), { recursive: true });\n    appendFileSync(reportPath, content);\n  } catch {\n    // well there is so much we can do...\n  }\n}\n\nexport type WriteDebugLogFn = (error: unknown) => void;\n\nconst DebugLogContext = createContext<WriteDebugLogFn | null>(null);\n\ninterface Props {\n  filePath: string;\n  children: ReactNode;\n}\n\nexport const DebugLogProvider: FC<Props> = ({ filePath, children }) => {\n  const writeToDebugLog = useCallback<WriteDebugLogFn>(\n    (error) => writeCrashReport(filePath, error),\n    [filePath]\n  );\n\n  return (\n    <DebugLogContext.Provider value={writeToDebugLog}>\n      {children}\n    </DebugLogContext.Provider>\n  );\n};\n\nexport const useDebugLog = (): WriteDebugLogFn => {\n  const context = useContext(DebugLogContext);\n  if (context === null) {\n    throw new Error(\n      'useDebugLog() cannot be used without an <DebugLogProvider>'\n    );\n  }\n  return context;\n};\n","import type { IHttpError } from '@wix/http-client';\nimport { HttpClient } from '@wix/http-client';\nimport VError from 'verror';\n\nexport function extractHttpError(error: unknown): IHttpError | null {\n  if (HttpClient.isHttpError(error)) {\n    return error;\n  }\n\n  const nestedError = error instanceof Error ? VError.cause(error) : null;\n  return nestedError ? extractHttpError(nestedError) : null;\n}\n","import type { IHttpError } from '@wix/http-client';\n\nexport function getHttpErrorInfo(httpError: IHttpError) {\n  return {\n    request: {\n      baseURL: httpError.config.baseURL,\n      url: httpError.config.url,\n      method: httpError.config.method,\n      headers: httpError.config.headers,\n      data: httpError.config.data,\n    },\n    response: {\n      code: httpError.code,\n      message: httpError.message,\n      status: httpError.response?.status,\n      headers: httpError.response?.headers,\n      data: httpError.response?.data,\n    },\n  } as const;\n}\n","import { createElement, useMemo } from 'react';\nimport type { FC, ReactNode } from 'react';\nimport { isCliSystemError, normalizeError } from '@wix/cli-error';\nimport { getErrorComponent } from '../get-error-component.js';\n\ninterface Props {\n  error: unknown;\n  systemErrorOverride?: ReactNode;\n}\n\nexport const ErrorViewer: FC<Props> = ({\n  error: originalError,\n  systemErrorOverride,\n}) => {\n  return useMemo(() => {\n    const error = normalizeError(originalError);\n\n    return isCliSystemError(error) && systemErrorOverride\n      ? systemErrorOverride\n      : createElement(getErrorComponent(error.cliCode));\n  }, [originalError, systemErrorOverride]);\n};\n","import type { ComponentType } from 'react';\nimport React from 'react';\nimport { match } from 'variant';\nimport { Box, Newline, Text, Link } from '@wix/cli-ui-kit';\nimport { outdent } from 'outdent';\nimport type { ZodIssue } from 'zod';\nimport type { CliErrorCodeType } from '@wix/cli-error';\nimport { ErrorMessage, SystemErrorMessage } from './components/ErrorMessage.js';\n\nexport function getErrorComponent(code: CliErrorCodeType): ComponentType {\n  return match(code, {\n    UnknownFailure: ({ error }) => {\n      return () => (\n        <>\n          <Text skin=\"error\">\n            Oh no, seems like the CLI encountered an unexpected error:\n          </Text>\n\n          {error instanceof Error ? (\n            <Text skin=\"error\">{error.message}</Text>\n          ) : (\n            <Text>{JSON.stringify(error)}</Text>\n          )}\n        </>\n      );\n    },\n    FailedToGetDeviceCode: () => {\n      return () => (\n        <SystemErrorMessage message=\"An error occured while logging in: Failed to issue a login device code\" />\n      );\n    },\n    FailedToGetAuthToken: () => {\n      return () => (\n        <SystemErrorMessage message=\"An error occured while logging in: Failed to issue refresh token\" />\n      );\n    },\n    FailedToRefreshTokenForSite: () => {\n      return () => (\n        <SystemErrorMessage message=\"An error occured while logging in: Failed to issue refresh token for site\" />\n      );\n    },\n    FailedToRenewAuthToken: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to renew access token.\" />\n      );\n    },\n    FailedToRenewAuthTokenSiteNotFound: ({ siteId }) => {\n      return () => (\n        <ErrorMessage\n          message={`Authenticate failed, your configured development site (${siteId}) could not be accessed`}\n          hint=\"Make sure the site exists and you still have access to it\"\n        />\n      );\n    },\n    FailedToRenewAuthTokenRefreshTokenRevoked: () => {\n      return () => (\n        <ErrorMessage\n          message=\"Failed to renew access token: refresh token has been revoked\"\n          hint=\"Please login again to get a new refresh token\"\n        />\n      );\n    },\n    FailedToRevokeRefreshToken: ({ email }) => {\n      return () => (\n        <SystemErrorMessage\n          message=\"An error occured while trying to logout: Failed to revoke refresh token!\"\n          explanation={`Wix CLI is still logged in to account ${email}`}\n        />\n      );\n    },\n    FailedToFetchPackageJson: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to fetch package data.\" />\n      );\n    },\n    FailedToCreateProjectFolder: ({ cause, packageFolder }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to create project folder: ${packageFolder}. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    LatestVersionOfCreateAppRequired: ({\n      currentVersion,\n      latestVersion,\n      updateCommand,\n    }) => {\n      return () => (\n        <ErrorMessage\n          message={\n            <>\n              Generating a Wix App is only supported using the latest version (\n              {latestVersion}) of <Text bold>@wix/create-app</Text> (current:{' '}\n              {currentVersion})\n            </>\n          }\n          hint={\n            <Text>\n              Make sure you are using the following command:\n              <Newline />\n              <Text bold>{updateCommand}</Text>\n              <Newline />\n              If the problem persists, try clearing your package manager's cache\n            </Text>\n          }\n        />\n      );\n    },\n    EmptyDirectoryRequiredAppGeneration: ({ folder }) => {\n      return () => (\n        <ErrorMessage\n          message={\n            <>\n              Generating a Wix App requires an empty directory but{' '}\n              <Text bold>{folder}</Text> already exists and isn't empty\n            </>\n          }\n          hint={\n            <Text>\n              Choose a different project name or delete the existing{' '}\n              <Text bold>{folder}</Text> folder\n            </Text>\n          }\n        />\n      );\n    },\n    InvalidNewPackageName: ({ packageName, validations }) => {\n      return () => (\n        <ErrorMessage\n          message={\n            <>\n              Generating a Wix App requires a valid npm package name for the\n              generated <Text bold>package.json</Text> <Newline />\n              The name <Text bold>{packageName}</Text> failed the following\n              validations:\n              <Newline />\n              {validations.map((validation, id) => (\n                <Text key={id}>\n                  <Newline />- {validation}\n                </Text>\n              ))}\n            </>\n          }\n          hint={`Choose a different project name that follows the validations above`}\n        />\n      );\n    },\n    SiteSelectorTimedout: () => {\n      return () => (\n        <ErrorMessage\n          message={`Waiting for application installation timed out.`}\n        />\n      );\n    },\n    TypeErrorInvalidUrl: () => {\n      return () => <ErrorMessage message={`Invalid assets URL.`} />;\n    },\n    UnsupportedPackageManager: ({ packageManagerName }) => {\n      return () => (\n        <ErrorMessage\n          message={`Generating a Wix App requires the usage of a supported package manager`}\n          hint={`Expected Yarn or NPM but ${\n            packageManagerName\n              ? `got ${packageManagerName}`\n              : `failed to detect a package manager`\n          }`}\n        />\n      );\n    },\n    UnsupportedPackageManagerWorkspaces: ({ packageManagerName }) => {\n      return () => (\n        <ErrorMessage\n          message={`Generating a Wix App inside ${packageManagerName} workspaces is not supported`}\n        />\n      );\n    },\n    FailedToGetDeveloperApps: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to get the list of your applications\" />\n      );\n    },\n    FailedToCreateDevCenterApp: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to register your application in Wix\" />\n      );\n    },\n    FailedToCreateTunnel: () => {\n      return () => <ErrorMessage message=\"Failed to create tunnel\" />;\n    },\n    FailedToDeleteTunnel: () => {\n      return () => <ErrorMessage message=\"Failed to delete tunnel\" />;\n    },\n    SitePermissionDenied: ({ siteId }) => {\n      return () => {\n        return (\n          <ErrorMessage\n            message={`You don't have permissions to site ${siteId}`}\n          />\n        );\n      };\n    },\n    AppPermissionDenied: ({ appId }) => {\n      return () => {\n        return (\n          <ErrorMessage\n            message={`You don't have permissions to application ${appId}`}\n          />\n        );\n      };\n    },\n    FailedToUpdateTelemetryConfig: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to change telemetry preferences\" />\n      );\n    },\n    FailedToInstallPackage: ({ packageName, cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to install npm package ${packageName}. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToResolveNpmDependencies: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to resolve npm dependencies\" />\n      );\n    },\n    FailedToInstallPackages: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to install npm packages. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedMigrationToAnyNpm: () => {\n      return () => (\n        <ErrorMessage\n          message={<>Could not start the migration process</>}\n          hint={\n            <Text>\n              Make sure that your package.json does not have packages installed\n              outside of dev dependencies\n            </Text>\n          }\n        />\n      );\n    },\n    DeprecatedVersion: ({ currentVersion }) => {\n      return () => (\n        <ErrorMessage\n          message={\n            <>\n              {`Your version of the Wix CLI (${currentVersion}) is`}\n              <Text bold> deprecated</Text>.\n            </>\n          }\n          hint={`Please update to the latest version to continue`}\n        />\n      );\n    },\n    FailedToUninstallPackage: ({ packageName, cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to uninstall npm package ${packageName}. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToSyncToRevision: ({ revision }) => {\n      return () => (\n        <ErrorMessage\n          message={`Failed to sync the local project to revision ${revision}`}\n        />\n      );\n    },\n    FailedToCreateVersion: () => {\n      return () => (\n        <ErrorMessage message=\"Wix CLI failed to create version for your app\" />\n      );\n    },\n    FailedToReadCache: ({ path }) => {\n      return () => (\n        <ErrorMessage message={`Failed to read cache file at ${path}.`} />\n      );\n    },\n    FailedToWriteCache: ({ path }) => {\n      return () => (\n        <ErrorMessage message={`Failed to write cache file at ${path}.`} />\n      );\n    },\n    UploadApplicationFailed: () => {\n      return () => <ErrorMessage message=\"Failed to upload the application\" />;\n    },\n    BuiltProjectNeeded: () => {\n      return () => (\n        <ErrorMessage message=\"Can not find build output, please execute `wix app build` to build your app before proceeding\" />\n      );\n    },\n    WixUninstallMissingPackageName: () => {\n      return () => <ErrorMessage message=\"Please specify a package name\" />;\n    },\n    FailedToReadJson: ({ filePath, cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to read ${filePath}. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    InvalidJsonFile: ({ filePath, cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Invalid JSON file located at ${filePath}. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToWriteWixLock: () => {\n      return () => <ErrorMessage message={`Failed to write 'wix.lock'`} />;\n    },\n    InvalidVeloConfigJson: ({ configFilename, cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Invalid ${configFilename}, make sure it's configured correctly. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    DashboardPageConfigNotFound: ({ configPath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Dashboard page config not found at ${configPath}`}\n        />\n      );\n    },\n    EmbeddedScriptConfigNotFound: ({ configPath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Embedded script config not found at ${configPath}`}\n        />\n      );\n    },\n    CustomElementConfigNotFound: ({ configPath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Site widget config not found at ${configPath}`}\n        />\n      );\n    },\n    NoExtensionsFound: () => {\n      return () => (\n        <ErrorMessage\n          message=\"Your project doesn't seem to have any extensions.\"\n          explanation=\"Extensions are the building blocks of your app.\"\n          hint=\"Make sure it is configured properly, or read our documentation (​https://wix.to/b7o4Ml0) to start developing your first extension.\"\n        />\n      );\n    },\n    NoPagesDirectoryFound: ({ srcDir }) => {\n      return () => (\n        <ErrorMessage\n          message={\n            <>\n              No <Text bold>pages</Text> directory was found under{' '}\n              <Text bold>{srcDir}</Text>.\n            </>\n          }\n          hint={\n            <Text>\n              Consider re-cloning the project repository or creating a{' '}\n              <Text bold>pages</Text> directory under <Text bold>{srcDir}</Text>\n              .\n            </Text>\n          }\n        />\n      );\n    },\n    DashboardPluginConfigNotFound: ({ configPath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Dashboard plugin config not found at ${configPath}`}\n        />\n      );\n    },\n    DashboardMenuPluginConfigNotFound: ({ configPath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Dashboard menu plugin config not found at ${configPath}`}\n        />\n      );\n    },\n    ServicePluginConfigNotFound: ({ configPath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Service plugin config not found at ${configPath}`}\n        />\n      );\n    },\n    DashboardModalConfigNotFound: ({ configPath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Dashboard modal config not found at ${configPath}`}\n        />\n      );\n    },\n    InvalidConfigSchemaError: ({ configPath, zodError }) => {\n      return () => (\n        <ErrorMessage\n          message={outdent`\n            Invalid configuration found at \\`${configPath}\\`:\n            The following errors were found:\n            ${zodError.errors.map(formatZodIssue).join('\\n')}`}\n          hint=\"Fix the errors above for your configurations to be applied successfully.\"\n        />\n      );\n    },\n    InvalidParamsOverrideSchemaError: ({ paramsOverridePath, zodError }) => {\n      return () => (\n        <ErrorMessage\n          message={outdent`\n            Invalid params override found at \\`${paramsOverridePath}\\`:\n            The following errors were found:\n            ${zodError.errors.map(formatZodIssue).join('\\n')}`}\n          hint=\"Fix the errors above for your params override to be applied successfully.\"\n        />\n      );\n    },\n    InvalidDependenciesJsonSchemaError: ({ path, zodError }) => {\n      return () => (\n        <ErrorMessage\n          message={outdent`\n            Invalid configuration found at \\`${path}\\`:\n            The following errors were found:\n            ${zodError.errors.map(formatZodIssue).join('\\n')}`}\n          hint={\n            <Text>\n              Try to re-install <Text bold>@wix/cli-app</Text> dependency\n            </Text>\n          }\n        />\n      );\n    },\n    PermissionDenied: () => {\n      return () => (\n        <ErrorMessage message=\"Forbidden operation. Missing permissions\" />\n      );\n    },\n    FailedToReadProjectFiles: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to read source files: make sure you have an 'src' folder and that it's readable. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToCreateVersionForSubmittedApp: () => {\n      return () => (\n        <ErrorMessage\n          message=\"Cannot create a new application version because the app has an active marketplace submission\"\n          hint=\"You will be able continue creating versions when your submission is approved or retracted\"\n        />\n      );\n    },\n    GridAppFilesMaxLengthExcceeded: ({ maxSizeViolationsData, filePaths }) => {\n      let errorMessage =\n        'Found one or more project files that are bigger than the allowed limit';\n\n      if (maxSizeViolationsData?.files.length) {\n        errorMessage += ` (${\n          maxSizeViolationsData.expectedSize\n        }KB): ${maxSizeViolationsData.files\n          .map((f) => `${filePaths[f.fileIndex]} (${f.receivedSize}KB)`)\n          .join(', ')}`;\n      }\n\n      return () => <ErrorMessage message={errorMessage} />;\n    },\n    GridAppFailedToUpdateFiles: () => {\n      return () => (\n        <ErrorMessage\n          message={outdent`\n            Failed to update files.\n            Failed to sync changes from local files to the Dev Editor\n            Still watching local files and will continue to sync changes...\n          `}\n        />\n      );\n    },\n    FailedToWatchFiles: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n\n      return () => (\n        <ErrorMessage\n          message={`Failed to watch files. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToCreateGridApp: ({ error }) => {\n      return () => (\n        <ErrorMessage\n          message=\"Failed to create an isolated environment.\"\n          explanation={error}\n        />\n      );\n    },\n    DeviceCodeTimedOut: () => {\n      return () => (\n        <ErrorMessage message=\"The device code has not been approved in the time allocated, please start the login process again.\" />\n      );\n    },\n    DuplicateComponentIdsError: ({ issues }) => {\n      const Issue = ({ issue }: { issue: (typeof issues)[0] }) => {\n        const typeToName = (type: (typeof issue)['components'][0]['type']) =>\n          match(type, {\n            page: () => 'page',\n            plugin: () => 'plugin',\n            'menu-plugin': () => 'menu plugin',\n            'sidebar-category': () => 'sidebar category',\n            'embedded-script': () => 'embedded script',\n            'custom-element': () => 'custom element',\n            modal: () => 'modal',\n            topology: () => 'topology',\n          });\n        return (\n          <Box flexDirection=\"column\">\n            <Text>\n              <Text bold>Duplicate ID: </Text>\n              {issue.id}\n            </Text>\n            <Text bold>Extensions:</Text>\n            {issue.components.map(({ name, path, type }) => (\n              <Text key={path}>\n                [{typeToName(type)}] {name} ({path})\n              </Text>\n            ))}\n            <Text>\n              <Text bold>Possible GUID: </Text>\n              {issue.suggestedId}\n            </Text>\n          </Box>\n        );\n      };\n      const hint = (\n        <Box flexDirection=\"column\" rowGap={1}>\n          <Text>\n            You can use the provided suggested GUIDs as the ID of the newly\n            created extension.\n          </Text>\n          {issues.map((issue) => (\n            <Issue issue={issue} key={issue.id} />\n          ))}\n        </Box>\n      );\n\n      return () => (\n        <ErrorMessage\n          message=\"Found multiple extensions with the same id, this might happen if you copy paste folders.\"\n          hint={hint}\n        />\n      );\n    },\n    InvalidResponseData: () => {\n      return () => (\n        <SystemErrorMessage message=\"Got unexpected response from server.\" />\n      );\n    },\n    InvalidCreateAppResponse: () => {\n      return () => (\n        <ErrorMessage message=\"`createApp` returned an invalid response.\" />\n      );\n    },\n    InvalidDeployAppResponse: () => {\n      return () => (\n        <ErrorMessage message=\"Got unexpected response from server. Make sure you are running a supported version of the Velo CLI.\" />\n      );\n    },\n    InvalidGetDeploymentResponse: () => {\n      return () => (\n        <ErrorMessage message=\"Got unexpected response from server. Please try again later..\" />\n      );\n    },\n    FailedToGetPagesDiff: () => {\n      return () => <ErrorMessage message=\"Failed to request pages diff.\" />;\n    },\n    InvalidViteBuildOutput: () => {\n      return () => <ErrorMessage message=\"Invalid vite build output\" />;\n    },\n    ViteModuleBundleNotFound: () => {\n      return () => (\n        <ErrorMessage message=\"Could not find module bundle in vite build output\" />\n      );\n    },\n    ViteFileNotFoundInOutput: ({ fileName }) => {\n      return () => (\n        <ErrorMessage\n          message={`Could not find ${fileName} in vite build output`}\n        />\n      );\n    },\n    FailedToCreateBackendDeployment: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to create backend deployment\" />\n      );\n    },\n    FailedToUpdateBackendDeployment: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to update backend deployment\" />\n      );\n    },\n    InvalidDeploymentUrl: ({ deploymentUrl }) => {\n      return () => (\n        <ErrorMessage\n          message={`Invalid deployment URL: \\`${deploymentUrl}\\``}\n        />\n      );\n    },\n    FailedToGetBackendDeployment: () => {\n      return () => <ErrorMessage message=\"Failed to get backend deployment\" />;\n    },\n    FailedToDeployBackend: () => {\n      return () => <ErrorMessage message=\"Failed to deploy backend\" />;\n    },\n    FailedToMarkDeploymentAsPermanent: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to make backend deployment permanent\" />\n      );\n    },\n    FailedToGetUserInfo: () => {\n      return () => <ErrorMessage message=\"Failed to get user information.\" />;\n    },\n    FailedToGetMyAccount: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to get account information.\" />\n      );\n    },\n    FailedToCreateDevelopmentSite: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to create a Development Site\" />\n      );\n    },\n    FailedToGetDevelopmentSites: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to request development sites.\" />\n      );\n    },\n    FailedToGetDevelopmentSitesLimit: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to request development sites limit.\" />\n      );\n    },\n    FailedToGetRequiredApps: () => {\n      return () => <ErrorMessage message=\"Failed to get app required apps.\" />;\n    },\n    FailedToGetMarketListing: () => {\n      return () => <ErrorMessage message=\"Failed to get market listing.\" />;\n    },\n    FailedToAddRequiredApp: () => {\n      return () => <ErrorMessage message=\"Failed to add required app.\" />;\n    },\n    FailedToQuerySites: () => {\n      return () => <ErrorMessage message=\"Failed to request sites list.\" />;\n    },\n    FailedToGetSite: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to get information about your configured Development Site\" />\n      );\n    },\n    FailedToDeploySite: () => {\n      return () => <ErrorMessage message=\"Failed to deploy site.\" />;\n    },\n    FailedToPublishDeployment: () => {\n      return () => <SystemErrorMessage message=\"Failed to publish site.\" />;\n    },\n    FailedToSaveDevelopmentSite: ({ path }) => {\n      return () => (\n        <ErrorMessage\n          message=\"Failed to save the current development site.\"\n          hint={`Make sure the \\`${path}\\` file has proper permissions and is accessible`}\n        />\n      );\n    },\n    FailedToBuildApp: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={\n            <>\n              Failed to build the application.\n              <Newline />\n              {causeMessage}\n            </>\n          }\n          hint={'Please check the build output for more information'}\n        />\n      );\n    },\n    FailedToCheckIfAppInstalled: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to fetch site installation details\" />\n      );\n    },\n    FailedToInitializeGitRepo: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to initialize git repo. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToInstallDependencies: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to install dependencies. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToCommitChanges: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to commit changes. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToDeleteAuthData: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage message={`Failed to delete auth data: ${causeMessage}`} />\n      );\n    },\n    FailedToDeleteLegacyAuthData: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to delete legacy auth data: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToSaveAuthData: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage message={`Failed to save auth data: ${causeMessage}`} />\n      );\n    },\n    FailedToSaveApiKeyAuthData: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to save api key auth data: ${causeMessage}`}\n        />\n      );\n    },\n    FailedToWriteJson: ({ filePath, cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to write JSON at path: ${filePath}. Cause: ${causeMessage}`}\n        />\n      );\n    },\n    TemplatePathNotFound: ({ templatePath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Template path not found: ${templatePath}`}\n          hint=\"Make sure the template path exists in the remote repository\"\n        />\n      );\n    },\n    FailedToCloneRepo: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Failed to clone repo: ${causeMessage}`}\n          hint=\"Make sure the Git URL is correct and that your local Git is configured properly to access the remote repository\"\n        />\n      );\n    },\n    InvalidGitUrl: ({ url }) => {\n      return () => (\n        <ErrorMessage\n          message={`Invalid Git URL: ${url}`}\n          hint=\"Make sure the Git URL is in the correct format\"\n        />\n      );\n    },\n    AuthenticationRequired: () => {\n      return () => (\n        <ErrorMessage message=\"You have to already be logged in to run this command.\" />\n      );\n    },\n    SiteConfiguredRequired: () => {\n      return () => (\n        <ErrorMessage message=\"You must configure the development site before running this command, or provide a site-id in the command options.\" />\n      );\n    },\n    FailedAddingPackageToWorkspace: () => {\n      return () => (\n        <ErrorMessage\n          message=\"Could not add package to the workspaces configuration. Please add it as instructed by your package manager.\"\n          hint={\n            <Text>\n              Full error can be found in <Text bold>wix-error.log</Text>\n            </Text>\n          }\n        />\n      );\n    },\n    FailedToGenerateSelfsignedCertificate: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to generate a Selfsigned certificate for development.\" />\n      );\n    },\n    NonInteractiveTerminal: () => {\n      return () => (\n        <ErrorMessage message=\"This command is not supported in non-interactive terminals. Please run the command in an interactive terminal (TTY).\" />\n      );\n    },\n    FailedToResolveViteOrigin: () => {\n      return () => (\n        <ErrorMessage message=\"Failed to resolve the base url for CSS asset urls\" />\n      );\n    },\n    FailedToCreateAppRelease: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to create an app configuration.\" />\n      );\n    },\n    FailedToUpdateAppRelease: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to update an app configuration.\" />\n      );\n    },\n    FailedToCreateComponents: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to create components.\" />\n      );\n    },\n    FailedToCheckDeprecatedStatus: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to check cli version deprecated status.\" />\n      );\n    },\n    FailedToGetResolveNpmDependenciesResult: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to resolve Wix's lockfile.\" />\n      );\n    },\n    CliAppVersionMismatch: ({ cliVersion, cliAppVersion }) => {\n      return () => (\n        <ErrorMessage\n          message={\n            <Text>\n              The versions of <Text bold>@wix/cli</Text> ({cliVersion}) and{' '}\n              <Text bold>@wix/cli-app</Text> ({cliAppVersion}) dependencies do\n              not match\n            </Text>\n          }\n          hint={\n            <Text>\n              Align their versions in your <Text bold>package.json</Text> and\n              re-install dependencies\n            </Text>\n          }\n        />\n      );\n    },\n    FailedToGetAppValidity: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to get validation status for app version\" />\n      );\n    },\n    InvalidDashboardPageRoute: ({ route, errorMessage }) => {\n      return () => (\n        <ErrorMessage\n          message={`Invalid dashboard page route: ${route}`}\n          hint={errorMessage}\n        />\n      );\n    },\n    InvalidEmbeddedScriptFolder: ({ path, errorMessage }) => {\n      return () => (\n        <ErrorMessage\n          message={`Invalid embedded script folder: ${path}`}\n          hint={errorMessage}\n        />\n      );\n    },\n    InvalidEmbeddedScriptTemplate: ({ templateFilename, errorMessage }) => {\n      return () => (\n        <ErrorMessage\n          message={`Invalid embedded script template in ${templateFilename}`}\n          hint={errorMessage}\n        />\n      );\n    },\n    InvalidCustomElementTagName: ({ tagName, errorMessage }) => {\n      return () => (\n        <ErrorMessage\n          message={\n            <Text>\n              We use name of folder as tagName for your site widget.\n              Unfortunately, <Text bold>{tagName}</Text> is invalid tagName.\n              Reason: {errorMessage}\n            </Text>\n          }\n          hint={\n            <Text>\n              You can find rules for tagName here:{' '}\n              <Text bold>\n                https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define#valid_custom_element_names\n              </Text>\n            </Text>\n          }\n        />\n      );\n    },\n    InvalidSiteFrontendPackageVersion: ({ packageName, versionRange }) => {\n      return () => (\n        <ErrorMessage\n          message={\n            <Text>\n              Package <Text bold>{packageName}</Text> has an invalid version\n              range <Text bold>{versionRange}</Text> in your{' '}\n              <Text bold>package.json</Text> file.\n            </Text>\n          }\n          hint={\n            <Text>\n              The version range must follow{' '}\n              <Text bold>semantic versioning</Text> rules, and it must contain a\n              major version.\n              <Newline />\n              Read more about it here:{' '}\n              <Link url=\"https://docs.npmjs.com/about-semantic-versioning\" />\n            </Text>\n          }\n        />\n      );\n    },\n    FailedToCreateSiteOverride: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to create site override configuration\" />\n      );\n    },\n    FailedToGetPipelineErrorInfo: () => {\n      return () => <SystemErrorMessage message=\"Failed to get error details\" />;\n    },\n    FailedToGetDeploymentStatus: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to get deployment status\" />\n      );\n    },\n    NetworkError: ({ cause }) => {\n      const causeMessage = getErrorMessage(cause);\n      return () => (\n        <ErrorMessage\n          message={`Network error occurred. Cause: ${causeMessage}`}\n          hint={`Make sure you have an active internet connection and try again shortly.`}\n        />\n      );\n    },\n    FailedToGenerateAppMarketQueryParam: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to get generate appMarket query parameter\" />\n      );\n    },\n    FailedToParseLog: () => {\n      return () => (\n        <SystemErrorMessage message=\"Failed to parse log from the server\" />\n      );\n    },\n    AppForVersionNotFound: ({ version }) => {\n      return () => (\n        <ErrorMessage\n          message={`Could not find app configuration for the provided version: \"${version}\"`}\n          hint={`Make sure that there is an app for this version.`}\n        />\n      );\n    },\n    FailedToFetchAppForVersion: () => {\n      return () => (\n        <SystemErrorMessage message={`Failed to fetch app configuration`} />\n      );\n    },\n    FailedToGetAppSecret: () => {\n      return () => (\n        <SystemErrorMessage\n          message={`Failed to fetch app keys and configuration`}\n        />\n      );\n    },\n    FailedToConnectToLogsService: () => {\n      return () => (\n        <ErrorMessage message={`Failed to connect to logs service.`} />\n      );\n    },\n    FailedToGetLogsTopology: () => {\n      return () => (\n        <ErrorMessage\n          message={`Failed to fetch logs configuration for the given version.`}\n          hint={`Try to use a different version.`}\n        />\n      );\n    },\n    FailedInstallCloudflareNoAccess: ({ path }) => {\n      return () => (\n        <ErrorMessage\n          message={`Failed to install required binary in \"${path}\"`}\n          hint={`Check that you have required permissions.`}\n        />\n      );\n    },\n    LogsConnectionTimeout: () => {\n      return () => (\n        <ErrorMessage message={`Log session has been closed due to timeout.`} />\n      );\n    },\n    InvalidServicePluginImplementation: () => {\n      return () => (\n        <ErrorMessage\n          message={`Your service plugin implementation is incorrect.`}\n        />\n      );\n    },\n    UnknownServicePlugin: ({ name }) => {\n      return () => (\n        <ErrorMessage\n          message={`Unknown service plugin with the name of \\`${name}\\``}\n        />\n      );\n    },\n    InvalidServicePluginFolder: ({ relativePath }) => {\n      return () => (\n        <ErrorMessage\n          message={`Invalid folder for service plugin in \\`${relativePath}\\``}\n        />\n      );\n    },\n    InvalidSiteOverrideID: () => {\n      return () => (\n        <ErrorMessage\n          message={`Failed to read devSiteOverrideId from local app configurations.`}\n          hint={`Restart the dev environment and make sure that the .wix/app.config.json file exists.`}\n        />\n      );\n    },\n  });\n}\n\nfunction getErrorMessage(cause: unknown) {\n  return cause instanceof Error ? cause.message : JSON.stringify(cause);\n}\n\nfunction formatZodIssue(issue: ZodIssue) {\n  const path = issue.path.join('.');\n\n  if (!path) {\n    return `- ${issue.message}`;\n  }\n\n  return `- \\`${path}\\`: ${issue.message}`;\n}\n","type TODO = any;\n\n// In the absence of a WeakSet or WeakMap implementation, don't break, but don't cache either.\nfunction noop(...args: Array<any>) {}\nfunction createWeakMap<K extends object, V>(): MyWeakMap<K, V> {\n  if (typeof WeakMap !== \"undefined\") {\n    return new WeakMap<K, V>();\n  } else {\n    return fakeSetOrMap<K, V>();\n  }\n}\n\ntype MyWeakMap<K extends object, V> = Pick<\n  WeakMap<K, V>,\n  \"delete\" | \"get\" | \"set\" | \"has\"\n>;\ntype MyWeakSetMap<K extends object, V> =\n  & Pick<WeakMap<K, V>, \"delete\" | \"get\" | \"set\" | \"has\">\n  & Pick<WeakSet<K>, \"add\">;\n\n/**\n * Creates and returns a no-op implementation of a WeakMap / WeakSet that never stores anything.\n */\nfunction fakeSetOrMap<K extends object, V = any>(): MyWeakSetMap<K, V> {\n  return {\n    add: noop as WeakSet<K>[\"add\"],\n    delete: noop as WeakMap<K, V>[\"delete\"],\n    get: noop as WeakMap<K, V>[\"get\"],\n    set: noop as WeakMap<K, V>[\"set\"],\n    has(k: K) {\n      return false;\n    },\n  };\n}\n\n// Safe hasOwnProperty\nconst hop = Object.prototype.hasOwnProperty;\nconst has = function (obj: object, prop: string): boolean {\n  return hop.call(obj, prop);\n};\n\n// Copy all own enumerable properties from source to target\nfunction extend<T, S extends object>(target: T, source: S) {\n  type Extended = T & S;\n  for (const prop in source) {\n    if (has(source, prop)) {\n      (target as any)[prop] = source[prop];\n    }\n  }\n  return target as Extended;\n}\n\nconst reLeadingNewline = /^[ \\t]*(?:\\r\\n|\\r|\\n)/;\nconst reTrailingNewline = /(?:\\r\\n|\\r|\\n)[ \\t]*$/;\nconst reStartsWithNewlineOrIsEmpty = /^(?:[\\r\\n]|$)/;\nconst reDetectIndentation = /(?:\\r\\n|\\r|\\n)([ \\t]*)(?:[^ \\t\\r\\n]|$)/;\nconst reOnlyWhitespaceWithAtLeastOneNewline = /^[ \\t]*[\\r\\n][ \\t\\r\\n]*$/;\n\nfunction _outdentArray(\n  strings: ReadonlyArray<string>,\n  firstInterpolatedValueSetsIndentationLevel: boolean,\n  options: Options,\n) {\n  // If first interpolated value is a reference to outdent,\n  // determine indentation level from the indentation of the interpolated value.\n  let indentationLevel = 0;\n\n  const match = strings[0].match(reDetectIndentation);\n  if (match) {\n    indentationLevel = match[1].length;\n  }\n\n  const reSource = `(\\\\r\\\\n|\\\\r|\\\\n).{0,${indentationLevel}}`;\n  const reMatchIndent = new RegExp(reSource, \"g\");\n\n  if (firstInterpolatedValueSetsIndentationLevel) {\n    strings = strings.slice(1);\n  }\n\n  const { newline, trimLeadingNewline, trimTrailingNewline } = options;\n  const normalizeNewlines = typeof newline === \"string\";\n  const l = strings.length;\n  const outdentedStrings = strings.map((v, i) => {\n    // Remove leading indentation from all lines\n    v = v.replace(reMatchIndent, \"$1\");\n    // Trim a leading newline from the first string\n    if (i === 0 && trimLeadingNewline) {\n      v = v.replace(reLeadingNewline, \"\");\n    }\n    // Trim a trailing newline from the last string\n    if (i === l - 1 && trimTrailingNewline) {\n      v = v.replace(reTrailingNewline, \"\");\n    }\n    // Normalize newlines\n    if (normalizeNewlines) {\n      v = v.replace(/\\r\\n|\\n|\\r/g, (_) => newline as string);\n    }\n    return v;\n  });\n  return outdentedStrings;\n}\n\nfunction concatStringsAndValues(\n  strings: ReadonlyArray<string>,\n  values: ReadonlyArray<any>,\n): string {\n  let ret = \"\";\n  for (let i = 0, l = strings.length; i < l; i++) {\n    ret += strings[i];\n    if (i < l - 1) {\n      ret += values[i];\n    }\n  }\n  return ret;\n}\n\nfunction isTemplateStringsArray(v: any): v is TemplateStringsArray {\n  return has(v, \"raw\") && has(v, \"length\");\n}\n\n/**\n * It is assumed that opts will not change.  If this is a problem, clone your options object and pass the clone to\n * makeInstance\n * @param options\n * @return {outdent}\n */\nfunction createInstance(options: Options): Outdent {\n  /** Cache of pre-processed template literal arrays */\n  const arrayAutoIndentCache = createWeakMap<\n    TemplateStringsArray,\n    Array<string>\n  >();\n  /**\n     * Cache of pre-processed template literal arrays, where first interpolated value is a reference to outdent,\n     * before interpolated values are injected.\n     */\n  const arrayFirstInterpSetsIndentCache = createWeakMap<\n    TemplateStringsArray,\n    Array<string>\n  >();\n\n  /* tslint:disable:no-shadowed-variable */\n  function outdent(\n    stringsOrOptions: TemplateStringsArray,\n    ...values: Array<any>\n  ): string;\n  function outdent(stringsOrOptions: Options): Outdent;\n  function outdent(\n    stringsOrOptions: TemplateStringsArray | Options,\n    ...values: Array<any>\n  ): string | Outdent {\n    /* tslint:enable:no-shadowed-variable */\n    if (isTemplateStringsArray(stringsOrOptions)) {\n      const strings = stringsOrOptions;\n\n      // Is first interpolated value a reference to outdent, alone on its own line, without any preceding non-whitespace?\n      const firstInterpolatedValueSetsIndentationLevel =\n        (values[0] === outdent || values[0] === defaultOutdent) &&\n        reOnlyWhitespaceWithAtLeastOneNewline.test(strings[0]) &&\n        reStartsWithNewlineOrIsEmpty.test(strings[1]);\n\n      // Perform outdentation\n      const cache = firstInterpolatedValueSetsIndentationLevel\n        ? arrayFirstInterpSetsIndentCache\n        : arrayAutoIndentCache;\n      let renderedArray = cache.get(strings);\n      if (!renderedArray) {\n        renderedArray = _outdentArray(\n          strings,\n          firstInterpolatedValueSetsIndentationLevel,\n          options,\n        );\n        cache.set(strings, renderedArray);\n      }\n      /** If no interpolated values, skip concatenation step */\n      if (values.length === 0) {\n        return renderedArray[0];\n      }\n      /** Concatenate string literals with interpolated values */\n      const rendered = concatStringsAndValues(\n        renderedArray,\n        firstInterpolatedValueSetsIndentationLevel ? values.slice(1) : values,\n      );\n\n      return rendered;\n    } else {\n      // Create and return a new instance of outdent with the given options\n      return createInstance(\n        extend(extend({}, options), stringsOrOptions || {}),\n      );\n    }\n  }\n\n  const fullOutdent = extend(outdent, {\n    string(str: string): string {\n      return _outdentArray([str], false, options)[0];\n    },\n  });\n\n  return fullOutdent;\n}\n\nconst defaultOutdent = createInstance({\n  trimLeadingNewline: true,\n  trimTrailingNewline: true,\n});\n\nexport interface Outdent {\n  /**\n     * Remove indentation from a template literal.\n     */\n  (strings: TemplateStringsArray, ...values: Array<any>): string;\n  /**\n     * Create and return a new Outdent instance with the given options.\n     */\n  (options: Options): Outdent;\n\n  /**\n     * Remove indentation from a string\n     */\n  string(str: string): string;\n\n  // /**\n  //  * Remove indentation from a template literal, but return a tuple of the\n  //  * outdented TemplateStringsArray and\n  //  */\n  // pass(strings: TemplateStringsArray, ...values: Array<any>): [TemplateStringsArray, ...Array<any>];\n}\nexport interface Options {\n  trimLeadingNewline?: boolean;\n  trimTrailingNewline?: boolean;\n  /**\n     * Normalize all newlines in the template literal to this value.\n     * \n     * If `null`, newlines are left untouched.\n     * \n     * Newlines that get normalized are '\\r\\n', '\\r', and '\\n'.\n     * \n     * Newlines within interpolated values are *never* normalized.\n     * \n     * Although intended for normalizing to '\\n' or '\\r\\n',\n     * you can also set to any string; for example ' '.\n     */\n  newline?: string | null;\n}\n\n// Named exports.  Simple and preferred.\n// import outdent from 'outdent';\nexport default defaultOutdent;\n// import {outdent} from 'outdent';\nexport { defaultOutdent as outdent };\n\n// In CommonJS environments, enable `var outdent = require('outdent');` by\n// replacing the exports object.\n// Make sure that our replacement includes the named exports from above.\ndeclare var module: any;\nif (typeof module !== \"undefined\") {\n  // In webpack harmony-modules environments, module.exports is read-only,\n  // so we fail gracefully.\n  try {\n    module.exports = defaultOutdent;\n    Object.defineProperty(defaultOutdent, \"__esModule\", { value: true });\n    (defaultOutdent as any).default = defaultOutdent;\n    (defaultOutdent as any).outdent = defaultOutdent;\n  } catch (e) {}\n}\n","import React from 'react';\nimport type { ReactElement, FC, ReactNode } from 'react';\nimport { Alert, Box, InsightIcon, Text } from '@wix/cli-ui-kit';\n\nexport const ErrorMessage: FC<{\n  message: string | ReactNode;\n  explanation?: string | ReactNode;\n  hint?: string | ReactElement;\n}> = ({ message, explanation, hint }) => (\n  <Box flexDirection=\"column\">\n    <Alert type=\"error\">{message}</Alert>\n\n    {explanation && <Alert type=\"warning\">{explanation}</Alert>}\n\n    {hint && (\n      <Box paddingTop={1} columnGap={1}>\n        <InsightIcon />\n        {typeof hint === 'string' ? <Text>{hint}</Text> : hint}\n      </Box>\n    )}\n  </Box>\n);\n\nexport const SystemErrorMessage: FC<{\n  message: string | ReactNode;\n  explanation?: string | ReactNode;\n  hint?: string | ReactElement;\n}> = ({ message, explanation, hint }) => (\n  <ErrorMessage\n    message={message}\n    explanation={explanation}\n    hint={\n      hint ??\n      'This is probably a temporary system error and has been logged. Try again shortly.'\n    }\n  />\n);\n","import { isType, variant, fields } from 'variant';\nimport type { VariantOf } from 'variant';\nimport {\n  NodeClient,\n  Scope,\n  getDefaultIntegrations,\n  defaultStackParser,\n  makeNodeTransport,\n} from '@sentry/node';\nimport { getTestOverrides } from '@wix/cli-test-overrides';\nimport { extractHttpError, getHttpErrorInfo } from '@wix/cli-http-client';\nimport VError from 'verror';\nimport { outdent } from 'outdent';\nimport type { CliError } from '@wix/cli-error';\nimport {\n  isCliSystemError,\n  normalizeError,\n  CliSystemErrorCode,\n} from '@wix/cli-error';\nimport EventEmitter from 'node:events';\n\nexport interface TypedEventEmitter {\n  on: (event: 'errorReported', listener: (error: CliError) => void) => this;\n\n  emit: (event: 'errorReported', error: CliError) => boolean;\n}\n\nexport interface ErrorReporterOptions {\n  dsn: string;\n  release: string;\n}\n\ninterface User {\n  id: string;\n}\n\ninterface UserFeedback {\n  userId: string;\n  eventId: string;\n  feedback: string;\n}\n\nexport type ErrorReporter = ReturnType<typeof createErrorReporter>;\n\nexport const ReportErrorResult = variant({\n  Reported: fields<{ eventId: string }>(),\n  Ignored: {},\n});\nexport type ReportErrorResult = VariantOf<typeof ReportErrorResult>;\n\nconst reportError = (\n  scope: Scope,\n  originalError: CliError,\n  { data }: { data?: unknown } = {}\n) => {\n  if (!isCliSystemError(originalError)) {\n    return ReportErrorResult.Ignored();\n  }\n\n  const error = isType(originalError.cliCode, CliSystemErrorCode.UnknownFailure)\n    ? originalError.cliCode.error\n    : originalError;\n\n  const eventId = scope.captureException(error, {\n    data,\n    captureContext: (localScope) => {\n      const httpError = extractHttpError(error);\n      if (httpError) {\n        localScope.setTag('requestId', httpError.requestId);\n        localScope.setContext('requestInfo', getHttpErrorInfo(httpError));\n      }\n      if (error instanceof Error) {\n        localScope.setContext('error details', {\n          info: VError.info(error),\n          fullStack: VError.fullStack(error),\n        });\n      }\n\n      return localScope;\n    },\n  });\n\n  return ReportErrorResult.Reported({ eventId });\n};\n\nexport function createErrorReporter({ dsn, release }: ErrorReporterOptions) {\n  const { sentryDsn: sentryDsnOverride } = getTestOverrides();\n\n  // https://docs.sentry.io/platforms/javascript/best-practices/multiple-sentry-instances/\n  const sentryClient = new NodeClient({\n    enabled:\n      sentryDsnOverride !== undefined || process.env.NODE_ENV === 'production',\n    dsn: sentryDsnOverride ?? dsn,\n    release,\n    integrations: getDefaultIntegrations({}).filter(\n      (integration) =>\n        integration.name !== 'OnUnhandledRejection' &&\n        integration.name !== 'OnUncaughtException' &&\n        // By default, @sentry/node adds metadata about installed packages.\n        integration.name !== 'Modules'\n    ),\n    stackParser: defaultStackParser,\n    transport: makeNodeTransport,\n    beforeSend(event) {\n      // By default @sentry/node includes the local hostname as `server_name`\n      // which is sensitive and not useful.\n\n      delete event.server_name;\n      return event;\n    },\n    // Since we pass `requestInfo`, the default depth of 3\n    // redacts most useful info passed from API error responses\n    // so we increase it to include more of the potential error http repsonse.\n    normalizeDepth: 10,\n  });\n\n  const sentryScope = new Scope();\n  sentryScope.setClient(sentryClient);\n  sentryClient.init();\n\n  const emitter: TypedEventEmitter = new EventEmitter();\n\n  return {\n    on: emitter.on.bind(emitter),\n    reportError: (\n      originalError: unknown,\n      { data }: { data?: unknown } = {}\n    ) => {\n      const error = normalizeError(originalError);\n      const result = reportError(sentryScope, error, { data });\n\n      emitter.emit('errorReported', error);\n\n      return result;\n    },\n    reportUserFeedback: async ({ userId, eventId, feedback }: UserFeedback) => {\n      /**\n       * Importing @sentry/browser because it includes the `captureUserFeedback` method\n       * which is not available in @sentry/node.\n       * This is a workaround until the method is added to @sentry/node.\n       * See: https://github.com/getsentry/sentry-javascript/issues/11072\n       */\n      const { BrowserClient } = await import('@sentry/browser');\n\n      const client = new BrowserClient({\n        enabled: sentryClient.getOptions().enabled,\n        dsn: sentryClient.getOptions().dsn,\n        integrations: [],\n        transport: makeNodeTransport,\n        stackParser: defaultStackParser,\n      });\n\n      client.captureUserFeedback({\n        event_id: eventId,\n        name: '',\n        email: `${userId}@wix.com`,\n        comments: outdent`\n          ---\n          user: https://bo.wix.com/um/users/${userId}\n          ---\n          ${feedback}\n        `,\n      });\n    },\n    setContext: (name: string, context: Record<string, unknown>) =>\n      sentryScope.setContext(name, context),\n    setUser: (user: User) => sentryScope.setUser(user),\n    getUser: (): User | undefined => {\n      const user = sentryScope.getUser();\n      if (typeof user?.id === 'string') {\n        return { id: user.id };\n      }\n    },\n  };\n}\n","export { httpIntegration } from './integrations/http.js';\nexport { nativeNodeFetchIntegration } from './integrations/node-fetch.js';\nexport { consoleIntegration } from './integrations/console.js';\nexport { nodeContextIntegration } from './integrations/context.js';\nexport { contextLinesIntegration } from './integrations/contextlines.js';\nexport { localVariablesIntegration } from './integrations/local-variables/index.js';\nexport { modulesIntegration } from './integrations/modules.js';\nexport { onUncaughtExceptionIntegration } from './integrations/onuncaughtexception.js';\nexport { onUnhandledRejectionIntegration } from './integrations/onunhandledrejection.js';\nexport { anrIntegration } from './integrations/anr/index.js';\nexport { expressErrorHandler, expressIntegration, setupExpressErrorHandler } from './integrations/tracing/express.js';\nexport { fastifyIntegration, setupFastifyErrorHandler } from './integrations/tracing/fastify.js';\nexport { graphqlIntegration } from './integrations/tracing/graphql.js';\nexport { mongoIntegration } from './integrations/tracing/mongo.js';\nexport { mongooseIntegration } from './integrations/tracing/mongoose.js';\nexport { mysqlIntegration } from './integrations/tracing/mysql.js';\nexport { mysql2Integration } from './integrations/tracing/mysql2.js';\nexport { redisIntegration } from './integrations/tracing/redis.js';\nexport { nestIntegration, setupNestErrorHandler } from './integrations/tracing/nest.js';\nexport { postgresIntegration } from './integrations/tracing/postgres.js';\nexport { prismaIntegration } from './integrations/tracing/prisma.js';\nexport { hapiIntegration, setupHapiErrorHandler } from './integrations/tracing/hapi/index.js';\nexport { koaIntegration, setupKoaErrorHandler } from './integrations/tracing/koa.js';\nexport { connectIntegration, setupConnectErrorHandler } from './integrations/tracing/connect.js';\nexport { spotlightIntegration } from './integrations/spotlight.js';\nexport { SentryContextManager } from './otel/contextManager.js';\nexport { generateInstrumentOnce } from './otel/instrument.js';\nexport { getDefaultIntegrations, getDefaultIntegrationsWithoutPerformance, init, initWithoutDefaultIntegrations, validateOpenTelemetrySetup } from './sdk/index.js';\nexport { initOpenTelemetry, preloadOpenTelemetry } from './sdk/initOtel.js';\nexport { getAutoPerformanceIntegrations } from './integrations/tracing/index.js';\nexport { defaultStackParser, getSentryRelease } from './sdk/api.js';\nexport { createGetModuleFromFilename } from './utils/module.js';\nexport { makeNodeTransport } from './transports/http.js';\nexport { NodeClient } from './sdk/client.js';\nexport { cron } from './cron/index.js';\nexport { DEFAULT_USER_INCLUDES, addRequestDataToEvent, extractRequestData } from '@sentry/utils';\nexport { addOpenTelemetryInstrumentation, continueTrace, setOpenTelemetryContextAsyncContextStrategy as setNodeAsyncContextStrategy } from '@sentry/opentelemetry';\nexport { SDK_VERSION, SEMANTIC_ATTRIBUTE_SENTRY_OP, SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN, SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE, SEMANTIC_ATTRIBUTE_SENTRY_SOURCE, Scope, addBreadcrumb, addEventProcessor, addIntegration, captureCheckIn, captureConsoleIntegration, captureEvent, captureException, captureFeedback, captureMessage, captureSession, close, createTransport, debugIntegration, dedupeIntegration, endSession, extraErrorDataIntegration, flush, functionToStringIntegration, getActiveSpan, getClient, getCurrentHub, getCurrentScope, getGlobalScope, getIsolationScope, getRootSpan, getSpanDescendants, getSpanStatusFromHttpCode, inboundFiltersIntegration, isInitialized, lastEventId, linkedErrorsIntegration, metricsDefault as metrics, parameterize, requestDataIntegration, rewriteFramesIntegration, sessionTimingIntegration, setContext, setCurrentClient, setExtra, setExtras, setHttpStatus, setMeasurement, setTag, setTags, setUser, spanToBaggageHeader, spanToJSON, spanToTraceHeader, startInactiveSpan, startNewTrace, startSession, startSpan, startSpanManual, trpcMiddleware, withActiveSpan, withIsolationScope, withMonitor, withScope, zodErrorsIntegration } from '@sentry/core';\n//# sourceMappingURL=index.js.map\n","import type { SpanKind, SpanStatus } from '@opentelemetry/api';\nimport type { ReadableSpan, TimedEvent } from '@opentelemetry/sdk-trace-base';\n\nimport type { AbstractSpan } from '../types';\n\n/**\n * Check if a given span has attributes.\n * This is necessary because the base `Span` type does not have attributes,\n * so in places where we are passed a generic span, we need to check if we want to access them.\n */\nexport function spanHasAttributes<SpanType extends AbstractSpan>(\n  span: SpanType,\n): span is SpanType & { attributes: ReadableSpan['attributes'] } {\n  const castSpan = span as ReadableSpan;\n  return !!castSpan.attributes && typeof castSpan.attributes === 'object';\n}\n\n/**\n * Check if a given span has a kind.\n * This is necessary because the base `Span` type does not have a kind,\n * so in places where we are passed a generic span, we need to check if we want to access it.\n */\nexport function spanHasKind<SpanType extends AbstractSpan>(span: SpanType): span is SpanType & { kind: SpanKind } {\n  const castSpan = span as ReadableSpan;\n  return !!castSpan.kind;\n}\n\n/**\n * Check if a given span has a status.\n * This is necessary because the base `Span` type does not have a status,\n * so in places where we are passed a generic span, we need to check if we want to access it.\n */\nexport function spanHasStatus<SpanType extends AbstractSpan>(\n  span: SpanType,\n): span is SpanType & { status: SpanStatus } {\n  const castSpan = span as ReadableSpan;\n  return !!castSpan.status;\n}\n\n/**\n * Check if a given span has a name.\n * This is necessary because the base `Span` type does not have a name,\n * so in places where we are passed a generic span, we need to check if we want to access it.\n */\nexport function spanHasName<SpanType extends AbstractSpan>(span: SpanType): span is SpanType & { name: string } {\n  const castSpan = span as ReadableSpan;\n  return !!castSpan.name;\n}\n\n/**\n * Check if a given span has a kind.\n * This is necessary because the base `Span` type does not have a kind,\n * so in places where we are passed a generic span, we need to check if we want to access it.\n */\nexport function spanHasParentId<SpanType extends AbstractSpan>(\n  span: SpanType,\n): span is SpanType & { parentSpanId: string } {\n  const castSpan = span as ReadableSpan;\n  return !!castSpan.parentSpanId;\n}\n\n/**\n * Check if a given span has events.\n * This is necessary because the base `Span` type does not have events,\n * so in places where we are passed a generic span, we need to check if we want to access it.\n */\nexport function spanHasEvents<SpanType extends AbstractSpan>(\n  span: SpanType,\n): span is SpanType & { events: TimedEvent[] } {\n  const castSpan = span as ReadableSpan;\n  return Array.isArray(castSpan.events);\n}\n","import type { Span } from '@opentelemetry/api';\nimport type { ReadableSpan } from '@opentelemetry/sdk-trace-base';\nimport { SEMATTRS_HTTP_METHOD, SEMATTRS_HTTP_URL } from '@opentelemetry/semantic-conventions';\nimport type { SanitizedRequestData } from '@sentry/types';\nimport { getSanitizedUrlString, parseUrl } from '@sentry/utils';\n\nimport { spanHasAttributes } from './spanTypes';\n\n/**\n * Get sanitizied request data from an OTEL span.\n */\nexport function getRequestSpanData(span: Span | ReadableSpan): Partial<SanitizedRequestData> {\n  // The base `Span` type has no `attributes`, so we need to guard here against that\n  if (!spanHasAttributes(span)) {\n    return {};\n  }\n\n  const data: Partial<SanitizedRequestData> = {\n    url: span.attributes[SEMATTRS_HTTP_URL] as string | undefined,\n    'http.method': span.attributes[SEMATTRS_HTTP_METHOD] as string | undefined,\n  };\n\n  // Default to GET if URL is set but method is not\n  if (!data['http.method'] && data.url) {\n    data['http.method'] = 'GET';\n  }\n\n  try {\n    const urlStr = span.attributes[SEMATTRS_HTTP_URL];\n    if (typeof urlStr === 'string') {\n      const url = parseUrl(urlStr);\n\n      data.url = getSanitizedUrlString(url);\n\n      if (url.search) {\n        data['http.query'] = url.search;\n      }\n      if (url.hash) {\n        data['http.fragment'] = url.hash;\n      }\n    }\n  } catch {\n    // ignore\n  }\n\n  return data;\n}\n","import type { Tracer } from '@opentelemetry/api';\nimport { trace } from '@opentelemetry/api';\nimport type { BasicTracerProvider } from '@opentelemetry/sdk-trace-base';\nimport type { BaseClient } from '@sentry/core';\nimport { SDK_VERSION } from '@sentry/core';\nimport type { Client } from '@sentry/types';\n\nimport type { OpenTelemetryClient as OpenTelemetryClientInterface } from '../types';\n\n// Typescript complains if we do not use `...args: any[]` for the mixin, with:\n// A mixin class must have a constructor with a single rest parameter of type 'any[]'.ts(2545)\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/**\n * Wrap an Client with things we need for OpenTelemetry support.\n *\n * Usage:\n * const OpenTelemetryClient = getWrappedClientClass(NodeClient);\n * const client = new OpenTelemetryClient(options);\n */\nexport function wrapClientClass<\n  ClassConstructor extends new (\n    ...args: any[]\n  ) => Client & BaseClient<any>,\n  WrappedClassConstructor extends new (\n    ...args: any[]\n  ) => Client & BaseClient<any> & OpenTelemetryClientInterface,\n>(ClientClass: ClassConstructor): WrappedClassConstructor {\n  class OpenTelemetryClient extends ClientClass implements OpenTelemetryClientInterface {\n    public traceProvider: BasicTracerProvider | undefined;\n    private _tracer: Tracer | undefined;\n\n    public constructor(...args: any[]) {\n      super(...args);\n    }\n\n    /** Get the OTEL tracer. */\n    public get tracer(): Tracer {\n      if (this._tracer) {\n        return this._tracer;\n      }\n\n      const name = '@sentry/opentelemetry';\n      const version = SDK_VERSION;\n      const tracer = trace.getTracer(name, version);\n      this._tracer = tracer;\n\n      return tracer;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public async flush(timeout?: number): Promise<boolean> {\n      const provider = this.traceProvider;\n      const spanProcessor = provider?.activeSpanProcessor;\n\n      if (spanProcessor) {\n        await spanProcessor.forceFlush();\n      }\n\n      return super.flush(timeout);\n    }\n  }\n\n  return OpenTelemetryClient as unknown as WrappedClassConstructor;\n}\n/* eslint-enable @typescript-eslint/no-explicit-any */\n","import { SpanKind } from '@opentelemetry/api';\n\nimport type { AbstractSpan } from '../types';\nimport { spanHasKind } from './spanTypes';\n\n/**\n * Get the span kind from a span.\n * For whatever reason, this is not public API on the generic \"Span\" type,\n * so we need to check if we actually have a `SDKTraceBaseSpan` where we can fetch this from.\n * Otherwise, we fall back to `SpanKind.INTERNAL`.\n */\nexport function getSpanKind(span: AbstractSpan): SpanKind {\n  if (spanHasKind(span)) {\n    return span.kind;\n  }\n\n  return SpanKind.INTERNAL;\n}\n","import { createContextKey } from '@opentelemetry/api';\n\nexport const SENTRY_TRACE_HEADER = 'sentry-trace';\nexport const SENTRY_BAGGAGE_HEADER = 'baggage';\n\nexport const SENTRY_TRACE_STATE_DSC = 'sentry.dsc';\nexport const SENTRY_TRACE_STATE_PARENT_SPAN_ID = 'sentry.parent_span_id';\nexport const SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING = 'sentry.sampled_not_recording';\nexport const SENTRY_TRACE_STATE_URL = 'sentry.url';\n\nexport const SENTRY_SCOPES_CONTEXT_KEY = createContextKey('sentry_scopes');\n\nexport const SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY = createContextKey('sentry_fork_isolation_scope');\n\nexport const SENTRY_FORK_SET_SCOPE_CONTEXT_KEY = createContextKey('sentry_fork_set_scope');\n\nexport const SENTRY_FORK_SET_ISOLATION_SCOPE_CONTEXT_KEY = createContextKey('sentry_fork_set_isolation_scope');\n","import type { Context } from '@opentelemetry/api';\nimport type { Scope } from '@sentry/types';\nimport { addNonEnumerableProperty } from '@sentry/utils';\n\nimport { SENTRY_SCOPES_CONTEXT_KEY } from '../constants';\nimport type { CurrentScopes } from '../types';\n\nconst SCOPE_CONTEXT_FIELD = '_scopeContext';\n\n/**\n * Try to get the current scopes from the given OTEL context.\n * This requires a Context Manager that was wrapped with getWrappedContextManager.\n */\nexport function getScopesFromContext(context: Context): CurrentScopes | undefined {\n  return context.getValue(SENTRY_SCOPES_CONTEXT_KEY) as CurrentScopes | undefined;\n}\n\n/**\n * Set the current scopes on an OTEL context.\n * This will return a forked context with the Propagation Context set.\n */\nexport function setScopesOnContext(context: Context, scopes: CurrentScopes): Context {\n  return context.setValue(SENTRY_SCOPES_CONTEXT_KEY, scopes);\n}\n\n/**\n * Set the context on the scope so we can later look it up.\n * We need this to get the context from the scope in the `trace` functions.\n */\nexport function setContextOnScope(scope: Scope, context: Context): void {\n  addNonEnumerableProperty(scope, SCOPE_CONTEXT_FIELD, context);\n}\n\n/**\n * Get the context related to a scope.\n * TODO v8: Use this for the `trace` functions.\n * */\nexport function getContextFromScope(scope: Scope): Context | undefined {\n  return (scope as { [SCOPE_CONTEXT_FIELD]?: Context })[SCOPE_CONTEXT_FIELD];\n}\n","import { SEMATTRS_HTTP_URL } from '@opentelemetry/semantic-conventions';\nimport { getClient, isSentryRequestUrl } from '@sentry/core';\n\nimport type { AbstractSpan } from '../types';\nimport { spanHasAttributes } from './spanTypes';\n\n/**\n *\n * @param otelSpan Checks wheter a given OTEL Span is an http request to sentry.\n * @returns boolean\n */\nexport function isSentryRequestSpan(span: AbstractSpan): boolean {\n  if (!spanHasAttributes(span)) {\n    return false;\n  }\n\n  const { attributes } = span;\n\n  const httpUrl = attributes[SEMATTRS_HTTP_URL];\n\n  if (!httpUrl) {\n    return false;\n  }\n\n  return isSentryRequestUrl(httpUrl.toString(), getClient());\n}\n","import type { AttributeValue, Attributes } from '@opentelemetry/api';\nimport { SpanKind } from '@opentelemetry/api';\nimport {\n  SEMATTRS_DB_STATEMENT,\n  SEMATTRS_DB_SYSTEM,\n  SEMATTRS_FAAS_TRIGGER,\n  SEMATTRS_HTTP_METHOD,\n  SEMATTRS_HTTP_ROUTE,\n  SEMATTRS_HTTP_TARGET,\n  SEMATTRS_HTTP_URL,\n  SEMATTRS_MESSAGING_SYSTEM,\n  SEMATTRS_RPC_SERVICE,\n} from '@opentelemetry/semantic-conventions';\nimport type { SpanAttributes, TransactionSource } from '@sentry/types';\nimport { getSanitizedUrlString, parseUrl, stripUrlQueryAndFragment } from '@sentry/utils';\n\nimport { SEMANTIC_ATTRIBUTE_SENTRY_OP } from '@sentry/core';\nimport type { AbstractSpan } from '../types';\nimport { getSpanKind } from './getSpanKind';\nimport { spanHasAttributes, spanHasName } from './spanTypes';\n\ninterface SpanDescription {\n  op: string | undefined;\n  description: string;\n  source: TransactionSource;\n  data?: Record<string, string | undefined>;\n}\n\n/**\n * Infer the op & description for a set of name, attributes and kind of a span.\n */\nexport function inferSpanData(name: string, attributes: SpanAttributes, kind: SpanKind): SpanDescription {\n  // This attribute is intentionally exported as a SEMATTR constant because it should stay intimite API\n  if (attributes['sentry.skip_span_data_inference']) {\n    return {\n      op: undefined,\n      description: name,\n      source: 'custom',\n      data: {\n        // Suggest to callers of `parseSpanDescription` to wipe the hint because it is unnecessary data in the end.\n        'sentry.skip_span_data_inference': undefined,\n      },\n    };\n  }\n\n  // if http.method exists, this is an http request span\n  //\n  // TODO: Referencing `http.request.method` is a temporary workaround until the semantic\n  // conventions export an attribute key for it.\n  const httpMethod = attributes['http.request.method'] || attributes[SEMATTRS_HTTP_METHOD];\n  if (httpMethod) {\n    return descriptionForHttpMethod({ attributes, name, kind }, httpMethod);\n  }\n\n  const dbSystem = attributes[SEMATTRS_DB_SYSTEM];\n  const opIsCache =\n    typeof attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP] === 'string' &&\n    attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP].startsWith('cache.');\n\n  // If db.type exists then this is a database call span\n  // If the Redis DB is used as a cache, the span description should not be changed\n  if (dbSystem && !opIsCache) {\n    return descriptionForDbSystem({ attributes, name });\n  }\n\n  // If rpc.service exists then this is a rpc call span.\n  const rpcService = attributes[SEMATTRS_RPC_SERVICE];\n  if (rpcService) {\n    return {\n      op: 'rpc',\n      description: name,\n      source: 'route',\n    };\n  }\n\n  // If messaging.system exists then this is a messaging system span.\n  const messagingSystem = attributes[SEMATTRS_MESSAGING_SYSTEM];\n  if (messagingSystem) {\n    return {\n      op: 'message',\n      description: name,\n      source: 'route',\n    };\n  }\n\n  // If faas.trigger exists then this is a function as a service span.\n  const faasTrigger = attributes[SEMATTRS_FAAS_TRIGGER];\n  if (faasTrigger) {\n    return { op: faasTrigger.toString(), description: name, source: 'route' };\n  }\n\n  return { op: undefined, description: name, source: 'custom' };\n}\n\n/**\n * Extract better op/description from an otel span.\n *\n * Based on https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/7422ce2a06337f68a59b552b8c5a2ac125d6bae5/exporter/sentryexporter/sentry_exporter.go#L306\n */\nexport function parseSpanDescription(span: AbstractSpan): SpanDescription {\n  const attributes = spanHasAttributes(span) ? span.attributes : {};\n  const name = spanHasName(span) ? span.name : '<unknown>';\n  const kind = getSpanKind(span);\n\n  return inferSpanData(name, attributes, kind);\n}\n\nfunction descriptionForDbSystem({ attributes, name }: { attributes: Attributes; name: string }): SpanDescription {\n  // Use DB statement (Ex \"SELECT * FROM table\") if possible as description.\n  const statement = attributes[SEMATTRS_DB_STATEMENT];\n\n  const description = statement ? statement.toString() : name;\n\n  return { op: 'db', description, source: 'task' };\n}\n\n/** Only exported for tests. */\nexport function descriptionForHttpMethod(\n  { name, kind, attributes }: { name: string; attributes: Attributes; kind: SpanKind },\n  httpMethod: AttributeValue,\n): SpanDescription {\n  const opParts = ['http'];\n\n  switch (kind) {\n    case SpanKind.CLIENT:\n      opParts.push('client');\n      break;\n    case SpanKind.SERVER:\n      opParts.push('server');\n      break;\n  }\n\n  const { urlPath, url, query, fragment, hasRoute } = getSanitizedUrl(attributes, kind);\n\n  if (!urlPath) {\n    return { op: opParts.join('.'), description: name, source: 'custom' };\n  }\n\n  // Ex. description=\"GET /api/users\".\n  const description = `${httpMethod} ${urlPath}`;\n\n  // If `httpPath` is a root path, then we can categorize the transaction source as route.\n  const source: TransactionSource = hasRoute || urlPath === '/' ? 'route' : 'url';\n\n  const data: Record<string, string> = {};\n\n  if (url) {\n    data.url = url;\n  }\n  if (query) {\n    data['http.query'] = query;\n  }\n  if (fragment) {\n    data['http.fragment'] = fragment;\n  }\n\n  return {\n    op: opParts.join('.'),\n    description,\n    source,\n    data,\n  };\n}\n\n/** Exported for tests only */\nexport function getSanitizedUrl(\n  attributes: Attributes,\n  kind: SpanKind,\n): {\n  url: string | undefined;\n  urlPath: string | undefined;\n  query: string | undefined;\n  fragment: string | undefined;\n  hasRoute: boolean;\n} {\n  // This is the relative path of the URL, e.g. /sub\n  const httpTarget = attributes[SEMATTRS_HTTP_TARGET];\n  // This is the full URL, including host & query params etc., e.g. https://example.com/sub?foo=bar\n  const httpUrl = attributes[SEMATTRS_HTTP_URL];\n  // This is the normalized route name - may not always be available!\n  const httpRoute = attributes[SEMATTRS_HTTP_ROUTE];\n\n  const parsedUrl = typeof httpUrl === 'string' ? parseUrl(httpUrl) : undefined;\n  const url = parsedUrl ? getSanitizedUrlString(parsedUrl) : undefined;\n  const query = parsedUrl && parsedUrl.search ? parsedUrl.search : undefined;\n  const fragment = parsedUrl && parsedUrl.hash ? parsedUrl.hash : undefined;\n\n  if (typeof httpRoute === 'string') {\n    return { urlPath: httpRoute, url, query, fragment, hasRoute: true };\n  }\n\n  if (kind === SpanKind.SERVER && typeof httpTarget === 'string') {\n    return { urlPath: stripUrlQueryAndFragment(httpTarget), url, query, fragment, hasRoute: false };\n  }\n\n  if (parsedUrl) {\n    return { urlPath: url, url, query, fragment, hasRoute: false };\n  }\n\n  // fall back to target even for client spans, if no URL is present\n  if (typeof httpTarget === 'string') {\n    return { urlPath: stripUrlQueryAndFragment(httpTarget), url, query, fragment, hasRoute: false };\n  }\n\n  return { urlPath: undefined, url, query, fragment, hasRoute: false };\n}\n","import { SEMANTIC_ATTRIBUTE_SENTRY_SOURCE, spanToJSON } from '@sentry/core';\nimport type { Client } from '@sentry/types';\nimport { parseSpanDescription } from './parseSpanDescription';\nimport { spanHasName } from './spanTypes';\n\n/**\n * Setup a DSC handler on the passed client,\n * ensuring that the transaction name is inferred from the span correctly.\n */\nexport function enhanceDscWithOpenTelemetryRootSpanName(client: Client): void {\n  client.on('createDsc', (dsc, rootSpan) => {\n    // We want to overwrite the transaction on the DSC that is created by default in core\n    // The reason for this is that we want to infer the span name, not use the initial one\n    // Otherwise, we'll get names like \"GET\" instead of e.g. \"GET /foo\"\n    // `parseSpanDescription` takes the attributes of the span into account for the name\n    // This mutates the passed-in DSC\n    if (rootSpan) {\n      const jsonSpan = spanToJSON(rootSpan);\n      const attributes = jsonSpan.data || {};\n      const source = attributes[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE];\n\n      const { description } = spanHasName(rootSpan) ? parseSpanDescription(rootSpan) : { description: undefined };\n      if (source !== 'url' && description) {\n        dsc.transaction = description;\n      }\n    }\n  });\n}\n","import { TraceState } from '@opentelemetry/core';\nimport type { DynamicSamplingContext } from '@sentry/types';\nimport { dynamicSamplingContextToSentryBaggageHeader } from '@sentry/utils';\nimport {\n  SENTRY_TRACE_STATE_DSC,\n  SENTRY_TRACE_STATE_PARENT_SPAN_ID,\n  SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING,\n} from '../constants';\n\n/**\n * Generate a TraceState for the given data.\n */\nexport function makeTraceState({\n  parentSpanId,\n  dsc,\n  sampled,\n}: {\n  parentSpanId?: string;\n  dsc?: Partial<DynamicSamplingContext>;\n  sampled?: boolean;\n}): TraceState {\n  // We store the DSC as OTEL trace state on the span context\n  const dscString = dsc ? dynamicSamplingContextToSentryBaggageHeader(dsc) : undefined;\n\n  // We _always_ set the parent span ID, even if it is empty\n  // If we'd set this to 'undefined' we could not know if the trace state was set, but there was no parentSpanId,\n  // vs the trace state was not set at all (in which case we want to do fallback handling)\n  // If `''`, it should be considered \"no parent\"\n  const traceStateBase = new TraceState().set(SENTRY_TRACE_STATE_PARENT_SPAN_ID, parentSpanId || '');\n\n  const traceStateWithDsc = dscString ? traceStateBase.set(SENTRY_TRACE_STATE_DSC, dscString) : traceStateBase;\n\n  // We also specifically want to store if this is sampled to be not recording,\n  // or unsampled (=could be either sampled or not)\n  return sampled === false ? traceStateWithDsc.set(SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING, '1') : traceStateWithDsc;\n}\n","import type { SpanContext } from '@opentelemetry/api';\nimport { TraceFlags } from '@opentelemetry/api';\nimport type { PropagationContext } from '@sentry/types';\nimport { makeTraceState } from './makeTraceState';\n\n/**\n * Generates a SpanContext that represents a PropagationContext.\n * This can be set on a `context` to make this a (virtual) active span.\n */\nexport function generateSpanContextForPropagationContext(propagationContext: PropagationContext): SpanContext {\n  // We store the DSC as OTEL trace state on the span context\n  const traceState = makeTraceState({\n    parentSpanId: propagationContext.parentSpanId,\n    dsc: propagationContext.dsc,\n    sampled: propagationContext.sampled,\n  });\n\n  const spanContext: SpanContext = {\n    traceId: propagationContext.traceId,\n    spanId: propagationContext.parentSpanId || '',\n    isRemote: true,\n    traceFlags: propagationContext.sampled ? TraceFlags.SAMPLED : TraceFlags.NONE,\n    traceState,\n  };\n\n  return spanContext;\n}\n","import type { Span } from '@opentelemetry/api';\nimport { trace } from '@opentelemetry/api';\n\n/**\n * Returns the currently active span.\n */\nexport function getActiveSpan(): Span | undefined {\n  return trace.getActiveSpan();\n}\n","declare const __DEBUG_BUILD__: boolean;\n\n/**\n * This serves as a build time flag that will be true by default, but false in non-debug builds or if users replace `__SENTRY_DEBUG__` in their generated code.\n *\n * ATTENTION: This constant must never cross package boundaries (i.e. be exported) to guarantee that it can be used for tree shaking.\n */\nexport const DEBUG_BUILD = __DEBUG_BUILD__;\n","import type { SpanContext } from '@opentelemetry/api';\nimport { TraceFlags } from '@opentelemetry/api';\nimport { baggageHeaderToDynamicSamplingContext } from '@sentry/utils';\nimport { SENTRY_TRACE_STATE_DSC, SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING } from '../constants';\n\n/**\n * OpenTelemetry only knows about SAMPLED or NONE decision,\n * but for us it is important to differentiate between unset and unsampled.\n *\n * Both of these are identified as `traceFlags === TracegFlags.NONE`,\n * but we additionally look at a special trace state to differentiate between them.\n */\nexport function getSamplingDecision(spanContext: SpanContext): boolean | undefined {\n  const { traceFlags, traceState } = spanContext;\n\n  const sampledNotRecording = traceState ? traceState.get(SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING) === '1' : false;\n\n  // If trace flag is `SAMPLED`, we interpret this as sampled\n  // If it is `NONE`, it could mean either it was sampled to be not recorder, or that it was not sampled at all\n  // For us this is an important difference, sow e look at the SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING\n  // to identify which it is\n  if (traceFlags === TraceFlags.SAMPLED) {\n    return true;\n  }\n\n  if (sampledNotRecording) {\n    return false;\n  }\n\n  // Fall back to DSC as a last resort, that may also contain `sampled`...\n  const dscString = traceState ? traceState.get(SENTRY_TRACE_STATE_DSC) : undefined;\n  const dsc = dscString ? baggageHeaderToDynamicSamplingContext(dscString) : undefined;\n\n  if (dsc?.sampled === 'true') {\n    return true;\n  }\n  if (dsc?.sampled === 'false') {\n    return false;\n  }\n\n  return undefined;\n}\n","type OpenTelemetryElement = 'SentrySpanProcessor' | 'SentryContextManager' | 'SentryPropagator' | 'SentrySampler';\n\nconst setupElements = new Set<OpenTelemetryElement>();\n\n/** Get all the OpenTelemetry elements that have been set up. */\nexport function openTelemetrySetupCheck(): OpenTelemetryElement[] {\n  return Array.from(setupElements);\n}\n\n/** Mark an OpenTelemetry element as setup. */\nexport function setIsSetup(element: OpenTelemetryElement): void {\n  setupElements.add(element);\n}\n\n/** Only exported for tests. */\nexport function clearOpenTelemetrySetupCheck(): void {\n  setupElements.clear();\n}\n","import type { Baggage, Context, Span, TextMapGetter, TextMapSetter } from '@opentelemetry/api';\nimport { INVALID_TRACEID } from '@opentelemetry/api';\nimport { context } from '@opentelemetry/api';\nimport { propagation, trace } from '@opentelemetry/api';\nimport { W3CBaggagePropagator, isTracingSuppressed } from '@opentelemetry/core';\nimport { SEMATTRS_HTTP_URL } from '@opentelemetry/semantic-conventions';\nimport type { continueTrace } from '@sentry/core';\nimport { hasTracingEnabled } from '@sentry/core';\nimport { getRootSpan } from '@sentry/core';\nimport { spanToJSON } from '@sentry/core';\nimport {\n  getClient,\n  getCurrentScope,\n  getDynamicSamplingContextFromClient,\n  getDynamicSamplingContextFromSpan,\n  getIsolationScope,\n} from '@sentry/core';\nimport type { DynamicSamplingContext, Options, PropagationContext } from '@sentry/types';\nimport {\n  LRUMap,\n  SENTRY_BAGGAGE_KEY_PREFIX,\n  baggageHeaderToDynamicSamplingContext,\n  generateSentryTraceHeader,\n  logger,\n  parseBaggageHeader,\n  propagationContextFromHeaders,\n  stringMatchesSomePattern,\n} from '@sentry/utils';\n\nimport {\n  SENTRY_BAGGAGE_HEADER,\n  SENTRY_TRACE_HEADER,\n  SENTRY_TRACE_STATE_DSC,\n  SENTRY_TRACE_STATE_PARENT_SPAN_ID,\n  SENTRY_TRACE_STATE_URL,\n} from './constants';\nimport { DEBUG_BUILD } from './debug-build';\nimport { getScopesFromContext, setScopesOnContext } from './utils/contextData';\nimport { generateSpanContextForPropagationContext } from './utils/generateSpanContextForPropagationContext';\nimport { getSamplingDecision } from './utils/getSamplingDecision';\nimport { setIsSetup } from './utils/setupCheck';\n\n/** Get the Sentry propagation context from a span context. */\nexport function getPropagationContextFromSpan(span: Span): PropagationContext {\n  const spanContext = span.spanContext();\n  const { traceId, spanId, traceState } = spanContext;\n\n  // When we have a dsc trace state, it means this came from the incoming trace\n  // Then this takes presedence over the root span\n  const dscString = traceState ? traceState.get(SENTRY_TRACE_STATE_DSC) : undefined;\n  const traceStateDsc = dscString ? baggageHeaderToDynamicSamplingContext(dscString) : undefined;\n\n  const parentSpanId = traceState ? traceState.get(SENTRY_TRACE_STATE_PARENT_SPAN_ID) || undefined : undefined;\n\n  const sampled = getSamplingDecision(spanContext);\n\n  // No trace state? --> Take DSC from root span\n  const dsc = traceStateDsc || getDynamicSamplingContextFromSpan(getRootSpan(span));\n\n  return {\n    traceId,\n    spanId,\n    sampled,\n    parentSpanId,\n    dsc,\n  };\n}\n\n/**\n * Injects and extracts `sentry-trace` and `baggage` headers from carriers.\n */\nexport class SentryPropagator extends W3CBaggagePropagator {\n  /** A map of URLs that have already been checked for if they match tracePropagationTargets. */\n  private _urlMatchesTargetsMap: LRUMap<string, boolean>;\n\n  public constructor() {\n    super();\n    setIsSetup('SentryPropagator');\n\n    // We're caching results so we don't have to recompute regexp every time we create a request.\n    this._urlMatchesTargetsMap = new LRUMap<string, boolean>(100);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public inject(context: Context, carrier: unknown, setter: TextMapSetter): void {\n    if (isTracingSuppressed(context)) {\n      DEBUG_BUILD && logger.log('[Tracing] Not injecting trace data for url because tracing is suppressed.');\n      return;\n    }\n\n    const activeSpan = trace.getSpan(context);\n    const url = activeSpan && getCurrentURL(activeSpan);\n\n    const tracePropagationTargets = getClient()?.getOptions()?.tracePropagationTargets;\n    if (\n      typeof url === 'string' &&\n      tracePropagationTargets &&\n      !this._shouldInjectTraceData(tracePropagationTargets, url)\n    ) {\n      DEBUG_BUILD &&\n        logger.log(\n          '[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:',\n          url,\n        );\n      return;\n    }\n\n    const existingBaggageHeader = getExistingBaggage(carrier);\n    let baggage = propagation.getBaggage(context) || propagation.createBaggage({});\n\n    const { dynamicSamplingContext, traceId, spanId, sampled } = getInjectionData(context);\n\n    if (existingBaggageHeader) {\n      const baggageEntries = parseBaggageHeader(existingBaggageHeader);\n\n      if (baggageEntries) {\n        Object.entries(baggageEntries).forEach(([key, value]) => {\n          baggage = baggage.setEntry(key, { value });\n        });\n      }\n    }\n\n    if (dynamicSamplingContext) {\n      baggage = Object.entries(dynamicSamplingContext).reduce<Baggage>((b, [dscKey, dscValue]) => {\n        if (dscValue) {\n          return b.setEntry(`${SENTRY_BAGGAGE_KEY_PREFIX}${dscKey}`, { value: dscValue });\n        }\n        return b;\n      }, baggage);\n    }\n\n    // We also want to avoid setting the default OTEL trace ID, if we get that for whatever reason\n    if (traceId && traceId !== INVALID_TRACEID) {\n      setter.set(carrier, SENTRY_TRACE_HEADER, generateSentryTraceHeader(traceId, spanId, sampled));\n    }\n\n    super.inject(propagation.setBaggage(context, baggage), carrier, setter);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public extract(context: Context, carrier: unknown, getter: TextMapGetter): Context {\n    const maybeSentryTraceHeader: string | string[] | undefined = getter.get(carrier, SENTRY_TRACE_HEADER);\n    const baggage = getter.get(carrier, SENTRY_BAGGAGE_HEADER);\n\n    const sentryTrace = maybeSentryTraceHeader\n      ? Array.isArray(maybeSentryTraceHeader)\n        ? maybeSentryTraceHeader[0]\n        : maybeSentryTraceHeader\n      : undefined;\n\n    const propagationContext = propagationContextFromHeaders(sentryTrace, baggage);\n\n    // Add remote parent span context\n    const ctxWithSpanContext = getContextWithRemoteActiveSpan(context, { sentryTrace, baggage });\n\n    // Also update the scope on the context (to be sure this is picked up everywhere)\n    const scopes = getScopesFromContext(ctxWithSpanContext);\n    const newScopes = {\n      scope: scopes ? scopes.scope.clone() : getCurrentScope().clone(),\n      isolationScope: scopes ? scopes.isolationScope : getIsolationScope(),\n    };\n    newScopes.scope.setPropagationContext(propagationContext);\n\n    return setScopesOnContext(ctxWithSpanContext, newScopes);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public fields(): string[] {\n    return [SENTRY_TRACE_HEADER, SENTRY_BAGGAGE_HEADER];\n  }\n\n  /** If we want to inject trace data for a given URL. */\n  private _shouldInjectTraceData(tracePropagationTargets: Options['tracePropagationTargets'], url: string): boolean {\n    if (tracePropagationTargets === undefined) {\n      return true;\n    }\n\n    const cachedDecision = this._urlMatchesTargetsMap.get(url);\n    if (cachedDecision !== undefined) {\n      return cachedDecision;\n    }\n\n    const decision = stringMatchesSomePattern(url, tracePropagationTargets);\n    this._urlMatchesTargetsMap.set(url, decision);\n    return decision;\n  }\n}\n\nfunction getInjectionData(context: Context): {\n  dynamicSamplingContext: Partial<DynamicSamplingContext> | undefined;\n  traceId: string | undefined;\n  spanId: string | undefined;\n  sampled: boolean | undefined;\n} {\n  const span = hasTracingEnabled() ? trace.getSpan(context) : undefined;\n  const spanIsRemote = span?.spanContext().isRemote;\n\n  // If we have a local span, we can just pick everything from it\n  if (span && !spanIsRemote) {\n    const spanContext = span.spanContext();\n\n    const propagationContext = getPropagationContextFromSpan(span);\n    const dynamicSamplingContext = getDynamicSamplingContext(propagationContext, spanContext.traceId);\n    return {\n      dynamicSamplingContext,\n      traceId: spanContext.traceId,\n      spanId: spanContext.spanId,\n      sampled: getSamplingDecision(spanContext),\n    };\n  }\n\n  // Else we try to use the propagation context from the scope\n  const scope = getScopesFromContext(context)?.scope || getCurrentScope();\n\n  const propagationContext = scope.getPropagationContext();\n  const dynamicSamplingContext = getDynamicSamplingContext(propagationContext, propagationContext.traceId);\n  return {\n    dynamicSamplingContext,\n    traceId: propagationContext.traceId,\n    spanId: propagationContext.spanId,\n    sampled: propagationContext.sampled,\n  };\n}\n\n/** Get the DSC from a context, or fall back to use the one from the client. */\nfunction getDynamicSamplingContext(\n  propagationContext: PropagationContext,\n  traceId: string | undefined,\n): Partial<DynamicSamplingContext> | undefined {\n  // If we have a DSC on the propagation context, we just use it\n  if (propagationContext?.dsc) {\n    return propagationContext.dsc;\n  }\n\n  // Else, we try to generate a new one\n  const client = getClient();\n\n  if (client) {\n    return getDynamicSamplingContextFromClient(traceId || propagationContext.traceId, client);\n  }\n\n  return undefined;\n}\n\nfunction getContextWithRemoteActiveSpan(\n  ctx: Context,\n  { sentryTrace, baggage }: Parameters<typeof continueTrace>[0],\n): Context {\n  const propagationContext = propagationContextFromHeaders(sentryTrace, baggage);\n\n  const spanContext = generateSpanContextForPropagationContext(propagationContext);\n  return trace.setSpanContext(ctx, spanContext);\n}\n\n/**\n * Takes trace strings and propagates them as a remote active span.\n * This should be used in addition to `continueTrace` in OTEL-powered environments.\n */\nexport function continueTraceAsRemoteSpan<T>(\n  ctx: Context,\n  options: Parameters<typeof continueTrace>[0],\n  callback: () => T,\n): T {\n  const ctxWithSpanContext = getContextWithRemoteActiveSpan(ctx, options);\n\n  return context.with(ctxWithSpanContext, callback);\n}\n\n/** Try to get the existing baggage header so we can merge this in. */\nfunction getExistingBaggage(carrier: unknown): string | undefined {\n  try {\n    const baggage = (carrier as Record<string, string | string[]>)[SENTRY_BAGGAGE_HEADER];\n    return Array.isArray(baggage) ? baggage.join(',') : baggage;\n  } catch {\n    return undefined;\n  }\n}\n\n/**\n * It is pretty tricky to get access to the outgoing request URL of a request in the propagator.\n * As we only have access to the context of the span to be sent and the carrier (=headers),\n * but the span may be unsampled and thus have no attributes.\n *\n * So we use the following logic:\n * 1. If we have an active span, we check if it has a URL attribute.\n * 2. Else, if the active span has no URL attribute (e.g. it is unsampled), we check a special trace state (which we set in our sampler).\n */\nfunction getCurrentURL(span: Span): string | undefined {\n  const urlAttribute = spanToJSON(span).data?.[SEMATTRS_HTTP_URL];\n  if (urlAttribute) {\n    return urlAttribute;\n  }\n\n  // Also look at the traceState, which we may set in the sampler even for unsampled spans\n  const urlTraceState = span.spanContext().traceState?.get(SENTRY_TRACE_STATE_URL);\n  if (urlTraceState) {\n    return urlTraceState;\n  }\n\n  return undefined;\n}\n","import type { Context, Span, SpanContext, SpanOptions, Tracer } from '@opentelemetry/api';\nimport { INVALID_SPANID, SpanStatusCode, TraceFlags, context, trace } from '@opentelemetry/api';\nimport { suppressTracing } from '@opentelemetry/core';\nimport {\n  SDK_VERSION,\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  continueTrace as baseContinueTrace,\n  getClient,\n  getCurrentScope,\n  getDynamicSamplingContextFromSpan,\n  getRootSpan,\n  handleCallbackErrors,\n  spanToJSON,\n} from '@sentry/core';\nimport type { Client, Scope, Span as SentrySpan } from '@sentry/types';\nimport { continueTraceAsRemoteSpan } from './propagator';\n\nimport type { OpenTelemetryClient, OpenTelemetrySpanContext } from './types';\nimport { getContextFromScope, getScopesFromContext } from './utils/contextData';\nimport { getSamplingDecision } from './utils/getSamplingDecision';\nimport { makeTraceState } from './utils/makeTraceState';\n\n/**\n * Wraps a function with a transaction/span and finishes the span after the function is done.\n * The created span is the active span and will be used as parent by other spans created inside the function\n * and can be accessed via `Sentry.getActiveSpan()`, as long as the function is executed while the scope is active.\n *\n * If you want to create a span that is not set as active, use {@link startInactiveSpan}.\n *\n * You'll always get a span passed to the callback,\n * it may just be a non-recording span if the span is not sampled or if tracing is disabled.\n */\nexport function startSpan<T>(options: OpenTelemetrySpanContext, callback: (span: Span) => T): T {\n  const tracer = getTracer();\n\n  const { name, parentSpan: customParentSpan } = options;\n\n  // If `options.parentSpan` is defined, we want to wrap the callback in `withActiveSpan`\n  const wrapper = getActiveSpanWrapper<T>(customParentSpan);\n\n  return wrapper(() => {\n    const activeCtx = getContext(options.scope, options.forceTransaction);\n    const shouldSkipSpan = options.onlyIfParent && !trace.getSpan(activeCtx);\n    const ctx = shouldSkipSpan ? suppressTracing(activeCtx) : activeCtx;\n\n    const spanOptions = getSpanOptions(options);\n\n    return tracer.startActiveSpan(name, spanOptions, ctx, span => {\n      return handleCallbackErrors(\n        () => callback(span),\n        () => {\n          // Only set the span status to ERROR when there wasn't any status set before, in order to avoid stomping useful span statuses\n          if (spanToJSON(span).status === undefined) {\n            span.setStatus({ code: SpanStatusCode.ERROR });\n          }\n        },\n        () => span.end(),\n      );\n    });\n  });\n}\n\n/**\n * Similar to `Sentry.startSpan`. Wraps a function with a span, but does not finish the span\n * after the function is done automatically. You'll have to call `span.end()` manually.\n *\n * The created span is the active span and will be used as parent by other spans created inside the function\n * and can be accessed via `Sentry.getActiveSpan()`, as long as the function is executed while the scope is active.\n *\n * You'll always get a span passed to the callback,\n * it may just be a non-recording span if the span is not sampled or if tracing is disabled.\n */\nexport function startSpanManual<T>(\n  options: OpenTelemetrySpanContext,\n  callback: (span: Span, finish: () => void) => T,\n): T {\n  const tracer = getTracer();\n\n  const { name, parentSpan: customParentSpan } = options;\n\n  // If `options.parentSpan` is defined, we want to wrap the callback in `withActiveSpan`\n  const wrapper = getActiveSpanWrapper<T>(customParentSpan);\n\n  return wrapper(() => {\n    const activeCtx = getContext(options.scope, options.forceTransaction);\n    const shouldSkipSpan = options.onlyIfParent && !trace.getSpan(activeCtx);\n    const ctx = shouldSkipSpan ? suppressTracing(activeCtx) : activeCtx;\n\n    const spanOptions = getSpanOptions(options);\n\n    return tracer.startActiveSpan(name, spanOptions, ctx, span => {\n      return handleCallbackErrors(\n        () => callback(span, () => span.end()),\n        () => {\n          // Only set the span status to ERROR when there wasn't any status set before, in order to avoid stomping useful span statuses\n          if (spanToJSON(span).status === undefined) {\n            span.setStatus({ code: SpanStatusCode.ERROR });\n          }\n        },\n      );\n    });\n  });\n}\n\n/**\n * Creates a span. This span is not set as active, so will not get automatic instrumentation spans\n * as children or be able to be accessed via `Sentry.getActiveSpan()`.\n *\n * If you want to create a span that is set as active, use {@link startSpan}.\n *\n * This function will always return a span,\n * it may just be a non-recording span if the span is not sampled or if tracing is disabled.\n */\nexport function startInactiveSpan(options: OpenTelemetrySpanContext): Span {\n  const tracer = getTracer();\n\n  const { name, parentSpan: customParentSpan } = options;\n\n  // If `options.parentSpan` is defined, we want to wrap the callback in `withActiveSpan`\n  const wrapper = getActiveSpanWrapper<Span>(customParentSpan);\n\n  return wrapper(() => {\n    const activeCtx = getContext(options.scope, options.forceTransaction);\n    const shouldSkipSpan = options.onlyIfParent && !trace.getSpan(activeCtx);\n    const ctx = shouldSkipSpan ? suppressTracing(activeCtx) : activeCtx;\n\n    const spanOptions = getSpanOptions(options);\n\n    const span = tracer.startSpan(name, spanOptions, ctx);\n\n    return span;\n  });\n}\n\n/**\n * Forks the current scope and sets the provided span as active span in the context of the provided callback. Can be\n * passed `null` to start an entirely new span tree.\n *\n * @param span Spans started in the context of the provided callback will be children of this span. If `null` is passed,\n * spans started within the callback will be root spans.\n * @param callback Execution context in which the provided span will be active. Is passed the newly forked scope.\n * @returns the value returned from the provided callback function.\n */\nexport function withActiveSpan<T>(span: Span | null, callback: (scope: Scope) => T): T {\n  const newContextWithActiveSpan = span ? trace.setSpan(context.active(), span) : trace.deleteSpan(context.active());\n  return context.with(newContextWithActiveSpan, () => callback(getCurrentScope()));\n}\n\nfunction getTracer(): Tracer {\n  const client = getClient<Client & OpenTelemetryClient>();\n  return (client && client.tracer) || trace.getTracer('@sentry/opentelemetry', SDK_VERSION);\n}\n\nfunction getSpanOptions(options: OpenTelemetrySpanContext): SpanOptions {\n  const { startTime, attributes, kind, op } = options;\n\n  // OTEL expects timestamps in ms, not seconds\n  const fixedStartTime = typeof startTime === 'number' ? ensureTimestampInMilliseconds(startTime) : startTime;\n\n  return {\n    attributes: op\n      ? {\n          [SEMANTIC_ATTRIBUTE_SENTRY_OP]: op,\n          ...attributes,\n        }\n      : attributes,\n    kind,\n    startTime: fixedStartTime,\n  };\n}\n\nfunction ensureTimestampInMilliseconds(timestamp: number): number {\n  const isMs = timestamp < 9999999999;\n  return isMs ? timestamp * 1000 : timestamp;\n}\n\nfunction getContext(scope: Scope | undefined, forceTransaction: boolean | undefined): Context {\n  const ctx = getContextForScope(scope);\n  const actualScope = getScopesFromContext(ctx)?.scope;\n\n  const parentSpan = trace.getSpan(ctx);\n\n  // In the case that we have no parent span, we need to \"simulate\" one to ensure the propagation context is correct\n  if (!parentSpan) {\n    const client = getClient();\n\n    if (actualScope && client) {\n      const propagationContext = actualScope.getPropagationContext();\n\n      // We store the DSC as OTEL trace state on the span context\n      const traceState = makeTraceState({\n        parentSpanId: propagationContext.parentSpanId,\n        // Not defined yet, we want to pick this up on-demand only\n        dsc: undefined,\n        sampled: propagationContext.sampled,\n      });\n\n      const spanOptions: SpanContext = {\n        traceId: propagationContext.traceId,\n        spanId: propagationContext.parentSpanId || propagationContext.spanId,\n        isRemote: true,\n        traceFlags: propagationContext.sampled ? TraceFlags.SAMPLED : TraceFlags.NONE,\n        traceState,\n      };\n\n      // Add remote parent span context,\n      return trace.setSpanContext(ctx, spanOptions);\n    }\n\n    // if we have no scope or client, we just return the context as-is\n    return ctx;\n  }\n\n  // If we don't want to force a transaction, and we have a parent span, all good, we just return as-is!\n  if (!forceTransaction) {\n    return ctx;\n  }\n\n  // Else, if we do have a parent span but want to force a transaction, we have to simulate a \"root\" context\n\n  // Else, we need to do two things:\n  // 1. Unset the parent span from the context, so we'll create a new root span\n  // 2. Ensure the propagation context is correct, so we'll continue from the parent span\n  const ctxWithoutSpan = trace.deleteSpan(ctx);\n\n  const { spanId, traceId } = parentSpan.spanContext();\n  const sampled = getSamplingDecision(parentSpan.spanContext());\n\n  // In this case, when we are forcing a transaction, we want to treat this like continuing an incoming trace\n  // so we set the traceState according to the root span\n  const rootSpan = getRootSpan(parentSpan);\n  const dsc = getDynamicSamplingContextFromSpan(rootSpan);\n\n  const traceState = makeTraceState({\n    dsc,\n    parentSpanId: spanId !== INVALID_SPANID ? spanId : undefined,\n    sampled,\n  });\n\n  const spanOptions: SpanContext = {\n    traceId,\n    spanId,\n    isRemote: true,\n    traceFlags: sampled ? TraceFlags.SAMPLED : TraceFlags.NONE,\n    traceState,\n  };\n\n  const ctxWithSpanContext = trace.setSpanContext(ctxWithoutSpan, spanOptions);\n\n  return ctxWithSpanContext;\n}\n\nfunction getContextForScope(scope?: Scope): Context {\n  if (scope) {\n    const ctx = getContextFromScope(scope);\n    if (ctx) {\n      return ctx;\n    }\n  }\n\n  return context.active();\n}\n\n/**\n * Continue a trace from `sentry-trace` and `baggage` values.\n * These values can be obtained from incoming request headers, or in the browser from `<meta name=\"sentry-trace\">`\n * and `<meta name=\"baggage\">` HTML tags.\n *\n * Spans started with `startSpan`, `startSpanManual` and `startInactiveSpan`, within the callback will automatically\n * be attached to the incoming trace.\n *\n * This is a custom version of `continueTrace` that is used in OTEL-powered environments.\n * It propagates the trace as a remote span, in addition to setting it on the propagation context.\n */\nexport function continueTrace<T>(options: Parameters<typeof baseContinueTrace>[0], callback: () => T): T {\n  return baseContinueTrace(options, () => {\n    return continueTraceAsRemoteSpan(context.active(), options, callback);\n  });\n}\n\nfunction getActiveSpanWrapper<T>(parentSpan: Span | SentrySpan | undefined | null): (callback: () => T) => T {\n  return parentSpan !== undefined\n    ? (callback: () => T) => {\n        return withActiveSpan(parentSpan, callback);\n      }\n    : (callback: () => T) => callback();\n}\n","import { context } from '@opentelemetry/api';\nimport { suppressTracing as suppressTracingImpl } from '@opentelemetry/core';\n\n/** Suppress tracing in the given callback, ensuring no spans are generated inside of it. */\nexport function suppressTracing<T>(callback: () => T): T {\n  const ctx = suppressTracingImpl(context.active());\n  return context.with(ctx, callback);\n}\n","import { getDynamicSamplingContextFromSpan, getRootSpan } from '@sentry/core';\nimport type { Client } from '@sentry/types';\nimport { dropUndefinedKeys } from '@sentry/utils';\nimport { SENTRY_TRACE_STATE_PARENT_SPAN_ID } from './constants';\nimport { getActiveSpan } from './utils/getActiveSpan';\nimport { spanHasParentId } from './utils/spanTypes';\n\n/** Ensure the `trace` context is set on all events. */\nexport function setupEventContextTrace(client: Client): void {\n  client.on('preprocessEvent', event => {\n    const span = getActiveSpan();\n    // For transaction events, this is handled separately\n    // Because the active span may not be the span that is actually the transaction event\n    if (!span || event.type === 'transaction') {\n      return;\n    }\n\n    const spanContext = span.spanContext();\n\n    // If we have a parent span id from trace state, use that ('' means no parent should be used)\n    // Else, pick the one from the span\n    const parentSpanIdFromTraceState = spanContext.traceState?.get(SENTRY_TRACE_STATE_PARENT_SPAN_ID);\n    const parent_span_id =\n      typeof parentSpanIdFromTraceState === 'string'\n        ? parentSpanIdFromTraceState || undefined\n        : spanHasParentId(span)\n          ? span.parentSpanId\n          : undefined;\n\n    // If event has already set `trace` context, use that one.\n    event.contexts = {\n      trace: dropUndefinedKeys({\n        trace_id: spanContext.traceId,\n        span_id: spanContext.spanId,\n        parent_span_id,\n      }),\n      ...event.contexts,\n    };\n\n    const rootSpan = getRootSpan(span);\n\n    event.sdkProcessingMetadata = {\n      dynamicSamplingContext: getDynamicSamplingContextFromSpan(rootSpan),\n      ...event.sdkProcessingMetadata,\n    };\n\n    return event;\n  });\n}\n","import * as api from '@opentelemetry/api';\nimport { getDefaultCurrentScope, getDefaultIsolationScope, setAsyncContextStrategy } from '@sentry/core';\nimport type { withActiveSpan as defaultWithActiveSpan } from '@sentry/core';\nimport type { Scope } from '@sentry/types';\n\nimport {\n  SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY,\n  SENTRY_FORK_SET_ISOLATION_SCOPE_CONTEXT_KEY,\n  SENTRY_FORK_SET_SCOPE_CONTEXT_KEY,\n} from './constants';\nimport { startInactiveSpan, startSpan, startSpanManual, withActiveSpan } from './trace';\nimport type { CurrentScopes } from './types';\nimport { getScopesFromContext } from './utils/contextData';\nimport { getActiveSpan } from './utils/getActiveSpan';\nimport { suppressTracing } from './utils/suppressTracing';\n\n/**\n * Sets the async context strategy to use follow the OTEL context under the hood.\n * We handle forking a hub inside of our custom OTEL Context Manager (./otelContextManager.ts)\n */\nexport function setOpenTelemetryContextAsyncContextStrategy(): void {\n  function getScopes(): CurrentScopes {\n    const ctx = api.context.active();\n    const scopes = getScopesFromContext(ctx);\n\n    if (scopes) {\n      return scopes;\n    }\n\n    // fallback behavior:\n    // if, for whatever reason, we can't find scopes on the context here, we have to fix this somehow\n    return {\n      scope: getDefaultCurrentScope(),\n      isolationScope: getDefaultIsolationScope(),\n    };\n  }\n\n  function withScope<T>(callback: (scope: Scope) => T): T {\n    const ctx = api.context.active();\n\n    // We depend on the otelContextManager to handle the context/hub\n    // We set the `SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY` context value, which is picked up by\n    // the OTEL context manager, which uses the presence of this key to determine if it should\n    // fork the isolation scope, or not\n    // as by default, we don't want to fork this, unless triggered explicitly by `withScope`\n    return api.context.with(ctx, () => {\n      return callback(getCurrentScope());\n    });\n  }\n\n  function withSetScope<T>(scope: Scope, callback: (scope: Scope) => T): T {\n    const ctx = api.context.active();\n\n    // We depend on the otelContextManager to handle the context/hub\n    // We set the `SENTRY_FORK_SET_SCOPE_CONTEXT_KEY` context value, which is picked up by\n    // the OTEL context manager, which picks up this scope as the current scope\n    return api.context.with(ctx.setValue(SENTRY_FORK_SET_SCOPE_CONTEXT_KEY, scope), () => {\n      return callback(scope);\n    });\n  }\n\n  function withIsolationScope<T>(callback: (isolationScope: Scope) => T): T {\n    const ctx = api.context.active();\n\n    // We depend on the otelContextManager to handle the context/hub\n    // We set the `SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY` context value, which is picked up by\n    // the OTEL context manager, which uses the presence of this key to determine if it should\n    // fork the isolation scope, or not\n    return api.context.with(ctx.setValue(SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY, true), () => {\n      return callback(getIsolationScope());\n    });\n  }\n\n  function withSetIsolationScope<T>(isolationScope: Scope, callback: (isolationScope: Scope) => T): T {\n    const ctx = api.context.active();\n\n    // We depend on the otelContextManager to handle the context/hub\n    // We set the `SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY` context value, which is picked up by\n    // the OTEL context manager, which uses the presence of this key to determine if it should\n    // fork the isolation scope, or not\n    return api.context.with(ctx.setValue(SENTRY_FORK_SET_ISOLATION_SCOPE_CONTEXT_KEY, isolationScope), () => {\n      return callback(getIsolationScope());\n    });\n  }\n\n  function getCurrentScope(): Scope {\n    return getScopes().scope;\n  }\n\n  function getIsolationScope(): Scope {\n    return getScopes().isolationScope;\n  }\n\n  setAsyncContextStrategy({\n    withScope,\n    withSetScope,\n    withSetIsolationScope,\n    withIsolationScope,\n    getCurrentScope,\n    getIsolationScope,\n    startSpan,\n    startSpanManual,\n    startInactiveSpan,\n    getActiveSpan,\n    // The types here don't fully align, because our own `Span` type is narrower\n    // than the OTEL one - but this is OK for here, as we now we'll only have OTEL spans passed around\n    withActiveSpan: withActiveSpan as typeof defaultWithActiveSpan,\n    suppressTracing: suppressTracing,\n  });\n}\n","import type { Context, ContextManager } from '@opentelemetry/api';\nimport { getCurrentScope, getIsolationScope } from '@sentry/core';\nimport type { Scope } from '@sentry/types';\n\nimport {\n  SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY,\n  SENTRY_FORK_SET_ISOLATION_SCOPE_CONTEXT_KEY,\n  SENTRY_FORK_SET_SCOPE_CONTEXT_KEY,\n} from './constants';\nimport { getScopesFromContext, setContextOnScope, setScopesOnContext } from './utils/contextData';\nimport { setIsSetup } from './utils/setupCheck';\n\n/**\n * Wrap an OpenTelemetry ContextManager in a way that ensures the context is kept in sync with the Sentry Scope.\n *\n * Usage:\n * import { AsyncLocalStorageContextManager } from '@opentelemetry/context-async-hooks';\n * const SentryContextManager = wrapContextManagerClass(AsyncLocalStorageContextManager);\n * const contextManager = new SentryContextManager();\n */\nexport function wrapContextManagerClass<ContextManagerInstance extends ContextManager>(\n  ContextManagerClass: new (...args: unknown[]) => ContextManagerInstance,\n): typeof ContextManagerClass {\n  /**\n   * This is a custom ContextManager for OpenTelemetry, which extends the default AsyncLocalStorageContextManager.\n   * It ensures that we create new scopes per context, so that the OTEL Context & the Sentry Scope are always in sync.\n   *\n   * Note that we currently only support AsyncHooks with this,\n   * but since this should work for Node 14+ anyhow that should be good enough.\n   */\n\n  // @ts-expect-error TS does not like this, but we know this is fine\n  class SentryContextManager extends ContextManagerClass {\n    public constructor(...args: unknown[]) {\n      super(...args);\n      setIsSetup('SentryContextManager');\n    }\n    /**\n     * Overwrite with() of the original AsyncLocalStorageContextManager\n     * to ensure we also create new scopes per context.\n     */\n    public with<A extends unknown[], F extends (...args: A) => ReturnType<F>>(\n      context: Context,\n      fn: F,\n      thisArg?: ThisParameterType<F>,\n      ...args: A\n    ): ReturnType<F> {\n      const currentScopes = getScopesFromContext(context);\n      const currentScope = currentScopes?.scope || getCurrentScope();\n      const currentIsolationScope = currentScopes?.isolationScope || getIsolationScope();\n\n      const shouldForkIsolationScope = context.getValue(SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY) === true;\n      const scope = context.getValue(SENTRY_FORK_SET_SCOPE_CONTEXT_KEY) as Scope | undefined;\n      const isolationScope = context.getValue(SENTRY_FORK_SET_ISOLATION_SCOPE_CONTEXT_KEY) as Scope | undefined;\n\n      const newCurrentScope = scope || currentScope.clone();\n      const newIsolationScope =\n        isolationScope || (shouldForkIsolationScope ? currentIsolationScope.clone() : currentIsolationScope);\n      const scopes = { scope: newCurrentScope, isolationScope: newIsolationScope };\n\n      const ctx1 = setScopesOnContext(context, scopes);\n\n      // Remove the unneeded values again\n      const ctx2 = ctx1\n        .deleteValue(SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY)\n        .deleteValue(SENTRY_FORK_SET_SCOPE_CONTEXT_KEY)\n        .deleteValue(SENTRY_FORK_SET_ISOLATION_SCOPE_CONTEXT_KEY);\n\n      setContextOnScope(newCurrentScope, ctx2);\n\n      return super.with(ctx2, fn, thisArg, ...args);\n    }\n  }\n\n  return SentryContextManager as unknown as typeof ContextManagerClass;\n}\n","/** If this attribute is true, it means that the parent is a remote span. */\nexport const SEMANTIC_ATTRIBUTE_SENTRY_PARENT_IS_REMOTE = 'sentry.parentIsRemote';\n","import type { ReadableSpan } from '@opentelemetry/sdk-trace-base';\nimport { SEMANTIC_ATTRIBUTE_SENTRY_PARENT_IS_REMOTE } from '../semanticAttributes';\n\nexport interface SpanNode {\n  id: string;\n  span?: ReadableSpan;\n  parentNode?: SpanNode | undefined;\n  children: SpanNode[];\n}\n\ntype SpanMap = Map<string, SpanNode>;\n\n/**\n * This function runs through a list of OTEL Spans, and wraps them in an `SpanNode`\n * where each node holds a reference to their parent node.\n */\nexport function groupSpansWithParents(spans: ReadableSpan[]): SpanNode[] {\n  const nodeMap: SpanMap = new Map<string, SpanNode>();\n\n  for (const span of spans) {\n    createOrUpdateSpanNodeAndRefs(nodeMap, span);\n  }\n\n  return Array.from(nodeMap, function ([_id, spanNode]) {\n    return spanNode;\n  });\n}\n\n/**\n * This returns the _local_ parent ID - `parentId` on the span may point to a remote span.\n */\nexport function getLocalParentId(span: ReadableSpan): string | undefined {\n  const parentIsRemote = span.attributes[SEMANTIC_ATTRIBUTE_SENTRY_PARENT_IS_REMOTE] === true;\n  // If the parentId is the trace parent ID, we pretend it's undefined\n  // As this means the parent exists somewhere else\n  return !parentIsRemote ? span.parentSpanId : undefined;\n}\n\nfunction createOrUpdateSpanNodeAndRefs(nodeMap: SpanMap, span: ReadableSpan): void {\n  const id = span.spanContext().spanId;\n  const parentId = getLocalParentId(span);\n\n  if (!parentId) {\n    createOrUpdateNode(nodeMap, { id, span, children: [] });\n    return;\n  }\n\n  // Else make sure to create parent node as well\n  // Note that the parent may not know it's parent _yet_, this may be updated in a later pass\n  const parentNode = createOrGetParentNode(nodeMap, parentId);\n  const node = createOrUpdateNode(nodeMap, { id, span, parentNode, children: [] });\n  parentNode.children.push(node);\n}\n\nfunction createOrGetParentNode(nodeMap: SpanMap, id: string): SpanNode {\n  const existing = nodeMap.get(id);\n\n  if (existing) {\n    return existing;\n  }\n\n  return createOrUpdateNode(nodeMap, { id, children: [] });\n}\n\nfunction createOrUpdateNode(nodeMap: SpanMap, spanNode: SpanNode): SpanNode {\n  const existing = nodeMap.get(spanNode.id);\n\n  // If span is already set, nothing to do here\n  if (existing && existing.span) {\n    return existing;\n  }\n\n  // If it exists but span is not set yet, we update it\n  if (existing && !existing.span) {\n    existing.span = spanNode.span;\n    existing.parentNode = spanNode.parentNode;\n    return existing;\n  }\n\n  // Else, we create a new one...\n  nodeMap.set(spanNode.id, spanNode);\n  return spanNode;\n}\n","import { SpanStatusCode } from '@opentelemetry/api';\nimport { SEMATTRS_HTTP_STATUS_CODE, SEMATTRS_RPC_GRPC_STATUS_CODE } from '@opentelemetry/semantic-conventions';\nimport { SPAN_STATUS_ERROR, SPAN_STATUS_OK, getSpanStatusFromHttpCode } from '@sentry/core';\nimport type { SpanAttributes, SpanStatus } from '@sentry/types';\n\nimport type { AbstractSpan } from '../types';\nimport { spanHasAttributes, spanHasStatus } from './spanTypes';\n\n// canonicalCodesGrpcMap maps some GRPC codes to Sentry's span statuses. See description in grpc documentation.\nconst canonicalGrpcErrorCodesMap: Record<string, SpanStatus['message']> = {\n  '1': 'cancelled',\n  '2': 'unknown_error',\n  '3': 'invalid_argument',\n  '4': 'deadline_exceeded',\n  '5': 'not_found',\n  '6': 'already_exists',\n  '7': 'permission_denied',\n  '8': 'resource_exhausted',\n  '9': 'failed_precondition',\n  '10': 'aborted',\n  '11': 'out_of_range',\n  '12': 'unimplemented',\n  '13': 'internal_error',\n  '14': 'unavailable',\n  '15': 'data_loss',\n  '16': 'unauthenticated',\n} as const;\n\nconst isStatusErrorMessageValid = (message: string): boolean => {\n  return Object.values(canonicalGrpcErrorCodesMap).includes(message as SpanStatus['message']);\n};\n\n/**\n * Get a Sentry span status from an otel span.\n */\nexport function mapStatus(span: AbstractSpan): SpanStatus {\n  const attributes = spanHasAttributes(span) ? span.attributes : {};\n  const status = spanHasStatus(span) ? span.status : undefined;\n\n  if (status) {\n    // Since span status OK is not set by default, we give it priority: https://opentelemetry.io/docs/concepts/signals/traces/#span-status\n    if (status.code === SpanStatusCode.OK) {\n      return { code: SPAN_STATUS_OK };\n      // If the span is already marked as erroneous we return that exact status\n    } else if (status.code === SpanStatusCode.ERROR) {\n      if (typeof status.message === 'undefined') {\n        const inferredStatus = inferStatusFromAttributes(attributes);\n        if (inferredStatus) {\n          return inferredStatus;\n        }\n      }\n\n      if (status.message && isStatusErrorMessageValid(status.message)) {\n        return { code: SPAN_STATUS_ERROR, message: status.message };\n      } else {\n        return { code: SPAN_STATUS_ERROR, message: 'unknown_error' };\n      }\n    }\n  }\n\n  // If the span status is UNSET, we try to infer it from HTTP or GRPC status codes.\n  const inferredStatus = inferStatusFromAttributes(attributes);\n\n  if (inferredStatus) {\n    return inferredStatus;\n  }\n\n  // We default to setting the spans status to ok.\n  if (status && status.code === SpanStatusCode.UNSET) {\n    return { code: SPAN_STATUS_OK };\n  } else {\n    return { code: SPAN_STATUS_ERROR, message: 'unknown_error' };\n  }\n}\n\nfunction inferStatusFromAttributes(attributes: SpanAttributes): SpanStatus | undefined {\n  // If the span status is UNSET, we try to infer it from HTTP or GRPC status codes.\n\n  const httpCodeAttribute = attributes[SEMATTRS_HTTP_STATUS_CODE];\n  const grpcCodeAttribute = attributes[SEMATTRS_RPC_GRPC_STATUS_CODE];\n\n  const numberHttpCode =\n    typeof httpCodeAttribute === 'number'\n      ? httpCodeAttribute\n      : typeof httpCodeAttribute === 'string'\n        ? parseInt(httpCodeAttribute)\n        : undefined;\n\n  if (typeof numberHttpCode === 'number') {\n    return getSpanStatusFromHttpCode(numberHttpCode);\n  }\n\n  if (typeof grpcCodeAttribute === 'string') {\n    return { code: SPAN_STATUS_ERROR, message: canonicalGrpcErrorCodesMap[grpcCodeAttribute] || 'unknown_error' };\n  }\n\n  return undefined;\n}\n","import type { Span } from '@opentelemetry/api';\nimport { SpanKind } from '@opentelemetry/api';\nimport type { ReadableSpan } from '@opentelemetry/sdk-trace-base';\nimport { SEMATTRS_HTTP_STATUS_CODE } from '@opentelemetry/semantic-conventions';\nimport {\n  captureEvent,\n  getCapturedScopesOnSpan,\n  getDynamicSamplingContextFromSpan,\n  getMetricSummaryJsonForSpan,\n  timedEventsToMeasurements,\n} from '@sentry/core';\nimport {\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,\n  SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,\n  SEMANTIC_ATTRIBUTE_SENTRY_SOURCE,\n  getStatusMessage,\n  spanTimeInputToSeconds,\n} from '@sentry/core';\nimport type { SpanJSON, SpanOrigin, TraceContext, TransactionEvent, TransactionSource } from '@sentry/types';\nimport { dropUndefinedKeys, logger } from '@sentry/utils';\nimport { SENTRY_TRACE_STATE_PARENT_SPAN_ID } from './constants';\n\nimport { DEBUG_BUILD } from './debug-build';\nimport { SEMANTIC_ATTRIBUTE_SENTRY_PARENT_IS_REMOTE } from './semanticAttributes';\nimport { getRequestSpanData } from './utils/getRequestSpanData';\nimport type { SpanNode } from './utils/groupSpansWithParents';\nimport { getLocalParentId } from './utils/groupSpansWithParents';\nimport { groupSpansWithParents } from './utils/groupSpansWithParents';\nimport { mapStatus } from './utils/mapStatus';\nimport { parseSpanDescription } from './utils/parseSpanDescription';\n\ntype SpanNodeCompleted = SpanNode & { span: ReadableSpan };\n\nconst MAX_SPAN_COUNT = 1000;\nconst DEFAULT_TIMEOUT = 300; // 5 min\n\n/**\n * A Sentry-specific exporter that converts OpenTelemetry Spans to Sentry Spans & Transactions.\n */\nexport class SentrySpanExporter {\n  private _flushTimeout: ReturnType<typeof setTimeout> | undefined;\n  private _finishedSpans: ReadableSpan[];\n  private _timeout: number;\n\n  public constructor(options?: { timeout?: number }) {\n    this._finishedSpans = [];\n    this._timeout = options?.timeout || DEFAULT_TIMEOUT;\n  }\n\n  /** Export a single span. */\n  public export(span: ReadableSpan): void {\n    this._finishedSpans.push(span);\n\n    // If the span has a local parent ID, we don't need to export anything just yet\n    if (getLocalParentId(span)) {\n      const openSpanCount = this._finishedSpans.length;\n      DEBUG_BUILD && logger.log(`SpanExporter has ${openSpanCount} unsent spans remaining`);\n      this._cleanupOldSpans();\n      return;\n    }\n\n    this._clearTimeout();\n\n    // If we got a parent span, we try to send the span tree\n    // Wait a tick for this, to ensure we avoid race conditions\n    this._flushTimeout = setTimeout(() => {\n      this.flush();\n    }, 1);\n  }\n\n  /** Try to flush any pending spans immediately. */\n  public flush(): void {\n    this._clearTimeout();\n\n    const openSpanCount = this._finishedSpans.length;\n\n    const remainingSpans = maybeSend(this._finishedSpans);\n\n    const remainingOpenSpanCount = remainingSpans.length;\n    const sentSpanCount = openSpanCount - remainingOpenSpanCount;\n\n    DEBUG_BUILD &&\n      logger.log(`SpanExporter exported ${sentSpanCount} spans, ${remainingOpenSpanCount} unsent spans remaining`);\n\n    this._cleanupOldSpans(remainingSpans);\n  }\n\n  /** Clear the exporter. */\n  public clear(): void {\n    this._finishedSpans = [];\n    this._clearTimeout();\n  }\n\n  /** Clear the flush timeout. */\n  private _clearTimeout(): void {\n    if (this._flushTimeout) {\n      clearTimeout(this._flushTimeout);\n      this._flushTimeout = undefined;\n    }\n  }\n\n  /**\n   * Remove any span that is older than 5min.\n   * We do this to avoid leaking memory.\n   */\n  private _cleanupOldSpans(spans = this._finishedSpans): void {\n    this._finishedSpans = spans.filter(span => {\n      const shouldDrop = shouldCleanupSpan(span, this._timeout);\n      DEBUG_BUILD &&\n        shouldDrop &&\n        logger.log(\n          `SpanExporter dropping span ${span.name} (${\n            span.spanContext().spanId\n          }) because it is pending for more than 5 minutes.`,\n        );\n      return !shouldDrop;\n    });\n  }\n}\n\n/**\n * Send the given spans, but only if they are part of a finished transaction.\n *\n * Returns the unsent spans.\n * Spans remain unsent when their parent span is not yet finished.\n * This will happen regularly, as child spans are generally finished before their parents.\n * But it _could_ also happen because, for whatever reason, a parent span was lost.\n * In this case, we'll eventually need to clean this up.\n */\nfunction maybeSend(spans: ReadableSpan[]): ReadableSpan[] {\n  const grouped = groupSpansWithParents(spans);\n  const remaining = new Set(grouped);\n\n  const rootNodes = getCompletedRootNodes(grouped);\n\n  rootNodes.forEach(root => {\n    remaining.delete(root);\n    const span = root.span;\n    const transactionEvent = createTransactionForOtelSpan(span);\n\n    // We'll recursively add all the child spans to this array\n    const spans = transactionEvent.spans || [];\n\n    root.children.forEach(child => {\n      createAndFinishSpanForOtelSpan(child, spans, remaining);\n    });\n\n    // spans.sort() mutates the array, but we do not use this anymore after this point\n    // so we can safely mutate it here\n    transactionEvent.spans =\n      spans.length > MAX_SPAN_COUNT\n        ? spans.sort((a, b) => a.start_timestamp - b.start_timestamp).slice(0, MAX_SPAN_COUNT)\n        : spans;\n\n    const measurements = timedEventsToMeasurements(span.events);\n    if (measurements) {\n      transactionEvent.measurements = measurements;\n    }\n\n    captureEvent(transactionEvent);\n  });\n\n  return Array.from(remaining)\n    .map(node => node.span)\n    .filter((span): span is ReadableSpan => !!span);\n}\n\nfunction nodeIsCompletedRootNode(node: SpanNode): node is SpanNodeCompleted {\n  return !!node.span && !node.parentNode;\n}\n\nfunction getCompletedRootNodes(nodes: SpanNode[]): SpanNodeCompleted[] {\n  return nodes.filter(nodeIsCompletedRootNode);\n}\n\nfunction shouldCleanupSpan(span: ReadableSpan, maxStartTimeOffsetSeconds: number): boolean {\n  const cutoff = Date.now() / 1000 - maxStartTimeOffsetSeconds;\n  return spanTimeInputToSeconds(span.startTime) < cutoff;\n}\n\nfunction parseSpan(span: ReadableSpan): { op?: string; origin?: SpanOrigin; source?: TransactionSource } {\n  const attributes = span.attributes;\n\n  const origin = attributes[SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN] as SpanOrigin | undefined;\n  const op = attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP] as string | undefined;\n  const source = attributes[SEMANTIC_ATTRIBUTE_SENTRY_SOURCE] as TransactionSource | undefined;\n\n  return { origin, op, source };\n}\n\nfunction createTransactionForOtelSpan(span: ReadableSpan): TransactionEvent {\n  const { op, description, data, origin = 'manual', source } = getSpanData(span);\n  const capturedSpanScopes = getCapturedScopesOnSpan(span as unknown as Span);\n\n  const sampleRate = span.attributes[SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE] as number | undefined;\n\n  const attributes = dropUndefinedKeys({\n    [SEMANTIC_ATTRIBUTE_SENTRY_SOURCE]: source,\n    [SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE]: sampleRate,\n    [SEMANTIC_ATTRIBUTE_SENTRY_OP]: op,\n    [SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: origin,\n    ...data,\n    ...removeSentryAttributes(span.attributes),\n  });\n\n  const { traceId: trace_id, spanId: span_id } = span.spanContext();\n\n  const parentSpanIdFromTraceState = span.spanContext().traceState?.get(SENTRY_TRACE_STATE_PARENT_SPAN_ID);\n\n  // If parentSpanIdFromTraceState is defined at all, we want it to take presedence\n  // In that case, an empty string should be interpreted as \"no parent span id\",\n  // even if `span.parentSpanId` is set\n  // this is the case when we are starting a new trace, where we have a virtual span based on the propagationContext\n  // We only want to continue the traceId in this case, but ignore the parent span\n  const parent_span_id =\n    typeof parentSpanIdFromTraceState === 'string' ? parentSpanIdFromTraceState || undefined : span.parentSpanId;\n\n  const status = mapStatus(span);\n\n  const traceContext: TraceContext = dropUndefinedKeys({\n    parent_span_id,\n    span_id,\n    trace_id,\n    data: attributes,\n    origin,\n    op,\n    status: getStatusMessage(status), // As per protocol, span status is allowed to be undefined\n  });\n\n  const transactionEvent: TransactionEvent = {\n    contexts: {\n      trace: traceContext,\n      otel: {\n        resource: span.resource.attributes,\n      },\n    },\n    spans: [],\n    start_timestamp: spanTimeInputToSeconds(span.startTime),\n    timestamp: spanTimeInputToSeconds(span.endTime),\n    transaction: description,\n    type: 'transaction',\n    sdkProcessingMetadata: {\n      ...dropUndefinedKeys({\n        capturedSpanScope: capturedSpanScopes.scope,\n        capturedSpanIsolationScope: capturedSpanScopes.isolationScope,\n        sampleRate,\n        dynamicSamplingContext: getDynamicSamplingContextFromSpan(span as unknown as Span),\n      }),\n    },\n    ...(source && {\n      transaction_info: {\n        source,\n      },\n    }),\n    _metrics_summary: getMetricSummaryJsonForSpan(span as unknown as Span),\n  };\n\n  return transactionEvent;\n}\n\nfunction createAndFinishSpanForOtelSpan(node: SpanNode, spans: SpanJSON[], remaining: Set<SpanNode>): void {\n  remaining.delete(node);\n  const span = node.span;\n\n  const shouldDrop = !span;\n\n  // If this span should be dropped, we still want to create spans for the children of this\n  if (shouldDrop) {\n    node.children.forEach(child => {\n      createAndFinishSpanForOtelSpan(child, spans, remaining);\n    });\n    return;\n  }\n\n  const span_id = span.spanContext().spanId;\n  const trace_id = span.spanContext().traceId;\n\n  const { attributes, startTime, endTime, parentSpanId } = span;\n\n  const { op, description, data, origin = 'manual' } = getSpanData(span);\n  const allData = dropUndefinedKeys({\n    [SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: origin,\n    [SEMANTIC_ATTRIBUTE_SENTRY_OP]: op,\n    ...removeSentryAttributes(attributes),\n    ...data,\n  });\n\n  const status = mapStatus(span);\n\n  const spanJSON: SpanJSON = dropUndefinedKeys({\n    span_id,\n    trace_id,\n    data: allData,\n    description,\n    parent_span_id: parentSpanId,\n    start_timestamp: spanTimeInputToSeconds(startTime),\n    // This is [0,0] by default in OTEL, in which case we want to interpret this as no end time\n    timestamp: spanTimeInputToSeconds(endTime) || undefined,\n    status: getStatusMessage(status), // As per protocol, span status is allowed to be undefined\n    op,\n    origin,\n    _metrics_summary: getMetricSummaryJsonForSpan(span as unknown as Span),\n    measurements: timedEventsToMeasurements(span.events),\n  });\n\n  spans.push(spanJSON);\n\n  node.children.forEach(child => {\n    createAndFinishSpanForOtelSpan(child, spans, remaining);\n  });\n}\n\nfunction getSpanData(span: ReadableSpan): {\n  data: Record<string, unknown>;\n  op?: string;\n  description: string;\n  source?: TransactionSource;\n  origin?: SpanOrigin;\n} {\n  const { op: definedOp, source: definedSource, origin } = parseSpan(span);\n  const { op: inferredOp, description, source: inferredSource, data: inferredData } = parseSpanDescription(span);\n\n  const op = definedOp || inferredOp;\n  const source = definedSource || inferredSource;\n\n  const data = { ...inferredData, ...getData(span) };\n\n  return {\n    op,\n    description,\n    source,\n    origin,\n    data,\n  };\n}\n\n/**\n * Remove custom `sentry.` attribtues we do not need to send.\n * These are more carrier attributes we use inside of the SDK, we do not need to send them to the API.\n */\nfunction removeSentryAttributes(data: Record<string, unknown>): Record<string, unknown> {\n  const cleanedData = { ...data };\n\n  /* eslint-disable @typescript-eslint/no-dynamic-delete */\n  delete cleanedData[SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE];\n  delete cleanedData[SEMANTIC_ATTRIBUTE_SENTRY_PARENT_IS_REMOTE];\n  /* eslint-enable @typescript-eslint/no-dynamic-delete */\n\n  return cleanedData;\n}\n\nfunction getData(span: ReadableSpan): Record<string, unknown> {\n  const attributes = span.attributes;\n  const data: Record<string, unknown> = {};\n\n  if (span.kind !== SpanKind.INTERNAL) {\n    data['otel.kind'] = SpanKind[span.kind];\n  }\n\n  if (attributes[SEMATTRS_HTTP_STATUS_CODE]) {\n    const statusCode = attributes[SEMATTRS_HTTP_STATUS_CODE] as string;\n    data['http.response.status_code'] = statusCode;\n  }\n\n  const requestData = getRequestSpanData(span);\n\n  if (requestData.url) {\n    data.url = requestData.url;\n  }\n\n  if (requestData['http.query']) {\n    data['http.query'] = requestData['http.query'].slice(1);\n  }\n  if (requestData['http.fragment']) {\n    data['http.fragment'] = requestData['http.fragment'].slice(1);\n  }\n\n  return data;\n}\n","import type { Context } from '@opentelemetry/api';\nimport { ROOT_CONTEXT, trace } from '@opentelemetry/api';\nimport type { ReadableSpan, Span, SpanProcessor as SpanProcessorInterface } from '@opentelemetry/sdk-trace-base';\nimport {\n  addChildSpanToSpan,\n  getClient,\n  getDefaultCurrentScope,\n  getDefaultIsolationScope,\n  logSpanEnd,\n  logSpanStart,\n  setCapturedScopesOnSpan,\n} from '@sentry/core';\nimport { SEMANTIC_ATTRIBUTE_SENTRY_PARENT_IS_REMOTE } from './semanticAttributes';\nimport { SentrySpanExporter } from './spanExporter';\nimport { getScopesFromContext } from './utils/contextData';\nimport { setIsSetup } from './utils/setupCheck';\n\nfunction onSpanStart(span: Span, parentContext: Context): void {\n  // This is a reliable way to get the parent span - because this is exactly how the parent is identified in the OTEL SDK\n  const parentSpan = trace.getSpan(parentContext);\n\n  let scopes = getScopesFromContext(parentContext);\n\n  // We need access to the parent span in order to be able to move up the span tree for breadcrumbs\n  if (parentSpan && !parentSpan.spanContext().isRemote) {\n    addChildSpanToSpan(parentSpan, span);\n  }\n\n  // We need this in the span exporter\n  if (parentSpan && parentSpan.spanContext().isRemote) {\n    span.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_PARENT_IS_REMOTE, true);\n  }\n\n  // The root context does not have scopes stored, so we check for this specifically\n  // As fallback we attach the global scopes\n  if (parentContext === ROOT_CONTEXT) {\n    scopes = {\n      scope: getDefaultCurrentScope(),\n      isolationScope: getDefaultIsolationScope(),\n    };\n  }\n\n  // We need the scope at time of span creation in order to apply it to the event when the span is finished\n  if (scopes) {\n    setCapturedScopesOnSpan(span, scopes.scope, scopes.isolationScope);\n  }\n\n  logSpanStart(span);\n\n  const client = getClient();\n  client?.emit('spanStart', span);\n}\n\nfunction onSpanEnd(span: Span): void {\n  logSpanEnd(span);\n\n  const client = getClient();\n  client?.emit('spanEnd', span);\n}\n\n/**\n * Converts OpenTelemetry Spans to Sentry Spans and sends them to Sentry via\n * the Sentry SDK.\n */\nexport class SentrySpanProcessor implements SpanProcessorInterface {\n  private _exporter: SentrySpanExporter;\n\n  public constructor(options?: { timeout?: number }) {\n    setIsSetup('SentrySpanProcessor');\n    this._exporter = new SentrySpanExporter(options);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public async forceFlush(): Promise<void> {\n    this._exporter.flush();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public async shutdown(): Promise<void> {\n    this._exporter.clear();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public onStart(span: Span, parentContext: Context): void {\n    onSpanStart(span, parentContext);\n  }\n\n  /** @inheritDoc */\n  public onEnd(span: Span & ReadableSpan): void {\n    onSpanEnd(span);\n\n    this._exporter.export(span);\n  }\n}\n","import type { Attributes, Context, Span, TraceState as TraceStateInterface } from '@opentelemetry/api';\nimport { SpanKind } from '@opentelemetry/api';\nimport { isSpanContextValid, trace } from '@opentelemetry/api';\nimport { TraceState } from '@opentelemetry/core';\nimport type { Sampler, SamplingResult } from '@opentelemetry/sdk-trace-base';\nimport { SamplingDecision } from '@opentelemetry/sdk-trace-base';\nimport {\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE,\n  hasTracingEnabled,\n  sampleSpan,\n} from '@sentry/core';\nimport type { Client, SpanAttributes } from '@sentry/types';\nimport { logger } from '@sentry/utils';\nimport { SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING, SENTRY_TRACE_STATE_URL } from './constants';\n\nimport { SEMATTRS_HTTP_METHOD, SEMATTRS_HTTP_URL } from '@opentelemetry/semantic-conventions';\nimport { DEBUG_BUILD } from './debug-build';\nimport { getPropagationContextFromSpan } from './propagator';\nimport { getSamplingDecision } from './utils/getSamplingDecision';\nimport { inferSpanData } from './utils/parseSpanDescription';\nimport { setIsSetup } from './utils/setupCheck';\n\n/**\n * A custom OTEL sampler that uses Sentry sampling rates to make its decision\n */\nexport class SentrySampler implements Sampler {\n  private _client: Client;\n\n  public constructor(client: Client) {\n    this._client = client;\n    setIsSetup('SentrySampler');\n  }\n\n  /** @inheritDoc */\n  public shouldSample(\n    context: Context,\n    traceId: string,\n    spanName: string,\n    spanKind: SpanKind,\n    spanAttributes: SpanAttributes,\n    _links: unknown,\n  ): SamplingResult {\n    const options = this._client.getOptions();\n\n    const parentSpan = trace.getSpan(context);\n    const parentContext = parentSpan?.spanContext();\n\n    if (!hasTracingEnabled(options)) {\n      return wrapSamplingDecision({ decision: undefined, context, spanAttributes });\n    }\n\n    // If we have a http.client span that has no local parent, we never want to sample it\n    // but we want to leave downstream sampling decisions up to the server\n    if (\n      spanKind === SpanKind.CLIENT &&\n      spanAttributes[SEMATTRS_HTTP_METHOD] &&\n      (!parentSpan || parentContext?.isRemote)\n    ) {\n      return wrapSamplingDecision({ decision: undefined, context, spanAttributes });\n    }\n\n    const parentSampled = parentSpan ? getParentSampled(parentSpan, traceId, spanName) : undefined;\n\n    // We want to pass the inferred name & attributes to the sampler method\n    const {\n      description: inferredSpanName,\n      data: inferredAttributes,\n      op,\n    } = inferSpanData(spanName, spanAttributes, spanKind);\n\n    const mergedAttributes = {\n      ...inferredAttributes,\n      ...spanAttributes,\n    };\n\n    if (op) {\n      mergedAttributes[SEMANTIC_ATTRIBUTE_SENTRY_OP] = op;\n    }\n\n    const mutableSamplingDecision = { decision: true };\n    this._client.emit(\n      'beforeSampling',\n      {\n        spanAttributes: mergedAttributes,\n        spanName: inferredSpanName,\n        parentSampled: parentSampled,\n        parentContext: parentContext,\n      },\n      mutableSamplingDecision,\n    );\n    if (!mutableSamplingDecision.decision) {\n      return wrapSamplingDecision({ decision: undefined, context, spanAttributes });\n    }\n\n    const [sampled, sampleRate] = sampleSpan(options, {\n      name: inferredSpanName,\n      attributes: mergedAttributes,\n      transactionContext: {\n        name: inferredSpanName,\n        parentSampled,\n      },\n      parentSampled,\n    });\n\n    const attributes: Attributes = {\n      [SEMANTIC_ATTRIBUTE_SENTRY_SAMPLE_RATE]: sampleRate,\n    };\n\n    const method = `${spanAttributes[SEMATTRS_HTTP_METHOD]}`.toUpperCase();\n    if (method === 'OPTIONS' || method === 'HEAD') {\n      DEBUG_BUILD && logger.log(`[Tracing] Not sampling span because HTTP method is '${method}' for ${spanName}`);\n\n      return {\n        ...wrapSamplingDecision({ decision: SamplingDecision.NOT_RECORD, context, spanAttributes }),\n        attributes,\n      };\n    }\n\n    if (!sampled) {\n      return {\n        ...wrapSamplingDecision({ decision: SamplingDecision.NOT_RECORD, context, spanAttributes }),\n        attributes,\n      };\n    }\n    return {\n      ...wrapSamplingDecision({ decision: SamplingDecision.RECORD_AND_SAMPLED, context, spanAttributes }),\n      attributes,\n    };\n  }\n\n  /** Returns the sampler name or short description with the configuration. */\n  public toString(): string {\n    return 'SentrySampler';\n  }\n}\n\nfunction getParentRemoteSampled(parentSpan: Span): boolean | undefined {\n  const traceId = parentSpan.spanContext().traceId;\n  const traceparentData = getPropagationContextFromSpan(parentSpan);\n\n  // Only inherit sampled if `traceId` is the same\n  return traceparentData && traceId === traceparentData.traceId ? traceparentData.sampled : undefined;\n}\n\nfunction getParentSampled(parentSpan: Span, traceId: string, spanName: string): boolean | undefined {\n  const parentContext = parentSpan.spanContext();\n\n  // Only inherit sample rate if `traceId` is the same\n  // Note for testing: `isSpanContextValid()` checks the format of the traceId/spanId, so we need to pass valid ones\n  if (isSpanContextValid(parentContext) && parentContext.traceId === traceId) {\n    if (parentContext.isRemote) {\n      const parentSampled = getParentRemoteSampled(parentSpan);\n      DEBUG_BUILD &&\n        logger.log(`[Tracing] Inheriting remote parent's sampled decision for ${spanName}: ${parentSampled}`);\n      return parentSampled;\n    }\n\n    const parentSampled = getSamplingDecision(parentContext);\n    DEBUG_BUILD && logger.log(`[Tracing] Inheriting parent's sampled decision for ${spanName}: ${parentSampled}`);\n    return parentSampled;\n  }\n\n  return undefined;\n}\n\n/**\n * Wrap a sampling decision with data that Sentry needs to work properly with it.\n * If you pass `decision: undefined`, it will be treated as `NOT_RECORDING`, but in contrast to passing `NOT_RECORDING`\n * it will not propagate this decision to downstream Sentry SDKs.\n */\nexport function wrapSamplingDecision({\n  decision,\n  context,\n  spanAttributes,\n}: { decision: SamplingDecision | undefined; context: Context; spanAttributes: SpanAttributes }): SamplingResult {\n  const traceState = getBaseTraceState(context, spanAttributes);\n\n  // If the decision is undefined, we treat it as NOT_RECORDING, but we don't propagate this decision to downstream SDKs\n  // Which is done by not setting `SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING` traceState\n  if (decision == undefined) {\n    return { decision: SamplingDecision.NOT_RECORD, traceState };\n  }\n\n  if (decision === SamplingDecision.NOT_RECORD) {\n    return { decision, traceState: traceState.set(SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING, '1') };\n  }\n\n  return { decision, traceState };\n}\n\nfunction getBaseTraceState(context: Context, spanAttributes: SpanAttributes): TraceStateInterface {\n  const parentSpan = trace.getSpan(context);\n  const parentContext = parentSpan?.spanContext();\n\n  let traceState = parentContext?.traceState || new TraceState();\n\n  // We always keep the URL on the trace state, so we can access it in the propagator\n  const url = spanAttributes[SEMATTRS_HTTP_URL];\n  if (url && typeof url === 'string') {\n    traceState = traceState.set(SENTRY_TRACE_STATE_URL, url);\n  }\n\n  return traceState;\n}\n","import type { Instrumentation } from '@opentelemetry/instrumentation';\nimport { registerInstrumentations } from '@opentelemetry/instrumentation';\n\n/**\n * This method takes an OpenTelemetry instrumentation or\n * array of instrumentations and registers them with OpenTelemetry.\n */\nexport function addOpenTelemetryInstrumentation(...instrumentations: Instrumentation[]): void {\n  registerInstrumentations({\n    instrumentations,\n  });\n}\n","import { context } from '@opentelemetry/api';\nimport { getScopesFromContext } from '@sentry/opentelemetry';\nimport type { Scope } from '@sentry/types';\n\n/**\n * Update the active isolation scope.\n * Should be used with caution!\n */\nexport function setIsolationScope(isolationScope: Scope): void {\n  const scopes = getScopesFromContext(context.active());\n  if (scopes) {\n    scopes.isolationScope = isolationScope;\n  }\n}\n","import type { Span } from '@opentelemetry/api';\nimport { SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN } from '@sentry/core';\nimport type { SpanOrigin } from '@sentry/types';\n\n/** Adds an origin to an OTEL Span. */\nexport function addOriginToSpan(span: Span, origin: SpanOrigin): void {\n  span.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN, origin);\n}\n","import type { RequestOptions } from 'node:http';\n\n/** Build a full URL from request options. */\nexport function getRequestUrl(requestOptions: RequestOptions): string {\n  const protocol = requestOptions.protocol || '';\n  const hostname = requestOptions.hostname || requestOptions.host || '';\n  // Don't log standard :80 (http) and :443 (https) ports to reduce the noise\n  // Also don't add port if the hostname already includes a port\n  const port =\n    !requestOptions.port || requestOptions.port === 80 || requestOptions.port === 443 || /^(.*):(\\d+)$/.test(hostname)\n      ? ''\n      : `:${requestOptions.port}`;\n  const path = requestOptions.path ? requestOptions.path : '/';\n  return `${protocol}//${hostname}${port}${path}`;\n}\n","import type { ClientRequest, IncomingMessage, RequestOptions, ServerResponse } from 'node:http';\nimport type { Span } from '@opentelemetry/api';\nimport { HttpInstrumentation } from '@opentelemetry/instrumentation-http';\nimport { addOpenTelemetryInstrumentation } from '@sentry/opentelemetry';\n\nimport {\n  addBreadcrumb,\n  defineIntegration,\n  getCapturedScopesOnSpan,\n  getCurrentScope,\n  getIsolationScope,\n  isSentryRequestUrl,\n  setCapturedScopesOnSpan,\n} from '@sentry/core';\nimport { getClient } from '@sentry/opentelemetry';\nimport type { IntegrationFn, SanitizedRequestData } from '@sentry/types';\n\nimport { getSanitizedUrlString, parseUrl, stripUrlQueryAndFragment } from '@sentry/utils';\nimport type { NodeClient } from '../sdk/client';\nimport { setIsolationScope } from '../sdk/scope';\nimport type { HTTPModuleRequestIncomingMessage } from '../transports/http-module';\nimport { addOriginToSpan } from '../utils/addOriginToSpan';\nimport { getRequestUrl } from '../utils/getRequestUrl';\n\nconst INTEGRATION_NAME = 'Http';\n\ninterface HttpOptions {\n  /**\n   * Whether breadcrumbs should be recorded for requests.\n   * Defaults to true\n   */\n  breadcrumbs?: boolean;\n\n  /**\n   * Do not capture spans or breadcrumbs for outgoing HTTP requests to URLs where the given callback returns `true`.\n   * This controls both span & breadcrumb creation - spans will be non recording if tracing is disabled.\n   *\n   * The `url` param contains the entire URL, including query string (if any), protocol, host, etc. of the outgoing request.\n   * For example: `'https://someService.com/users/details?id=123'`\n   *\n   * The `request` param contains the original {@type RequestOptions} object used to make the outgoing request.\n   * You can use it to filter on additional properties like method, headers, etc.\n   */\n  ignoreOutgoingRequests?: (url: string, request: RequestOptions) => boolean;\n\n  /**\n   * Do not capture spans or breadcrumbs for incoming HTTP requests to URLs where the given callback returns `true`.\n   * This controls both span & breadcrumb creation - spans will be non recording if tracing is disabled.\n   *\n   * The `urlPath` param consists of the URL path and query string (if any) of the incoming request.\n   * For example: `'/users/details?id=123'`\n   *\n   * The `request` param contains the original {@type IncomingMessage} object of the incoming request.\n   * You can use it to filter on additional properties like method, headers, etc.\n   */\n  ignoreIncomingRequests?: (urlPath: string, request: IncomingMessage) => boolean;\n\n  /**\n   * Additional instrumentation options that are passed to the underlying HttpInstrumentation.\n   */\n  instrumentation?: {\n    requestHook?: (span: Span, req: ClientRequest | HTTPModuleRequestIncomingMessage) => void;\n    responseHook?: (span: Span, response: HTTPModuleRequestIncomingMessage | ServerResponse) => void;\n    applyCustomAttributesOnSpan?: (\n      span: Span,\n      request: ClientRequest | HTTPModuleRequestIncomingMessage,\n      response: HTTPModuleRequestIncomingMessage | ServerResponse,\n    ) => void;\n\n    /**\n     * You can pass any configuration through to the underlying instrumention.\n     * Note that there are no semver guarantees for this!\n     */\n    _experimentalConfig?: ConstructorParameters<typeof HttpInstrumentation>[0];\n  };\n\n  /** Allows to pass a custom version of HttpInstrumentation. We use this for Next.js. */\n  _instrumentation?: typeof HttpInstrumentation;\n}\n\nlet _httpOptions: HttpOptions = {};\nlet _httpInstrumentation: HttpInstrumentation | undefined;\n\n/**\n * Instrument the HTTP module.\n * This can only be instrumented once! If this called again later, we just update the options.\n */\nexport const instrumentHttp = Object.assign(\n  function (): void {\n    if (_httpInstrumentation) {\n      return;\n    }\n\n    const _InstrumentationClass = _httpOptions._instrumentation || HttpInstrumentation;\n\n    _httpInstrumentation = new _InstrumentationClass({\n      ..._httpOptions.instrumentation?._experimentalConfig,\n      ignoreOutgoingRequestHook: request => {\n        const url = getRequestUrl(request);\n\n        if (!url) {\n          return false;\n        }\n\n        if (isSentryRequestUrl(url, getClient())) {\n          return true;\n        }\n\n        const _ignoreOutgoingRequests = _httpOptions.ignoreOutgoingRequests;\n        if (_ignoreOutgoingRequests && _ignoreOutgoingRequests(url, request)) {\n          return true;\n        }\n\n        return false;\n      },\n\n      ignoreIncomingRequestHook: request => {\n        // request.url is the only property that holds any information about the url\n        // it only consists of the URL path and query string (if any)\n        const urlPath = request.url;\n\n        const method = request.method?.toUpperCase();\n        // We do not capture OPTIONS/HEAD requests as transactions\n        if (method === 'OPTIONS' || method === 'HEAD') {\n          return true;\n        }\n\n        const _ignoreIncomingRequests = _httpOptions.ignoreIncomingRequests;\n        if (urlPath && _ignoreIncomingRequests && _ignoreIncomingRequests(urlPath, request)) {\n          return true;\n        }\n\n        return false;\n      },\n\n      requireParentforOutgoingSpans: false,\n      requireParentforIncomingSpans: false,\n      requestHook: (span, req) => {\n        addOriginToSpan(span, 'auto.http.otel.http');\n\n        // both, incoming requests and \"client\" requests made within the app trigger the requestHook\n        // we only want to isolate and further annotate incoming requests (IncomingMessage)\n        if (_isClientRequest(req)) {\n          _httpOptions.instrumentation?.requestHook?.(span, req);\n          return;\n        }\n\n        const scopes = getCapturedScopesOnSpan(span);\n\n        const isolationScope = (scopes.isolationScope || getIsolationScope()).clone();\n        const scope = scopes.scope || getCurrentScope();\n\n        // Update the isolation scope, isolate this request\n        isolationScope.setSDKProcessingMetadata({ request: req });\n\n        const client = getClient<NodeClient>();\n        if (client && client.getOptions().autoSessionTracking) {\n          isolationScope.setRequestSession({ status: 'ok' });\n        }\n        setIsolationScope(isolationScope);\n        setCapturedScopesOnSpan(span, scope, isolationScope);\n\n        // attempt to update the scope's `transactionName` based on the request URL\n        // Ideally, framework instrumentations coming after the HttpInstrumentation\n        // update the transactionName once we get a parameterized route.\n        const httpMethod = (req.method || 'GET').toUpperCase();\n        const httpTarget = stripUrlQueryAndFragment(req.url || '/');\n\n        const bestEffortTransactionName = `${httpMethod} ${httpTarget}`;\n\n        isolationScope.setTransactionName(bestEffortTransactionName);\n\n        _httpOptions.instrumentation?.requestHook?.(span, req);\n      },\n      responseHook: (span, res) => {\n        const client = getClient<NodeClient>();\n        if (client && client.getOptions().autoSessionTracking) {\n          setImmediate(() => {\n            client['_captureRequestSession']();\n          });\n        }\n\n        _httpOptions.instrumentation?.responseHook?.(span, res);\n      },\n      applyCustomAttributesOnSpan: (\n        span: Span,\n        request: ClientRequest | HTTPModuleRequestIncomingMessage,\n        response: HTTPModuleRequestIncomingMessage | ServerResponse,\n      ) => {\n        const _breadcrumbs = typeof _httpOptions.breadcrumbs === 'undefined' ? true : _httpOptions.breadcrumbs;\n        if (_breadcrumbs) {\n          _addRequestBreadcrumb(request, response);\n        }\n\n        _httpOptions.instrumentation?.applyCustomAttributesOnSpan?.(span, request, response);\n      },\n    });\n\n    addOpenTelemetryInstrumentation(_httpInstrumentation);\n  },\n  {\n    id: INTEGRATION_NAME,\n  },\n);\n\nconst _httpIntegration = ((options: HttpOptions = {}) => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      _httpOptions = options;\n      instrumentHttp();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * The http integration instruments Node's internal http and https modules.\n * It creates breadcrumbs and spans for outgoing HTTP requests which will be attached to the currently active span.\n */\nexport const httpIntegration = defineIntegration(_httpIntegration);\n\n/** Add a breadcrumb for outgoing requests. */\nfunction _addRequestBreadcrumb(\n  request: ClientRequest | HTTPModuleRequestIncomingMessage,\n  response: HTTPModuleRequestIncomingMessage | ServerResponse,\n): void {\n  // Only generate breadcrumbs for outgoing requests\n  if (!_isClientRequest(request)) {\n    return;\n  }\n\n  const data = getBreadcrumbData(request);\n  addBreadcrumb(\n    {\n      category: 'http',\n      data: {\n        status_code: response.statusCode,\n        ...data,\n      },\n      type: 'http',\n    },\n    {\n      event: 'response',\n      request,\n      response,\n    },\n  );\n}\n\nfunction getBreadcrumbData(request: ClientRequest): Partial<SanitizedRequestData> {\n  try {\n    // `request.host` does not contain the port, but the host header does\n    const host = request.getHeader('host') || request.host;\n    const url = new URL(request.path, `${request.protocol}//${host}`);\n    const parsedUrl = parseUrl(url.toString());\n\n    const data: Partial<SanitizedRequestData> = {\n      url: getSanitizedUrlString(parsedUrl),\n      'http.method': request.method || 'GET',\n    };\n\n    if (parsedUrl.search) {\n      data['http.query'] = parsedUrl.search;\n    }\n    if (parsedUrl.hash) {\n      data['http.fragment'] = parsedUrl.hash;\n    }\n\n    return data;\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Determines if @param req is a ClientRequest, meaning the request was created within the express app\n * and it's an outgoing request.\n * Checking for properties instead of using `instanceOf` to avoid importing the request classes.\n */\nfunction _isClientRequest(req: ClientRequest | HTTPModuleRequestIncomingMessage): req is ClientRequest {\n  return 'outputData' in req && 'outputSize' in req && !('client' in req) && !('statusCode' in req);\n}\n","declare const __DEBUG_BUILD__: boolean;\n\n/**\n * This serves as a build time flag that will be true by default, but false in non-debug builds or if users replace `__SENTRY_DEBUG__` in their generated code.\n *\n * ATTENTION: This constant must never cross package boundaries (i.e. be exported) to guarantee that it can be used for tree shaking.\n */\nexport const DEBUG_BUILD = __DEBUG_BUILD__;\n","import { parseSemver } from '@sentry/utils';\n\nexport const NODE_VERSION = parseSemver(process.versions.node) as { major: number; minor: number; patch: number };\nexport const NODE_MAJOR = NODE_VERSION.major;\n","import type { Span } from '@opentelemetry/api';\nimport { trace } from '@opentelemetry/api';\nimport { context, propagation } from '@opentelemetry/api';\nimport { addBreadcrumb, defineIntegration, getCurrentScope, hasTracingEnabled } from '@sentry/core';\nimport {\n  addOpenTelemetryInstrumentation,\n  generateSpanContextForPropagationContext,\n  getPropagationContextFromSpan,\n} from '@sentry/opentelemetry';\nimport type { IntegrationFn, SanitizedRequestData } from '@sentry/types';\nimport { getSanitizedUrlString, logger, parseUrl } from '@sentry/utils';\nimport { DEBUG_BUILD } from '../debug-build';\nimport { NODE_MAJOR } from '../nodeVersion';\n\nimport type { FetchInstrumentation } from 'opentelemetry-instrumentation-fetch-node';\n\nimport { addOriginToSpan } from '../utils/addOriginToSpan';\n\ninterface FetchRequest {\n  method: string;\n  origin: string;\n  path: string;\n  headers: string | string[];\n}\n\ninterface FetchResponse {\n  headers: Buffer[];\n  statusCode: number;\n}\n\ninterface NodeFetchOptions {\n  /**\n   * Whether breadcrumbs should be recorded for requests.\n   * Defaults to true\n   */\n  breadcrumbs?: boolean;\n\n  /**\n   * Do not capture spans or breadcrumbs for outgoing fetch requests to URLs where the given callback returns `true`.\n   * This controls both span & breadcrumb creation - spans will be non recording if tracing is disabled.\n   */\n  ignoreOutgoingRequests?: (url: string) => boolean;\n}\n\nconst _nativeNodeFetchIntegration = ((options: NodeFetchOptions = {}) => {\n  const _breadcrumbs = typeof options.breadcrumbs === 'undefined' ? true : options.breadcrumbs;\n  const _ignoreOutgoingRequests = options.ignoreOutgoingRequests;\n\n  async function getInstrumentation(): Promise<FetchInstrumentation | void> {\n    // Only add NodeFetch if Node >= 18, as previous versions do not support it\n    if (NODE_MAJOR < 18) {\n      DEBUG_BUILD && logger.log('NodeFetch is not supported on Node < 18, skipping instrumentation...');\n      return;\n    }\n\n    try {\n      const pkg = await import('opentelemetry-instrumentation-fetch-node');\n      const { FetchInstrumentation } = pkg;\n\n      class SentryNodeFetchInstrumentation extends FetchInstrumentation {\n        // We extend this method so we have access to request _and_ response for the breadcrumb\n        public onHeaders({ request, response }: { request: FetchRequest; response: FetchResponse }): void {\n          if (_breadcrumbs) {\n            _addRequestBreadcrumb(request, response);\n          }\n\n          return super.onHeaders({ request, response });\n        }\n      }\n\n      return new SentryNodeFetchInstrumentation({\n        ignoreRequestHook: (request: FetchRequest) => {\n          const url = getAbsoluteUrl(request.origin, request.path);\n          const tracingDisabled = !hasTracingEnabled();\n          const shouldIgnore = _ignoreOutgoingRequests && url && _ignoreOutgoingRequests(url);\n\n          if (shouldIgnore) {\n            return true;\n          }\n\n          // If tracing is disabled, we still want to propagate traces\n          // So we do that manually here, matching what the instrumentation does otherwise\n          if (tracingDisabled) {\n            const ctx = context.active();\n            const addedHeaders: Record<string, string> = {};\n\n            // We generate a virtual span context from the active one,\n            // Where we attach the URL to the trace state, so the propagator can pick it up\n            const activeSpan = trace.getSpan(ctx);\n            const propagationContext = activeSpan\n              ? getPropagationContextFromSpan(activeSpan)\n              : getCurrentScope().getPropagationContext();\n\n            const spanContext = generateSpanContextForPropagationContext(propagationContext);\n            // We know that in practice we'll _always_ haven a traceState here\n            spanContext.traceState = spanContext.traceState?.set('sentry.url', url);\n            const ctxWithUrlTraceState = trace.setSpanContext(ctx, spanContext);\n\n            propagation.inject(ctxWithUrlTraceState, addedHeaders);\n\n            const requestHeaders = request.headers;\n            if (Array.isArray(requestHeaders)) {\n              Object.entries(addedHeaders).forEach(headers => requestHeaders.push(...headers));\n            } else {\n              request.headers += Object.entries(addedHeaders)\n                .map(([k, v]) => `${k}: ${v}\\r\\n`)\n                .join('');\n            }\n\n            // Prevent starting a span for this request\n            return true;\n          }\n\n          return false;\n        },\n        onRequest: ({ span }: { span: Span }) => {\n          _updateSpan(span);\n        },\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      } as any);\n    } catch (error) {\n      // Could not load instrumentation\n      DEBUG_BUILD && logger.log('Error while loading NodeFetch instrumentation: \\n', error);\n    }\n  }\n\n  return {\n    name: 'NodeFetch',\n    setupOnce() {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      getInstrumentation().then(instrumentation => {\n        if (instrumentation) {\n          addOpenTelemetryInstrumentation(instrumentation);\n        }\n      });\n    },\n  };\n}) satisfies IntegrationFn;\n\nexport const nativeNodeFetchIntegration = defineIntegration(_nativeNodeFetchIntegration);\n\n/** Update the span with data we need. */\nfunction _updateSpan(span: Span): void {\n  addOriginToSpan(span, 'auto.http.otel.node_fetch');\n}\n\n/** Add a breadcrumb for outgoing requests. */\nfunction _addRequestBreadcrumb(request: FetchRequest, response: FetchResponse): void {\n  const data = getBreadcrumbData(request);\n\n  addBreadcrumb(\n    {\n      category: 'http',\n      data: {\n        status_code: response.statusCode,\n        ...data,\n      },\n      type: 'http',\n    },\n    {\n      event: 'response',\n      request,\n      response,\n    },\n  );\n}\n\nfunction getBreadcrumbData(request: FetchRequest): Partial<SanitizedRequestData> {\n  try {\n    const url = new URL(request.path, request.origin);\n    const parsedUrl = parseUrl(url.toString());\n\n    const data: Partial<SanitizedRequestData> = {\n      url: getSanitizedUrlString(parsedUrl),\n      'http.method': request.method || 'GET',\n    };\n\n    if (parsedUrl.search) {\n      data['http.query'] = parsedUrl.search;\n    }\n    if (parsedUrl.hash) {\n      data['http.fragment'] = parsedUrl.hash;\n    }\n\n    return data;\n  } catch {\n    return {};\n  }\n}\n\n// Matching the behavior of the base instrumentation\nfunction getAbsoluteUrl(origin: string, path: string = '/'): string {\n  const url = `${origin}`;\n\n  if (origin.endsWith('/') && path.startsWith('/')) {\n    return `${url}${path.slice(1)}`;\n  }\n\n  if (!origin.endsWith('/') && !path.startsWith('/')) {\n    return `${url}/${path.slice(1)}`;\n  }\n\n  return `${url}${path}`;\n}\n","import * as util from 'node:util';\nimport { addBreadcrumb, defineIntegration, getClient } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { addConsoleInstrumentationHandler, severityLevelFromString } from '@sentry/utils';\n\nconst INTEGRATION_NAME = 'Console';\n\nconst _consoleIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setup(client) {\n      addConsoleInstrumentationHandler(({ args, level }) => {\n        if (getClient() !== client) {\n          return;\n        }\n\n        addBreadcrumb(\n          {\n            category: 'console',\n            level: severityLevelFromString(level),\n            message: util.format.apply(undefined, args),\n          },\n          {\n            input: [...args],\n            level,\n          },\n        );\n      });\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Capture console logs as breadcrumbs.\n */\nexport const consoleIntegration = defineIntegration(_consoleIntegration);\n","/* eslint-disable max-lines */\nimport { execFile } from 'node:child_process';\nimport { readFile, readdir } from 'node:fs';\nimport * as os from 'node:os';\nimport { join } from 'node:path';\nimport { promisify } from 'node:util';\nimport { defineIntegration } from '@sentry/core';\nimport type {\n  AppContext,\n  CloudResourceContext,\n  Contexts,\n  CultureContext,\n  DeviceContext,\n  Event,\n  IntegrationFn,\n  OsContext,\n} from '@sentry/types';\n\nexport const readFileAsync = promisify(readFile);\nexport const readDirAsync = promisify(readdir);\n\n// Process enhanced with methods from Node 18, 20, 22 as @types/node\n// is on `14.18.0` to match minimum version requirements of the SDK\ninterface ProcessWithCurrentValues extends NodeJS.Process {\n  availableMemory?(): number;\n}\n\nconst INTEGRATION_NAME = 'Context';\n\ninterface DeviceContextOptions {\n  cpu?: boolean;\n  memory?: boolean;\n}\n\ninterface ContextOptions {\n  app?: boolean;\n  os?: boolean;\n  device?: DeviceContextOptions | boolean;\n  culture?: boolean;\n  cloudResource?: boolean;\n}\n\nconst _nodeContextIntegration = ((options: ContextOptions = {}) => {\n  let cachedContext: Promise<Contexts> | undefined;\n\n  const _options = {\n    app: true,\n    os: true,\n    device: true,\n    culture: true,\n    cloudResource: true,\n    ...options,\n  };\n\n  /** Add contexts to the event. Caches the context so we only look it up once. */\n  async function addContext(event: Event): Promise<Event> {\n    if (cachedContext === undefined) {\n      cachedContext = _getContexts();\n    }\n\n    const updatedContext = _updateContext(await cachedContext);\n\n    event.contexts = {\n      ...event.contexts,\n      app: { ...updatedContext.app, ...event.contexts?.app },\n      os: { ...updatedContext.os, ...event.contexts?.os },\n      device: { ...updatedContext.device, ...event.contexts?.device },\n      culture: { ...updatedContext.culture, ...event.contexts?.culture },\n      cloud_resource: { ...updatedContext.cloud_resource, ...event.contexts?.cloud_resource },\n    };\n\n    return event;\n  }\n\n  /** Get the contexts from node. */\n  async function _getContexts(): Promise<Contexts> {\n    const contexts: Contexts = {};\n\n    if (_options.os) {\n      contexts.os = await getOsContext();\n    }\n\n    if (_options.app) {\n      contexts.app = getAppContext();\n    }\n\n    if (_options.device) {\n      contexts.device = getDeviceContext(_options.device);\n    }\n\n    if (_options.culture) {\n      const culture = getCultureContext();\n\n      if (culture) {\n        contexts.culture = culture;\n      }\n    }\n\n    if (_options.cloudResource) {\n      contexts.cloud_resource = getCloudResourceContext();\n    }\n\n    return contexts;\n  }\n\n  return {\n    name: INTEGRATION_NAME,\n    processEvent(event) {\n      return addContext(event);\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Capture context about the environment and the device that the client is running on, to events.\n */\nexport const nodeContextIntegration = defineIntegration(_nodeContextIntegration);\n\n/**\n * Updates the context with dynamic values that can change\n */\nfunction _updateContext(contexts: Contexts): Contexts {\n  // Only update properties if they exist\n\n  if (contexts?.app?.app_memory) {\n    contexts.app.app_memory = process.memoryUsage().rss;\n  }\n\n  if (contexts?.app?.free_memory && typeof (process as ProcessWithCurrentValues).availableMemory === 'function') {\n    const freeMemory = (process as ProcessWithCurrentValues).availableMemory?.();\n    if (freeMemory != null) {\n      contexts.app.free_memory = freeMemory;\n    }\n  }\n\n  if (contexts?.device?.free_memory) {\n    contexts.device.free_memory = os.freemem();\n  }\n\n  return contexts;\n}\n\n/**\n * Returns the operating system context.\n *\n * Based on the current platform, this uses a different strategy to provide the\n * most accurate OS information. Since this might involve spawning subprocesses\n * or accessing the file system, this should only be executed lazily and cached.\n *\n *  - On macOS (Darwin), this will execute the `sw_vers` utility. The context\n *    has a `name`, `version`, `build` and `kernel_version` set.\n *  - On Linux, this will try to load a distribution release from `/etc` and set\n *    the `name`, `version` and `kernel_version` fields.\n *  - On all other platforms, only a `name` and `version` will be returned. Note\n *    that `version` might actually be the kernel version.\n */\nasync function getOsContext(): Promise<OsContext> {\n  const platformId = os.platform();\n  switch (platformId) {\n    case 'darwin':\n      return getDarwinInfo();\n    case 'linux':\n      return getLinuxInfo();\n    default:\n      return {\n        name: PLATFORM_NAMES[platformId] || platformId,\n        version: os.release(),\n      };\n  }\n}\n\nfunction getCultureContext(): CultureContext | undefined {\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-explicit-any\n    if (typeof (process.versions as unknown as any).icu !== 'string') {\n      // Node was built without ICU support\n      return;\n    }\n\n    // Check that node was built with full Intl support. Its possible it was built without support for non-English\n    // locales which will make resolvedOptions inaccurate\n    //\n    // https://nodejs.org/api/intl.html#detecting-internationalization-support\n    const january = new Date(9e8);\n    const spanish = new Intl.DateTimeFormat('es', { month: 'long' });\n    if (spanish.format(january) === 'enero') {\n      const options = Intl.DateTimeFormat().resolvedOptions();\n\n      return {\n        locale: options.locale,\n        timezone: options.timeZone,\n      };\n    }\n  } catch (err) {\n    //\n  }\n\n  return;\n}\n\n/**\n * Get app context information from process\n */\nexport function getAppContext(): AppContext {\n  const app_memory = process.memoryUsage().rss;\n  const app_start_time = new Date(Date.now() - process.uptime() * 1000).toISOString();\n  // https://nodejs.org/api/process.html#processavailablememory\n  const appContext: AppContext = { app_start_time, app_memory };\n\n  if (typeof (process as ProcessWithCurrentValues).availableMemory === 'function') {\n    const freeMemory = (process as ProcessWithCurrentValues).availableMemory?.();\n    if (freeMemory != null) {\n      appContext.free_memory = freeMemory;\n    }\n  }\n\n  return appContext;\n}\n\n/**\n * Gets device information from os\n */\nexport function getDeviceContext(deviceOpt: DeviceContextOptions | true): DeviceContext {\n  const device: DeviceContext = {};\n\n  // Sometimes os.uptime() throws due to lacking permissions: https://github.com/getsentry/sentry-javascript/issues/8202\n  let uptime;\n  try {\n    uptime = os.uptime && os.uptime();\n  } catch (e) {\n    // noop\n  }\n\n  // os.uptime or its return value seem to be undefined in certain environments (e.g. Azure functions).\n  // Hence, we only set boot time, if we get a valid uptime value.\n  // @see https://github.com/getsentry/sentry-javascript/issues/5856\n  if (typeof uptime === 'number') {\n    device.boot_time = new Date(Date.now() - uptime * 1000).toISOString();\n  }\n\n  device.arch = os.arch();\n\n  if (deviceOpt === true || deviceOpt.memory) {\n    device.memory_size = os.totalmem();\n    device.free_memory = os.freemem();\n  }\n\n  if (deviceOpt === true || deviceOpt.cpu) {\n    const cpuInfo: os.CpuInfo[] | undefined = os.cpus();\n    const firstCpu = cpuInfo && cpuInfo[0];\n    if (firstCpu) {\n      device.processor_count = cpuInfo.length;\n      device.cpu_description = firstCpu.model;\n      device.processor_frequency = firstCpu.speed;\n    }\n  }\n\n  return device;\n}\n\n/** Mapping of Node's platform names to actual OS names. */\nconst PLATFORM_NAMES: { [platform: string]: string } = {\n  aix: 'IBM AIX',\n  freebsd: 'FreeBSD',\n  openbsd: 'OpenBSD',\n  sunos: 'SunOS',\n  win32: 'Windows',\n};\n\n/** Linux version file to check for a distribution. */\ninterface DistroFile {\n  /** The file name, located in `/etc`. */\n  name: string;\n  /** Potential distributions to check. */\n  distros: [string, ...string[]];\n}\n\n/** Mapping of linux release files located in /etc to distributions. */\nconst LINUX_DISTROS: DistroFile[] = [\n  { name: 'fedora-release', distros: ['Fedora'] },\n  { name: 'redhat-release', distros: ['Red Hat Linux', 'Centos'] },\n  { name: 'redhat_version', distros: ['Red Hat Linux'] },\n  { name: 'SuSE-release', distros: ['SUSE Linux'] },\n  { name: 'lsb-release', distros: ['Ubuntu Linux', 'Arch Linux'] },\n  { name: 'debian_version', distros: ['Debian'] },\n  { name: 'debian_release', distros: ['Debian'] },\n  { name: 'arch-release', distros: ['Arch Linux'] },\n  { name: 'gentoo-release', distros: ['Gentoo Linux'] },\n  { name: 'novell-release', distros: ['SUSE Linux'] },\n  { name: 'alpine-release', distros: ['Alpine Linux'] },\n];\n\n/** Functions to extract the OS version from Linux release files. */\nconst LINUX_VERSIONS: {\n  [identifier: string]: (content: string) => string | undefined;\n} = {\n  alpine: content => content,\n  arch: content => matchFirst(/distrib_release=(.*)/, content),\n  centos: content => matchFirst(/release ([^ ]+)/, content),\n  debian: content => content,\n  fedora: content => matchFirst(/release (..)/, content),\n  mint: content => matchFirst(/distrib_release=(.*)/, content),\n  red: content => matchFirst(/release ([^ ]+)/, content),\n  suse: content => matchFirst(/VERSION = (.*)\\n/, content),\n  ubuntu: content => matchFirst(/distrib_release=(.*)/, content),\n};\n\n/**\n * Executes a regular expression with one capture group.\n *\n * @param regex A regular expression to execute.\n * @param text Content to execute the RegEx on.\n * @returns The captured string if matched; otherwise undefined.\n */\nfunction matchFirst(regex: RegExp, text: string): string | undefined {\n  const match = regex.exec(text);\n  return match ? match[1] : undefined;\n}\n\n/** Loads the macOS operating system context. */\nasync function getDarwinInfo(): Promise<OsContext> {\n  // Default values that will be used in case no operating system information\n  // can be loaded. The default version is computed via heuristics from the\n  // kernel version, but the build ID is missing.\n  const darwinInfo: OsContext = {\n    kernel_version: os.release(),\n    name: 'Mac OS X',\n    version: `10.${Number(os.release().split('.')[0]) - 4}`,\n  };\n\n  try {\n    // We try to load the actual macOS version by executing the `sw_vers` tool.\n    // This tool should be available on every standard macOS installation. In\n    // case this fails, we stick with the values computed above.\n\n    const output = await new Promise<string>((resolve, reject) => {\n      execFile('/usr/bin/sw_vers', (error: Error | null, stdout: string) => {\n        if (error) {\n          reject(error);\n          return;\n        }\n        resolve(stdout);\n      });\n    });\n\n    darwinInfo.name = matchFirst(/^ProductName:\\s+(.*)$/m, output);\n    darwinInfo.version = matchFirst(/^ProductVersion:\\s+(.*)$/m, output);\n    darwinInfo.build = matchFirst(/^BuildVersion:\\s+(.*)$/m, output);\n  } catch (e) {\n    // ignore\n  }\n\n  return darwinInfo;\n}\n\n/** Returns a distribution identifier to look up version callbacks. */\nfunction getLinuxDistroId(name: string): string {\n  return (name.split(' ') as [string])[0].toLowerCase();\n}\n\n/** Loads the Linux operating system context. */\nasync function getLinuxInfo(): Promise<OsContext> {\n  // By default, we cannot assume anything about the distribution or Linux\n  // version. `os.release()` returns the kernel version and we assume a generic\n  // \"Linux\" name, which will be replaced down below.\n  const linuxInfo: OsContext = {\n    kernel_version: os.release(),\n    name: 'Linux',\n  };\n\n  try {\n    // We start guessing the distribution by listing files in the /etc\n    // directory. This is were most Linux distributions (except Knoppix) store\n    // release files with certain distribution-dependent meta data. We search\n    // for exactly one known file defined in `LINUX_DISTROS` and exit if none\n    // are found. In case there are more than one file, we just stick with the\n    // first one.\n    const etcFiles = await readDirAsync('/etc');\n    const distroFile = LINUX_DISTROS.find(file => etcFiles.includes(file.name));\n    if (!distroFile) {\n      return linuxInfo;\n    }\n\n    // Once that file is known, load its contents. To make searching in those\n    // files easier, we lowercase the file contents. Since these files are\n    // usually quite small, this should not allocate too much memory and we only\n    // hold on to it for a very short amount of time.\n    const distroPath = join('/etc', distroFile.name);\n    const contents = ((await readFileAsync(distroPath, { encoding: 'utf-8' })) as string).toLowerCase();\n\n    // Some Linux distributions store their release information in the same file\n    // (e.g. RHEL and Centos). In those cases, we scan the file for an\n    // identifier, that basically consists of the first word of the linux\n    // distribution name (e.g. \"red\" for Red Hat). In case there is no match, we\n    // just assume the first distribution in our list.\n    const { distros } = distroFile;\n    linuxInfo.name = distros.find(d => contents.indexOf(getLinuxDistroId(d)) >= 0) || distros[0];\n\n    // Based on the found distribution, we can now compute the actual version\n    // number. This is different for every distribution, so several strategies\n    // are computed in `LINUX_VERSIONS`.\n    const id = getLinuxDistroId(linuxInfo.name);\n    linuxInfo.version = LINUX_VERSIONS[id]?.(contents);\n  } catch (e) {\n    // ignore\n  }\n\n  return linuxInfo;\n}\n\n/**\n * Grabs some information about hosting provider based on best effort.\n */\nfunction getCloudResourceContext(): CloudResourceContext | undefined {\n  if (process.env.VERCEL) {\n    // https://vercel.com/docs/concepts/projects/environment-variables/system-environment-variables#system-environment-variables\n    return {\n      'cloud.provider': 'vercel',\n      'cloud.region': process.env.VERCEL_REGION,\n    };\n  } else if (process.env.AWS_REGION) {\n    // https://docs.aws.amazon.com/lambda/latest/dg/configuration-envvars.html\n    return {\n      'cloud.provider': 'aws',\n      'cloud.region': process.env.AWS_REGION,\n      'cloud.platform': process.env.AWS_EXECUTION_ENV,\n    };\n  } else if (process.env.GCP_PROJECT) {\n    // https://cloud.google.com/composer/docs/how-to/managing/environment-variables#reserved_variables\n    return {\n      'cloud.provider': 'gcp',\n    };\n  } else if (process.env.ALIYUN_REGION_ID) {\n    // TODO: find where I found these environment variables - at least gc.github.com returns something\n    return {\n      'cloud.provider': 'alibaba_cloud',\n      'cloud.region': process.env.ALIYUN_REGION_ID,\n    };\n  } else if (process.env.WEBSITE_SITE_NAME && process.env.REGION_NAME) {\n    // https://learn.microsoft.com/en-us/azure/app-service/reference-app-settings?tabs=kudu%2Cdotnet#app-environment\n    return {\n      'cloud.provider': 'azure',\n      'cloud.region': process.env.REGION_NAME,\n    };\n  } else if (process.env.IBM_CLOUD_REGION) {\n    // TODO: find where I found these environment variables - at least gc.github.com returns something\n    return {\n      'cloud.provider': 'ibm_cloud',\n      'cloud.region': process.env.IBM_CLOUD_REGION,\n    };\n  } else if (process.env.TENCENTCLOUD_REGION) {\n    // https://www.tencentcloud.com/document/product/583/32748\n    return {\n      'cloud.provider': 'tencent_cloud',\n      'cloud.region': process.env.TENCENTCLOUD_REGION,\n      'cloud.account.id': process.env.TENCENTCLOUD_APPID,\n      'cloud.availability_zone': process.env.TENCENTCLOUD_ZONE,\n    };\n  } else if (process.env.NETLIFY) {\n    // https://docs.netlify.com/configure-builds/environment-variables/#read-only-variables\n    return {\n      'cloud.provider': 'netlify',\n    };\n  } else if (process.env.FLY_REGION) {\n    // https://fly.io/docs/reference/runtime-environment/\n    return {\n      'cloud.provider': 'fly.io',\n      'cloud.region': process.env.FLY_REGION,\n    };\n  } else if (process.env.DYNO) {\n    // https://devcenter.heroku.com/articles/dynos#local-environment-variables\n    return {\n      'cloud.provider': 'heroku',\n    };\n  } else {\n    return undefined;\n  }\n}\n","import { createReadStream } from 'node:fs';\nimport { createInterface } from 'node:readline';\nimport { defineIntegration } from '@sentry/core';\nimport type { Event, IntegrationFn, StackFrame } from '@sentry/types';\nimport { LRUMap, logger, snipLine } from '@sentry/utils';\n\nimport { DEBUG_BUILD } from '../debug-build';\n\nconst LRU_FILE_CONTENTS_CACHE = new LRUMap<string, Record<number, string>>(10);\nconst LRU_FILE_CONTENTS_FS_READ_FAILED = new LRUMap<string, 1>(20);\nconst DEFAULT_LINES_OF_CONTEXT = 7;\nconst INTEGRATION_NAME = 'ContextLines';\n// Determines the upper bound of lineno/colno that we will attempt to read. Large colno values are likely to be\n// minified code while large lineno values are likely to be bundled code.\n// Exported for testing purposes.\nexport const MAX_CONTEXTLINES_COLNO: number = 1000;\nexport const MAX_CONTEXTLINES_LINENO: number = 10000;\n\ninterface ContextLinesOptions {\n  /**\n   * Sets the number of context lines for each frame when loading a file.\n   * Defaults to 7.\n   *\n   * Set to 0 to disable loading and inclusion of source files.\n   **/\n  frameContextLines?: number;\n}\n\n/**\n * Exported for testing purposes.\n */\nexport function resetFileContentCache(): void {\n  LRU_FILE_CONTENTS_CACHE.clear();\n}\n\n/**\n * Get or init map value\n */\nfunction emplace<T extends LRUMap<K, V>, K extends string, V>(map: T, key: K, contents: V): V {\n  const value = map.get(key);\n\n  if (value === undefined) {\n    map.set(key, contents);\n    return contents;\n  }\n\n  return value;\n}\n\n/**\n * Determines if context lines should be skipped for a file.\n * - .min.(mjs|cjs|js) files are and not useful since they dont point to the original source\n * - node: prefixed modules are part of the runtime and cannot be resolved to a file\n * - data: skip json, wasm and inline js https://nodejs.org/api/esm.html#data-imports\n */\nfunction shouldSkipContextLinesForFile(path: string): boolean {\n  // Test the most common prefix and extension first. These are the ones we\n  // are most likely to see in user applications and are the ones we can break out of first.\n  if (path.startsWith('node:')) return true;\n  if (path.endsWith('.min.js')) return true;\n  if (path.endsWith('.min.cjs')) return true;\n  if (path.endsWith('.min.mjs')) return true;\n  if (path.startsWith('data:')) return true;\n  return false;\n}\n\n/**\n * Determines if we should skip contextlines based off the max lineno and colno values.\n */\nfunction shouldSkipContextLinesForFrame(frame: StackFrame): boolean {\n  if (frame.lineno !== undefined && frame.lineno > MAX_CONTEXTLINES_LINENO) return true;\n  if (frame.colno !== undefined && frame.colno > MAX_CONTEXTLINES_COLNO) return true;\n  return false;\n}\n/**\n * Checks if we have all the contents that we need in the cache.\n */\nfunction rangeExistsInContentCache(file: string, range: ReadlineRange): boolean {\n  const contents = LRU_FILE_CONTENTS_CACHE.get(file);\n  if (contents === undefined) return false;\n\n  for (let i = range[0]; i <= range[1]; i++) {\n    if (contents[i] === undefined) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Creates contiguous ranges of lines to read from a file. In the case where context lines overlap,\n * the ranges are merged to create a single range.\n */\nfunction makeLineReaderRanges(lines: number[], linecontext: number): ReadlineRange[] {\n  if (!lines.length) {\n    return [];\n  }\n\n  let i = 0;\n  const line = lines[0];\n\n  if (typeof line !== 'number') {\n    return [];\n  }\n\n  let current = makeContextRange(line, linecontext);\n  const out: ReadlineRange[] = [];\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    if (i === lines.length - 1) {\n      out.push(current);\n      break;\n    }\n\n    // If the next line falls into the current range, extend the current range to lineno + linecontext.\n    const next = lines[i + 1];\n    if (typeof next !== 'number') {\n      break;\n    }\n    if (next <= current[1]) {\n      current[1] = next + linecontext;\n    } else {\n      out.push(current);\n      current = makeContextRange(next, linecontext);\n    }\n\n    i++;\n  }\n\n  return out;\n}\n\n/**\n * Extracts lines from a file and stores them in a cache.\n */\nfunction getContextLinesFromFile(path: string, ranges: ReadlineRange[], output: Record<number, string>): Promise<void> {\n  return new Promise((resolve, _reject) => {\n    // It is important *not* to have any async code between createInterface and the 'line' event listener\n    // as it will cause the 'line' event to\n    // be emitted before the listener is attached.\n    const stream = createReadStream(path);\n    const lineReaded = createInterface({\n      input: stream,\n    });\n\n    // Init at zero and increment at the start of the loop because lines are 1 indexed.\n    let lineNumber = 0;\n    let currentRangeIndex = 0;\n    const range = ranges[currentRangeIndex];\n    if (range === undefined) {\n      // We should never reach this point, but if we do, we should resolve the promise to prevent it from hanging.\n      resolve();\n      return;\n    }\n    let rangeStart = range[0];\n    let rangeEnd = range[1];\n\n    // We use this inside Promise.all, so we need to resolve the promise even if there is an error\n    // to prevent Promise.all from short circuiting the rest.\n    function onStreamError(e: Error): void {\n      // Mark file path as failed to read and prevent multiple read attempts.\n      LRU_FILE_CONTENTS_FS_READ_FAILED.set(path, 1);\n      DEBUG_BUILD && logger.error(`Failed to read file: ${path}. Error: ${e}`);\n      lineReaded.close();\n      lineReaded.removeAllListeners();\n      resolve();\n    }\n\n    // We need to handle the error event to prevent the process from crashing in < Node 16\n    // https://github.com/nodejs/node/pull/31603\n    stream.on('error', onStreamError);\n    lineReaded.on('error', onStreamError);\n    lineReaded.on('close', resolve);\n\n    lineReaded.on('line', line => {\n      lineNumber++;\n      if (lineNumber < rangeStart) return;\n\n      // !Warning: This mutates the cache by storing the snipped line into the cache.\n      output[lineNumber] = snipLine(line, 0);\n\n      if (lineNumber >= rangeEnd) {\n        if (currentRangeIndex === ranges.length - 1) {\n          // We need to close the file stream and remove listeners, else the reader will continue to run our listener;\n          lineReaded.close();\n          lineReaded.removeAllListeners();\n          return;\n        }\n        currentRangeIndex++;\n        const range = ranges[currentRangeIndex];\n        if (range === undefined) {\n          // This should never happen as it means we have a bug in the context.\n          lineReaded.close();\n          lineReaded.removeAllListeners();\n          return;\n        }\n        rangeStart = range[0];\n        rangeEnd = range[1];\n      }\n    });\n  });\n}\n\n/**\n * Adds surrounding (context) lines of the line that an exception occurred on to the event.\n * This is done by reading the file line by line and extracting the lines. The extracted lines are stored in\n * a cache to prevent multiple reads of the same file. Failures to read a file are similarly cached to prevent multiple\n * failing reads from happening.\n */\n/* eslint-disable complexity */\nasync function addSourceContext(event: Event, contextLines: number): Promise<Event> {\n  // keep a lookup map of which files we've already enqueued to read,\n  // so we don't enqueue the same file multiple times which would cause multiple i/o reads\n  const filesToLines: Record<string, number[]> = {};\n\n  if (contextLines > 0 && event.exception?.values) {\n    for (const exception of event.exception.values) {\n      if (!exception.stacktrace?.frames?.length) {\n        continue;\n      }\n\n      // Maps preserve insertion order, so we iterate in reverse, starting at the\n      // outermost frame and closer to where the exception has occurred (poor mans priority)\n      for (let i = exception.stacktrace.frames.length - 1; i >= 0; i--) {\n        const frame: StackFrame | undefined = exception.stacktrace.frames[i];\n        const filename = frame?.filename;\n\n        if (\n          !frame ||\n          typeof filename !== 'string' ||\n          typeof frame.lineno !== 'number' ||\n          shouldSkipContextLinesForFile(filename) ||\n          shouldSkipContextLinesForFrame(frame)\n        ) {\n          continue;\n        }\n\n        const filesToLinesOutput = filesToLines[filename];\n        if (!filesToLinesOutput) filesToLines[filename] = [];\n        // @ts-expect-error this is defined above\n        filesToLines[filename].push(frame.lineno);\n      }\n    }\n  }\n\n  const files = Object.keys(filesToLines);\n  if (files.length == 0) {\n    return event;\n  }\n\n  const readlinePromises: Promise<void>[] = [];\n  for (const file of files) {\n    // If we failed to read this before, dont try reading it again.\n    if (LRU_FILE_CONTENTS_FS_READ_FAILED.get(file)) {\n      continue;\n    }\n\n    const filesToLineRanges = filesToLines[file];\n    if (!filesToLineRanges) {\n      continue;\n    }\n\n    // Sort ranges so that they are sorted by line increasing order and match how the file is read.\n    filesToLineRanges.sort((a, b) => a - b);\n    // Check if the contents are already in the cache and if we can avoid reading the file again.\n    const ranges = makeLineReaderRanges(filesToLineRanges, contextLines);\n    if (ranges.every(r => rangeExistsInContentCache(file, r))) {\n      continue;\n    }\n\n    const cache = emplace(LRU_FILE_CONTENTS_CACHE, file, {});\n    readlinePromises.push(getContextLinesFromFile(file, ranges, cache));\n  }\n\n  // The promise rejections are caught in order to prevent them from short circuiting Promise.all\n  await Promise.all(readlinePromises).catch(() => {\n    DEBUG_BUILD && logger.log('Failed to read one or more source files and resolve context lines');\n  });\n\n  // Perform the same loop as above, but this time we can assume all files are in the cache\n  // and attempt to add source context to frames.\n  if (contextLines > 0 && event.exception?.values) {\n    for (const exception of event.exception.values) {\n      if (exception.stacktrace && exception.stacktrace.frames && exception.stacktrace.frames.length > 0) {\n        addSourceContextToFrames(exception.stacktrace.frames, contextLines, LRU_FILE_CONTENTS_CACHE);\n      }\n    }\n  }\n\n  return event;\n}\n/* eslint-enable complexity */\n\n/** Adds context lines to frames */\nfunction addSourceContextToFrames(\n  frames: StackFrame[],\n  contextLines: number,\n  cache: LRUMap<string, Record<number, string>>,\n): void {\n  for (const frame of frames) {\n    // Only add context if we have a filename and it hasn't already been added\n    if (frame.filename && frame.context_line === undefined && typeof frame.lineno === 'number') {\n      const contents = cache.get(frame.filename);\n      if (contents === undefined) {\n        continue;\n      }\n\n      addContextToFrame(frame.lineno, frame, contextLines, contents);\n    }\n  }\n}\n\n/**\n * Clears the context lines from a frame, used to reset a frame to its original state\n * if we fail to resolve all context lines for it.\n */\nfunction clearLineContext(frame: StackFrame): void {\n  delete frame.pre_context;\n  delete frame.context_line;\n  delete frame.post_context;\n}\n\n/**\n * Resolves context lines before and after the given line number and appends them to the frame;\n */\nexport function addContextToFrame(\n  lineno: number,\n  frame: StackFrame,\n  contextLines: number,\n  contents: Record<number, string> | undefined,\n): void {\n  // When there is no line number in the frame, attaching context is nonsensical and will even break grouping.\n  // We already check for lineno before calling this, but since StackFrame lineno ism optional, we check it again.\n  if (frame.lineno === undefined || contents === undefined) {\n    DEBUG_BUILD && logger.error('Cannot resolve context for frame with no lineno or file contents');\n    return;\n  }\n\n  frame.pre_context = [];\n  for (let i = makeRangeStart(lineno, contextLines); i < lineno; i++) {\n    // We always expect the start context as line numbers cannot be negative. If we dont find a line, then\n    // something went wrong somewhere. Clear the context and return without adding any linecontext.\n    const line = contents[i];\n    if (line === undefined) {\n      clearLineContext(frame);\n      DEBUG_BUILD && logger.error(`Could not find line ${i} in file ${frame.filename}`);\n      return;\n    }\n\n    frame.pre_context.push(line);\n  }\n\n  // We should always have the context line. If we dont, something went wrong, so we clear the context and return\n  // without adding any linecontext.\n  if (contents[lineno] === undefined) {\n    clearLineContext(frame);\n    DEBUG_BUILD && logger.error(`Could not find line ${lineno} in file ${frame.filename}`);\n    return;\n  }\n\n  frame.context_line = contents[lineno];\n\n  const end = makeRangeEnd(lineno, contextLines);\n  frame.post_context = [];\n  for (let i = lineno + 1; i <= end; i++) {\n    // Since we dont track when the file ends, we cant clear the context if we dont find a line as it could\n    // just be that we reached the end of the file.\n    const line = contents[i];\n    if (line === undefined) {\n      break;\n    }\n    frame.post_context.push(line);\n  }\n}\n\n// Helper functions for generating line context ranges. They take a line number and the number of lines of context to\n// include before and after the line and generate an inclusive range of indices.\ntype ReadlineRange = [start: number, end: number];\n// Compute inclusive end context range\nfunction makeRangeStart(line: number, linecontext: number): number {\n  return Math.max(1, line - linecontext);\n}\n// Compute inclusive start context range\nfunction makeRangeEnd(line: number, linecontext: number): number {\n  return line + linecontext;\n}\n// Determine start and end indices for context range (inclusive);\nfunction makeContextRange(line: number, linecontext: number): [start: number, end: number] {\n  return [makeRangeStart(line, linecontext), makeRangeEnd(line, linecontext)];\n}\n\n/** Exported only for tests, as a type-safe variant. */\nexport const _contextLinesIntegration = ((options: ContextLinesOptions = {}) => {\n  const contextLines = options.frameContextLines !== undefined ? options.frameContextLines : DEFAULT_LINES_OF_CONTEXT;\n\n  return {\n    name: INTEGRATION_NAME,\n    processEvent(event) {\n      return addSourceContext(event, contextLines);\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Capture the lines before and after the frame's context.\n */\nexport const contextLinesIntegration = defineIntegration(_contextLinesIntegration);\n","import type { Debugger } from 'node:inspector';\nimport type { StackFrame, StackParser } from '@sentry/types';\n\nexport type Variables = Record<string, unknown>;\n\nexport type RateLimitIncrement = () => void;\n\n/**\n * Creates a rate limiter that will call the disable callback when the rate limit is reached and the enable callback\n * when a timeout has occurred.\n * @param maxPerSecond Maximum number of calls per second\n * @param enable Callback to enable capture\n * @param disable Callback to disable capture\n * @returns A function to call to increment the rate limiter count\n */\nexport function createRateLimiter(\n  maxPerSecond: number,\n  enable: () => void,\n  disable: (seconds: number) => void,\n): RateLimitIncrement {\n  let count = 0;\n  let retrySeconds = 5;\n  let disabledTimeout = 0;\n\n  setInterval(() => {\n    if (disabledTimeout === 0) {\n      if (count > maxPerSecond) {\n        retrySeconds *= 2;\n        disable(retrySeconds);\n\n        // Cap at one day\n        if (retrySeconds > 86400) {\n          retrySeconds = 86400;\n        }\n        disabledTimeout = retrySeconds;\n      }\n    } else {\n      disabledTimeout -= 1;\n\n      if (disabledTimeout === 0) {\n        enable();\n      }\n    }\n\n    count = 0;\n  }, 1_000).unref();\n\n  return () => {\n    count += 1;\n  };\n}\n\n// Add types for the exception event data\nexport type PausedExceptionEvent = Debugger.PausedEventDataType & {\n  data: {\n    // This contains error.stack\n    description: string;\n  };\n};\n\n/** Could this be an anonymous function? */\nexport function isAnonymous(name: string | undefined): boolean {\n  return name !== undefined && (name.length === 0 || name === '?' || name === '<anonymous>');\n}\n\n/** Do the function names appear to match? */\nexport function functionNamesMatch(a: string | undefined, b: string | undefined): boolean {\n  return a === b || (isAnonymous(a) && isAnonymous(b));\n}\n\n/** Creates a unique hash from stack frames */\nexport function hashFrames(frames: StackFrame[] | undefined): string | undefined {\n  if (frames === undefined) {\n    return;\n  }\n\n  // Only hash the 10 most recent frames (ie. the last 10)\n  return frames.slice(-10).reduce((acc, frame) => `${acc},${frame.function},${frame.lineno},${frame.colno}`, '');\n}\n\n/**\n * We use the stack parser to create a unique hash from the exception stack trace\n * This is used to lookup vars when the exception passes through the event processor\n */\nexport function hashFromStack(stackParser: StackParser, stack: string | undefined): string | undefined {\n  if (stack === undefined) {\n    return undefined;\n  }\n\n  return hashFrames(stackParser(stack, 1));\n}\n\nexport interface FrameVariables {\n  function: string;\n  vars?: Variables;\n}\n\nexport interface LocalVariablesIntegrationOptions {\n  /**\n   * Capture local variables for both caught and uncaught exceptions\n   *\n   * - When false, only uncaught exceptions will have local variables\n   * - When true, both caught and uncaught exceptions will have local variables.\n   *\n   * Defaults to `true`.\n   *\n   * Capturing local variables for all exceptions can be expensive since the debugger pauses for every throw to collect\n   * local variables.\n   *\n   * To reduce the likelihood of this feature impacting app performance or throughput, this feature is rate-limited.\n   * Once the rate limit is reached, local variables will only be captured for uncaught exceptions until a timeout has\n   * been reached.\n   */\n  captureAllExceptions?: boolean;\n  /**\n   * Maximum number of exceptions to capture local variables for per second before rate limiting is triggered.\n   */\n  maxExceptionsPerSecond?: number;\n}\n\nexport interface LocalVariablesWorkerArgs extends LocalVariablesIntegrationOptions {\n  /**\n   * Whether to enable debug logging.\n   */\n  debug: boolean;\n  /**\n   * Base path used to calculate module name.\n   *\n   * Defaults to `dirname(process.argv[1])` and falls back to `process.cwd()`\n   */\n  basePath?: string;\n}\n","import { Worker } from 'node:worker_threads';\nimport { defineIntegration } from '@sentry/core';\nimport type { Event, Exception, IntegrationFn } from '@sentry/types';\nimport { LRUMap, logger } from '@sentry/utils';\n\nimport type { NodeClient } from '../../sdk/client';\nimport type { FrameVariables, LocalVariablesIntegrationOptions, LocalVariablesWorkerArgs } from './common';\nimport { functionNamesMatch, hashFrames } from './common';\n\n// This string is a placeholder that gets overwritten with the worker code.\nexport const base64WorkerScript = '###LocalVariablesWorkerScript###';\n\nfunction log(...args: unknown[]): void {\n  logger.log('[LocalVariables]', ...args);\n}\n\n/**\n * Adds local variables to exception frames\n */\nexport const localVariablesAsyncIntegration = defineIntegration(((\n  integrationOptions: LocalVariablesIntegrationOptions = {},\n) => {\n  const cachedFrames: LRUMap<string, FrameVariables[]> = new LRUMap(20);\n\n  function addLocalVariablesToException(exception: Exception): void {\n    const hash = hashFrames(exception?.stacktrace?.frames);\n\n    if (hash === undefined) {\n      return;\n    }\n\n    // Check if we have local variables for an exception that matches the hash\n    // remove is identical to get but also removes the entry from the cache\n    const cachedFrame = cachedFrames.remove(hash);\n\n    if (cachedFrame === undefined) {\n      return;\n    }\n\n    // Filter out frames where the function name is `new Promise` since these are in the error.stack frames\n    // but do not appear in the debugger call frames\n    const frames = (exception.stacktrace?.frames || []).filter(frame => frame.function !== 'new Promise');\n\n    for (let i = 0; i < frames.length; i++) {\n      // Sentry frames are in reverse order\n      const frameIndex = frames.length - i - 1;\n\n      const cachedFrameVariable = cachedFrame[i];\n      const frameVariable = frames[frameIndex];\n\n      if (!frameVariable || !cachedFrameVariable) {\n        // Drop out if we run out of frames to match up\n        break;\n      }\n\n      if (\n        // We need to have vars to add\n        cachedFrameVariable.vars === undefined ||\n        // We're not interested in frames that are not in_app because the vars are not relevant\n        frameVariable.in_app === false ||\n        // The function names need to match\n        !functionNamesMatch(frameVariable.function, cachedFrameVariable.function)\n      ) {\n        continue;\n      }\n\n      frameVariable.vars = cachedFrameVariable.vars;\n    }\n  }\n\n  function addLocalVariablesToEvent(event: Event): Event {\n    for (const exception of event.exception?.values || []) {\n      addLocalVariablesToException(exception);\n    }\n\n    return event;\n  }\n\n  async function startInspector(): Promise<void> {\n    // We load inspector dynamically because on some platforms Node is built without inspector support\n    const inspector = await import('node:inspector');\n    if (!inspector.url()) {\n      inspector.open(0);\n    }\n  }\n\n  function startWorker(options: LocalVariablesWorkerArgs): void {\n    const worker = new Worker(new URL(`data:application/javascript;base64,${base64WorkerScript}`), {\n      workerData: options,\n      // We don't want any Node args to be passed to the worker\n      execArgv: [],\n    });\n\n    process.on('exit', () => {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      worker.terminate();\n    });\n\n    worker.on('message', ({ exceptionHash, frames }) => {\n      cachedFrames.set(exceptionHash, frames);\n    });\n\n    worker.once('error', (err: Error) => {\n      log('Worker error', err);\n    });\n\n    worker.once('exit', (code: number) => {\n      log('Worker exit', code);\n    });\n\n    // Ensure this thread can't block app exit\n    worker.unref();\n  }\n\n  return {\n    name: 'LocalVariablesAsync',\n    setup(client: NodeClient) {\n      const clientOptions = client.getOptions();\n\n      if (!clientOptions.includeLocalVariables) {\n        return;\n      }\n\n      const options: LocalVariablesWorkerArgs = {\n        ...integrationOptions,\n        debug: logger.isEnabled(),\n      };\n\n      startInspector().then(\n        () => {\n          try {\n            startWorker(options);\n          } catch (e) {\n            logger.error('Failed to start worker', e);\n          }\n        },\n        e => {\n          logger.error('Failed to start inspector', e);\n        },\n      );\n    },\n    processEvent(event: Event): Event {\n      return addLocalVariablesToEvent(event);\n    },\n  };\n}) satisfies IntegrationFn);\n","import type { Debugger, InspectorNotification, Runtime, Session } from 'node:inspector';\nimport { defineIntegration, getClient } from '@sentry/core';\nimport type { Event, Exception, IntegrationFn, StackParser } from '@sentry/types';\nimport { LRUMap, logger } from '@sentry/utils';\n\nimport { NODE_MAJOR } from '../../nodeVersion';\nimport type { NodeClient } from '../../sdk/client';\nimport type {\n  FrameVariables,\n  LocalVariablesIntegrationOptions,\n  PausedExceptionEvent,\n  RateLimitIncrement,\n  Variables,\n} from './common';\nimport { createRateLimiter, functionNamesMatch, hashFrames, hashFromStack } from './common';\n\ntype OnPauseEvent = InspectorNotification<Debugger.PausedEventDataType>;\nexport interface DebugSession {\n  /** Configures and connects to the debug session */\n  configureAndConnect(onPause: (message: OnPauseEvent, complete: () => void) => void, captureAll: boolean): void;\n  /** Updates which kind of exceptions to capture */\n  setPauseOnExceptions(captureAll: boolean): void;\n  /** Gets local variables for an objectId */\n  getLocalVariables(objectId: string, callback: (vars: Variables) => void): void;\n}\n\ntype Next<T> = (result: T) => void;\ntype Add<T> = (fn: Next<T>) => void;\ntype CallbackWrapper<T> = { add: Add<T>; next: Next<T> };\n\n/** Creates a container for callbacks to be called sequentially */\nexport function createCallbackList<T>(complete: Next<T>): CallbackWrapper<T> {\n  // A collection of callbacks to be executed last to first\n  let callbacks: Next<T>[] = [];\n\n  let completedCalled = false;\n  function checkedComplete(result: T): void {\n    callbacks = [];\n    if (completedCalled) {\n      return;\n    }\n    completedCalled = true;\n    complete(result);\n  }\n\n  // complete should be called last\n  callbacks.push(checkedComplete);\n\n  function add(fn: Next<T>): void {\n    callbacks.push(fn);\n  }\n\n  function next(result: T): void {\n    const popped = callbacks.pop() || checkedComplete;\n\n    try {\n      popped(result);\n    } catch (_) {\n      // If there is an error, we still want to call the complete callback\n      checkedComplete(result);\n    }\n  }\n\n  return { add, next };\n}\n\n/**\n * Promise API is available as `Experimental` and in Node 19 only.\n *\n * Callback-based API is `Stable` since v14 and `Experimental` since v8.\n * Because of that, we are creating our own `AsyncSession` class.\n *\n * https://nodejs.org/docs/latest-v19.x/api/inspector.html#promises-api\n * https://nodejs.org/docs/latest-v14.x/api/inspector.html\n */\nclass AsyncSession implements DebugSession {\n  /** Throws if inspector API is not available */\n  private constructor(private readonly _session: Session) {\n    //\n  }\n\n  public static async create(orDefault?: DebugSession | undefined): Promise<DebugSession> {\n    if (orDefault) {\n      return orDefault;\n    }\n\n    const inspector = await import('node:inspector');\n    return new AsyncSession(new inspector.Session());\n  }\n\n  /** @inheritdoc */\n  public configureAndConnect(onPause: (event: OnPauseEvent, complete: () => void) => void, captureAll: boolean): void {\n    this._session.connect();\n\n    this._session.on('Debugger.paused', event => {\n      onPause(event, () => {\n        // After the pause work is complete, resume execution or the exception context memory is leaked\n        this._session.post('Debugger.resume');\n      });\n    });\n\n    this._session.post('Debugger.enable');\n    this._session.post('Debugger.setPauseOnExceptions', { state: captureAll ? 'all' : 'uncaught' });\n  }\n\n  public setPauseOnExceptions(captureAll: boolean): void {\n    this._session.post('Debugger.setPauseOnExceptions', { state: captureAll ? 'all' : 'uncaught' });\n  }\n\n  /** @inheritdoc */\n  public getLocalVariables(objectId: string, complete: (vars: Variables) => void): void {\n    this._getProperties(objectId, props => {\n      const { add, next } = createCallbackList<Variables>(complete);\n\n      for (const prop of props) {\n        if (prop?.value?.objectId && prop?.value.className === 'Array') {\n          const id = prop.value.objectId;\n          add(vars => this._unrollArray(id, prop.name, vars, next));\n        } else if (prop?.value?.objectId && prop?.value?.className === 'Object') {\n          const id = prop.value.objectId;\n          add(vars => this._unrollObject(id, prop.name, vars, next));\n        } else if (prop?.value) {\n          add(vars => this._unrollOther(prop, vars, next));\n        }\n      }\n\n      next({});\n    });\n  }\n\n  /**\n   * Gets all the PropertyDescriptors of an object\n   */\n  private _getProperties(objectId: string, next: (result: Runtime.PropertyDescriptor[]) => void): void {\n    this._session.post(\n      'Runtime.getProperties',\n      {\n        objectId,\n        ownProperties: true,\n      },\n      (err, params) => {\n        if (err) {\n          next([]);\n        } else {\n          next(params.result);\n        }\n      },\n    );\n  }\n\n  /**\n   * Unrolls an array property\n   */\n  private _unrollArray(objectId: string, name: string, vars: Variables, next: (vars: Variables) => void): void {\n    this._getProperties(objectId, props => {\n      vars[name] = props\n        .filter(v => v.name !== 'length' && !isNaN(parseInt(v.name, 10)))\n        .sort((a, b) => parseInt(a.name, 10) - parseInt(b.name, 10))\n        .map(v => v?.value?.value);\n\n      next(vars);\n    });\n  }\n\n  /**\n   * Unrolls an object property\n   */\n  private _unrollObject(objectId: string, name: string, vars: Variables, next: (obj: Variables) => void): void {\n    this._getProperties(objectId, props => {\n      vars[name] = props\n        .map<[string, unknown]>(v => [v.name, v?.value?.value])\n        .reduce((obj, [key, val]) => {\n          obj[key] = val;\n          return obj;\n        }, {} as Variables);\n\n      next(vars);\n    });\n  }\n\n  /**\n   * Unrolls other properties\n   */\n  private _unrollOther(prop: Runtime.PropertyDescriptor, vars: Variables, next: (vars: Variables) => void): void {\n    if (prop.value) {\n      if ('value' in prop.value) {\n        if (prop.value.value === undefined || prop.value.value === null) {\n          vars[prop.name] = `<${prop.value.value}>`;\n        } else {\n          vars[prop.name] = prop.value.value;\n        }\n      } else if ('description' in prop.value && prop.value.type !== 'function') {\n        vars[prop.name] = `<${prop.value.description}>`;\n      } else if (prop.value.type === 'undefined') {\n        vars[prop.name] = '<undefined>';\n      }\n    }\n\n    next(vars);\n  }\n}\n\nconst INTEGRATION_NAME = 'LocalVariables';\n\n/**\n * Adds local variables to exception frames\n */\nconst _localVariablesSyncIntegration = ((\n  options: LocalVariablesIntegrationOptions = {},\n  sessionOverride?: DebugSession,\n) => {\n  const cachedFrames: LRUMap<string, FrameVariables[]> = new LRUMap(20);\n  let rateLimiter: RateLimitIncrement | undefined;\n  let shouldProcessEvent = false;\n\n  function addLocalVariablesToException(exception: Exception): void {\n    const hash = hashFrames(exception?.stacktrace?.frames);\n\n    if (hash === undefined) {\n      return;\n    }\n\n    // Check if we have local variables for an exception that matches the hash\n    // remove is identical to get but also removes the entry from the cache\n    const cachedFrame = cachedFrames.remove(hash);\n\n    if (cachedFrame === undefined) {\n      return;\n    }\n\n    // Filter out frames where the function name is `new Promise` since these are in the error.stack frames\n    // but do not appear in the debugger call frames\n    const frames = (exception.stacktrace?.frames || []).filter(frame => frame.function !== 'new Promise');\n\n    for (let i = 0; i < frames.length; i++) {\n      // Sentry frames are in reverse order\n      const frameIndex = frames.length - i - 1;\n\n      const cachedFrameVariable = cachedFrame[i];\n      const frameVariable = frames[frameIndex];\n\n      // Drop out if we run out of frames to match up\n      if (!frameVariable || !cachedFrameVariable) {\n        break;\n      }\n\n      if (\n        // We need to have vars to add\n        cachedFrameVariable.vars === undefined ||\n        // We're not interested in frames that are not in_app because the vars are not relevant\n        frameVariable.in_app === false ||\n        // The function names need to match\n        !functionNamesMatch(frameVariable.function, cachedFrameVariable.function)\n      ) {\n        continue;\n      }\n\n      frameVariable.vars = cachedFrameVariable.vars;\n    }\n  }\n\n  function addLocalVariablesToEvent(event: Event): Event {\n    for (const exception of event?.exception?.values || []) {\n      addLocalVariablesToException(exception);\n    }\n\n    return event;\n  }\n\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      const client = getClient<NodeClient>();\n      const clientOptions = client?.getOptions();\n\n      if (!clientOptions?.includeLocalVariables) {\n        return;\n      }\n\n      // Only setup this integration if the Node version is >= v18\n      // https://github.com/getsentry/sentry-javascript/issues/7697\n      const unsupportedNodeVersion = NODE_MAJOR < 18;\n\n      if (unsupportedNodeVersion) {\n        logger.log('The `LocalVariables` integration is only supported on Node >= v18.');\n        return;\n      }\n\n      AsyncSession.create(sessionOverride).then(\n        session => {\n          function handlePaused(\n            stackParser: StackParser,\n            { params: { reason, data, callFrames } }: InspectorNotification<PausedExceptionEvent>,\n            complete: () => void,\n          ): void {\n            if (reason !== 'exception' && reason !== 'promiseRejection') {\n              complete();\n              return;\n            }\n\n            rateLimiter?.();\n\n            // data.description contains the original error.stack\n            const exceptionHash = hashFromStack(stackParser, data?.description);\n\n            if (exceptionHash == undefined) {\n              complete();\n              return;\n            }\n\n            const { add, next } = createCallbackList<FrameVariables[]>(frames => {\n              cachedFrames.set(exceptionHash, frames);\n              complete();\n            });\n\n            // Because we're queuing up and making all these calls synchronously, we can potentially overflow the stack\n            // For this reason we only attempt to get local variables for the first 5 frames\n            for (let i = 0; i < Math.min(callFrames.length, 5); i++) {\n              // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n              const { scopeChain, functionName, this: obj } = callFrames[i]!;\n\n              const localScope = scopeChain.find(scope => scope.type === 'local');\n\n              // obj.className is undefined in ESM modules\n              const fn =\n                obj.className === 'global' || !obj.className ? functionName : `${obj.className}.${functionName}`;\n\n              if (localScope?.object.objectId === undefined) {\n                add(frames => {\n                  frames[i] = { function: fn };\n                  next(frames);\n                });\n              } else {\n                const id = localScope.object.objectId;\n                add(frames =>\n                  session?.getLocalVariables(id, vars => {\n                    frames[i] = { function: fn, vars };\n                    next(frames);\n                  }),\n                );\n              }\n            }\n\n            next([]);\n          }\n\n          const captureAll = options.captureAllExceptions !== false;\n\n          session.configureAndConnect(\n            (ev, complete) =>\n              handlePaused(clientOptions.stackParser, ev as InspectorNotification<PausedExceptionEvent>, complete),\n            captureAll,\n          );\n\n          if (captureAll) {\n            const max = options.maxExceptionsPerSecond || 50;\n\n            rateLimiter = createRateLimiter(\n              max,\n              () => {\n                logger.log('Local variables rate-limit lifted.');\n                session?.setPauseOnExceptions(true);\n              },\n              seconds => {\n                logger.log(\n                  `Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${seconds} seconds.`,\n                );\n                session?.setPauseOnExceptions(false);\n              },\n            );\n          }\n\n          shouldProcessEvent = true;\n        },\n        error => {\n          logger.log('The `LocalVariables` integration failed to start.', error);\n        },\n      );\n    },\n    processEvent(event: Event): Event {\n      if (shouldProcessEvent) {\n        return addLocalVariablesToEvent(event);\n      }\n\n      return event;\n    },\n    // These are entirely for testing\n    _getCachedFramesCount(): number {\n      return cachedFrames.size;\n    },\n    _getFirstCachedFrame(): FrameVariables[] | undefined {\n      return cachedFrames.values()[0];\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Adds local variables to exception frames.\n */\nexport const localVariablesSyncIntegration = defineIntegration(_localVariablesSyncIntegration);\n","import type { Integration } from '@sentry/types';\nimport { NODE_VERSION } from '../../nodeVersion';\nimport type { LocalVariablesIntegrationOptions } from './common';\nimport { localVariablesAsyncIntegration } from './local-variables-async';\nimport { localVariablesSyncIntegration } from './local-variables-sync';\n\nexport const localVariablesIntegration = (options: LocalVariablesIntegrationOptions = {}): Integration => {\n  return NODE_VERSION.major < 19 ? localVariablesSyncIntegration(options) : localVariablesAsyncIntegration(options);\n};\n","import { existsSync, readFileSync } from 'node:fs';\nimport { dirname, join } from 'node:path';\nimport { defineIntegration } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\n\nlet moduleCache: { [key: string]: string };\n\nconst INTEGRATION_NAME = 'Modules';\n\nconst _modulesIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    processEvent(event) {\n      event.modules = {\n        ...event.modules,\n        ..._getModules(),\n      };\n\n      return event;\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Add node modules / packages to the event.\n */\nexport const modulesIntegration = defineIntegration(_modulesIntegration);\n\n/** Extract information about paths */\nfunction getPaths(): string[] {\n  try {\n    return require.cache ? Object.keys(require.cache as Record<string, unknown>) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\n/** Extract information about package.json modules */\nfunction collectModules(): {\n  [name: string]: string;\n} {\n  const mainPaths = (require.main && require.main.paths) || [];\n  const paths = getPaths();\n  const infos: {\n    [name: string]: string;\n  } = {};\n  const seen: {\n    [path: string]: boolean;\n  } = {};\n\n  paths.forEach(path => {\n    let dir = path;\n\n    /** Traverse directories upward in the search of package.json file */\n    const updir = (): void | (() => void) => {\n      const orig = dir;\n      dir = dirname(orig);\n\n      if (!dir || orig === dir || seen[orig]) {\n        return undefined;\n      }\n      if (mainPaths.indexOf(dir) < 0) {\n        return updir();\n      }\n\n      const pkgfile = join(orig, 'package.json');\n      seen[orig] = true;\n\n      if (!existsSync(pkgfile)) {\n        return updir();\n      }\n\n      try {\n        const info = JSON.parse(readFileSync(pkgfile, 'utf8')) as {\n          name: string;\n          version: string;\n        };\n        infos[info.name] = info.version;\n      } catch (_oO) {\n        // no-empty\n      }\n    };\n\n    updir();\n  });\n\n  return infos;\n}\n\n/** Fetches the list of modules and the versions loaded by the entry file for your node.js app. */\nfunction _getModules(): { [key: string]: string } {\n  if (!moduleCache) {\n    moduleCache = collectModules();\n  }\n  return moduleCache;\n}\n","import { getClient } from '@sentry/core';\nimport { consoleSandbox, logger } from '@sentry/utils';\nimport { DEBUG_BUILD } from '../debug-build';\nimport type { NodeClient } from '../sdk/client';\n\nconst DEFAULT_SHUTDOWN_TIMEOUT = 2000;\n\n/**\n * @hidden\n */\nexport function logAndExitProcess(error: Error): void {\n  consoleSandbox(() => {\n    // eslint-disable-next-line no-console\n    console.error(error);\n  });\n\n  const client = getClient<NodeClient>();\n\n  if (client === undefined) {\n    DEBUG_BUILD && logger.warn('No NodeClient was defined, we are exiting the process now.');\n    global.process.exit(1);\n    return;\n  }\n\n  const options = client.getOptions();\n  const timeout =\n    (options && options.shutdownTimeout && options.shutdownTimeout > 0 && options.shutdownTimeout) ||\n    DEFAULT_SHUTDOWN_TIMEOUT;\n  client.close(timeout).then(\n    (result: boolean) => {\n      if (!result) {\n        DEBUG_BUILD && logger.warn('We reached the timeout for emptying the request buffer, still exiting now!');\n      }\n      global.process.exit(1);\n    },\n    error => {\n      DEBUG_BUILD && logger.error(error);\n    },\n  );\n}\n","import { captureException, defineIntegration } from '@sentry/core';\nimport { getClient } from '@sentry/core';\nimport { logger } from '@sentry/utils';\n\nimport { DEBUG_BUILD } from '../debug-build';\nimport type { NodeClient } from '../sdk/client';\nimport { logAndExitProcess } from '../utils/errorhandling';\n\ntype OnFatalErrorHandler = (firstError: Error, secondError?: Error) => void;\n\ntype TaggedListener = NodeJS.UncaughtExceptionListener & {\n  tag?: string;\n};\n\ninterface OnUncaughtExceptionOptions {\n  /**\n   * Controls if the SDK should register a handler to exit the process on uncaught errors:\n   * - `true`: The SDK will exit the process on all uncaught errors.\n   * - `false`: The SDK will only exit the process when there are no other `uncaughtException` handlers attached.\n   *\n   * Default: `false`\n   */\n  exitEvenIfOtherHandlersAreRegistered: boolean;\n\n  /**\n   * This is called when an uncaught error would cause the process to exit.\n   *\n   * @param firstError Uncaught error causing the process to exit\n   * @param secondError Will be set if the handler was called multiple times. This can happen either because\n   * `onFatalError` itself threw, or because an independent error happened somewhere else while `onFatalError`\n   * was running.\n   */\n  onFatalError?(this: void, firstError: Error, secondError?: Error): void;\n}\n\nconst INTEGRATION_NAME = 'OnUncaughtException';\n\n/**\n * Add a global exception handler.\n */\nexport const onUncaughtExceptionIntegration = defineIntegration((options: Partial<OnUncaughtExceptionOptions> = {}) => {\n  const optionsWithDefaults = {\n    exitEvenIfOtherHandlersAreRegistered: false,\n    ...options,\n  };\n\n  return {\n    name: INTEGRATION_NAME,\n    setup(client: NodeClient) {\n      global.process.on('uncaughtException', makeErrorHandler(client, optionsWithDefaults));\n    },\n  };\n});\n\ntype ErrorHandler = { _errorHandler: boolean } & ((error: Error) => void);\n\n/** Exported only for tests */\nexport function makeErrorHandler(client: NodeClient, options: OnUncaughtExceptionOptions): ErrorHandler {\n  const timeout = 2000;\n  let caughtFirstError: boolean = false;\n  let caughtSecondError: boolean = false;\n  let calledFatalError: boolean = false;\n  let firstError: Error;\n\n  const clientOptions = client.getOptions();\n\n  return Object.assign(\n    (error: Error): void => {\n      let onFatalError: OnFatalErrorHandler = logAndExitProcess;\n\n      if (options.onFatalError) {\n        onFatalError = options.onFatalError;\n      } else if (clientOptions.onFatalError) {\n        onFatalError = clientOptions.onFatalError as OnFatalErrorHandler;\n      }\n\n      // Attaching a listener to `uncaughtException` will prevent the node process from exiting. We generally do not\n      // want to alter this behaviour so we check for other listeners that users may have attached themselves and adjust\n      // exit behaviour of the SDK accordingly:\n      // - If other listeners are attached, do not exit.\n      // - If the only listener attached is ours, exit.\n      const userProvidedListenersCount = (global.process.listeners('uncaughtException') as TaggedListener[]).filter(\n        listener => {\n          // There are 3 listeners we ignore:\n          return (\n            // as soon as we're using domains this listener is attached by node itself\n            listener.name !== 'domainUncaughtExceptionClear' &&\n            // the handler we register for tracing\n            listener.tag !== 'sentry_tracingErrorCallback' &&\n            // the handler we register in this integration\n            (listener as ErrorHandler)._errorHandler !== true\n          );\n        },\n      ).length;\n\n      const processWouldExit = userProvidedListenersCount === 0;\n      const shouldApplyFatalHandlingLogic = options.exitEvenIfOtherHandlersAreRegistered || processWouldExit;\n\n      if (!caughtFirstError) {\n        // this is the first uncaught error and the ultimate reason for shutting down\n        // we want to do absolutely everything possible to ensure it gets captured\n        // also we want to make sure we don't go recursion crazy if more errors happen after this one\n        firstError = error;\n        caughtFirstError = true;\n\n        if (getClient() === client) {\n          captureException(error, {\n            originalException: error,\n            captureContext: {\n              level: 'fatal',\n            },\n            mechanism: {\n              handled: false,\n              type: 'onuncaughtexception',\n            },\n          });\n        }\n\n        if (!calledFatalError && shouldApplyFatalHandlingLogic) {\n          calledFatalError = true;\n          onFatalError(error);\n        }\n      } else {\n        if (shouldApplyFatalHandlingLogic) {\n          if (calledFatalError) {\n            // we hit an error *after* calling onFatalError - pretty boned at this point, just shut it down\n            DEBUG_BUILD &&\n              logger.warn(\n                'uncaught exception after calling fatal error shutdown callback - this is bad! forcing shutdown',\n              );\n            logAndExitProcess(error);\n          } else if (!caughtSecondError) {\n            // two cases for how we can hit this branch:\n            //   - capturing of first error blew up and we just caught the exception from that\n            //     - quit trying to capture, proceed with shutdown\n            //   - a second independent error happened while waiting for first error to capture\n            //     - want to avoid causing premature shutdown before first error capture finishes\n            // it's hard to immediately tell case 1 from case 2 without doing some fancy/questionable domain stuff\n            // so let's instead just delay a bit before we proceed with our action here\n            // in case 1, we just wait a bit unnecessarily but ultimately do the same thing\n            // in case 2, the delay hopefully made us wait long enough for the capture to finish\n            // two potential nonideal outcomes:\n            //   nonideal case 1: capturing fails fast, we sit around for a few seconds unnecessarily before proceeding correctly by calling onFatalError\n            //   nonideal case 2: case 2 happens, 1st error is captured but slowly, timeout completes before capture and we treat second error as the sendErr of (nonexistent) failure from trying to capture first error\n            // note that after hitting this branch, we might catch more errors where (caughtSecondError && !calledFatalError)\n            //   we ignore them - they don't matter to us, we're just waiting for the second error timeout to finish\n            caughtSecondError = true;\n            setTimeout(() => {\n              if (!calledFatalError) {\n                // it was probably case 1, let's treat err as the sendErr and call onFatalError\n                calledFatalError = true;\n                onFatalError(firstError, error);\n              } else {\n                // it was probably case 2, our first error finished capturing while we waited, cool, do nothing\n              }\n            }, timeout); // capturing could take at least sendTimeout to fail, plus an arbitrary second for how long it takes to collect surrounding source etc\n          }\n        }\n      }\n    },\n    { _errorHandler: true },\n  );\n}\n","import { captureException, defineIntegration, getClient } from '@sentry/core';\nimport type { Client, IntegrationFn } from '@sentry/types';\nimport { consoleSandbox } from '@sentry/utils';\nimport { logAndExitProcess } from '../utils/errorhandling';\n\ntype UnhandledRejectionMode = 'none' | 'warn' | 'strict';\n\ninterface OnUnhandledRejectionOptions {\n  /**\n   * Option deciding what to do after capturing unhandledRejection,\n   * that mimicks behavior of node's --unhandled-rejection flag.\n   */\n  mode: UnhandledRejectionMode;\n}\n\nconst INTEGRATION_NAME = 'OnUnhandledRejection';\n\nconst _onUnhandledRejectionIntegration = ((options: Partial<OnUnhandledRejectionOptions> = {}) => {\n  const mode = options.mode || 'warn';\n\n  return {\n    name: INTEGRATION_NAME,\n    setup(client) {\n      global.process.on('unhandledRejection', makeUnhandledPromiseHandler(client, { mode }));\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Add a global promise rejection handler.\n */\nexport const onUnhandledRejectionIntegration = defineIntegration(_onUnhandledRejectionIntegration);\n\n/**\n * Send an exception with reason\n * @param reason string\n * @param promise promise\n *\n * Exported only for tests.\n */\nexport function makeUnhandledPromiseHandler(\n  client: Client,\n  options: OnUnhandledRejectionOptions,\n): (reason: unknown, promise: unknown) => void {\n  return function sendUnhandledPromise(reason: unknown, promise: unknown): void {\n    if (getClient() !== client) {\n      return;\n    }\n\n    captureException(reason, {\n      originalException: promise,\n      captureContext: {\n        extra: { unhandledPromiseRejection: true },\n      },\n      mechanism: {\n        handled: false,\n        type: 'onunhandledrejection',\n      },\n    });\n\n    handleRejection(reason, options);\n  };\n}\n\n/**\n * Handler for `mode` option\n\n */\nfunction handleRejection(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  reason: any,\n  options: OnUnhandledRejectionOptions,\n): void {\n  // https://github.com/nodejs/node/blob/7cf6f9e964aa00772965391c23acda6d71972a9a/lib/internal/process/promises.js#L234-L240\n  const rejectionWarning =\n    'This error originated either by ' +\n    'throwing inside of an async function without a catch block, ' +\n    'or by rejecting a promise which was not handled with .catch().' +\n    ' The promise rejected with the reason:';\n\n  /* eslint-disable no-console */\n  if (options.mode === 'warn') {\n    consoleSandbox(() => {\n      console.warn(rejectionWarning);\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      console.error(reason && reason.stack ? reason.stack : reason);\n    });\n  } else if (options.mode === 'strict') {\n    consoleSandbox(() => {\n      console.warn(rejectionWarning);\n    });\n    logAndExitProcess(reason);\n  }\n  /* eslint-enable no-console */\n}\n","import type { Instrumentation } from '@opentelemetry/instrumentation';\nimport { addOpenTelemetryInstrumentation } from '@sentry/opentelemetry';\n\nconst INSTRUMENTED: Record<string, Instrumentation> = {};\n\n/**\n * Instrument an OpenTelemetry instrumentation once.\n * This will skip running instrumentation again if it was already instrumented.\n */\nexport function generateInstrumentOnce<Options = unknown>(\n  name: string,\n  creator: (options?: Options) => Instrumentation,\n): ((options?: Options) => void) & { id: string } {\n  return Object.assign(\n    (options?: Options) => {\n      const instrumented = INSTRUMENTED[name];\n      if (instrumented) {\n        // If options are provided, ensure we update them\n        if (options) {\n          instrumented.setConfig(options);\n        }\n        return;\n      }\n\n      const instrumentation = creator(options);\n      INSTRUMENTED[name] = instrumentation;\n\n      addOpenTelemetryInstrumentation(instrumentation);\n    },\n    { id: name },\n  );\n}\n","/** Detect CommonJS. */\nexport function isCjs(): boolean {\n  return typeof require !== 'undefined';\n}\n","import type * as http from 'node:http';\nimport { ExpressInstrumentation } from '@opentelemetry/instrumentation-express';\nimport { SEMANTIC_ATTRIBUTE_SENTRY_OP, defineIntegration, getDefaultIsolationScope, spanToJSON } from '@sentry/core';\nimport { captureException, getClient, getIsolationScope } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { logger } from '@sentry/utils';\nimport { DEBUG_BUILD } from '../../debug-build';\nimport { generateInstrumentOnce } from '../../otel/instrument';\nimport type { NodeClient } from '../../sdk/client';\nimport { addOriginToSpan } from '../../utils/addOriginToSpan';\nimport { ensureIsWrapped } from '../../utils/ensureIsWrapped';\n\nconst INTEGRATION_NAME = 'Express';\n\nexport const instrumentExpress = generateInstrumentOnce(\n  INTEGRATION_NAME,\n  () =>\n    new ExpressInstrumentation({\n      requestHook(span) {\n        addOriginToSpan(span, 'auto.http.otel.express');\n\n        const attributes = spanToJSON(span).data || {};\n        // this is one of: middleware, request_handler, router\n        const type = attributes['express.type'];\n\n        if (type) {\n          span.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_OP, `${type}.express`);\n        }\n\n        // Also update the name, we don't need to \"middleware - \" prefix\n        const name = attributes['express.name'];\n        if (typeof name === 'string') {\n          span.updateName(name);\n        }\n      },\n      spanNameHook(info, defaultName) {\n        if (getIsolationScope() === getDefaultIsolationScope()) {\n          DEBUG_BUILD &&\n            logger.warn('Isolation scope is still default isolation scope - skipping setting transactionName');\n          return defaultName;\n        }\n        if (info.layerType === 'request_handler') {\n          // type cast b/c Otel unfortunately types info.request as any :(\n          const req = info.request as { method?: string };\n          const method = req.method ? req.method.toUpperCase() : 'GET';\n          getIsolationScope().setTransactionName(`${method} ${info.route}`);\n        }\n        return defaultName;\n      },\n    }),\n);\n\nconst _expressIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentExpress();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Express integration\n *\n * Capture tracing data for express.\n * In order to capture exceptions, you have to call `setupExpressErrorHandler(app)` before any other middleware and after all controllers.\n */\nexport const expressIntegration = defineIntegration(_expressIntegration);\n\ninterface MiddlewareError extends Error {\n  status?: number | string;\n  statusCode?: number | string;\n  status_code?: number | string;\n  output?: {\n    statusCode?: number | string;\n  };\n}\n\ntype ExpressMiddleware = (\n  error: MiddlewareError,\n  req: http.IncomingMessage,\n  res: http.ServerResponse,\n  next: (error: MiddlewareError) => void,\n) => void;\n\ninterface ExpressHandlerOptions {\n  /**\n   * Callback method deciding whether error should be captured and sent to Sentry\n   * @param error Captured middleware error\n   */\n  shouldHandleError?(this: void, error: MiddlewareError): boolean;\n}\n\n/**\n * An Express-compatible error handler.\n */\nexport function expressErrorHandler(options?: ExpressHandlerOptions): ExpressMiddleware {\n  return function sentryErrorMiddleware(\n    error: MiddlewareError,\n    _req: http.IncomingMessage,\n    res: http.ServerResponse,\n    next: (error: MiddlewareError) => void,\n  ): void {\n    const shouldHandleError = options?.shouldHandleError || defaultShouldHandleError;\n\n    if (shouldHandleError(error)) {\n      const client = getClient<NodeClient>();\n      if (client && client.getOptions().autoSessionTracking) {\n        // Check if the `SessionFlusher` is instantiated on the client to go into this branch that marks the\n        // `requestSession.status` as `Crashed`, and this check is necessary because the `SessionFlusher` is only\n        // instantiated when the the`requestHandler` middleware is initialised, which indicates that we should be\n        // running in SessionAggregates mode\n        const isSessionAggregatesMode = client['_sessionFlusher'] !== undefined;\n        if (isSessionAggregatesMode) {\n          const requestSession = getIsolationScope().getRequestSession();\n          // If an error bubbles to the `errorHandler`, then this is an unhandled error, and should be reported as a\n          // Crashed session. The `_requestSession.status` is checked to ensure that this error is happening within\n          // the bounds of a request, and if so the status is updated\n          if (requestSession && requestSession.status !== undefined) {\n            requestSession.status = 'crashed';\n          }\n        }\n      }\n\n      const eventId = captureException(error, { mechanism: { type: 'middleware', handled: false } });\n      (res as { sentry?: string }).sentry = eventId;\n      next(error);\n\n      return;\n    }\n\n    next(error);\n  };\n}\n\n/**\n * Setup an error handler for Express.\n * The error handler must be before any other middleware and after all controllers.\n */\nexport function setupExpressErrorHandler(\n  app: { use: (middleware: ExpressMiddleware) => unknown },\n  options?: ExpressHandlerOptions,\n): void {\n  app.use(expressErrorHandler(options));\n  ensureIsWrapped(app.use, 'express');\n}\n\nfunction getStatusCodeFromResponse(error: MiddlewareError): number {\n  const statusCode = error.status || error.statusCode || error.status_code || (error.output && error.output.statusCode);\n  return statusCode ? parseInt(statusCode as string, 10) : 500;\n}\n\n/** Returns true if response code is internal server error */\nfunction defaultShouldHandleError(error: MiddlewareError): boolean {\n  const status = getStatusCodeFromResponse(error);\n  return status >= 500;\n}\n","import { FastifyInstrumentation } from '@opentelemetry/instrumentation-fastify';\nimport {\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,\n  captureException,\n  defineIntegration,\n  getClient,\n  getIsolationScope,\n  spanToJSON,\n} from '@sentry/core';\nimport type { IntegrationFn, Span } from '@sentry/types';\nimport { generateInstrumentOnce } from '../../otel/instrument';\nimport { ensureIsWrapped } from '../../utils/ensureIsWrapped';\n\n// We inline the types we care about here\ninterface Fastify {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  register: (plugin: any) => void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  addHook: (hook: string, handler: (request: any, reply: any, error: Error) => void) => void;\n}\n\n/**\n * Minimal request type containing properties around route information.\n * Works for Fastify 3, 4 and presumably 5.\n */\ninterface FastifyRequestRouteInfo {\n  // since fastify@4.10.0\n  routeOptions?: {\n    url?: string;\n    method?: string;\n  };\n  routerPath?: string;\n}\n\nconst INTEGRATION_NAME = 'Fastify';\n\nexport const instrumentFastify = generateInstrumentOnce(\n  INTEGRATION_NAME,\n  () =>\n    new FastifyInstrumentation({\n      requestHook(span) {\n        addFastifySpanAttributes(span);\n      },\n    }),\n);\n\nconst _fastifyIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentFastify();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Express integration\n *\n * Capture tracing data for fastify.\n */\nexport const fastifyIntegration = defineIntegration(_fastifyIntegration);\n\n/**\n * Setup an error handler for Fastify.\n */\nexport function setupFastifyErrorHandler(fastify: Fastify): void {\n  const plugin = Object.assign(\n    function (fastify: Fastify, _options: unknown, done: () => void): void {\n      fastify.addHook('onError', async (_request, _reply, error) => {\n        captureException(error);\n      });\n\n      // registering `onRequest` hook here instead of using Otel `onRequest` callback b/c `onRequest` hook\n      // is ironically called in the fastify `preHandler` hook which is called later in the lifecycle:\n      // https://fastify.dev/docs/latest/Reference/Lifecycle/\n      fastify.addHook('onRequest', async (request, _reply) => {\n        const reqWithRouteInfo = request as FastifyRequestRouteInfo;\n\n        // Taken from Otel Fastify instrumentation:\n        // https://github.com/open-telemetry/opentelemetry-js-contrib/blob/main/plugins/node/opentelemetry-instrumentation-fastify/src/instrumentation.ts#L94-L96\n        const routeName = reqWithRouteInfo.routeOptions?.url || reqWithRouteInfo.routerPath;\n        const method = reqWithRouteInfo.routeOptions?.method || 'GET';\n\n        getIsolationScope().setTransactionName(`${method} ${routeName}`);\n      });\n\n      done();\n    },\n    {\n      [Symbol.for('skip-override')]: true,\n      [Symbol.for('fastify.display-name')]: 'sentry-fastify-error-handler',\n    },\n  );\n\n  fastify.register(plugin);\n\n  // Sadly, middleware spans do not go through `requestHook`, so we handle those here\n  // We register this hook in this method, because if we register it in the integration `setup`,\n  // it would always run even for users that are not even using fastify\n  const client = getClient();\n  if (client) {\n    client.on('spanStart', span => {\n      addFastifySpanAttributes(span);\n    });\n  }\n\n  ensureIsWrapped(fastify.addHook, 'fastify');\n}\n\nfunction addFastifySpanAttributes(span: Span): void {\n  const attributes = spanToJSON(span).data || {};\n\n  // this is one of: middleware, request_handler\n  const type = attributes['fastify.type'];\n\n  // If this is already set, or we have no fastify span, no need to process again...\n  if (attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP] || !type) {\n    return;\n  }\n\n  span.setAttributes({\n    [SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: 'auto.http.otel.fastify',\n    [SEMANTIC_ATTRIBUTE_SENTRY_OP]: `${type}.fastify`,\n  });\n\n  // Also update the name, we don't need to \"middleware - \" prefix\n  const name = attributes['fastify.name'] || attributes['plugin.name'] || attributes['hook.name'];\n  if (typeof name === 'string') {\n    // Also remove `fastify -> ` prefix\n    span.updateName(name.replace(/^fastify -> /, ''));\n  }\n}\n","import { GraphQLInstrumentation } from '@opentelemetry/instrumentation-graphql';\nimport { defineIntegration } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { generateInstrumentOnce } from '../../otel/instrument';\n\nimport { addOriginToSpan } from '../../utils/addOriginToSpan';\n\ninterface GraphqlOptions {\n  /** Do not create spans for resolvers. */\n  ignoreResolveSpans?: boolean;\n\n  /**\n   * Don't create spans for the execution of the default resolver on object properties.\n   *\n   * When a resolver function is not defined on the schema for a field, graphql will\n   * use the default resolver which just looks for a property with that name on the object.\n   * If the property is not a function, it's not very interesting to trace.\n   * This option can reduce noise and number of spans created.\n   */\n  ignoreTrivalResolveSpans?: boolean;\n}\n\nconst INTEGRATION_NAME = 'Graphql';\n\nexport const instrumentGraphql = generateInstrumentOnce<GraphqlOptions>(\n  INTEGRATION_NAME,\n  (_options: GraphqlOptions = {}) => {\n    const options = {\n      ignoreResolveSpans: true,\n      ignoreTrivialResolveSpans: true,\n      ..._options,\n    };\n\n    return new GraphQLInstrumentation({\n      ...options,\n      responseHook(span) {\n        addOriginToSpan(span, 'auto.graphql.otel.graphql');\n      },\n    });\n  },\n);\n\nconst _graphqlIntegration = ((options: GraphqlOptions = {}) => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentGraphql(options);\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * GraphQL integration\n *\n * Capture tracing data for GraphQL.\n */\nexport const graphqlIntegration = defineIntegration(_graphqlIntegration);\n","import { MongoDBInstrumentation } from '@opentelemetry/instrumentation-mongodb';\nimport { defineIntegration } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { generateInstrumentOnce } from '../../otel/instrument';\n\nimport { addOriginToSpan } from '../../utils/addOriginToSpan';\n\nconst INTEGRATION_NAME = 'Mongo';\n\nexport const instrumentMongo = generateInstrumentOnce(\n  INTEGRATION_NAME,\n  () =>\n    new MongoDBInstrumentation({\n      responseHook(span) {\n        addOriginToSpan(span, 'auto.db.otel.mongo');\n      },\n    }),\n);\n\nconst _mongoIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentMongo();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * MongoDB integration\n *\n * Capture tracing data for MongoDB.\n */\nexport const mongoIntegration = defineIntegration(_mongoIntegration);\n","import { MongooseInstrumentation } from '@opentelemetry/instrumentation-mongoose';\nimport { defineIntegration } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { generateInstrumentOnce } from '../../otel/instrument';\n\nimport { addOriginToSpan } from '../../utils/addOriginToSpan';\n\nconst INTEGRATION_NAME = 'Mongoose';\n\nexport const instrumentMongoose = generateInstrumentOnce(\n  INTEGRATION_NAME,\n  () =>\n    new MongooseInstrumentation({\n      responseHook(span) {\n        addOriginToSpan(span, 'auto.db.otel.mongoose');\n      },\n    }),\n);\n\nconst _mongooseIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentMongoose();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Mongoose integration\n *\n * Capture tracing data for Mongoose.\n */\nexport const mongooseIntegration = defineIntegration(_mongooseIntegration);\n","import { MySQLInstrumentation } from '@opentelemetry/instrumentation-mysql';\nimport { defineIntegration } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { generateInstrumentOnce } from '../../otel/instrument';\n\nconst INTEGRATION_NAME = 'Mysql';\n\nexport const instrumentMysql = generateInstrumentOnce(INTEGRATION_NAME, () => new MySQLInstrumentation({}));\n\nconst _mysqlIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentMysql();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * MySQL integration\n *\n * Capture tracing data for mysql.\n */\nexport const mysqlIntegration = defineIntegration(_mysqlIntegration);\n","import { MySQL2Instrumentation } from '@opentelemetry/instrumentation-mysql2';\nimport { defineIntegration } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { generateInstrumentOnce } from '../../otel/instrument';\n\nimport { addOriginToSpan } from '../../utils/addOriginToSpan';\n\nconst INTEGRATION_NAME = 'Mysql2';\n\nexport const instrumentMysql2 = generateInstrumentOnce(\n  INTEGRATION_NAME,\n  () =>\n    new MySQL2Instrumentation({\n      responseHook(span) {\n        addOriginToSpan(span, 'auto.db.otel.mysql2');\n      },\n    }),\n);\n\nconst _mysql2Integration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentMysql2();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * MySQL2 integration\n *\n * Capture tracing data for mysql2\n */\nexport const mysql2Integration = defineIntegration(_mysql2Integration);\n","import type { CommandArgs as IORedisCommandArgs } from '@opentelemetry/instrumentation-ioredis';\nimport { flatten } from '@sentry/utils';\n\nconst SINGLE_ARG_COMMANDS = ['get', 'set', 'setex'];\n\nexport const GET_COMMANDS = ['get', 'mget'];\nexport const SET_COMMANDS = ['set', 'setex'];\n// todo: del, expire\n\n/** Checks if a given command is in the list of redis commands.\n *  Useful because commands can come in lowercase or uppercase (depending on the library). */\nexport function isInCommands(redisCommands: string[], command: string): boolean {\n  return redisCommands.includes(command.toLowerCase());\n}\n\n/** Determine cache operation based on redis statement */\nexport function getCacheOperation(\n  command: string,\n): 'cache.get' | 'cache.put' | 'cache.remove' | 'cache.flush' | undefined {\n  if (isInCommands(GET_COMMANDS, command)) {\n    return 'cache.get';\n  } else if (isInCommands(SET_COMMANDS, command)) {\n    return 'cache.put';\n  } else {\n    return undefined;\n  }\n}\n\nfunction keyHasPrefix(key: string, prefixes: string[]): boolean {\n  return prefixes.some(prefix => key.startsWith(prefix));\n}\n\n/** Safely converts a redis key to a string (comma-separated if there are multiple keys) */\nexport function getCacheKeySafely(redisCommand: string, cmdArgs: IORedisCommandArgs): string[] | undefined {\n  try {\n    if (cmdArgs.length === 0) {\n      return undefined;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const processArg = (arg: string | Buffer | number | any[]): string[] => {\n      if (typeof arg === 'string' || typeof arg === 'number' || Buffer.isBuffer(arg)) {\n        return [arg.toString()];\n      } else if (Array.isArray(arg)) {\n        return flatten(arg.map(arg => processArg(arg)));\n      } else {\n        return ['<unknown>'];\n      }\n    };\n\n    const firstArg = cmdArgs[0];\n    if (isInCommands(SINGLE_ARG_COMMANDS, redisCommand) && firstArg != null) {\n      return processArg(firstArg);\n    }\n\n    return flatten(cmdArgs.map(arg => processArg(arg)));\n  } catch (e) {\n    return undefined;\n  }\n}\n\n/** Determines whether a redis operation should be considered as \"cache operation\" by checking if a key is prefixed.\n *  We only support certain commands (such as 'set', 'get', 'mget'). */\nexport function shouldConsiderForCache(redisCommand: string, keys: string[], prefixes: string[]): boolean {\n  if (!getCacheOperation(redisCommand)) {\n    return false;\n  }\n\n  for (const key of keys) {\n    if (keyHasPrefix(key, prefixes)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/** Calculates size based on the cache response value */\nexport function calculateCacheItemSize(response: unknown): number | undefined {\n  const getSize = (value: unknown): number | undefined => {\n    try {\n      if (Buffer.isBuffer(value)) return value.byteLength;\n      else if (typeof value === 'string') return value.length;\n      else if (typeof value === 'number') return value.toString().length;\n      else if (value === null || value === undefined) return 0;\n      return JSON.stringify(value).length;\n    } catch (e) {\n      return undefined;\n    }\n  };\n\n  return Array.isArray(response)\n    ? response.reduce((acc: number | undefined, curr) => {\n        const size = getSize(curr);\n        return typeof size === 'number' ? (acc !== undefined ? acc + size : size) : acc;\n      }, 0)\n    : getSize(response);\n}\n","import type { Span } from '@opentelemetry/api';\nimport type { RedisResponseCustomAttributeFunction } from '@opentelemetry/instrumentation-ioredis';\nimport { IORedisInstrumentation } from '@opentelemetry/instrumentation-ioredis';\nimport { RedisInstrumentation } from '@opentelemetry/instrumentation-redis-4';\nimport {\n  SEMANTIC_ATTRIBUTE_CACHE_HIT,\n  SEMANTIC_ATTRIBUTE_CACHE_ITEM_SIZE,\n  SEMANTIC_ATTRIBUTE_CACHE_KEY,\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,\n  defineIntegration,\n  spanToJSON,\n} from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { truncate } from '@sentry/utils';\nimport { generateInstrumentOnce } from '../../otel/instrument';\nimport {\n  GET_COMMANDS,\n  calculateCacheItemSize,\n  getCacheKeySafely,\n  getCacheOperation,\n  isInCommands,\n  shouldConsiderForCache,\n} from '../../utils/redisCache';\n\ninterface RedisOptions {\n  cachePrefixes?: string[];\n}\n\nconst INTEGRATION_NAME = 'Redis';\n\nlet _redisOptions: RedisOptions = {};\n\nconst cacheResponseHook: RedisResponseCustomAttributeFunction = (span: Span, redisCommand, cmdArgs, response) => {\n  span.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN, 'auto.db.otel.redis');\n\n  const safeKey = getCacheKeySafely(redisCommand, cmdArgs);\n  const cacheOperation = getCacheOperation(redisCommand);\n\n  if (\n    !safeKey ||\n    !cacheOperation ||\n    !_redisOptions?.cachePrefixes ||\n    !shouldConsiderForCache(redisCommand, safeKey, _redisOptions.cachePrefixes)\n  ) {\n    // not relevant for cache\n    return;\n  }\n\n  // otel/ioredis seems to be using the old standard, as there was a change to those params: https://github.com/open-telemetry/opentelemetry-specification/issues/3199\n  // We are using params based on the docs: https://opentelemetry.io/docs/specs/semconv/attributes-registry/network/\n  const networkPeerAddress = spanToJSON(span).data?.['net.peer.name'];\n  const networkPeerPort = spanToJSON(span).data?.['net.peer.port'];\n  if (networkPeerPort && networkPeerAddress) {\n    span.setAttributes({ 'network.peer.address': networkPeerAddress, 'network.peer.port': networkPeerPort });\n  }\n\n  const cacheItemSize = calculateCacheItemSize(response);\n\n  if (cacheItemSize) {\n    span.setAttribute(SEMANTIC_ATTRIBUTE_CACHE_ITEM_SIZE, cacheItemSize);\n  }\n\n  if (isInCommands(GET_COMMANDS, redisCommand) && cacheItemSize !== undefined) {\n    span.setAttribute(SEMANTIC_ATTRIBUTE_CACHE_HIT, cacheItemSize > 0);\n  }\n\n  span.setAttributes({\n    [SEMANTIC_ATTRIBUTE_SENTRY_OP]: cacheOperation,\n    [SEMANTIC_ATTRIBUTE_CACHE_KEY]: safeKey,\n  });\n\n  const spanDescription = safeKey.join(', ');\n\n  span.updateName(truncate(spanDescription, 1024));\n};\n\nconst instrumentIORedis = generateInstrumentOnce('IORedis', () => {\n  return new IORedisInstrumentation({\n    responseHook: cacheResponseHook,\n  });\n});\n\nconst instrumentRedis4 = generateInstrumentOnce('Redis-4', () => {\n  return new RedisInstrumentation({\n    responseHook: cacheResponseHook,\n  });\n});\n\n/** To be able to preload all Redis OTel instrumentations with just one ID (\"Redis\"), all the instrumentations are generated in this one function  */\nexport const instrumentRedis = Object.assign(\n  (): void => {\n    instrumentIORedis();\n    instrumentRedis4();\n\n    // todo: implement them gradually\n    // new LegacyRedisInstrumentation({}),\n  },\n  { id: INTEGRATION_NAME },\n);\n\nconst _redisIntegration = ((options: RedisOptions = {}) => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      _redisOptions = options;\n      instrumentRedis();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Redis integration for \"ioredis\"\n *\n * Capture tracing data for redis and ioredis.\n */\nexport const redisIntegration = defineIntegration(_redisIntegration);\n","import { NestInstrumentation } from '@opentelemetry/instrumentation-nestjs-core';\nimport {\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,\n  captureException,\n  defineIntegration,\n  getClient,\n  getDefaultIsolationScope,\n  getIsolationScope,\n  spanToJSON,\n} from '@sentry/core';\nimport type { IntegrationFn, Span } from '@sentry/types';\nimport { logger } from '@sentry/utils';\nimport { generateInstrumentOnce } from '../../otel/instrument';\n\ninterface MinimalNestJsExecutionContext {\n  getType: () => string;\n\n  switchToHttp: () => {\n    // minimal request object\n    // according to official types, all properties are required but\n    // let's play it safe and assume they're optional\n    getRequest: () => {\n      route?: {\n        path?: string;\n      };\n      method?: string;\n    };\n  };\n}\n\ninterface NestJsErrorFilter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  catch(exception: any, host: any): void;\n}\n\ninterface MinimalNestJsApp {\n  useGlobalFilters: (arg0: NestJsErrorFilter) => void;\n  useGlobalInterceptors: (interceptor: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    intercept: (context: MinimalNestJsExecutionContext, next: { handle: () => any }) => any;\n  }) => void;\n}\n\nconst INTEGRATION_NAME = 'Nest';\n\nexport const instrumentNest = generateInstrumentOnce(INTEGRATION_NAME, () => new NestInstrumentation());\n\nconst _nestIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentNest();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Nest framework integration\n *\n * Capture tracing data for nest.\n */\nexport const nestIntegration = defineIntegration(_nestIntegration);\n\n/**\n * Setup an error handler for Nest.\n */\nexport function setupNestErrorHandler(app: MinimalNestJsApp, baseFilter: NestJsErrorFilter): void {\n  // Sadly, NestInstrumentation has no requestHook, so we need to add the attributes here\n  // We register this hook in this method, because if we register it in the integration `setup`,\n  // it would always run even for users that are not even using Nest.js\n  const client = getClient();\n  if (client) {\n    client.on('spanStart', span => {\n      addNestSpanAttributes(span);\n    });\n  }\n\n  app.useGlobalInterceptors({\n    intercept(context, next) {\n      if (getIsolationScope() === getDefaultIsolationScope()) {\n        logger.warn('Isolation scope is still the default isolation scope, skipping setting transactionName.');\n        return next.handle();\n      }\n\n      if (context.getType() === 'http') {\n        const req = context.switchToHttp().getRequest();\n        if (req.route) {\n          getIsolationScope().setTransactionName(`${req.method?.toUpperCase() || 'GET'} ${req.route.path}`);\n        }\n      }\n\n      return next.handle();\n    },\n  });\n\n  const wrappedFilter = new Proxy(baseFilter, {\n    get(target, prop, receiver) {\n      if (prop === 'catch') {\n        const originalCatch = Reflect.get(target, prop, receiver);\n\n        return (exception: unknown, host: unknown) => {\n          const status_code = (exception as { status?: number }).status;\n\n          // don't report expected errors\n          if (status_code !== undefined && status_code >= 400 && status_code < 500) {\n            return originalCatch.apply(target, [exception, host]);\n          }\n\n          captureException(exception);\n          return originalCatch.apply(target, [exception, host]);\n        };\n      }\n      return Reflect.get(target, prop, receiver);\n    },\n  });\n\n  app.useGlobalFilters(wrappedFilter);\n}\n\nfunction addNestSpanAttributes(span: Span): void {\n  const attributes = spanToJSON(span).data || {};\n\n  // this is one of: app_creation, request_context, handler\n  const type = attributes['nestjs.type'];\n\n  // If this is already set, or we have no nest.js span, no need to process again...\n  if (attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP] || !type) {\n    return;\n  }\n\n  span.setAttributes({\n    [SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: 'auto.http.otel.nestjs',\n    [SEMANTIC_ATTRIBUTE_SENTRY_OP]: `${type}.nestjs`,\n  });\n}\n","import { PgInstrumentation } from '@opentelemetry/instrumentation-pg';\nimport { defineIntegration } from '@sentry/core';\nimport type { IntegrationFn } from '@sentry/types';\nimport { generateInstrumentOnce } from '../../otel/instrument';\n\nimport { addOriginToSpan } from '../../utils/addOriginToSpan';\n\nconst INTEGRATION_NAME = 'Postgres';\n\nexport const instrumentPostgres = generateInstrumentOnce(\n  INTEGRATION_NAME,\n  () =>\n    new PgInstrumentation({\n      requireParentSpan: true,\n      requestHook(span) {\n        addOriginToSpan(span, 'auto.db.otel.postgres');\n      },\n    }),\n);\n\nconst _postgresIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentPostgres();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Postgres integration\n *\n * Capture tracing data for pg.\n */\nexport const postgresIntegration = defineIntegration(_postgresIntegration);\n","import { HapiInstrumentation } from '@opentelemetry/instrumentation-hapi';\nimport {\n  SDK_VERSION,\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,\n  captureException,\n  defineIntegration,\n  getClient,\n  getDefaultIsolationScope,\n  getIsolationScope,\n  spanToJSON,\n} from '@sentry/core';\nimport type { IntegrationFn, Span } from '@sentry/types';\nimport { logger } from '@sentry/utils';\nimport { DEBUG_BUILD } from '../../../debug-build';\nimport { generateInstrumentOnce } from '../../../otel/instrument';\nimport { ensureIsWrapped } from '../../../utils/ensureIsWrapped';\nimport type { Request, RequestEvent, Server } from './types';\n\nconst INTEGRATION_NAME = 'Hapi';\n\nexport const instrumentHapi = generateInstrumentOnce(INTEGRATION_NAME, () => new HapiInstrumentation());\n\nconst _hapiIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentHapi();\n    },\n  };\n}) satisfies IntegrationFn;\n\n/**\n * Hapi integration\n *\n * Capture tracing data for Hapi.\n * If you also want to capture errors, you need to call `setupHapiErrorHandler(server)` after you set up your server.\n */\nexport const hapiIntegration = defineIntegration(_hapiIntegration);\n\nfunction isErrorEvent(event: RequestEvent): event is RequestEvent {\n  return event && (event as RequestEvent).error !== undefined;\n}\n\nfunction sendErrorToSentry(errorData: object): void {\n  captureException(errorData, {\n    mechanism: {\n      type: 'hapi',\n      handled: false,\n      data: {\n        function: 'hapiErrorPlugin',\n      },\n    },\n  });\n}\n\nexport const hapiErrorPlugin = {\n  name: 'SentryHapiErrorPlugin',\n  version: SDK_VERSION,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  register: async function (serverArg: Record<any, any>) {\n    const server = serverArg as unknown as Server;\n\n    server.events.on({ name: 'request', channels: ['error'] }, (request: Request, event: RequestEvent) => {\n      if (getIsolationScope() !== getDefaultIsolationScope()) {\n        const route = request.route;\n        if (route && route.path) {\n          getIsolationScope().setTransactionName(`${route.method?.toUpperCase() || 'GET'} ${route.path}`);\n        }\n      } else {\n        DEBUG_BUILD &&\n          logger.warn('Isolation scope is still the default isolation scope - skipping setting transactionName');\n      }\n\n      if (isErrorEvent(event)) {\n        sendErrorToSentry(event.error);\n      }\n    });\n  },\n};\n\n/**\n * Add a Hapi plugin to capture errors to Sentry.\n */\nexport async function setupHapiErrorHandler(server: Server): Promise<void> {\n  await server.register(hapiErrorPlugin);\n\n  // Sadly, middleware spans do not go through `requestHook`, so we handle those here\n  // We register this hook in this method, because if we register it in the integration `setup`,\n  // it would always run even for users that are not even using hapi\n  const client = getClient();\n  if (client) {\n    client.on('spanStart', span => {\n      addHapiSpanAttributes(span);\n    });\n  }\n\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  ensureIsWrapped(server.register, 'hapi');\n}\n\nfunction addHapiSpanAttributes(span: Span): void {\n  const attributes = spanToJSON(span).data || {};\n\n  // this is one of: router, plugin, server.ext\n  const type = attributes['hapi.type'];\n\n  // If this is already set, or we have no Hapi span, no need to process again...\n  if (attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP] || !type) {\n    return;\n  }\n\n  span.setAttributes({\n    [SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: 'auto.http.otel.hapi',\n    [SEMANTIC_ATTRIBUTE_SENTRY_OP]: `${type}.hapi`,\n  });\n}\n","import { KoaInstrumentation } from '@opentelemetry/instrumentation-koa';\nimport { SEMATTRS_HTTP_ROUTE } from '@opentelemetry/semantic-conventions';\nimport {\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,\n  captureException,\n  defineIntegration,\n  getDefaultIsolationScope,\n  getIsolationScope,\n  spanToJSON,\n} from '@sentry/core';\nimport type { IntegrationFn, Span } from '@sentry/types';\nimport { logger } from '@sentry/utils';\nimport { DEBUG_BUILD } from '../../debug-build';\nimport { generateInstrumentOnce } from '../../otel/instrument';\nimport { ensureIsWrapped } from '../../utils/ensureIsWrapped';\n\nconst INTEGRATION_NAME = 'Koa';\n\nexport const instrumentKoa = generateInstrumentOnce(\n  INTEGRATION_NAME,\n  () =>\n    new KoaInstrumentation({\n      requestHook(span, info) {\n        addKoaSpanAttributes(span);\n\n        if (getIsolationScope() === getDefaultIsolationScope()) {\n          DEBUG_BUILD && logger.warn('Isolation scope is default isolation scope - skipping setting transactionName');\n          return;\n        }\n        const attributes = spanToJSON(span).data;\n        const route = attributes && attributes[SEMATTRS_HTTP_ROUTE];\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        const method: string = info?.context?.request?.method?.toUpperCase() || 'GET';\n        if (route) {\n          getIsolationScope().setTransactionName(`${method} ${route}`);\n        }\n      },\n    }),\n);\n\nconst _koaIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentKoa();\n    },\n  };\n}) satisfies IntegrationFn;\n\nexport const koaIntegration = defineIntegration(_koaIntegration);\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const setupKoaErrorHandler = (app: { use: (arg0: (ctx: any, next: any) => Promise<void>) => void }): void => {\n  app.use(async (ctx, next) => {\n    try {\n      await next();\n    } catch (error) {\n      captureException(error);\n      throw error;\n    }\n  });\n\n  ensureIsWrapped(app.use, 'koa');\n};\n\nfunction addKoaSpanAttributes(span: Span): void {\n  span.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN, 'auto.http.otel.koa');\n\n  const attributes = spanToJSON(span).data || {};\n\n  // this is one of: middleware, router\n  const type = attributes['koa.type'];\n\n  if (type) {\n    span.setAttribute(SEMANTIC_ATTRIBUTE_SENTRY_OP, `${type}.koa`);\n  }\n\n  // Also update the name\n  const name = attributes['koa.name'];\n  if (typeof name === 'string') {\n    // Somehow, name is sometimes `''` for middleware spans\n    // See: https://github.com/open-telemetry/opentelemetry-js-contrib/issues/2220\n    span.updateName(name || '< unknown >');\n  }\n}\n","import { ConnectInstrumentation } from '@opentelemetry/instrumentation-connect';\nimport {\n  SEMANTIC_ATTRIBUTE_SENTRY_OP,\n  SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN,\n  captureException,\n  defineIntegration,\n  getClient,\n  spanToJSON,\n} from '@sentry/core';\nimport type { IntegrationFn, Span } from '@sentry/types';\nimport { generateInstrumentOnce } from '../../otel/instrument';\nimport { ensureIsWrapped } from '../../utils/ensureIsWrapped';\n\ntype ConnectApp = {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  use: (middleware: any) => void;\n};\n\nconst INTEGRATION_NAME = 'Connect';\n\nexport const instrumentConnect = generateInstrumentOnce(INTEGRATION_NAME, () => new ConnectInstrumentation());\n\nconst _connectIntegration = (() => {\n  return {\n    name: INTEGRATION_NAME,\n    setupOnce() {\n      instrumentConnect();\n    },\n  };\n}) satisfies IntegrationFn;\n\nexport const connectIntegration = defineIntegration(_connectIntegration);\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction connectErrorMiddleware(err: any, req: any, res: any, next: any): void {\n  captureException(err);\n  next(err);\n}\n\nexport const setupConnectErrorHandler = (app: ConnectApp): void => {\n  app.use(connectErrorMiddleware);\n\n  // Sadly, ConnectInstrumentation has no requestHook, so we need to add the attributes here\n  // We register this hook in this method, because if we register it in the integration `setup`,\n  // it would always run even for users that are not even using connect\n  const client = getClient();\n  if (client) {\n    client.on('spanStart', span => {\n      addConnectSpanAttributes(span);\n    });\n  }\n\n  ensureIsWrapped(app.use, 'connect');\n};\n\nfunction addConnectSpanAttributes(span: Span): void {\n  const attributes = spanToJSON(span).data || {};\n\n  // this is one of: middleware, request_handler\n  const type = attributes['connect.type'];\n\n  // If this is already set, or we have no connect span, no need to process again...\n  if (attributes[SEMANTIC_ATTRIBUTE_SENTRY_OP] || !type) {\n    return;\n  }\n\n  span.setAttributes({\n    [SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN]: 'auto.http.otel.connect',\n    [SEMANTIC_ATTRIBUTE_SENTRY_OP]: `${type}.connect`,\n  });\n\n  // Also update the name, we don't need to \"middleware - \" prefix\n  const name = attributes['connect.name'];\n  if (typeof name === 'string') {\n    span.updateName(name);\n  }\n}\n","import type { Integration } from '@sentry/types';\nimport { instrumentHttp } from '../http';\n\nimport { connectIntegration, instrumentConnect } from './connect';\nimport { expressIntegration, instrumentExpress } from './express';\nimport { fastifyIntegration, instrumentFastify } from './fastify';\nimport { graphqlIntegration, instrumentGraphql } from './graphql';\nimport { hapiIntegration, instrumentHapi } from './hapi';\nimport { instrumentKoa, koaIntegration } from './koa';\nimport { instrumentMongo, mongoIntegration } from './mongo';\nimport { instrumentMongoose, mongooseIntegration } from './mongoose';\nimport { instrumentMysql, mysqlIntegration } from './mysql';\nimport { instrumentMysql2, mysql2Integration } from './mysql2';\nimport { instrumentNest, nestIntegration } from './nest';\nimport { instrumentPostgres, postgresIntegration } from './postgres';\nimport { instrumentRedis, redisIntegration } from './redis';\n\n/**\n * With OTEL, all performance integrations will be added, as OTEL only initializes them when the patched package is actually required.\n */\nexport function getAutoPerformanceIntegrations(): Integration[] {\n  return [\n    expressIntegration(),\n    fastifyIntegration(),\n    graphqlIntegration(),\n    mongoIntegration(),\n    mongooseIntegration(),\n    mysqlIntegration(),\n    mysql2Integration(),\n    redisIntegration(),\n    postgresIntegration(),\n    // For now, we do not include prisma by default because it has ESM issues\n    // See https://github.com/prisma/prisma/issues/23410\n    // TODO v8: Figure out a better solution for this, maybe only disable in ESM mode?\n    // prismaIntegration(),\n    nestIntegration(),\n    hapiIntegration(),\n    koaIntegration(),\n    connectIntegration(),\n  ];\n}\n\n/**\n * Get a list of methods to instrument OTEL, when preload instrumentation.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function getOpenTelemetryInstrumentationToPreload(): (((options?: any) => void) & { id: string })[] {\n  return [\n    instrumentHttp,\n    instrumentExpress,\n    instrumentConnect,\n    instrumentFastify,\n    instrumentHapi,\n    instrumentKoa,\n    instrumentNest,\n    instrumentMongo,\n    instrumentMongoose,\n    instrumentMysql,\n    instrumentMysql2,\n    instrumentPostgres,\n    instrumentHapi,\n    instrumentGraphql,\n    instrumentRedis,\n  ];\n}\n","/**\n * This code was originally forked from https://github.com/TooTallNate/proxy-agents/tree/b133295fd16f6475578b6b15bd9b4e33ecb0d0b7\n * With the following LICENSE:\n *\n * (The MIT License)\n *\n * Copyright (c) 2013 Nathan Rajlich <nathan@tootallnate.net>*\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:*\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.*\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/* eslint-disable @typescript-eslint/explicit-member-accessibility */\n/* eslint-disable @typescript-eslint/member-ordering */\n/* eslint-disable jsdoc/require-jsdoc */\nimport * as http from 'node:http';\nimport type * as net from 'node:net';\nimport type { Duplex } from 'node:stream';\nimport type * as tls from 'node:tls';\n\nexport * from './helpers';\n\ninterface HttpConnectOpts extends net.TcpNetConnectOpts {\n  secureEndpoint: false;\n  protocol?: string;\n}\n\ninterface HttpsConnectOpts extends tls.ConnectionOptions {\n  secureEndpoint: true;\n  protocol?: string;\n  port: number;\n}\n\nexport type AgentConnectOpts = HttpConnectOpts | HttpsConnectOpts;\n\nconst INTERNAL = Symbol('AgentBaseInternalState');\n\ninterface InternalState {\n  defaultPort?: number;\n  protocol?: string;\n  currentSocket?: Duplex;\n}\n\nexport abstract class Agent extends http.Agent {\n  private [INTERNAL]: InternalState;\n\n  // Set by `http.Agent` - missing from `@types/node`\n  options!: Partial<net.TcpNetConnectOpts & tls.ConnectionOptions>;\n  keepAlive!: boolean;\n\n  constructor(opts?: http.AgentOptions) {\n    super(opts);\n    this[INTERNAL] = {};\n  }\n\n  abstract connect(\n    req: http.ClientRequest,\n    options: AgentConnectOpts,\n  ): Promise<Duplex | http.Agent> | Duplex | http.Agent;\n\n  /**\n   * Determine whether this is an `http` or `https` request.\n   */\n  isSecureEndpoint(options?: AgentConnectOpts): boolean {\n    if (options) {\n      // First check the `secureEndpoint` property explicitly, since this\n      // means that a parent `Agent` is \"passing through\" to this instance.\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n      if (typeof (options as any).secureEndpoint === 'boolean') {\n        return options.secureEndpoint;\n      }\n\n      // If no explicit `secure` endpoint, check if `protocol` property is\n      // set. This will usually be the case since using a full string URL\n      // or `URL` instance should be the most common usage.\n      if (typeof options.protocol === 'string') {\n        return options.protocol === 'https:';\n      }\n    }\n\n    // Finally, if no `protocol` property was set, then fall back to\n    // checking the stack trace of the current call stack, and try to\n    // detect the \"https\" module.\n    const { stack } = new Error();\n    if (typeof stack !== 'string') return false;\n    return stack.split('\\n').some(l => l.indexOf('(https.js:') !== -1 || l.indexOf('node:https:') !== -1);\n  }\n\n  createSocket(req: http.ClientRequest, options: AgentConnectOpts, cb: (err: Error | null, s?: Duplex) => void): void {\n    const connectOpts = {\n      ...options,\n      secureEndpoint: this.isSecureEndpoint(options),\n    };\n    Promise.resolve()\n      .then(() => this.connect(req, connectOpts))\n      .then(socket => {\n        if (socket instanceof http.Agent) {\n          // @ts-expect-error `addRequest()` isn't defined in `@types/node`\n          return socket.addRequest(req, connectOpts);\n        }\n        this[INTERNAL].currentSocket = socket;\n        // @ts-expect-error `createSocket()` isn't defined in `@types/node`\n        super.createSocket(req, options, cb);\n      }, cb);\n  }\n\n  createConnection(): Duplex {\n    const socket = this[INTERNAL].currentSocket;\n    this[INTERNAL].currentSocket = undefined;\n    if (!socket) {\n      throw new Error('No socket was returned in the `connect()` function');\n    }\n    return socket;\n  }\n\n  get defaultPort(): number {\n    return this[INTERNAL].defaultPort ?? (this.protocol === 'https:' ? 443 : 80);\n  }\n\n  set defaultPort(v: number) {\n    if (this[INTERNAL]) {\n      this[INTERNAL].defaultPort = v;\n    }\n  }\n\n  get protocol(): string {\n    return this[INTERNAL].protocol ?? (this.isSecureEndpoint() ? 'https:' : 'http:');\n  }\n\n  set protocol(v: string) {\n    if (this[INTERNAL]) {\n      this[INTERNAL].protocol = v;\n    }\n  }\n}\n","/**\n * This code was originally forked from https://github.com/TooTallNate/proxy-agents/tree/b133295fd16f6475578b6b15bd9b4e33ecb0d0b7\n * With the following LICENSE:\n *\n * (The MIT License)\n *\n * Copyright (c) 2013 Nathan Rajlich <nathan@tootallnate.net>*\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:*\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.*\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\n/* eslint-disable jsdoc/require-jsdoc */\nimport type { IncomingHttpHeaders } from 'node:http';\nimport type { Readable } from 'node:stream';\nimport { logger } from '@sentry/utils';\n\nfunction debug(...args: unknown[]): void {\n  logger.log('[https-proxy-agent:parse-proxy-response]', ...args);\n}\n\nexport interface ConnectResponse {\n  statusCode: number;\n  statusText: string;\n  headers: IncomingHttpHeaders;\n}\n\nexport function parseProxyResponse(socket: Readable): Promise<{ connect: ConnectResponse; buffered: Buffer }> {\n  return new Promise((resolve, reject) => {\n    // we need to buffer any HTTP traffic that happens with the proxy before we get\n    // the CONNECT response, so that if the response is anything other than an \"200\"\n    // response code, then we can re-play the \"data\" events on the socket once the\n    // HTTP parser is hooked up...\n    let buffersLength = 0;\n    const buffers: Buffer[] = [];\n\n    function read() {\n      const b = socket.read();\n      if (b) ondata(b);\n      else socket.once('readable', read);\n    }\n\n    function cleanup() {\n      socket.removeListener('end', onend);\n      socket.removeListener('error', onerror);\n      socket.removeListener('readable', read);\n    }\n\n    function onend() {\n      cleanup();\n      debug('onend');\n      reject(new Error('Proxy connection ended before receiving CONNECT response'));\n    }\n\n    function onerror(err: Error) {\n      cleanup();\n      debug('onerror %o', err);\n      reject(err);\n    }\n\n    function ondata(b: Buffer) {\n      buffers.push(b);\n      buffersLength += b.length;\n\n      const buffered = Buffer.concat(buffers, buffersLength);\n      const endOfHeaders = buffered.indexOf('\\r\\n\\r\\n');\n\n      if (endOfHeaders === -1) {\n        // keep buffering\n        debug('have not received end of HTTP headers yet...');\n        read();\n        return;\n      }\n\n      const headerParts = buffered.slice(0, endOfHeaders).toString('ascii').split('\\r\\n');\n      const firstLine = headerParts.shift();\n      if (!firstLine) {\n        socket.destroy();\n        return reject(new Error('No header received from proxy CONNECT response'));\n      }\n      const firstLineParts = firstLine.split(' ');\n      const statusCode = +(firstLineParts[1] || 0);\n      const statusText = firstLineParts.slice(2).join(' ');\n      const headers: IncomingHttpHeaders = {};\n      for (const header of headerParts) {\n        if (!header) continue;\n        const firstColon = header.indexOf(':');\n        if (firstColon === -1) {\n          socket.destroy();\n          return reject(new Error(`Invalid header from proxy CONNECT response: \"${header}\"`));\n        }\n        const key = header.slice(0, firstColon).toLowerCase();\n        const value = header.slice(firstColon + 1).trimStart();\n        const current = headers[key];\n        if (typeof current === 'string') {\n          headers[key] = [current, value];\n        } else if (Array.isArray(current)) {\n          current.push(value);\n        } else {\n          headers[key] = value;\n        }\n      }\n      debug('got proxy server response: %o %o', firstLine, headers);\n      cleanup();\n      resolve({\n        connect: {\n          statusCode,\n          statusText,\n          headers,\n        },\n        buffered,\n      });\n    }\n\n    socket.on('error', onerror);\n    socket.on('end', onend);\n\n    read();\n  });\n}\n","/**\n * This code was originally forked from https://github.com/TooTallNate/proxy-agents/tree/b133295fd16f6475578b6b15bd9b4e33ecb0d0b7\n * With the following LICENSE:\n *\n * (The MIT License)\n *\n * Copyright (c) 2013 Nathan Rajlich <nathan@tootallnate.net>*\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:*\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.*\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/* eslint-disable @typescript-eslint/explicit-member-accessibility */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport type * as http from 'node:http';\nimport type { OutgoingHttpHeaders } from 'node:http';\nimport * as net from 'node:net';\nimport * as tls from 'node:tls';\nimport { logger } from '@sentry/utils';\nimport { Agent } from './base';\nimport type { AgentConnectOpts } from './base';\nimport { parseProxyResponse } from './parse-proxy-response';\n\nfunction debug(...args: unknown[]): void {\n  logger.log('[https-proxy-agent]', ...args);\n}\n\ntype Protocol<T> = T extends `${infer Protocol}:${infer _}` ? Protocol : never;\n\ntype ConnectOptsMap = {\n  http: Omit<net.TcpNetConnectOpts, 'host' | 'port'>;\n  https: Omit<tls.ConnectionOptions, 'host' | 'port'>;\n};\n\ntype ConnectOpts<T> = {\n  [P in keyof ConnectOptsMap]: Protocol<T> extends P ? ConnectOptsMap[P] : never;\n}[keyof ConnectOptsMap];\n\nexport type HttpsProxyAgentOptions<T> = ConnectOpts<T> &\n  http.AgentOptions & {\n    headers?: OutgoingHttpHeaders | (() => OutgoingHttpHeaders);\n  };\n\n/**\n * The `HttpsProxyAgent` implements an HTTP Agent subclass that connects to\n * the specified \"HTTP(s) proxy server\" in order to proxy HTTPS requests.\n *\n * Outgoing HTTP requests are first tunneled through the proxy server using the\n * `CONNECT` HTTP request method to establish a connection to the proxy server,\n * and then the proxy server connects to the destination target and issues the\n * HTTP request from the proxy server.\n *\n * `https:` requests have their socket connection upgraded to TLS once\n * the connection to the proxy server has been established.\n */\nexport class HttpsProxyAgent<Uri extends string> extends Agent {\n  static protocols = ['http', 'https'] as const;\n\n  readonly proxy: URL;\n  proxyHeaders: OutgoingHttpHeaders | (() => OutgoingHttpHeaders);\n  connectOpts: net.TcpNetConnectOpts & tls.ConnectionOptions;\n\n  constructor(proxy: Uri | URL, opts?: HttpsProxyAgentOptions<Uri>) {\n    super(opts);\n    this.options = {};\n    this.proxy = typeof proxy === 'string' ? new URL(proxy) : proxy;\n    this.proxyHeaders = opts?.headers ?? {};\n    debug('Creating new HttpsProxyAgent instance: %o', this.proxy.href);\n\n    // Trim off the brackets from IPv6 addresses\n    const host = (this.proxy.hostname || this.proxy.host).replace(/^\\[|\\]$/g, '');\n    const port = this.proxy.port ? parseInt(this.proxy.port, 10) : this.proxy.protocol === 'https:' ? 443 : 80;\n    this.connectOpts = {\n      // Attempt to negotiate http/1.1 for proxy servers that support http/2\n      ALPNProtocols: ['http/1.1'],\n      ...(opts ? omit(opts, 'headers') : null),\n      host,\n      port,\n    };\n  }\n\n  /**\n   * Called when the node-core HTTP client library is creating a\n   * new HTTP request.\n   */\n  async connect(req: http.ClientRequest, opts: AgentConnectOpts): Promise<net.Socket> {\n    const { proxy } = this;\n\n    if (!opts.host) {\n      throw new TypeError('No \"host\" provided');\n    }\n\n    // Create a socket connection to the proxy server.\n    let socket: net.Socket;\n    if (proxy.protocol === 'https:') {\n      debug('Creating `tls.Socket`: %o', this.connectOpts);\n      const servername = this.connectOpts.servername || this.connectOpts.host;\n      socket = tls.connect({\n        ...this.connectOpts,\n        servername: servername && net.isIP(servername) ? undefined : servername,\n      });\n    } else {\n      debug('Creating `net.Socket`: %o', this.connectOpts);\n      socket = net.connect(this.connectOpts);\n    }\n\n    const headers: OutgoingHttpHeaders =\n      typeof this.proxyHeaders === 'function' ? this.proxyHeaders() : { ...this.proxyHeaders };\n    const host = net.isIPv6(opts.host) ? `[${opts.host}]` : opts.host;\n    let payload = `CONNECT ${host}:${opts.port} HTTP/1.1\\r\\n`;\n\n    // Inject the `Proxy-Authorization` header if necessary.\n    if (proxy.username || proxy.password) {\n      const auth = `${decodeURIComponent(proxy.username)}:${decodeURIComponent(proxy.password)}`;\n      headers['Proxy-Authorization'] = `Basic ${Buffer.from(auth).toString('base64')}`;\n    }\n\n    headers.Host = `${host}:${opts.port}`;\n\n    if (!headers['Proxy-Connection']) {\n      headers['Proxy-Connection'] = this.keepAlive ? 'Keep-Alive' : 'close';\n    }\n    for (const name of Object.keys(headers)) {\n      payload += `${name}: ${headers[name]}\\r\\n`;\n    }\n\n    const proxyResponsePromise = parseProxyResponse(socket);\n\n    socket.write(`${payload}\\r\\n`);\n\n    const { connect, buffered } = await proxyResponsePromise;\n    req.emit('proxyConnect', connect);\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore Not EventEmitter in Node types\n    this.emit('proxyConnect', connect, req);\n\n    if (connect.statusCode === 200) {\n      req.once('socket', resume);\n\n      if (opts.secureEndpoint) {\n        // The proxy is connecting to a TLS server, so upgrade\n        // this socket connection to a TLS connection.\n        debug('Upgrading socket connection to TLS');\n        const servername = opts.servername || opts.host;\n        return tls.connect({\n          ...omit(opts, 'host', 'path', 'port'),\n          socket,\n          servername: net.isIP(servername) ? undefined : servername,\n        });\n      }\n\n      return socket;\n    }\n\n    // Some other status code that's not 200... need to re-play the HTTP\n    // header \"data\" events onto the socket once the HTTP machinery is\n    // attached so that the node core `http` can parse and handle the\n    // error status code.\n\n    // Close the original socket, and a new \"fake\" socket is returned\n    // instead, so that the proxy doesn't get the HTTP request\n    // written to it (which may contain `Authorization` headers or other\n    // sensitive data).\n    //\n    // See: https://hackerone.com/reports/541502\n    socket.destroy();\n\n    const fakeSocket = new net.Socket({ writable: false });\n    fakeSocket.readable = true;\n\n    // Need to wait for the \"socket\" event to re-play the \"data\" events.\n    req.once('socket', (s: net.Socket) => {\n      debug('Replaying proxy buffer for failed request');\n      // Replay the \"buffered\" Buffer onto the fake `socket`, since at\n      // this point the HTTP module machinery has been hooked up for\n      // the user.\n      s.push(buffered);\n      s.push(null);\n    });\n\n    return fakeSocket;\n  }\n}\n\nfunction resume(socket: net.Socket | tls.TLSSocket): void {\n  socket.resume();\n}\n\nfunction omit<T extends object, K extends [...(keyof T)[]]>(\n  obj: T,\n  ...keys: K\n): {\n  [K2 in Exclude<keyof T, K[number]>]: T[K2];\n} {\n  const ret = {} as {\n    [K in keyof typeof obj]: (typeof obj)[K];\n  };\n  let key: keyof typeof obj;\n  for (key in obj) {\n    if (!keys.includes(key)) {\n      ret[key] = obj[key];\n    }\n  }\n  return ret;\n}\n","import * as http from 'node:http';\nimport * as https from 'node:https';\nimport { Readable } from 'node:stream';\nimport { createGzip } from 'node:zlib';\nimport { createTransport, suppressTracing } from '@sentry/core';\nimport type {\n  BaseTransportOptions,\n  Transport,\n  TransportMakeRequestResponse,\n  TransportRequest,\n  TransportRequestExecutor,\n} from '@sentry/types';\nimport { consoleSandbox } from '@sentry/utils';\nimport { HttpsProxyAgent } from '../proxy';\nimport type { HTTPModule } from './http-module';\n\nexport interface NodeTransportOptions extends BaseTransportOptions {\n  /** Define custom headers */\n  headers?: Record<string, string>;\n  /** Set a proxy that should be used for outbound requests. */\n  proxy?: string;\n  /** HTTPS proxy CA certificates */\n  caCerts?: string | Buffer | Array<string | Buffer>;\n  /** Custom HTTP module. Defaults to the native 'http' and 'https' modules. */\n  httpModule?: HTTPModule;\n  /** Allow overriding connection keepAlive, defaults to false */\n  keepAlive?: boolean;\n}\n\n// Estimated maximum size for reasonable standalone event\nconst GZIP_THRESHOLD = 1024 * 32;\n\n/**\n * Gets a stream from a Uint8Array or string\n * Readable.from is ideal but was added in node.js v12.3.0 and v10.17.0\n */\nfunction streamFromBody(body: Uint8Array | string): Readable {\n  return new Readable({\n    read() {\n      this.push(body);\n      this.push(null);\n    },\n  });\n}\n\n/**\n * Creates a Transport that uses native the native 'http' and 'https' modules to send events to Sentry.\n */\nexport function makeNodeTransport(options: NodeTransportOptions): Transport {\n  let urlSegments: URL;\n\n  try {\n    urlSegments = new URL(options.url);\n  } catch (e) {\n    consoleSandbox(() => {\n      // eslint-disable-next-line no-console\n      console.warn(\n        '[@sentry/node]: Invalid dsn or tunnel option, will not send any events. The tunnel option must be a full URL when used.',\n      );\n    });\n    return createTransport(options, () => Promise.resolve({}));\n  }\n\n  const isHttps = urlSegments.protocol === 'https:';\n\n  // Proxy prioritization: http => `options.proxy` | `process.env.http_proxy`\n  // Proxy prioritization: https => `options.proxy` | `process.env.https_proxy` | `process.env.http_proxy`\n  const proxy = applyNoProxyOption(\n    urlSegments,\n    options.proxy || (isHttps ? process.env.https_proxy : undefined) || process.env.http_proxy,\n  );\n\n  const nativeHttpModule = isHttps ? https : http;\n  const keepAlive = options.keepAlive === undefined ? false : options.keepAlive;\n\n  // TODO(v9): Evaluate if we can set keepAlive to true. This would involve testing for memory leaks in older node\n  // versions(>= 8) as they had memory leaks when using it: #2555\n  const agent = proxy\n    ? (new HttpsProxyAgent(proxy) as http.Agent)\n    : new nativeHttpModule.Agent({ keepAlive, maxSockets: 30, timeout: 2000 });\n\n  // This ensures we do not generate any spans in OpenTelemetry for the transport\n  return suppressTracing(() => {\n    const requestExecutor = createRequestExecutor(options, options.httpModule ?? nativeHttpModule, agent);\n    return createTransport(options, requestExecutor);\n  });\n}\n\n/**\n * Honors the `no_proxy` env variable with the highest priority to allow for hosts exclusion.\n *\n * @param transportUrl The URL the transport intends to send events to.\n * @param proxy The client configured proxy.\n * @returns A proxy the transport should use.\n */\nfunction applyNoProxyOption(transportUrlSegments: URL, proxy: string | undefined): string | undefined {\n  const { no_proxy } = process.env;\n\n  const urlIsExemptFromProxy =\n    no_proxy &&\n    no_proxy\n      .split(',')\n      .some(\n        exemption => transportUrlSegments.host.endsWith(exemption) || transportUrlSegments.hostname.endsWith(exemption),\n      );\n\n  if (urlIsExemptFromProxy) {\n    return undefined;\n  } else {\n    return proxy;\n  }\n}\n\n/**\n * Creates a RequestExecutor to be used with `createTransport`.\n */\nfunction createRequestExecutor(\n  options: NodeTransportOptions,\n  httpModule: HTTPModule,\n  agent: http.Agent,\n): TransportRequestExecutor {\n  const { hostname, pathname, port, protocol, search } = new URL(options.url);\n  return function makeRequest(request: TransportRequest): Promise<TransportMakeRequestResponse> {\n    return new Promise((resolve, reject) => {\n      let body = streamFromBody(request.body);\n\n      const headers: Record<string, string> = { ...options.headers };\n\n      if (request.body.length > GZIP_THRESHOLD) {\n        headers['content-encoding'] = 'gzip';\n        body = body.pipe(createGzip());\n      }\n\n      const req = httpModule.request(\n        {\n          method: 'POST',\n          agent,\n          headers,\n          hostname,\n          path: `${pathname}${search}`,\n          port,\n          protocol,\n          ca: options.caCerts,\n        },\n        res => {\n          res.on('data', () => {\n            // Drain socket\n          });\n\n          res.on('end', () => {\n            // Drain socket\n          });\n\n          res.setEncoding('utf8');\n\n          // \"Key-value pairs of header names and values. Header names are lower-cased.\"\n          // https://nodejs.org/api/http.html#http_message_headers\n          const retryAfterHeader = res.headers['retry-after'] ?? null;\n          const rateLimitsHeader = res.headers['x-sentry-rate-limits'] ?? null;\n\n          resolve({\n            statusCode: res.statusCode,\n            headers: {\n              'retry-after': retryAfterHeader,\n              'x-sentry-rate-limits': Array.isArray(rateLimitsHeader) ? rateLimitsHeader[0] || null : rateLimitsHeader,\n            },\n          });\n        },\n      );\n\n      req.on('error', reject);\n      body.pipe(req);\n    });\n  };\n}\n","import { posix, sep } from 'node:path';\nimport { dirname } from '@sentry/utils';\n\n/** normalizes Windows paths */\nfunction normalizeWindowsPath(path: string): string {\n  return path\n    .replace(/^[A-Z]:/, '') // remove Windows-style prefix\n    .replace(/\\\\/g, '/'); // replace all `\\` instances with `/`\n}\n\n/** Creates a function that gets the module name from a filename */\nexport function createGetModuleFromFilename(\n  basePath: string = process.argv[1] ? dirname(process.argv[1]) : process.cwd(),\n  isWindows: boolean = sep === '\\\\',\n): (filename: string | undefined) => string | undefined {\n  const normalizedBase = isWindows ? normalizeWindowsPath(basePath) : basePath;\n\n  return (filename: string | undefined) => {\n    if (!filename) {\n      return;\n    }\n\n    const normalizedFilename = isWindows ? normalizeWindowsPath(filename) : filename;\n\n    // eslint-disable-next-line prefer-const\n    let { dir, base: file, ext } = posix.parse(normalizedFilename);\n\n    if (ext === '.js' || ext === '.mjs' || ext === '.cjs') {\n      file = file.slice(0, ext.length * -1);\n    }\n\n    if (!dir) {\n      // No dirname whatsoever\n      dir = '.';\n    }\n\n    const n = dir.lastIndexOf('/node_modules');\n    if (n > -1) {\n      return `${dir.slice(n + 14).replace(/\\//g, '.')}:${file}`;\n    }\n\n    // Let's see if it's a part of the main module\n    // To be a part of main module, it has to share the same base\n    if (dir.startsWith(normalizedBase)) {\n      let moduleName = dir.slice(normalizedBase.length + 1).replace(/\\//g, '.');\n\n      if (moduleName) {\n        moduleName += ':';\n      }\n      moduleName += file;\n\n      return moduleName;\n    }\n\n    return file;\n  };\n}\n","// PUBLIC APIS\n\nimport type { StackParser } from '@sentry/types';\nimport { GLOBAL_OBJ, createStackParser, nodeStackLineParser } from '@sentry/utils';\nimport { createGetModuleFromFilename } from '../utils/module';\n\n/**\n * Returns a release dynamically from environment variables.\n */\n// eslint-disable-next-line complexity\nexport function getSentryRelease(fallback?: string): string | undefined {\n  // Always read first as Sentry takes this as precedence\n  if (process.env.SENTRY_RELEASE) {\n    return process.env.SENTRY_RELEASE;\n  }\n\n  // This supports the variable that sentry-webpack-plugin injects\n  if (GLOBAL_OBJ.SENTRY_RELEASE && GLOBAL_OBJ.SENTRY_RELEASE.id) {\n    return GLOBAL_OBJ.SENTRY_RELEASE.id;\n  }\n\n  // This list is in approximate alpha order, separated into 3 categories:\n  // 1. Git providers\n  // 2. CI providers with specific environment variables (has the provider name in the variable name)\n  // 3. CI providers with generic environment variables (checked for last to prevent possible false positives)\n\n  const possibleReleaseNameOfGitProvider =\n    // GitHub Actions - https://help.github.com/en/actions/configuring-and-managing-workflows/using-environment-variables#default-environment-variables\n    process.env['GITHUB_SHA'] ||\n    // GitLab CI - https://docs.gitlab.com/ee/ci/variables/predefined_variables.html\n    process.env['CI_MERGE_REQUEST_SOURCE_BRANCH_SHA'] ||\n    process.env['CI_BUILD_REF'] ||\n    process.env['CI_COMMIT_SHA'] ||\n    // Bitbucket - https://support.atlassian.com/bitbucket-cloud/docs/variables-and-secrets/\n    process.env['BITBUCKET_COMMIT'];\n\n  const possibleReleaseNameOfCiProvidersWithSpecificEnvVar =\n    // AppVeyor - https://www.appveyor.com/docs/environment-variables/\n    process.env['APPVEYOR_PULL_REQUEST_HEAD_COMMIT'] ||\n    process.env['APPVEYOR_REPO_COMMIT'] ||\n    // AWS CodeBuild - https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-env-vars.html\n    process.env['CODEBUILD_RESOLVED_SOURCE_VERSION'] ||\n    // AWS Amplify - https://docs.aws.amazon.com/amplify/latest/userguide/environment-variables.html\n    process.env['AWS_COMMIT_ID'] ||\n    // Azure Pipelines - https://docs.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&tabs=yaml\n    process.env['BUILD_SOURCEVERSION'] ||\n    // Bitrise - https://devcenter.bitrise.io/builds/available-environment-variables/\n    process.env['GIT_CLONE_COMMIT_HASH'] ||\n    // Buddy CI - https://buddy.works/docs/pipelines/environment-variables#default-environment-variables\n    process.env['BUDDY_EXECUTION_REVISION'] ||\n    // Builtkite - https://buildkite.com/docs/pipelines/environment-variables\n    process.env['BUILDKITE_COMMIT'] ||\n    // CircleCI - https://circleci.com/docs/variables/\n    process.env['CIRCLE_SHA1'] ||\n    // Cirrus CI - https://cirrus-ci.org/guide/writing-tasks/#environment-variables\n    process.env['CIRRUS_CHANGE_IN_REPO'] ||\n    // Codefresh - https://codefresh.io/docs/docs/codefresh-yaml/variables/\n    process.env['CF_REVISION'] ||\n    // Codemagic - https://docs.codemagic.io/yaml-basic-configuration/environment-variables/\n    process.env['CM_COMMIT'] ||\n    // Cloudflare Pages - https://developers.cloudflare.com/pages/platform/build-configuration/#environment-variables\n    process.env['CF_PAGES_COMMIT_SHA'] ||\n    // Drone - https://docs.drone.io/pipeline/environment/reference/\n    process.env['DRONE_COMMIT_SHA'] ||\n    // Flightcontrol - https://www.flightcontrol.dev/docs/guides/flightcontrol/environment-variables#built-in-environment-variables\n    process.env['FC_GIT_COMMIT_SHA'] ||\n    // Heroku #1 https://devcenter.heroku.com/articles/heroku-ci\n    process.env['HEROKU_TEST_RUN_COMMIT_VERSION'] ||\n    // Heroku #2 https://docs.sentry.io/product/integrations/deployment/heroku/#configure-releases\n    process.env['HEROKU_SLUG_COMMIT'] ||\n    // Render - https://render.com/docs/environment-variables\n    process.env['RENDER_GIT_COMMIT'] ||\n    // Semaphore CI - https://docs.semaphoreci.com/ci-cd-environment/environment-variables\n    process.env['SEMAPHORE_GIT_SHA'] ||\n    // TravisCI - https://docs.travis-ci.com/user/environment-variables/#default-environment-variables\n    process.env['TRAVIS_PULL_REQUEST_SHA'] ||\n    // Vercel - https://vercel.com/docs/v2/build-step#system-environment-variables\n    process.env['VERCEL_GIT_COMMIT_SHA'] ||\n    process.env['VERCEL_GITHUB_COMMIT_SHA'] ||\n    process.env['VERCEL_GITLAB_COMMIT_SHA'] ||\n    process.env['VERCEL_BITBUCKET_COMMIT_SHA'] ||\n    // Zeit (now known as Vercel)\n    process.env['ZEIT_GITHUB_COMMIT_SHA'] ||\n    process.env['ZEIT_GITLAB_COMMIT_SHA'] ||\n    process.env['ZEIT_BITBUCKET_COMMIT_SHA'];\n\n  const possibleReleaseNameOfCiProvidersWithGenericEnvVar =\n    // CloudBees CodeShip - https://docs.cloudbees.com/docs/cloudbees-codeship/latest/pro-builds-and-configuration/environment-variables\n    process.env['CI_COMMIT_ID'] ||\n    // Coolify - https://coolify.io/docs/knowledge-base/environment-variables\n    process.env['SOURCE_COMMIT'] ||\n    // Heroku #3 https://devcenter.heroku.com/changelog-items/630\n    process.env['SOURCE_VERSION'] ||\n    // Jenkins - https://plugins.jenkins.io/git/#environment-variables\n    process.env['GIT_COMMIT'] ||\n    // Netlify - https://docs.netlify.com/configure-builds/environment-variables/#build-metadata\n    process.env['COMMIT_REF'] ||\n    // TeamCity - https://www.jetbrains.com/help/teamcity/predefined-build-parameters.html\n    process.env['BUILD_VCS_NUMBER'] ||\n    // Woodpecker CI - https://woodpecker-ci.org/docs/usage/environment\n    process.env['CI_COMMIT_SHA'];\n\n  return (\n    possibleReleaseNameOfGitProvider ||\n    possibleReleaseNameOfCiProvidersWithSpecificEnvVar ||\n    possibleReleaseNameOfCiProvidersWithGenericEnvVar ||\n    fallback\n  );\n}\n\n/** Node.js stack parser */\nexport const defaultStackParser: StackParser = createStackParser(nodeStackLineParser(createGetModuleFromFilename()));\n","import * as os from 'node:os';\nimport type { Tracer } from '@opentelemetry/api';\nimport { trace } from '@opentelemetry/api';\nimport type { BasicTracerProvider } from '@opentelemetry/sdk-trace-base';\nimport type { ServerRuntimeClientOptions } from '@sentry/core';\nimport { SDK_VERSION, ServerRuntimeClient, applySdkMetadata } from '@sentry/core';\nimport { logger } from '@sentry/utils';\nimport { isMainThread, threadId } from 'worker_threads';\nimport { DEBUG_BUILD } from '../debug-build';\nimport type { NodeClientOptions } from '../types';\n\nconst DEFAULT_CLIENT_REPORT_FLUSH_INTERVAL_MS = 60_000; // 60s was chosen arbitrarily\n\n/** A client for using Sentry with Node & OpenTelemetry. */\nexport class NodeClient extends ServerRuntimeClient<NodeClientOptions> {\n  public traceProvider: BasicTracerProvider | undefined;\n  private _tracer: Tracer | undefined;\n  private _clientReportInterval: NodeJS.Timeout | undefined;\n  private _clientReportOnExitFlushListener: (() => void) | undefined;\n\n  public constructor(options: NodeClientOptions) {\n    const clientOptions: ServerRuntimeClientOptions = {\n      ...options,\n      platform: 'node',\n      runtime: { name: 'node', version: global.process.version },\n      serverName: options.serverName || global.process.env.SENTRY_NAME || os.hostname(),\n    };\n\n    applySdkMetadata(clientOptions, 'node');\n\n    logger.log(\n      `Initializing Sentry: process: ${process.pid}, thread: ${isMainThread ? 'main' : `worker-${threadId}`}.`,\n    );\n\n    super(clientOptions);\n  }\n\n  /** Get the OTEL tracer. */\n  public get tracer(): Tracer {\n    if (this._tracer) {\n      return this._tracer;\n    }\n\n    const name = '@sentry/node';\n    const version = SDK_VERSION;\n    const tracer = trace.getTracer(name, version);\n    this._tracer = tracer;\n\n    return tracer;\n  }\n\n  // Eslint ignore explanation: This is already documented in super.\n  // eslint-disable-next-line jsdoc/require-jsdoc\n  public async flush(timeout?: number): Promise<boolean> {\n    const provider = this.traceProvider;\n    const spanProcessor = provider?.activeSpanProcessor;\n\n    if (spanProcessor) {\n      await spanProcessor.forceFlush();\n    }\n\n    if (this.getOptions().sendClientReports) {\n      this._flushOutcomes();\n    }\n\n    return super.flush(timeout);\n  }\n\n  // Eslint ignore explanation: This is already documented in super.\n  // eslint-disable-next-line jsdoc/require-jsdoc\n  public close(timeout?: number | undefined): PromiseLike<boolean> {\n    if (this._clientReportInterval) {\n      clearInterval(this._clientReportInterval);\n    }\n\n    if (this._clientReportOnExitFlushListener) {\n      process.off('beforeExit', this._clientReportOnExitFlushListener);\n    }\n\n    return super.close(timeout);\n  }\n\n  /**\n   * Will start tracking client reports for this client.\n   *\n   * NOTICE: This method will create an interval that is periodically called and attach a `process.on('beforeExit')`\n   * hook. To clean up these resources, call `.close()` when you no longer intend to use the client. Not doing so will\n   * result in a memory leak.\n   */\n  // The reason client reports need to be manually activated with this method instead of just enabling them in a\n  // constructor, is that if users periodically and unboundedly create new clients, we will create more and more\n  // intervals and beforeExit listeners, thus leaking memory. In these situations, users are required to call\n  // `client.close()` in order to dispose of the acquired resources.\n  // We assume that calling this method in Sentry.init() is a sensible default, because calling Sentry.init() over and\n  // over again would also result in memory leaks.\n  // Note: We have experimented with using `FinalizationRegisty` to clear the interval when the client is garbage\n  // collected, but it did not work, because the cleanup function never got called.\n  public startClientReportTracking(): void {\n    const clientOptions = this.getOptions();\n    if (clientOptions.sendClientReports) {\n      this._clientReportOnExitFlushListener = () => {\n        this._flushOutcomes();\n      };\n\n      this._clientReportInterval = setInterval(\n        () => {\n          DEBUG_BUILD && logger.log('Flushing client reports based on interval.');\n          this._flushOutcomes();\n        },\n        clientOptions.clientReportFlushInterval ?? DEFAULT_CLIENT_REPORT_FLUSH_INTERVAL_MS,\n      )\n        // Unref is critical for not preventing the process from exiting because the interval is active.\n        .unref();\n\n      process.on('beforeExit', this._clientReportOnExitFlushListener);\n    }\n  }\n}\n","import {\n  endSession,\n  functionToStringIntegration,\n  getClient,\n  getCurrentScope,\n  getIntegrationsToSetup,\n  getIsolationScope,\n  hasTracingEnabled,\n  inboundFiltersIntegration,\n  linkedErrorsIntegration,\n  requestDataIntegration,\n  startSession,\n} from '@sentry/core';\nimport {\n  enhanceDscWithOpenTelemetryRootSpanName,\n  openTelemetrySetupCheck,\n  setOpenTelemetryContextAsyncContextStrategy,\n  setupEventContextTrace,\n} from '@sentry/opentelemetry';\nimport type { Client, Integration, Options } from '@sentry/types';\nimport {\n  consoleSandbox,\n  dropUndefinedKeys,\n  logger,\n  propagationContextFromHeaders,\n  stackParserFromStackParserOptions,\n} from '@sentry/utils';\nimport { DEBUG_BUILD } from '../debug-build';\nimport { consoleIntegration } from '../integrations/console';\nimport { nodeContextIntegration } from '../integrations/context';\nimport { contextLinesIntegration } from '../integrations/contextlines';\n\nimport { httpIntegration } from '../integrations/http';\nimport { localVariablesIntegration } from '../integrations/local-variables';\nimport { modulesIntegration } from '../integrations/modules';\nimport { nativeNodeFetchIntegration } from '../integrations/node-fetch';\nimport { onUncaughtExceptionIntegration } from '../integrations/onuncaughtexception';\nimport { onUnhandledRejectionIntegration } from '../integrations/onunhandledrejection';\nimport { spotlightIntegration } from '../integrations/spotlight';\nimport { getAutoPerformanceIntegrations } from '../integrations/tracing';\nimport { makeNodeTransport } from '../transports';\nimport type { NodeClientOptions, NodeOptions } from '../types';\nimport { isCjs } from '../utils/commonjs';\nimport { defaultStackParser, getSentryRelease } from './api';\nimport { NodeClient } from './client';\nimport { initOpenTelemetry, maybeInitializeEsmLoader } from './initOtel';\n\nfunction getCjsOnlyIntegrations(): Integration[] {\n  return isCjs() ? [modulesIntegration()] : [];\n}\n\n/**\n * Get default integrations, excluding performance.\n */\nexport function getDefaultIntegrationsWithoutPerformance(): Integration[] {\n  return [\n    // Common\n    inboundFiltersIntegration(),\n    functionToStringIntegration(),\n    linkedErrorsIntegration(),\n    requestDataIntegration(),\n    // Native Wrappers\n    consoleIntegration(),\n    httpIntegration(),\n    nativeNodeFetchIntegration(),\n    // Global Handlers\n    onUncaughtExceptionIntegration(),\n    onUnhandledRejectionIntegration(),\n    // Event Info\n    contextLinesIntegration(),\n    localVariablesIntegration(),\n    nodeContextIntegration(),\n    ...getCjsOnlyIntegrations(),\n  ];\n}\n\n/** Get the default integrations for the Node SDK. */\nexport function getDefaultIntegrations(options: Options): Integration[] {\n  return [\n    ...getDefaultIntegrationsWithoutPerformance(),\n    // We only add performance integrations if tracing is enabled\n    // Note that this means that without tracing enabled, e.g. `expressIntegration()` will not be added\n    // This means that generally request isolation will work (because that is done by httpIntegration)\n    // But `transactionName` will not be set automatically\n    ...(shouldAddPerformanceIntegrations(options) ? getAutoPerformanceIntegrations() : []),\n  ];\n}\n\nfunction shouldAddPerformanceIntegrations(options: Options): boolean {\n  if (!hasTracingEnabled(options)) {\n    return false;\n  }\n\n  // We want to ensure `tracesSampleRate` is not just undefined/null here\n  // eslint-disable-next-line deprecation/deprecation\n  return options.enableTracing || options.tracesSampleRate != null || 'tracesSampler' in options;\n}\n\n/**\n * Initialize Sentry for Node.\n */\nexport function init(options: NodeOptions | undefined = {}): NodeClient | undefined {\n  return _init(options, getDefaultIntegrations);\n}\n\n/**\n * Initialize Sentry for Node, without any integrations added by default.\n */\nexport function initWithoutDefaultIntegrations(options: NodeOptions | undefined = {}): NodeClient {\n  return _init(options, () => []);\n}\n\n/**\n * Initialize Sentry for Node, without performance instrumentation.\n */\nfunction _init(\n  _options: NodeOptions | undefined = {},\n  getDefaultIntegrationsImpl: (options: Options) => Integration[],\n): NodeClient {\n  const options = getClientOptions(_options, getDefaultIntegrationsImpl);\n\n  if (options.debug === true) {\n    if (DEBUG_BUILD) {\n      logger.enable();\n    } else {\n      // use `console.warn` rather than `logger.warn` since by non-debug bundles have all `logger.x` statements stripped\n      consoleSandbox(() => {\n        // eslint-disable-next-line no-console\n        console.warn('[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.');\n      });\n    }\n  }\n\n  if (!isCjs() && options.registerEsmLoaderHooks !== false) {\n    maybeInitializeEsmLoader(options.registerEsmLoaderHooks === true ? undefined : options.registerEsmLoaderHooks);\n  }\n\n  setOpenTelemetryContextAsyncContextStrategy();\n\n  const scope = getCurrentScope();\n  scope.update(options.initialScope);\n\n  const client = new NodeClient(options);\n  // The client is on the current scope, from where it generally is inherited\n  getCurrentScope().setClient(client);\n\n  if (isEnabled(client)) {\n    client.init();\n  }\n\n  logger.log(`Running in ${isCjs() ? 'CommonJS' : 'ESM'} mode.`);\n\n  if (options.autoSessionTracking) {\n    startSessionTracking();\n  }\n\n  client.startClientReportTracking();\n\n  updateScopeFromEnvVariables();\n\n  if (options.spotlight) {\n    // force integrations to be setup even if no DSN was set\n    // If they have already been added before, they will be ignored anyhow\n    const integrations = client.getOptions().integrations;\n    for (const integration of integrations) {\n      client.addIntegration(integration);\n    }\n    client.addIntegration(\n      spotlightIntegration({\n        sidecarUrl: typeof options.spotlight === 'string' ? options.spotlight : undefined,\n      }),\n    );\n  }\n\n  // If users opt-out of this, they _have_ to set up OpenTelemetry themselves\n  // There is no way to use this SDK without OpenTelemetry!\n  if (!options.skipOpenTelemetrySetup) {\n    initOpenTelemetry(client);\n    validateOpenTelemetrySetup();\n  }\n\n  enhanceDscWithOpenTelemetryRootSpanName(client);\n  setupEventContextTrace(client);\n\n  return client;\n}\n\n/**\n * Validate that your OpenTelemetry setup is correct.\n */\nexport function validateOpenTelemetrySetup(): void {\n  if (!DEBUG_BUILD) {\n    return;\n  }\n\n  const setup = openTelemetrySetupCheck();\n\n  const required = ['SentrySpanProcessor', 'SentryContextManager', 'SentryPropagator'] as const;\n  for (const k of required) {\n    if (!setup.includes(k)) {\n      logger.error(\n        `You have to set up the ${k}. Without this, the OpenTelemetry & Sentry integration will not work properly.`,\n      );\n    }\n  }\n\n  if (!setup.includes('SentrySampler')) {\n    logger.warn(\n      'You have to set up the SentrySampler. Without this, the OpenTelemetry & Sentry integration may still work, but sample rates set for the Sentry SDK will not be respected.',\n    );\n  }\n}\n\nfunction getClientOptions(\n  options: NodeOptions,\n  getDefaultIntegrationsImpl: (options: Options) => Integration[],\n): NodeClientOptions {\n  const release = getRelease(options.release);\n\n  const autoSessionTracking =\n    typeof release !== 'string'\n      ? false\n      : options.autoSessionTracking === undefined\n        ? true\n        : options.autoSessionTracking;\n\n  const tracesSampleRate = getTracesSampleRate(options.tracesSampleRate);\n\n  const baseOptions = dropUndefinedKeys({\n    transport: makeNodeTransport,\n    dsn: process.env.SENTRY_DSN,\n    environment: process.env.SENTRY_ENVIRONMENT,\n    sendClientReports: true,\n  });\n\n  const overwriteOptions = dropUndefinedKeys({\n    release,\n    autoSessionTracking,\n    tracesSampleRate,\n  });\n\n  const mergedOptions = {\n    ...baseOptions,\n    ...options,\n    ...overwriteOptions,\n  };\n\n  if (options.defaultIntegrations === undefined) {\n    options.defaultIntegrations = getDefaultIntegrationsImpl(mergedOptions);\n  }\n\n  const clientOptions: NodeClientOptions = {\n    ...mergedOptions,\n    stackParser: stackParserFromStackParserOptions(options.stackParser || defaultStackParser),\n    integrations: getIntegrationsToSetup({\n      defaultIntegrations: options.defaultIntegrations,\n      integrations: options.integrations,\n    }),\n  };\n\n  return clientOptions;\n}\n\nfunction getRelease(release: NodeOptions['release']): string | undefined {\n  if (release !== undefined) {\n    return release;\n  }\n\n  const detectedRelease = getSentryRelease();\n  if (detectedRelease !== undefined) {\n    return detectedRelease;\n  }\n\n  return undefined;\n}\n\nfunction getTracesSampleRate(tracesSampleRate: NodeOptions['tracesSampleRate']): number | undefined {\n  if (tracesSampleRate !== undefined) {\n    return tracesSampleRate;\n  }\n\n  const sampleRateFromEnv = process.env.SENTRY_TRACES_SAMPLE_RATE;\n  if (!sampleRateFromEnv) {\n    return undefined;\n  }\n\n  const parsed = parseFloat(sampleRateFromEnv);\n  return isFinite(parsed) ? parsed : undefined;\n}\n\n/**\n * Update scope and propagation context based on environmental variables.\n *\n * See https://github.com/getsentry/rfcs/blob/main/text/0071-continue-trace-over-process-boundaries.md\n * for more details.\n */\nfunction updateScopeFromEnvVariables(): void {\n  const sentryUseEnvironment = (process.env.SENTRY_USE_ENVIRONMENT || '').toLowerCase();\n  if (!['false', 'n', 'no', 'off', '0'].includes(sentryUseEnvironment)) {\n    const sentryTraceEnv = process.env.SENTRY_TRACE;\n    const baggageEnv = process.env.SENTRY_BAGGAGE;\n    const propagationContext = propagationContextFromHeaders(sentryTraceEnv, baggageEnv);\n    getCurrentScope().setPropagationContext(propagationContext);\n  }\n}\n\n/**\n * Enable automatic Session Tracking for the node process.\n */\nfunction startSessionTracking(): void {\n  const client = getClient<NodeClient>();\n  if (client && client.getOptions().autoSessionTracking) {\n    client.initSessionFlusher();\n  }\n\n  startSession();\n\n  // Emitted in the case of healthy sessions, error of `mechanism.handled: true` and unhandledrejections because\n  // The 'beforeExit' event is not emitted for conditions causing explicit termination,\n  // such as calling process.exit() or uncaught exceptions.\n  // Ref: https://nodejs.org/api/process.html#process_event_beforeexit\n  process.on('beforeExit', () => {\n    const session = getIsolationScope().getSession();\n\n    // Only call endSession, if the Session exists on Scope and SessionStatus is not a\n    // Terminal Status i.e. Exited or Crashed because\n    // \"When a session is moved away from ok it must not be updated anymore.\"\n    // Ref: https://develop.sentry.dev/sdk/sessions/\n    if (session && session.status !== 'ok') {\n      endSession();\n    }\n  });\n}\n\nfunction isEnabled(client: Client): boolean {\n  return client.getOptions().enabled !== false && client.getTransport() !== undefined;\n}\n","import { stdin } from 'node:process';\nimport React from 'react';\nimport { isType } from 'variant';\nimport { createFsCache, CacheState } from '@wix/cli-fs-cache';\nimport { render, renderSync } from '@wix/cli-ui-kit';\nimport { I18nProvider } from '@wix/cli-i18n';\nimport { UserFeedbackForm } from './components/UserFeedback/Form.js';\nimport { UserFeedbackFallback } from './components/UserFeedback/Fallback.js';\nimport { ReportErrorResult } from './error-reporter.js';\nimport type { ErrorReporter } from './error-reporter.js';\nimport messages from './messages.json';\n\ninterface Options {\n  cachePath: string | undefined;\n  errorReporter: ErrorReporter;\n  reportResult: ReportErrorResult;\n}\n\nexport async function collectUserFeedback({\n  cachePath,\n  reportResult,\n  errorReporter,\n}: Options) {\n  if (\n    !stdin.isTTY ||\n    !cachePath ||\n    !isType(reportResult, ReportErrorResult.Reported)\n  ) {\n    return;\n  }\n\n  const fsCache = createFsCache({\n    filePath: cachePath,\n    ttlInHours: 1,\n  });\n  const cacheState = await fsCache.get();\n\n  if (isType(cacheState, CacheState.Exists)) {\n    return;\n  }\n\n  const user = errorReporter.getUser();\n\n  if (user) {\n    await render(\n      <I18nProvider messages={messages}>\n        <UserFeedbackForm\n          onSubmit={({ feedback }) => {\n            void errorReporter.reportUserFeedback({\n              userId: user.id,\n              eventId: reportResult.eventId,\n              feedback,\n            });\n          }}\n        />\n      </I18nProvider>\n    );\n  } else {\n    renderSync(\n      <I18nProvider messages={messages}>\n        <UserFeedbackFallback />\n      </I18nProvider>\n    );\n  }\n\n  await fsCache.set({ reported: true });\n}\n","import { writeJson, readJson, pathExists } from '@wix/cli-fs';\nimport { CliError, CliErrorCode } from '@wix/cli-error';\nimport { getTestOverrides } from '@wix/cli-test-overrides';\nimport { join } from 'node:path';\nimport type { VariantOf } from 'variant';\nimport { fields, variant } from 'variant';\nimport { z } from 'zod';\n\nexport const CacheState = variant({\n  Exists: fields<{ data: unknown }>(),\n  NotExists: {},\n});\n\nexport type CacheState = VariantOf<typeof CacheState>;\n\nconst CacheData = z.object({\n  data: z.unknown(),\n  createdAt: z.number(),\n});\n\ntype CacheData = z.infer<typeof CacheData>;\n\ninterface CliCacheOptions {\n  filePath: string;\n  ttlInHours?: number;\n}\n\nconst isFileExpired = (createdAt: number, ttlInHours: number) => {\n  return Date.now() - createdAt.valueOf() > ttlInHours * 60 * 60 * 1000;\n};\n\nexport function getFsCacheFilePath(dirPath: string, fileName: string) {\n  const testOverrides = getTestOverrides();\n\n  if (testOverrides.fsCacheDir) {\n    return join(testOverrides.fsCacheDir, fileName);\n  }\n\n  return join(dirPath, fileName);\n}\n\nexport function createFsCache({\n  filePath,\n  ttlInHours = 24 * 7,\n}: CliCacheOptions) {\n  const get = async (): Promise<CacheState> => {\n    try {\n      const isCacheExists = await pathExists(filePath);\n\n      if (isCacheExists) {\n        const cacheData = CacheData.parse(await readJson(filePath));\n\n        if (!isFileExpired(cacheData.createdAt, ttlInHours)) {\n          return CacheState.Exists({ data: cacheData.data });\n        }\n      }\n\n      return CacheState.NotExists();\n    } catch (e) {\n      throw new CliError({\n        code: CliErrorCode.FailedToReadCache({ path: filePath }),\n        cause: e,\n      });\n    }\n  };\n\n  const set = async (data: unknown): Promise<CacheState> => {\n    try {\n      await writeJson(filePath, {\n        data,\n        createdAt: Date.now(),\n      });\n      return CacheState.Exists({ data });\n    } catch (e) {\n      throw new CliError({\n        code: CliErrorCode.FailedToWriteCache({ path: filePath }),\n        cause: e,\n      });\n    }\n  };\n\n  return {\n    get,\n    set,\n  };\n}\n","import React, { useState, useCallback } from 'react';\nimport type { FC } from 'react';\nimport { useTranslation } from '@wix/cli-i18n';\nimport { Text, ConfirmInput, TextInput, Box } from '@wix/cli-ui-kit';\nimport { ContactUs } from './ContactUs.js';\n\ninterface Props {\n  onSubmit: ({ feedback }: { feedback: string }) => void;\n}\n\nexport const UserFeedbackForm: FC<Props> = ({ onSubmit }) => {\n  const { t } = useTranslation();\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [consent, setConsent] = useState<boolean>();\n\n  const handleConsentSubmit = useCallback((value: boolean) => {\n    setConsent(value);\n    if (!value) setIsSubmitted(true);\n  }, []);\n\n  const handleSubmit = useCallback(\n    (feedback: string) => {\n      setIsSubmitted(true);\n      onSubmit({ feedback });\n    },\n    [onSubmit]\n  );\n\n  return (\n    <>\n      <Box flexDirection=\"column\" marginTop={1} marginBottom={1}>\n        <Text>{t('user_feedback.title')}</Text>\n        <Text skin=\"secondary\">{t('user_feedback.subtitle')}</Text>\n      </Box>\n      <ConfirmInput\n        label={t('user_feedback.consent.label')}\n        onSubmit={handleConsentSubmit}\n      />\n      {consent === true && (\n        <TextInput\n          label={t('user_feedback.comments.label')}\n          onSubmit={handleSubmit}\n        />\n      )}\n      {isSubmitted && (\n        <Box flexDirection=\"column\" marginTop={1}>\n          <Text>\n            {consent\n              ? t('user_feedback.submitted')\n              : t('user_feedback.declined')}\n          </Text>\n          <ContactUs />\n        </Box>\n      )}\n    </>\n  );\n};\n","import React from 'react';\nimport type { FC } from 'react';\nimport { Trans } from '@wix/cli-i18n';\nimport { Link } from '@wix/cli-ui-kit';\n\nexport const ContactUs: FC = () => (\n  <Trans\n    i18nKey=\"user_feedback.contact_us\"\n    components={[<Link url=\"https://discord.gg/devs-on-wix\" />]}\n  />\n);\n","import React from 'react';\nimport type { FC } from 'react';\nimport { Box } from '@wix/cli-ui-kit';\nimport { ContactUs } from './ContactUs.js';\n\nexport const UserFeedbackFallback: FC = () => {\n  return (\n    <Box flexDirection=\"column\" marginTop={1}>\n      <ContactUs />\n    </Box>\n  );\n};\n","{\n  \"user_feedback.title\": \"Your experience matters to us. Would you like to submit feedback regarding this incident?\",\n  \"user_feedback.subtitle\": \"We may contact you by email in case we need more details.\",\n  \"user_feedback.consent.label\": \"Submit feedback?\",\n  \"user_feedback.comments.label\": \"Feedback (optional)\",\n  \"user_feedback.submitted\": \"Thank you for your cooperation in helping us resolve this issue promptly.\",\n  \"user_feedback.declined\": \"Thank you for your feedback.\",\n  \"user_feedback.contact_us\": \"Reach us in Discord in case you have more questions: <0 />\"\n}\n","import React, { createContext, useContext } from 'react';\nimport type { FC, ReactNode } from 'react';\nimport type { ErrorReporter } from './error-reporter.js';\n\nconst ErrorReporterContext = createContext<ErrorReporter | null>(null);\n\ninterface Props {\n  value: ErrorReporter;\n  children: ReactNode;\n}\n\nexport const ErrorReporterProvider: FC<Props> = (props) => (\n  <ErrorReporterContext.Provider {...props} />\n);\n\nexport const useErrorReporter = (): ErrorReporter => {\n  const context = useContext(ErrorReporterContext);\n  if (context === null) {\n    throw new Error(\n      'useErrorReporter() cannot be used without an <ErrorReporterProvider>'\n    );\n  }\n  return context;\n};\n","export {\n  createErrorHandler,\n  type ErrorHandlerFn,\n} from './create-error-handler.js';\nexport { ErrorViewer } from './components/ErrorViewer.js';\nexport { createErrorReporter, type ErrorReporter } from './error-reporter.js';\nexport {\n  ErrorReporterProvider,\n  useErrorReporter,\n} from './error-reporter-context.js';\n","import type { ReactNode } from 'react';\nimport React, { createContext, useContext } from 'react';\nimport type { BiLogger } from '@wix/cli-telemetry';\n\nconst BiContext = createContext<BiLogger | null>(null);\n\nexport const BiProvider = function ({\n  children,\n  value: biLogger,\n}: {\n  children: ReactNode;\n  value: BiLogger;\n}) {\n  return <BiContext.Provider value={biLogger}>{children}</BiContext.Provider>;\n};\n\nexport const useBiLogger = (): BiLogger => {\n  const context = useContext(BiContext);\n\n  if (context === null) {\n    throw new Error('useBiLogger() cannot be used without an <BiProvider>');\n  }\n\n  return context;\n};\n","export { useBiLogger, BiProvider } from './useBi.js';\n"],"mappings":";;opCAsBM,SAAUA,GAAgBC,EAAgB,CAC9C,OAAOA,EAAQ,SAASC,GAAsB,EAAI,CACpD,CAEM,SAAUC,GAAkBF,EAAgB,CAChD,OAAOA,EAAQ,YAAYC,EAAoB,CACjD,CAEM,SAAUE,GAAoBH,EAAgB,CAClD,OAAOA,EAAQ,SAASC,EAAoB,IAAM,EACpD,CAhCA,IAkBMA,GAlBNG,GAAAC,EAAA,kBAAAC,IAgBAC,IAEMN,GAAuBO,GAC3B,gDAAgD,ICnBlD,IAgBaC,GACAC,GACAC,GAGAC,GAEAC,GAEAC,GAEAC,GA3BbC,GAAAC,EAAA,kBAAAC,IAgBaT,GAA6B,IAC7BC,GAA+B,IAC/BC,GAA0B,IAG1BC,GAAiB,UAEjBC,GAA+B,IAE/BC,GAAmC,KAEnCC,GAA2B,8HCMlC,SAAUI,GAAkBC,EAAkB,CAClD,OAAOA,EAAS,OAAO,SAACC,EAAgBC,EAAe,CACrD,IAAMC,EAAQ,GAAGF,GACfA,IAAW,GAAKG,GAA0B,IACzCF,EACH,OAAOC,EAAM,OAASE,GAA2BJ,EAASE,CAC5D,EAAG,EAAE,CACP,CAEM,SAAUG,GAAYC,EAAgB,CAC1C,OAAOA,EAAQ,cAAa,EAAG,IAAI,SAACC,EAAY,KAAZC,EAAAC,GAAAF,EAAA,CAAA,EAACG,EAAGF,EAAA,CAAA,EAAEN,EAAKM,EAAA,CAAA,EACzCG,EAAW,mBAAmBD,CAAG,EAAC,IAAI,mBAAmBR,EAAM,KAAK,EAIxE,OAAIA,EAAM,WAAa,SACrBS,GAASC,GAA+BV,EAAM,SAAS,SAAQ,GAG1DS,CACT,CAAC,CACH,CAEM,SAAUE,GACdF,EAAa,CAEb,IAAMG,EAAaH,EAAM,MAAMC,EAA4B,EAC3D,GAAI,EAAAE,EAAW,QAAU,GACzB,KAAMC,EAAcD,EAAW,MAAK,EACpC,GAAKC,EACL,KAAMC,EAAiBD,EAAY,QAAQE,EAA0B,EACrE,GAAI,EAAAD,GAAkB,GACtB,KAAMN,EAAM,mBACVK,EAAY,UAAU,EAAGC,CAAc,EAAE,KAAI,CAAE,EAE3Cd,EAAQ,mBACZa,EAAY,UAAUC,EAAiB,CAAC,EAAE,KAAI,CAAE,EAE9CE,EACJ,OAAIJ,EAAW,OAAS,IACtBI,EAAWC,GACTL,EAAW,KAAKF,EAA4B,CAAC,GAG1C,CAAE,IAAGF,EAAE,MAAKR,EAAE,SAAQgB,CAAA,IAC/B,CAMM,SAAUE,GACdlB,EAAc,CAEd,OAAI,OAAOA,GAAU,UAAYA,EAAM,SAAW,EAAU,CAAA,EACrDA,EACJ,MAAMC,EAAuB,EAC7B,IAAI,SAAAQ,EAAK,CACR,OAAOE,GAAkBF,CAAK,CAChC,CAAC,EACA,OAAO,SAAAU,EAAO,CAAI,OAAAA,IAAY,QAAaA,EAAQ,MAAM,OAAS,CAAhD,CAAiD,EACnE,OAA+B,SAACC,EAASD,EAAO,CAE/C,OAAAC,EAAQD,EAAS,GAAG,EAAIA,EAAS,MAC1BC,CACT,EAAG,CAAA,CAAE,CACT,mCApFAC,IAKAC,kSCpBA,IAwCAC,GAxCAC,GAAAC,EAAA,kBAAAC,IAgBAC,IASAC,KACAC,KAMAC,KAQAP,GAAA,UAAA,CAAA,SAAAA,GAAA,CA6CA,CA5CE,OAAAA,EAAA,UAAA,OAAA,SAAOQ,EAAkBC,EAAkBC,EAAqB,CAC9D,IAAMC,EAAUC,GAAY,WAAWJ,CAAO,EAC9C,GAAI,GAACG,GAAWE,GAAoBL,CAAO,GAC3C,KAAMM,EAAWC,GAAYJ,CAAO,EACjC,OAAO,SAACK,EAAY,CACnB,OAAOA,EAAK,QAAUC,EACxB,CAAC,EACA,MAAM,EAAGC,EAA4B,EAClCC,EAAcC,GAAkBN,CAAQ,EAC1CK,EAAY,OAAS,GACvBT,EAAO,IAAID,EAASY,GAAgBF,CAAW,EAEnD,EAEAnB,EAAA,UAAA,QAAA,SAAQQ,EAAkBC,EAAkBa,EAAqB,CAC/D,IAAMH,EAAcG,EAAO,IAAIb,EAASY,EAAc,EAChDE,EAAgB,MAAM,QAAQJ,CAAW,EAC3CA,EAAY,KAAKK,EAAuB,EACxCL,EACJ,GAAI,CAACI,EAAe,OAAOf,EAC3B,IAAMG,EAAwC,CAAA,EAC9C,GAAIY,EAAc,SAAW,EAC3B,OAAOf,EAET,IAAMiB,EAAQF,EAAc,MAAMC,EAAuB,EAWzD,OAVAC,EAAM,QAAQ,SAAAC,EAAK,CACjB,IAAMC,EAAUC,GAAkBF,CAAK,EACvC,GAAIC,EAAS,CACX,IAAME,EAA6B,CAAE,MAAOF,EAAQ,KAAK,EACrDA,EAAQ,WACVE,EAAa,SAAWF,EAAQ,UAElChB,EAAQgB,EAAQ,GAAG,EAAIE,EAE3B,CAAC,EACG,OAAO,QAAQlB,CAAO,EAAE,SAAW,EAC9BH,EAEFI,GAAY,WAAWJ,EAASI,GAAY,cAAcD,CAAO,CAAC,CAC3E,EAEAX,EAAA,UAAA,OAAA,UAAA,CACE,MAAO,CAACqB,EAAc,CACxB,EACFrB,CAAA,EA7CA,ICxCA,IAwCA8B,GAxCAC,GAAAC,EAAA,kBAAAC,IAwCAH,GAAA,UAAA,CAWE,SAAAA,EAAmBI,EAAoBC,EAAqB,CAC1D,KAAK,gBAAkBA,EACvB,KAAK,aAAeD,EAAY,IAAG,EACnC,KAAK,mBAAqBC,EAAe,IAAG,CAC9C,CAMO,OAAAL,EAAA,UAAA,IAAP,UAAA,CACE,IAAMM,EAAQ,KAAK,gBAAgB,IAAG,EAAK,KAAK,mBAChD,OAAO,KAAK,aAAeA,CAC7B,EACFN,CAAA,EAzBA,ICtBM,SAAUO,GAAmBC,EAAmB,SAC9CC,EAAsB,CAAA,EAE5B,GAAI,OAAOD,GAAe,UAAYA,GAAc,KAClD,OAAOC,MAGT,QAAyBC,EAAAC,GAAA,OAAO,QAAQH,CAAU,CAAC,EAAAI,EAAAF,EAAA,KAAA,EAAA,CAAAE,EAAA,KAAAA,EAAAF,EAAA,KAAA,EAAE,CAA1C,IAAAG,EAAAC,GAAAF,EAAA,MAAA,CAAA,EAACG,EAAGF,EAAA,CAAA,EAAEG,EAAGH,EAAA,CAAA,EAClB,GAAI,CAACI,GAAeF,CAAG,EAAG,CACxBG,GAAK,KAAK,0BAA0BH,CAAK,EACzC,SAEF,GAAI,CAACI,GAAiBH,CAAG,EAAG,CAC1BE,GAAK,KAAK,wCAAwCH,CAAK,EACvD,SAEE,MAAM,QAAQC,CAAG,EACnBP,EAAIM,CAAG,EAAIC,EAAI,MAAK,EAEpBP,EAAIM,CAAG,EAAIC,oGAIf,OAAOP,CACT,CAEM,SAAUQ,GAAeF,EAAY,CACzC,OAAO,OAAOA,GAAQ,UAAYA,EAAI,OAAS,CACjD,CAEM,SAAUI,GAAiBH,EAAY,CAC3C,OAAIA,GAAO,KACF,GAGL,MAAM,QAAQA,CAAG,EACZI,GAAiCJ,CAAG,EAGtCK,GAA+BL,CAAG,CAC3C,CAEA,SAASI,GAAiCE,EAAc,SAClDC,MAEJ,QAAsBC,EAAAb,GAAAW,CAAG,EAAAG,EAAAD,EAAA,KAAA,EAAA,CAAAC,EAAA,KAAAA,EAAAD,EAAA,KAAA,EAAE,CAAtB,IAAME,EAAOD,EAAA,MAEhB,GAAIC,GAAW,KAEf,IAAI,CAACH,EAAM,CACT,GAAIF,GAA+BK,CAAO,EAAG,CAC3CH,EAAO,OAAOG,EACd,SAGF,MAAO,GAGT,GAAI,OAAOA,IAAYH,EAIvB,MAAO,sGAGT,MAAO,EACT,CAEA,SAASF,GAA+BL,EAAY,CAClD,OAAQ,OAAOA,EAAK,CAClB,IAAK,SACL,IAAK,UACL,IAAK,SACH,MAAO,GAGX,MAAO,EACT,CA/FA,UAAAW,GAAAC,EAAA,kBAAAC,IAgBAC,8kBCOM,SAAUC,IAAmB,CACjC,OAAO,SAACC,EAAa,CACnBC,GAAK,MAAMC,GAAmBF,CAAE,CAAC,CACnC,CACF,CAMA,SAASE,GAAmBF,EAAsB,CAChD,OAAI,OAAOA,GAAO,SACTA,EAEA,KAAK,UAAUG,GAAiBH,CAAE,CAAC,CAE9C,CAOA,SAASG,GAAiBH,EAAa,CAIrC,QAHMI,EAAS,CAAA,EACXC,EAAUL,EAEPK,IAAY,MACjB,OAAO,oBAAoBA,CAAO,EAAE,QAAQ,SAAAC,EAAY,CACtD,GAAI,CAAAF,EAAOE,CAAY,EACvB,KAAMC,EAAQF,EAAQC,CAAoC,EACtDC,IACFH,EAAOE,CAAY,EAAI,OAAOC,CAAK,GAEvC,CAAC,EACDF,EAAU,OAAO,eAAeA,CAAO,EAGzC,OAAOD,CACT,CA9DA,IAAAI,GAAAC,EAAA,kBAAAC,IAgBAC,MCWM,SAAUC,GAAsBC,EAAqB,CACzDC,GAAkBD,CACpB,CAMM,SAAUE,GAAmBC,EAAa,CAC9C,GAAI,CACFF,GAAgBE,CAAE,OACZ,CAAA,CACV,CAvCA,IAqBIF,GArBJG,GAAAC,EAAA,kBAAAC,IAiBAC,KAIIN,GAAkBO,GAAmB,ICrBzC,IAgBYC,GAhBZC,GAAAC,EAAA,kBAAAC,KAgBA,SAAYH,EAAmB,CAC7BA,EAAA,UAAA,aACAA,EAAA,SAAA,YACAA,EAAA,qBAAA,yBACAA,EAAA,oBAAA,wBACAA,EAAA,wBAAA,2BACAA,EAAA,aAAA,cACF,GAPYA,KAAAA,GAAmB,CAAA,EAAA,ICe/B,SAASI,GAAiBC,EAAY,CACpC,OACEC,GAAyB,QAAQD,CAAiC,EAAI,EAE1E,CAgCA,SAASE,GAAgBF,EAAY,CACnC,OACEG,GAAyB,QAAQH,CAAgC,EAAI,EAEzE,CAWA,SAASI,GAAcJ,EAAY,CACjC,OAAOK,GAAuB,QAAQL,CAA8B,EAAI,EAC1E,CAgKA,SAASM,GACPN,EACAO,EACAC,EAAuB,CAEvB,GAAI,SAAOA,EAAOR,CAAG,EAAM,KAI3B,KAAMS,EAAQ,OAAOD,EAAOR,CAAG,CAAC,EAEhCO,EAAYP,CAAG,EAAIS,EAAM,YAAW,IAAO,OAC7C,CAUA,SAASC,GACPC,EACAJ,EACAC,EACAI,EACAC,EAAc,CAEd,GAHAD,IAAA,SAAAA,EAAA,MACAC,IAAA,SAAAA,EAAA,KAEI,OAAOL,EAAOG,CAAI,EAAM,IAAa,CACvC,IAAMF,EAAQ,OAAOD,EAAOG,CAAI,CAAW,EACtC,MAAMF,CAAK,IACVA,EAAQG,EACVL,EAAYI,CAAI,EAAIC,EACXH,EAAQI,EACjBN,EAAYI,CAAI,EAAIE,EAEpBN,EAAYI,CAAI,EAAIF,GAI5B,CASA,SAASK,GACPH,EACAI,EACAC,EACAC,EAAkC,CAAlCA,IAAA,SAAAA,EAAAC,IAEA,IAAMC,EAAaH,EAAML,CAAI,EACzB,OAAOQ,GAAe,WACxBJ,EAAOJ,CAAI,EAAIQ,EAAW,MAAMF,CAAS,EAAE,IAAI,SAAAG,EAAC,CAAI,OAAAA,EAAE,KAAI,CAAN,CAAQ,EAEhE,CAmBA,SAASC,GACPrB,EACAO,EACAC,EAAuB,CAEvB,IAAMC,EAAQD,EAAOR,CAAG,EACxB,GAAI,OAAOS,GAAU,SAAU,CAC7B,IAAMa,EAAWC,GAAYd,EAAM,YAAW,CAAE,EAC5Ca,GAAY,OACdf,EAAYP,CAAG,EAAIsB,GAGzB,CAMM,SAAUE,GAAiBhB,EAAuB,CACtD,IAAMD,EAA2B,CAAA,EAEjC,QAAWkB,KAAOC,GAAqB,CACrC,IAAM1B,EAAMyB,EAEZ,OAAQzB,EAAK,CACX,IAAK,iBACHqB,GAAmBrB,EAAKO,EAAaC,CAAM,EAC3C,MAEF,QACE,GAAIT,GAAiBC,CAAG,EACtBM,GAAaN,EAAKO,EAAaC,CAAM,UAC5BN,GAAgBF,CAAG,EAC5BU,GAAYV,EAAKO,EAAaC,CAAM,UAC3BJ,GAAcJ,CAAG,EAC1Bc,GAAgBd,EAAKO,EAAaC,CAAM,MACnC,CACL,IAAMC,EAAQD,EAAOR,CAAG,EACpB,OAAOS,EAAU,KAAeA,IAAU,OAC5CF,EAAYP,CAAG,EAAI,OAAOS,CAAK,KAMzC,OAAOF,CACT,CAjXA,IAmBMW,GAMAjB,GAYAE,GAoCAE,GAyEOsB,GAEAC,GAEAC,GACAC,GAKAJ,GAuJPH,GAnTNQ,GAAAC,EAAA,kBAAAC,IAgBAC,IACAC,KAEMjB,GAAyB,IAMzBjB,GAA2B,CAAC,mBAAmB,EAY/CE,GAA2B,CAC/B,0BACA,iCACA,0BACA,0BACA,2BACA,kCACA,2BACA,2BACA,oCACA,6BACA,yCACA,kCACA,8CACA,uCACA,8BACA,6BACA,4CACA,2CACA,6BACA,oCACA,qCACA,kCACA,mCAaIE,GAAyB,CAC7B,wBACA,oBAuEWsB,GAAuC,IAEvCC,GAAgC,IAEhCC,GAA+C,IAC/CC,GAA8C,IAK9CJ,GAA6C,CACxD,kBAAmB,GACnB,eAAgB,GAChB,8BAA+B,GAC/B,2BAA4B,GAC5B,SAAU,GACV,wBAAyB,GACzB,UAAW,GACX,wBAAyB,IACzB,+BAAgC,IAChC,wBAAyB,KACzB,wBAAyB,IACzB,yBAA0B,IAC1B,gCAAiC,IACjC,yBAA0B,KAC1B,yBAA0B,IAC1B,gCAAiC,GACjC,gCAAiC,KACjC,8BAA+B,GAC/B,8BAA+B,GAC/B,0BAA2B,GAC3B,4BAA6B,GAC7B,mCAAoC,GACpC,oCAAqC,GACrC,iCAAkC,GAClC,2BAA4B,GAC5B,kCAAmC,GACnC,mCAAoC,GACpC,gCAAiC,GACjC,2BAA4B,IAC5B,kCAAmC,IACnC,mCAAoC,IACpC,gCAAiC,IACjC,8BAA+B,qCAC/B,eAAgBU,GAAa,KAC7B,sBAAuB,CAAA,EACvB,iBAAkB,CAAC,eAAgB,SAAS,EAC5C,yBAA0B,GAC1B,kBAAmB,GACnB,kCAAmCT,GACnC,2BAA4BC,GAC5B,uCAAwCD,GACxC,gCAAiCC,GACjC,4CACED,GACF,qCAAsCC,GACtC,4BAA6B,IAC7B,2BAA4B,IAC5B,0CACEC,GACF,yCACEC,GACF,qBAAsB,GACtB,oBAAqBO,GAAoB,oBACzC,wBAAyB,GACzB,mBAAoB,GACpB,4BAA6B,GAC7B,mCAAoC,GACpC,oCAAqC,GACrC,iCAAkC,GAClC,+BAAgC,GAChC,sCAAuC,GACvC,uCAAwC,GACxC,oCAAqC,GACrC,+BAAgC,GAChC,sCAAuC,GACvC,uCAAwC,GACxC,oCAAqC,GACrC,8BAA+B,GAC/B,qCAAsC,GACtC,sCAAuC,GACvC,mCAAoC,GACpC,sCAAuC,GACvC,6CAA8C,GAC9C,8CAA+C,GAC/C,2CAA4C,GAC5C,4BAA6B,gBAC7B,mCAAoC,gBACpC,oCAAqC,gBACrC,iCAAkC,gBAClC,kDAAmD,cAuE/Cd,GAA+C,CACnD,IAAKa,GAAa,IAClB,QAASA,GAAa,QACtB,MAAOA,GAAa,MACpB,KAAMA,GAAa,KACnB,KAAMA,GAAa,KACnB,MAAOA,GAAa,MACpB,KAAMA,GAAa,QChSf,SAAUE,IAAM,CACpB,IAAMC,EAAaC,GAAiB,QAAQ,GAAsB,EAClE,OAAO,OAAO,OAAO,CAAA,EAAIC,GAAqBF,CAAU,CAC1D,CAEM,SAAUG,IAAqB,CACnC,OAAOF,GAAiB,QAAQ,GAAsB,CACxD,CAjCA,IAAAG,GAAAC,EAAA,kBAAAC,IAgBAF,OChBA,IAkBaG,GAlBbC,GAAAC,EAAA,kBAAAC,IAkBaH,GAAc,OAAO,YAAe,SAAW,WAAa,SCFzE,SAASI,GAASC,EAAgB,CAEhC,OAAIA,GAAY,IAAMA,GAAY,GACzBA,EAAW,GAIhBA,GAAY,IAAMA,GAAY,IACzBA,EAAW,GAIbA,EAAW,EACpB,CAEM,SAAUC,GAAYC,EAAc,CAIxC,QAHMC,EAAM,IAAI,WAAWD,EAAO,OAAS,CAAC,EACxCE,EAAS,EAEJC,EAAI,EAAGA,EAAIH,EAAO,OAAQG,GAAK,EAAG,CACzC,IAAMC,EAAKP,GAASG,EAAO,WAAWG,CAAC,CAAC,EAClCE,EAAKR,GAASG,EAAO,WAAWG,EAAI,CAAC,CAAC,EAC5CF,EAAIC,GAAQ,EAAKE,GAAM,EAAKC,EAG9B,OAAOJ,CACT,CA1CA,IAAAK,GAAAC,EAAA,kBAAAC,MCiBM,SAAUC,GAAYC,EAAc,CACxC,OAAO,OAAO,KAAKC,GAAYD,CAAM,CAAC,EAAE,SAAS,QAAQ,CAC3D,CAnBA,IAAAE,GAAAC,EAAA,kBAAAC,IAeAC,OCuBA,SAASC,GAAeC,EAAa,CACnC,OAAO,UAAmB,CACxB,QAASC,EAAI,EAAGA,EAAID,EAAQ,EAAGC,IAG7BC,GAAc,cAAe,KAAK,OAAM,EAAK,KAAA,IAAA,EAAK,EAAE,IAAM,EAAGD,EAAI,CAAC,EAIpE,QAASA,EAAI,EAAGA,EAAID,GACd,EAAAE,GAAcD,CAAC,EAAI,GADEA,IAGdA,IAAMD,EAAQ,IACvBE,GAAcF,EAAQ,CAAC,EAAI,GAI/B,OAAOE,GAAc,SAAS,MAAO,EAAGF,CAAK,CAC/C,CACF,CAzDA,IAiBMG,GACAC,GAKNC,GAcMH,GArCNI,GAAAC,EAAA,kBAAAC,IAiBML,GAAgB,EAChBC,GAAiB,GAKvBC,GAAA,UAAA,CAAA,SAAAA,GAAA,CAKE,KAAA,gBAAkBN,GAAeK,EAAc,EAM/C,KAAA,eAAiBL,GAAeI,EAAa,CAC/C,CAAA,OAAAE,CAAA,EAZA,EAcMH,GAAgB,OAAO,YAAYE,EAAc,ICrBvD,OAAS,eAAAK,OAAmB,aAhB5B,IAkBaC,GAlBbC,GAAAC,EAAA,kBAAAC,IAkBaH,GAAgBD,KClB7B,IAiBaK,GAjBbC,GAAAC,EAAA,kBAAAC,IAiBaH,GAAU,WCjBvB,OA0BaI,GA1BbC,GAAAC,EAAA,kBAAAC,IAgBAC,KACAC,KASaL,IAAQM,GAAA,CAAA,EACnBA,GAACC,EAA8B,EAAG,gBAClCD,GAACE,EAAgC,EAAG,OACpCF,GAACG,EAAkC,EAAGC,GACtCJ,GAACK,EAAiC,EAAGC,SCfjC,SAAUC,GAAWC,EAAmB,CAC5CA,EAAM,MAAK,CACb,CAjBA,IAAAC,GAAAC,EAAA,kBAAAC,MCAA,IAAAC,GAAAC,EAAA,kBAAAC,IAgBAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,OCtBA,IAAAC,GAAAC,EAAA,kBAAAC,IAeAC,OCcM,SAAUC,GAAeC,EAAmB,CAChD,IAAMC,EAAeD,EAAc,IAE7BE,EAAU,KAAK,MAAMD,CAAY,EAEjCE,EAAQ,KAAK,MAAOH,EAAc,IAAQI,EAA2B,EAC3E,MAAO,CAACF,EAASC,CAAK,CACxB,CAEM,SAAUE,IAAa,CAC3B,IAAIC,EAAaC,GAAY,WAC7B,GAAI,OAAOD,GAAe,SAAU,CAClC,IAAME,EAAyBD,GAC/BD,EAAaE,EAAK,QAAUA,EAAK,OAAO,WAE1C,OAAOF,CACT,CAMM,SAAUG,GAAOC,EAAuB,CAC5C,IAAMJ,EAAaP,GAAeM,GAAa,CAAE,EAC3CM,EAAMZ,GACV,OAAOW,GAAmB,SAAWA,EAAiBH,GAAY,IAAG,CAAE,EAGzE,OAAOK,GAAWN,EAAYK,CAAG,CACnC,CAOM,SAAUE,GAAkBC,EAAmB,CAEnD,GAAIC,GAAkBD,CAAI,EACxB,OAAOA,EACF,GAAI,OAAOA,GAAS,SAEzB,OAAIA,EAAOT,GAAa,EACfI,GAAOK,CAAI,EAGXf,GAAee,CAAI,EAEvB,GAAIA,aAAgB,KACzB,OAAOf,GAAee,EAAK,QAAO,CAAE,EAEpC,MAAM,UAAU,oBAAoB,CAExC,CAOM,SAAUE,GACdC,EACAC,EAAmB,CAEnB,IAAIhB,EAAUgB,EAAQ,CAAC,EAAID,EAAU,CAAC,EAClCd,EAAQe,EAAQ,CAAC,EAAID,EAAU,CAAC,EAGpC,OAAId,EAAQ,IACVD,GAAW,EAEXC,GAASgB,IAGJ,CAACjB,EAASC,CAAK,CACxB,CAMM,SAAUiB,GAAkBN,EAAgB,CAChD,IAAMO,EAAYC,GACZC,EAAM,GAAG,IAAI,OAAOF,CAAS,EAAIP,EAAK,CAAC,EAAC,IACxCU,EAAaD,EAAI,OAAOA,EAAI,OAASF,EAAY,CAAC,EAClDI,EAAO,IAAI,KAAKX,EAAK,CAAC,EAAI,GAAI,EAAE,YAAW,EACjD,OAAOW,EAAK,QAAQ,OAAQD,CAAU,CACxC,CAMM,SAAUE,GAAoBZ,EAAgB,CAClD,OAAOA,EAAK,CAAC,EAAIK,GAAwBL,EAAK,CAAC,CACjD,CAMM,SAAUa,GAAqBb,EAAgB,CACnD,OAAOA,EAAK,CAAC,EAAI,IAAMA,EAAK,CAAC,EAAI,GACnC,CAMM,SAAUc,GAAqBd,EAAgB,CACnD,OAAOA,EAAK,CAAC,EAAI,IAAMA,EAAK,CAAC,EAAI,GACnC,CAMM,SAAUC,GAAkBc,EAAc,CAC9C,OACE,MAAM,QAAQA,CAAK,GACnBA,EAAM,SAAW,GACjB,OAAOA,EAAM,CAAC,GAAM,UACpB,OAAOA,EAAM,CAAC,GAAM,QAExB,CAMM,SAAUC,GACdD,EAAc,CAEd,OACEd,GAAkBc,CAAK,GACvB,OAAOA,GAAU,UACjBA,aAAiB,IAErB,CAKM,SAAUjB,GAAWmB,EAAmBC,EAAiB,CAC7D,IAAMC,EAAM,CAACF,EAAM,CAAC,EAAIC,EAAM,CAAC,EAAGD,EAAM,CAAC,EAAIC,EAAM,CAAC,CAAC,EAGrD,OAAIC,EAAI,CAAC,GAAKd,KACZc,EAAI,CAAC,GAAKd,GACVc,EAAI,CAAC,GAAK,GAGLA,CACT,CAtLA,IAoBMX,GACAY,GACA9B,GACAe,GAvBNgB,GAAAC,EAAA,kBAAAC,IAiBAC,KAGMhB,GAAoB,EACpBY,GAA8B,EAC9B9B,GAA8B,KAAK,IAAI,GAAI8B,EAA2B,EACtEf,GAAwB,KAAK,IAAI,GAAIG,EAAiB,ICvB5D,IAAAiB,GAAAC,EAAA,kBAAAC,MCAA,IAqBYC,GArBZC,GAAAC,EAAA,kBAAAC,KAqBA,SAAYH,EAAgB,CAC1BA,EAAAA,EAAA,QAAA,CAAA,EAAA,UACAA,EAAAA,EAAA,OAAA,CAAA,EAAA,QACF,GAHYA,KAAAA,GAAgB,CAAA,EAAA,ICrB5B,OAmCAI,GAnCAC,GAAAC,EAAA,kBAAAC,IAgBAC,iTAmBAJ,GAAA,UAAA,CASE,SAAAA,EAAYK,EAAsC,CAAtCA,IAAA,SAAAA,EAAA,CAAA,SACV,KAAK,cAAeC,EAAAD,EAAO,eAAW,MAAAC,IAAA,OAAAA,EAAI,CAAA,EAE1C,KAAK,QAAU,MAAM,KACnB,IAAI,IACF,KAAK,aAEF,IAAI,SAAAC,EAAC,CAAI,OAAC,OAAOA,EAAE,QAAW,WAAaA,EAAE,OAAM,EAAK,CAAA,CAA/C,CAAkD,EAC3D,OAAO,SAACC,EAAGC,EAAC,CAAK,OAAAD,EAAE,OAAOC,CAAC,CAAV,EAAa,CAAA,CAAE,CAAC,CACrC,CAEL,CAWA,OAAAT,EAAA,UAAA,OAAA,SAAOU,EAAkBC,EAAkBC,EAAqB,aAC9D,QAAyBC,EAAAC,GAAA,KAAK,YAAY,EAAAC,EAAAF,EAAA,KAAA,EAAA,CAAAE,EAAA,KAAAA,EAAAF,EAAA,KAAA,EAAE,CAAvC,IAAMG,EAAUD,EAAA,MACnB,GAAI,CACFC,EAAW,OAAON,EAASC,EAASC,CAAM,QACnCK,EAAK,CACZC,GAAK,KACH,yBAAyBF,EAAW,YAAY,KAAI,UAAUC,EAAI,OAAS,qGAInF,EAWAjB,EAAA,UAAA,QAAA,SAAQU,EAAkBC,EAAkBQ,EAAqB,CAC/D,OAAO,KAAK,aAAa,OAAO,SAACC,EAAKJ,EAAU,CAC9C,GAAI,CACF,OAAOA,EAAW,QAAQI,EAAKT,EAASQ,CAAM,QACvCF,EAAK,CACZC,GAAK,KACH,yBAAyBF,EAAW,YAAY,KAAI,UAAUC,EAAI,OAAS,EAG/E,OAAOG,CACT,EAAGV,CAAO,CACZ,EAEAV,EAAA,UAAA,OAAA,UAAA,CAEE,OAAO,KAAK,QAAQ,MAAK,CAC3B,EACFA,CAAA,EArEA,ICJM,SAAUqB,GAAYC,EAAW,CACrC,OAAOC,GAAgB,KAAKD,CAAG,CACjC,CAMM,SAAUE,GAAcC,EAAa,CACzC,OACEC,GAAuB,KAAKD,CAAK,GACjC,CAACE,GAAgC,KAAKF,CAAK,CAE/C,CA5CA,IAgBMG,GACAC,GACAC,GACAP,GACAG,GACAC,GArBNI,GAAAC,EAAA,kBAAAC,IAgBML,GAAuB,eACvBC,GAAY,QAAQD,GAAoB,UACxCE,GAAmB,WAAWF,GAAoB,gBAAgBA,GAAoB,SACtFL,GAAkB,IAAI,OAAO,OAAOM,GAAS,IAAIC,GAAgB,IAAI,EACrEJ,GAAyB,sBACzBC,GAAkC,QCrBxC,IAmBMO,GACAC,GACAC,GACAC,GAWNC,GAjCAC,GAAAC,EAAA,kBAAAC,IAiBAC,KAEMR,GAAwB,GACxBC,GAAsB,IACtBC,GAAyB,IACzBC,GAAiC,IAWvCC,GAAA,UAAA,CAGE,SAAAA,EAAYK,EAAsB,CAF1B,KAAA,eAAsC,IAAI,IAG5CA,GAAe,KAAK,OAAOA,CAAa,CAC9C,CAEA,OAAAL,EAAA,UAAA,IAAA,SAAIM,EAAaC,EAAa,CAG5B,IAAMC,EAAa,KAAK,OAAM,EAC9B,OAAIA,EAAW,eAAe,IAAIF,CAAG,GACnCE,EAAW,eAAe,OAAOF,CAAG,EAEtCE,EAAW,eAAe,IAAIF,EAAKC,CAAK,EACjCC,CACT,EAEAR,EAAA,UAAA,MAAA,SAAMM,EAAW,CACf,IAAME,EAAa,KAAK,OAAM,EAC9B,OAAAA,EAAW,eAAe,OAAOF,CAAG,EAC7BE,CACT,EAEAR,EAAA,UAAA,IAAA,SAAIM,EAAW,CACb,OAAO,KAAK,eAAe,IAAIA,CAAG,CACpC,EAEAN,EAAA,UAAA,UAAA,UAAA,CAAA,IAAAS,EAAA,KACE,OAAO,KAAK,MAAK,EACd,OAAO,SAACC,EAAeJ,EAAG,CACzB,OAAAI,EAAI,KAAKJ,EAAMP,GAAiCU,EAAK,IAAIH,CAAG,CAAC,EACtDI,CACT,EAAG,CAAA,CAAE,EACJ,KAAKZ,EAAsB,CAChC,EAEQE,EAAA,UAAA,OAAR,SAAeK,EAAqB,CAC9BA,EAAc,OAASR,KAC3B,KAAK,eAAiBQ,EACnB,MAAMP,EAAsB,EAC5B,QAAO,EACP,OAAO,SAACY,EAA0BC,EAAY,CAC7C,IAAMC,EAAaD,EAAK,KAAI,EACtB,EAAIC,EAAW,QAAQb,EAA8B,EAC3D,GAAI,IAAM,GAAI,CACZ,IAAMO,EAAMM,EAAW,MAAM,EAAG,CAAC,EAC3BL,EAAQK,EAAW,MAAM,EAAI,EAAGD,EAAK,MAAM,EAC7CE,GAAYP,CAAG,GAAKQ,GAAcP,CAAK,GACzCG,EAAI,IAAIJ,EAAKC,CAAK,EAKtB,OAAOG,CACT,EAAG,IAAI,GAAK,EAGV,KAAK,eAAe,KAAOd,KAC7B,KAAK,eAAiB,IAAI,IACxB,MAAM,KAAK,KAAK,eAAe,QAAO,CAAE,EACrC,QAAO,EACP,MAAM,EAAGA,EAAqB,CAAC,GAGxC,EAEQI,EAAA,UAAA,MAAR,UAAA,CACE,OAAO,MAAM,KAAK,KAAK,eAAe,KAAI,CAAE,EAAE,QAAO,CACvD,EAEQA,EAAA,UAAA,OAAR,UAAA,CACE,IAAMQ,EAAa,IAAIR,EACvB,OAAAQ,EAAW,eAAiB,IAAI,IAAI,KAAK,cAAc,EAChDA,CACT,EACFR,CAAA,EA5EA,ICkBM,SAAUe,GAAiBC,EAAmB,CAClD,IAAMC,EAAQC,GAAmB,KAAKF,CAAW,EAMjD,MALI,CAACC,GAKDA,EAAM,CAAC,IAAM,MAAQA,EAAM,CAAC,EAAU,KAEnC,CACL,QAASA,EAAM,CAAC,EAChB,OAAQA,EAAM,CAAC,EACf,WAAY,SAASA,EAAM,CAAC,EAAG,EAAE,EAErC,CAjEA,IA6BaE,GACAC,GAEPC,GACAC,GACAC,GACAC,GACAC,GACAP,GAoCNQ,GAzEAC,GAAAC,EAAA,kBAAAC,IAgBAC,IAUAC,KACAC,KAEab,GAAsB,cACtBC,GAAqB,aAE5BC,GAAU,KACVC,GAAe,oBACfC,GAAgB,0BAChBC,GAAiB,0BACjBC,GAAa,cACbP,GAAqB,IAAI,OAC7B,SAASI,GAAY,MAAMC,GAAa,MAAMC,GAAc,MAAMC,GAAU,cAAc,EAmC5FC,GAAA,UAAA,CAAA,SAAAA,GAAA,CAqDA,CApDE,OAAAA,EAAA,UAAA,OAAA,SAAOO,EAAkBC,EAAkBC,EAAqB,CAC9D,IAAMC,EAAcC,GAAM,eAAeJ,CAAO,EAChD,GACE,GAACG,GACDE,GAAoBL,CAAO,GAC3B,CAACM,GAAmBH,CAAW,GAIjC,KAAMpB,EAAiBK,GAAO,IAAIe,EAAY,QAAO,IACnDA,EAAY,OAAM,KACf,OAAOA,EAAY,YAAcI,GAAW,IAAI,EAAE,SAAS,EAAE,EAElEL,EAAO,IAAID,EAASf,GAAqBH,CAAW,EAChDoB,EAAY,YACdD,EAAO,IACLD,EACAd,GACAgB,EAAY,WAAW,UAAS,CAAE,EAGxC,EAEAV,EAAA,UAAA,QAAA,SAAQO,EAAkBC,EAAkBO,EAAqB,CAC/D,IAAMC,EAAoBD,EAAO,IAAIP,EAASf,EAAmB,EACjE,GAAI,CAACuB,EAAmB,OAAOT,EAC/B,IAAMjB,EAAc,MAAM,QAAQ0B,CAAiB,EAC/CA,EAAkB,CAAC,EACnBA,EACJ,GAAI,OAAO1B,GAAgB,SAAU,OAAOiB,EAC5C,IAAMG,EAAcrB,GAAiBC,CAAW,EAChD,GAAI,CAACoB,EAAa,OAAOH,EAEzBG,EAAY,SAAW,GAEvB,IAAMO,EAAmBF,EAAO,IAAIP,EAASd,EAAkB,EAC/D,GAAIuB,EAAkB,CAGpB,IAAMC,EAAQ,MAAM,QAAQD,CAAgB,EACxCA,EAAiB,KAAK,GAAG,EACzBA,EACJP,EAAY,WAAa,IAAIS,GAC3B,OAAOD,GAAU,SAAWA,EAAQ,MAAS,EAGjD,OAAOP,GAAM,eAAeJ,EAASG,CAAW,CAClD,EAEAV,EAAA,UAAA,OAAA,UAAA,CACE,MAAO,CAACP,GAAqBC,EAAkB,CACjD,EACFM,CAAA,EArDA,ICzEA,IAAAoB,GAAAC,EAAA,kBAAAC,MCqCM,SAAUC,GAAeC,EAAkBC,EAAiB,CAChE,OAAOD,EAAQ,SAASE,GAAkBD,CAAI,CAChD,CAEM,SAAUE,GAAkBH,EAAgB,CAChD,OAAOA,EAAQ,YAAYE,EAAgB,CAC7C,CAEM,SAAUE,GAAeJ,EAAgB,CAC7C,OAAOA,EAAQ,SAASE,EAAgB,CAC1C,CA/CA,IAkBMA,GAIMG,GAtBZC,GAAAC,EAAA,kBAAAC,IAgBAC,IAEMP,GAAmBQ,GACvB,4CAA4C,GAG9C,SAAYL,EAAO,CACjBA,EAAA,KAAA,MACF,GAFYA,KAAAA,GAAO,CAAA,EAAA,ICtBnB,IAsBAM,GAtBAC,GAAAC,EAAA,kBAAAC,IAgBAC,IAMAJ,GAAA,UAAA,CAAA,SAAAA,GAAA,CAUA,CATE,OAAAA,EAAA,UAAA,aAAA,UAAA,CACE,MAAO,CACL,SAAUK,GAAiB,WAE/B,EAEAL,EAAA,UAAA,SAAA,UAAA,CACE,MAAO,kBACT,EACFA,CAAA,EAVA,ICtBA,IAsBAM,GAtBAC,GAAAC,EAAA,kBAAAC,IAgBAC,IAMAJ,GAAA,UAAA,CAAA,SAAAA,GAAA,CAUA,CATE,OAAAA,EAAA,UAAA,aAAA,UAAA,CACE,MAAO,CACL,SAAUK,GAAiB,mBAE/B,EAEAL,EAAA,UAAA,SAAA,UAAA,CACE,MAAO,iBACT,EACFA,CAAA,EAVA,ICtBA,IAoCAM,GApCAC,GAAAC,EAAA,kBAAAC,IAgBAC,IAWAC,KACAC,KACAC,KAOAP,GAAA,UAAA,CAOE,SAAAA,EAAYQ,EAAgC,aAC1C,KAAK,MAAQA,EAAO,KAEf,KAAK,QACRC,GACE,IAAI,MAAM,wDAAwD,CAAC,EAErE,KAAK,MAAQ,IAAIC,IAGnB,KAAK,sBACHC,EAAAH,EAAO,uBAAmB,MAAAG,IAAA,OAAAA,EAAI,IAAID,GACpC,KAAK,yBACHE,EAAAJ,EAAO,0BAAsB,MAAAI,IAAA,OAAAA,EAAI,IAAIC,GACvC,KAAK,qBACHC,EAAAN,EAAO,sBAAkB,MAAAM,IAAA,OAAAA,EAAI,IAAIJ,GACnC,KAAK,wBACHK,EAAAP,EAAO,yBAAqB,MAAAO,IAAA,OAAAA,EAAI,IAAIF,EACxC,CAEA,OAAAb,EAAA,UAAA,aAAA,SACEgB,EACAC,EACAC,EACAC,EACAC,EACAC,EAAa,CAEb,IAAMC,EAAgBC,GAAM,eAAeP,CAAO,EAElD,MAAI,CAACM,GAAiB,CAACE,GAAmBF,CAAa,EAC9C,KAAK,MAAM,aAChBN,EACAC,EACAC,EACAC,EACAC,EACAC,CAAK,EAILC,EAAc,SACZA,EAAc,WAAaG,GAAW,QACjC,KAAK,qBAAqB,aAC/BT,EACAC,EACAC,EACAC,EACAC,EACAC,CAAK,EAGF,KAAK,wBAAwB,aAClCL,EACAC,EACAC,EACAC,EACAC,EACAC,CAAK,EAILC,EAAc,WAAaG,GAAW,QACjC,KAAK,oBAAoB,aAC9BT,EACAC,EACAC,EACAC,EACAC,EACAC,CAAK,EAIF,KAAK,uBAAuB,aACjCL,EACAC,EACAC,EACAC,EACAC,EACAC,CAAK,CAET,EAEArB,EAAA,UAAA,SAAA,UAAA,CACE,MAAO,oBAAoB,KAAK,MAAM,SAAQ,EAAE,yBAAyB,KAAK,qBAAqB,SAAQ,EAAE,4BAA4B,KAAK,wBAAwB,SAAQ,EAAE,wBAAwB,KAAK,oBAAoB,SAAQ,EAAE,2BAA2B,KAAK,uBAAuB,SAAQ,EAAE,GAC9S,EACFA,CAAA,EA7FA,ICpCA,IA2BA0B,GA3BAC,GAAAC,EAAA,kBAAAC,IAgBAC,IAWAJ,GAAA,UAAA,CAGE,SAAAA,EAA6BK,EAAkB,CAAlBA,IAAA,SAAAA,EAAA,GAAA,KAAA,OAAAA,EAC3B,KAAK,OAAS,KAAK,WAAWA,CAAM,EACpC,KAAK,YAAc,KAAK,MAAM,KAAK,OAAS,UAAU,CACxD,CAEA,OAAAL,EAAA,UAAA,aAAA,SAAaM,EAAkBC,EAAe,CAC5C,MAAO,CACL,SACEC,GAAeD,CAAO,GAAK,KAAK,YAAYA,CAAO,EAAI,KAAK,YACxDE,GAAiB,mBACjBA,GAAiB,WAE3B,EAEAT,EAAA,UAAA,SAAA,UAAA,CACE,MAAO,qBAAqB,KAAK,OAAM,GACzC,EAEQA,EAAA,UAAA,WAAR,SAAmBU,EAAa,CAC9B,OAAI,OAAOA,GAAU,UAAY,MAAMA,CAAK,EAAU,EAC/CA,GAAS,EAAI,EAAIA,GAAS,EAAI,EAAIA,CAC3C,EAEQV,EAAA,UAAA,YAAR,SAAoBO,EAAe,CAEjC,QADII,EAAe,EACVC,EAAI,EAAGA,EAAIL,EAAQ,OAAS,EAAGK,IAAK,CAC3C,IAAMC,EAAMD,EAAI,EACVE,EAAO,SAASP,EAAQ,MAAMM,EAAKA,EAAM,CAAC,EAAG,EAAE,EACrDF,GAAgBA,EAAeG,KAAU,EAE3C,OAAOH,CACT,EACFX,CAAA,EAnCA,ICgBA,SAASe,GAAQC,EAAgBC,EAAc,CAC7C,OAAO,SAAUC,EAAQ,CACvB,OAAOF,EAAKC,EAAUC,CAAG,CAAC,CAC5B,CACF,CA8BM,SAAUC,GAAcC,EAAU,CACtC,GAAI,CAACC,GAAaD,CAAK,GAAKE,GAAWF,CAAK,IAAMG,GAChD,MAAO,GAET,IAAMC,EAAQC,GAAaL,CAAK,EAChC,GAAII,IAAU,KACZ,MAAO,GAET,IAAME,EAAOC,GAAe,KAAKH,EAAO,aAAa,GAAKA,EAAM,YAChE,OACE,OAAOE,GAAQ,YACfA,aAAgBA,GAChBE,GAAa,KAAKF,CAAI,IAAMG,EAEhC,CA0BA,SAASR,GAAaD,EAAU,CAC9B,OAAOA,GAAS,MAAQ,OAAOA,GAAS,QAC1C,CASA,SAASE,GAAWF,EAAU,CAC5B,OAAIA,GAAS,KACJA,IAAU,OAAYU,GAAeC,GAEvCC,IAAkBA,MAAkB,OAAOZ,CAAK,EACnDa,GAAUb,CAAK,EACfc,GAAed,CAAK,CAC1B,CASA,SAASa,GAAUb,EAAU,CAC3B,IAAMe,EAAQR,GAAe,KAAKP,EAAOY,EAAqB,EAC5DI,EAAMhB,EAAMY,EAAqB,EAC/BK,EAAW,GAEf,GAAI,CACFjB,EAAMY,EAAqB,EAAI,OAC/BK,EAAW,QACD,EAIZ,IAAMC,EAASC,GAAqB,KAAKnB,CAAK,EAC9C,OAAIiB,IACEF,EACFf,EAAMY,EAAqB,EAAII,EAE/B,OAAOhB,EAAMY,EAAqB,GAG/BM,CACT,CASA,SAASJ,GAAed,EAAU,CAChC,OAAOmB,GAAqB,KAAKnB,CAAK,CACxC,CAhLA,IAuBMG,GACAQ,GACAD,GACAU,GACAZ,GACAC,GACAJ,GACAgB,GACAd,GACAK,GACAO,GAjCNG,GAAAC,EAAA,kBAAAC,IAuBMrB,GAAY,kBACZQ,GAAU,gBACVD,GAAe,qBACfU,GAAY,SAAS,UACrBZ,GAAeY,GAAU,SACzBX,GAAmBD,GAAa,KAAK,MAAM,EAC3CH,GAAeV,GAAQ,OAAO,eAAgB,MAAM,EACpD0B,GAAc,OAAO,UACrBd,GAAiBc,GAAY,eAC7BT,GAAiB,OAAS,OAAO,YAAc,OAC/CO,GAAuBE,GAAY,WCFnC,SAAUI,IAAK,SAACC,EAAA,CAAA,EAAAC,EAAA,EAAAA,EAAA,UAAA,OAAAA,IAAAD,EAAAC,CAAA,EAAA,UAAAA,CAAA,EAMpB,QALIC,EAAcF,EAAK,MAAK,EACtBG,EAAkD,IAAI,QAIrDH,EAAK,OAAS,GACnBE,EAASE,GAAgBF,EAAQF,EAAK,MAAK,EAAI,EAAGG,CAAO,EAG3D,OAAOD,CACT,CAEA,SAASG,GAAUC,EAAU,CAC3B,OAAIC,GAAQD,CAAK,EACRA,EAAM,MAAK,EAEbA,CACT,CAUA,SAASF,GACPI,EACAC,EACAC,EACAP,EAAmC,CADnCO,IAAA,SAAAA,EAAA,GAGA,IAAIR,EACJ,GAAI,EAAAQ,EAAQC,IAIZ,IADAD,IACIE,GAAYJ,CAAG,GAAKI,GAAYH,CAAG,GAAKI,GAAWJ,CAAG,EACxDP,EAASG,GAAUI,CAAG,UACbF,GAAQC,CAAG,GAEpB,GADAN,EAASM,EAAI,MAAK,EACdD,GAAQE,CAAG,EACb,QAAS,EAAI,EAAGK,EAAIL,EAAI,OAAQ,EAAIK,EAAG,IACrCZ,EAAO,KAAKG,GAAUI,EAAI,CAAC,CAAC,CAAC,UAEtBM,GAASN,CAAG,EAErB,QADMO,EAAO,OAAO,KAAKP,CAAG,EACnB,EAAI,EAAGK,EAAIE,EAAK,OAAQ,EAAIF,EAAG,IAAK,CAC3C,IAAMG,EAAMD,EAAK,CAAC,EAClBd,EAAOe,CAAG,EAAIZ,GAAUI,EAAIQ,CAAG,CAAC,WAG3BF,GAASP,CAAG,EACrB,GAAIO,GAASN,CAAG,EAAG,CACjB,GAAI,CAACS,GAAYV,EAAKC,CAAG,EACvB,OAAOA,EAETP,EAAS,OAAO,OAAO,CAAA,EAAIM,CAAG,EAG9B,QAFMQ,EAAO,OAAO,KAAKP,CAAG,EAEnB,EAAI,EAAGK,EAAIE,EAAK,OAAQ,EAAIF,EAAG,IAAK,CAC3C,IAAMG,EAAMD,EAAK,CAAC,EACZG,EAAWV,EAAIQ,CAAG,EAExB,GAAIL,GAAYO,CAAQ,EAClB,OAAOA,EAAa,IACtB,OAAOjB,EAAOe,CAAG,EAGjBf,EAAOe,CAAG,EAAIE,MAEX,CACL,IAAMC,EAAOlB,EAAOe,CAAG,EACjBI,EAAOF,EAEb,GACEG,GAAoBd,EAAKS,EAAKd,CAAO,GACrCmB,GAAoBb,EAAKQ,EAAKd,CAAO,EAErC,OAAOD,EAAOe,CAAG,MACZ,CACL,GAAIF,GAASK,CAAI,GAAKL,GAASM,CAAI,EAAG,CACpC,IAAME,EAAOpB,EAAQ,IAAIiB,CAAI,GAAK,CAAA,EAC5BI,EAAOrB,EAAQ,IAAIkB,CAAI,GAAK,CAAA,EAClCE,EAAK,KAAK,CAAE,IAAKf,EAAK,IAAGS,CAAA,CAAE,EAC3BO,EAAK,KAAK,CAAE,IAAKf,EAAK,IAAGQ,CAAA,CAAE,EAC3Bd,EAAQ,IAAIiB,EAAMG,CAAI,EACtBpB,EAAQ,IAAIkB,EAAMG,CAAI,EAGxBtB,EAAOe,CAAG,EAAIb,GACZF,EAAOe,CAAG,EACVE,EACAT,EACAP,CAAO,UAMfD,EAASO,EAIb,OAAOP,EACT,CAQA,SAASoB,GACPG,EACAR,EACAd,EAAmC,CAGnC,QADMuB,EAAMvB,EAAQ,IAAIsB,EAAIR,CAAG,CAAC,GAAK,CAAA,EAC5BU,EAAI,EAAGb,EAAIY,EAAI,OAAQC,EAAIb,EAAGa,IAAK,CAC1C,IAAMC,EAAOF,EAAIC,CAAC,EAClB,GAAIC,EAAK,MAAQX,GAAOW,EAAK,MAAQH,EACnC,MAAO,GAGX,MAAO,EACT,CAEA,SAASlB,GAAQD,EAAU,CACzB,OAAO,MAAM,QAAQA,CAAK,CAC5B,CAEA,SAASO,GAAWP,EAAU,CAC5B,OAAO,OAAOA,GAAU,UAC1B,CAEA,SAASS,GAAST,EAAU,CAC1B,MACE,CAACM,GAAYN,CAAK,GAClB,CAACC,GAAQD,CAAK,GACd,CAACO,GAAWP,CAAK,GACjB,OAAOA,GAAU,QAErB,CAEA,SAASM,GAAYN,EAAU,CAC7B,OACE,OAAOA,GAAU,UACjB,OAAOA,GAAU,UACjB,OAAOA,GAAU,WACjB,OAAOA,EAAU,KACjBA,aAAiB,MACjBA,aAAiB,QACjBA,IAAU,IAEd,CAEA,SAASY,GAAYV,EAAUC,EAAQ,CACrC,MAAI,GAACoB,GAAcrB,CAAG,GAAK,CAACqB,GAAcpB,CAAG,EAK/C,CApMA,IAoBME,GApBNmB,GAAAC,EAAA,kBAAAC,IAkBAC,KAEMtB,GAAY,KCkBZ,SAAUuB,GACdC,EACAC,EAAe,CAEf,IAAIC,EAEEC,EAAiB,IAAI,QAAe,SACxCC,EACAC,EAAM,CAENH,EAAgB,WAAW,UAAuB,CAChDG,EAAO,IAAIC,GAAa,sBAAsB,CAAC,CACjD,EAAGL,CAAO,CACZ,CAAC,EAED,OAAO,QAAQ,KAAK,CAACD,EAASG,CAAc,CAAC,EAAE,KAC7C,SAAAI,EAAM,CACJ,oBAAaL,CAAa,EACnBK,CACT,EACA,SAAAC,EAAM,CACJ,mBAAaN,CAAa,EACpBM,CACR,CAAC,CAEL,CA/DA,OAmBAF,GAnBAG,GAAAC,EAAA,kBAAAC,+dAmBAL,GAAA,SAAAM,EAAA,CAAkCC,GAAAP,EAAAM,CAAA,EAChC,SAAAN,EAAYQ,EAAgB,CAA5B,IAAAC,EACEH,EAAA,KAAA,KAAME,CAAO,GAAC,KAId,cAAO,eAAeC,EAAMT,EAAa,SAAS,GACpD,CACF,OAAAA,CAAA,EARkC,KAAK,ICJjC,SAAUU,GAAWC,EAAaC,EAA2B,CACjE,OAAI,OAAOA,GAAe,SACjBD,IAAQC,EAER,CAAC,CAACD,EAAI,MAAMC,CAAU,CAEjC,CAMM,SAAUC,GACdF,EACAG,EAAoC,SAEpC,GAAI,CAACA,EACH,MAAO,OAGT,QAAwBC,EAAAC,GAAAF,CAAW,EAAAG,EAAAF,EAAA,KAAA,EAAA,CAAAE,EAAA,KAAAA,EAAAF,EAAA,KAAA,EAAE,CAAhC,IAAMG,EAASD,EAAA,MAClB,GAAIP,GAAWC,EAAKO,CAAS,EAC3B,MAAO,qGAGX,MAAO,EACT,kVCnBM,SAAUC,GAAUC,EAAa,CACrC,OACE,OAAOA,GAAS,YAChB,OAAQA,EAAqB,YAAe,YAC5C,OAAQA,EAAqB,UAAa,YACzCA,EAAqB,YAAc,EAExC,CA7BA,IAAAC,GAAAC,EAAA,kBAAAC,MCAA,IAgBAC,GAhBAC,GAAAC,EAAA,kBAAAC,IAgBAH,GAAA,UAAA,CAIE,SAAAA,GAAA,CAAA,IAAAI,EAAA,KACE,KAAK,SAAW,IAAI,QAAQ,SAACC,EAASC,EAAM,CAC1CF,EAAK,SAAWC,EAChBD,EAAK,QAAUE,CACjB,CAAC,CACH,CAEA,cAAA,eAAIN,EAAA,UAAA,UAAO,KAAX,UAAA,CACE,OAAO,KAAK,QACd,kCAEAA,EAAA,UAAA,QAAA,SAAQO,EAAM,CACZ,KAAK,SAASA,CAAG,CACnB,EAEAP,EAAA,UAAA,OAAA,SAAOQ,EAAY,CACjB,KAAK,QAAQA,CAAG,CAClB,EACFR,CAAA,EAtBA,IChBA,UAqBAS,GArBAC,GAAAC,EAAA,kBAAAC,IAgBAC,ueAKAJ,GAAA,UAAA,CAOE,SAAAA,EACUK,EACAC,EAAW,CADX,KAAA,UAAAD,EACA,KAAA,MAAAC,EAJF,KAAA,UAAY,GACZ,KAAA,UAAY,IAAIC,EAIrB,CAEH,cAAA,eAAIP,EAAA,UAAA,WAAQ,KAAZ,UAAA,CACE,OAAO,KAAK,SACd,kCAEA,OAAA,eAAIA,EAAA,UAAA,UAAO,KAAX,UAAA,CACE,OAAO,KAAK,UAAU,OACxB,kCAEAA,EAAA,UAAA,KAAA,UAAA,WAAAQ,EAAA,KAAKC,EAAA,CAAA,EAAAC,EAAA,EAAAA,EAAA,UAAA,OAAAA,IAAAD,EAAAC,CAAA,EAAA,UAAAA,CAAA,EACH,GAAI,CAAC,KAAK,UAAW,CACnB,KAAK,UAAY,GACjB,GAAI,CACF,QAAQ,SAAQC,EAAA,KAAK,WAAU,KAAI,MAAAA,EAAAC,GAAA,CAAC,KAAK,KAAK,EAAAC,GAAKJ,CAAI,EAAA,EAAA,CAAA,CAAA,EAAG,KACxD,SAAAK,EAAG,CAAI,OAAAN,EAAK,UAAU,QAAQM,CAAG,CAA1B,EACP,SAAAC,EAAG,CAAI,OAAAP,EAAK,UAAU,OAAOO,CAAG,CAAzB,CAA0B,QAE5BA,EAAK,CACZ,KAAK,UAAU,OAAOA,CAAG,GAG7B,OAAO,KAAK,UAAU,OACxB,EACFf,CAAA,EAlCA,ICOM,SAAUgB,GACdC,EACAC,EAAM,CAEN,OAAO,IAAI,QAAQ,SAAAC,EAAO,CAExBC,GAAQ,KAAKC,GAAgBD,GAAQ,OAAM,CAAE,EAAG,UAAA,CAC9CH,EAAS,OAAOC,EAAK,SAACI,EAAoB,CACxCH,EAAQG,CAAM,CAChB,CAAC,CACH,CAAC,CACH,CAAC,CACH,CAxCA,IAAAC,GAAAC,EAAA,kBAAAC,IAgBAC,IAEAC,OClBA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,sBAAAE,GAAA,oBAAAC,GAAA,kBAAAC,GAAA,mBAAAC,GAAA,wBAAAC,GAAA,kCAAAC,GAAA,yCAAAC,GAAA,wBAAAC,GAAA,iDAAAC,GAAA,gDAAAC,GAAA,qBAAAC,GAAA,uBAAAC,GAAA,YAAAC,GAAA,sBAAAC,GAAA,aAAAC,GAAA,wBAAAC,GAAA,uBAAAC,GAAA,iBAAAC,GAAA,6BAAAC,GAAA,eAAAC,GAAA,wBAAAC,GAAA,YAAAC,GAAA,yBAAAC,GAAA,8BAAAC,GAAA,gBAAAC,GAAA,eAAAC,GAAA,iBAAAC,GAAA,oBAAAC,GAAA,sBAAAC,GAAA,WAAAC,GAAA,0BAAAC,GAAA,mBAAAC,GAAA,kBAAAC,GAAA,uBAAAC,GAAA,gBAAAC,GAAA,gBAAAC,GAAA,WAAAC,GAAA,mBAAAC,GAAA,yBAAAC,GAAA,yBAAAC,GAAA,wBAAAC,GAAA,sBAAAC,GAAA,aAAAC,GAAA,mBAAAC,GAAA,qBAAAC,GAAA,gBAAAC,GAAA,sBAAAC,GAAA,wBAAAC,GAAA,iBAAAC,GAAA,cAAAC,GAAA,wBAAAC,GAAA,UAAAC,GAAA,mBAAAC,GAAA,kBAAAC,GAAA,qBAAAC,GAAA,qBAAAC,GAAA,uBAAAC,GAAA,0BAAAC,GAAA,mBAAAC,GAAA,oBAAAC,GAAA,sBAAAC,GAAA,eAAAC,GAAA,sBAAAC,GAAA,eAAAC,KAAA,IA8CarB,GA9CbsB,GAAAC,EAAA,kBAAAC,IAgBAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,UAEAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACarD,GAAW,CACtB,QAAOsD,gHC5BT,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,gBAAA,kBACAA,EAAA,mBAAA,qBACAA,EAAA,iBAAA,kBACF,GAJYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,4qBCJ1B,IAAAC,GAAA,WAQAC,EAAA,aAiCAC,GAAA,aACAC,GAAA,EAAA,KAAA,EACAC,GAAA,KAMaC,GAAiB,CAC5BC,EACAC,EACAC,EAAmB,UACT,CACV,IAAMC,EAAeH,GAAc,CAAA,EAC7BI,EAAWD,EAAa,UAAYD,EACpCG,GAAQF,EAAa,MAAQ,IAAI,SAAQ,EACzCG,EAAOH,EAAa,MAAQ,IAC9BI,EACFJ,EAAa,MAAQA,EAAa,UAAYF,EAAQ,MAAQ,YAIhE,OACGM,EAAgB,QAAQ,GAAG,IAAM,IAClCF,GACAA,IAAS,MACTA,IAAS,QAETE,GAAQ,IAAIF,CAAI,IAGX,GAAGD,CAAQ,KAAKG,CAAI,GAAGD,CAAI,EACpC,EAxBaE,EAAA,eAAcT,GA6BpB,IAAMU,GAAsB,CACjCC,EACAC,IACkB,CAClB,IAAMC,EAAaF,IAAShB,GAAA,SAAS,OAAS,IAAM,IAGpD,OAAIiB,GAAcA,GAAc,KAAOA,EAAaC,EAC3ClB,GAAA,eAAe,MAIjBA,GAAA,eAAe,KACxB,EAbac,EAAA,oBAAmBC,GAoBzB,IAAMI,GAAmB,CAC9BC,EACAC,IACW,CACX,GAAI,OAAOA,GAAY,SACrB,OAAOA,IAAYD,EACd,GAAIC,aAAmB,OAC5B,OAAOA,EAAQ,KAAKD,CAAQ,EACvB,GAAI,OAAOC,GAAY,WAC5B,OAAOA,EAAQD,CAAQ,EAEvB,MAAM,IAAI,UAAU,oCAAoC,CAE5D,EAbaN,EAAA,iBAAgBK,GAuBtB,IAAMG,GAAY,CACvBF,EACAG,EACAC,IACW,CACX,GAAI,CAACD,EAEH,MAAO,GAGT,GAAI,CACF,QAAWF,KAAWE,EACpB,MAAIT,EAAA,kBAAiBM,EAAUC,CAAO,EACpC,MAAO,SAGJI,EAAG,CACND,GACFA,EAAYC,CAAC,EAIjB,MAAO,EACT,EAvBaX,EAAA,UAASQ,GA8Bf,IAAMI,GAAmB,CAACC,EAAYC,IAAoB,CAC/D,IAAMC,EAAUD,EAAM,QAEtBD,EAAK,aAAavB,GAAA,eAAe,gBAAiBwB,EAAM,IAAI,EAC5DD,EAAK,aAAavB,GAAA,eAAe,mBAAoByB,CAAO,EAC5DF,EAAK,UAAU,CAAE,KAAM3B,GAAA,eAAe,MAAO,QAAA6B,CAAO,CAAE,EACtDF,EAAK,gBAAgBC,CAAK,CAC5B,EAPad,EAAA,iBAAgBY,GActB,IAAMI,GAAmC,CAC9CC,EACAC,IACQ,CACR,IAAMC,EAASC,GAAiBH,EAAQ,OAAO,EAC3CE,IAAW,UAEXnB,EAAA,cAAaiB,EAAQ,OAAO,EAC9BC,EAAW/B,EAAA,oCAAoC,EAAIgC,EAEnDD,EAAW/B,EAAA,iDAAiD,EAAIgC,EAEpE,EAZanB,EAAA,iCAAgCgB,GAmBtC,IAAMK,GAAoC,CAC/CC,EACAJ,IACQ,CACR,IAAMC,EAASC,GAAiBE,EAAS,OAAO,EAC5CH,IAAW,UAEXnB,EAAA,cAAasB,EAAS,OAAO,EAC/BJ,EAAW/B,EAAA,qCAAqC,EAAIgC,EAEpDD,EAAW/B,EAAA,kDAAkD,EAAIgC,EAErE,EAZanB,EAAA,kCAAiCqB,GAc9C,SAASD,GACP3B,EAAkD,CAElD,IAAM8B,EAAsB9B,EAAQ,gBAAgB,EACpD,GAAI8B,IAAwB,OAAW,OAAO,KAE9C,IAAMC,EAAgB,SAASD,EAA+B,EAAE,EAChE,OAAI,MAAMC,CAAa,EAAU,KAE1BA,CACT,CAEO,IAAMC,GACXhC,GACW,CACX,IAAMiC,EAAWjC,EAAQ,kBAAkB,EAE3C,MAAO,CAAC,CAACiC,GAAYA,IAAa,UACpC,EANa1B,EAAA,aAAYyB,GAclB,IAAME,GAAiB,CAC5BC,EACAC,IAME,CACF,IAAIC,EAAW,IACXC,EAAS,GACTC,EACJ,GAAI,OAAOJ,GAAY,SACrBI,EAAgB3C,GAAI,MAAMuC,CAAO,EACjCE,EAAYE,EAAyC,UAAY,IACjED,EAAS,GAAGC,EAAc,UAAY,OAAO,KAAKA,EAAc,IAAI,GAChEH,IAAiB,QACnB,OAAO,OAAOG,EAAeH,CAAY,UAElCD,aAAmBvC,GAAI,IAChC2C,EAAgB,CACd,SAAUJ,EAAQ,SAClB,SACE,OAAOA,EAAQ,UAAa,UAAYA,EAAQ,SAAS,WAAW,GAAG,EACnEA,EAAQ,SAAS,MAAM,EAAG,EAAE,EAC5BA,EAAQ,SACd,KAAM,GAAGA,EAAQ,UAAY,EAAE,GAAGA,EAAQ,QAAU,EAAE,IAEpDA,EAAQ,OAAS,KACnBI,EAAc,KAAO,OAAOJ,EAAQ,IAAI,IAEtCA,EAAQ,UAAYA,EAAQ,YAC9BI,EAAc,KAAO,GAAGJ,EAAQ,QAAQ,IAAIA,EAAQ,QAAQ,IAE9DE,EAAWF,EAAQ,SACnBG,EAASH,EAAQ,OACbC,IAAiB,QACnB,OAAO,OAAOG,EAAeH,CAAY,MAEtC,CACLG,EAAgB,OAAO,OACrB,CAAE,SAAUJ,EAAQ,KAAO,QAAU,MAAS,EAC9CA,CAAO,EAETE,EAAYF,EAAoB,SAC5B,CAACE,GAAYE,EAAc,OAC7BF,EAAWzC,GAAI,MAAM2C,EAAc,IAAI,EAAE,UAAY,KAEvD,IAAMC,EACJD,EAAc,OACbA,EAAc,MAAQ,KACnB,GAAGA,EAAc,QAAQ,GAAGA,EAAc,IAAI,GAC9CA,EAAc,UACpBD,EAAS,GAAGC,EAAc,UAAY,OAAO,KAAKC,CAAQ,GAK5D,IAAMC,EAASF,EAAc,OACzBA,EAAc,OAAO,YAAW,EAChC,MAEJ,MAAO,CAAE,OAAAD,EAAQ,SAAAD,EAAU,OAAAI,EAAQ,cAAAF,CAAa,CAClD,EA/DahC,EAAA,eAAc2B,GAqEpB,IAAMQ,GAAsBP,GAA6B,CAC9D,GAAI,CAACA,EACH,MAAO,GAGT,IAAMQ,EAAO,OAAOR,EACpB,OAAOQ,IAAS,UAAaA,IAAS,UAAY,CAAC,MAAM,QAAQR,CAAO,CAC1E,EAPa5B,EAAA,mBAAkBmC,GASxB,IAAME,GACXC,GAI+C,OAC/C,GAAIA,EAAe,UAAYA,EAAe,KAC5C,MAAO,CAAE,SAAUA,EAAe,SAAU,KAAMA,EAAe,IAAI,EAEvE,IAAMC,IAAUC,EAAAF,EAAe,QAAI,MAAAE,IAAA,OAAA,OAAAA,EAAE,MAAM,uBAAuB,IAAK,KACjEP,EACJK,EAAe,WAAaC,IAAY,KAAO,YAAcA,EAAQ,CAAC,GACpE1C,EAAOyC,EAAe,KAC1B,OAAKzC,IACC0C,GAAWA,EAAQ,CAAC,EAEtB1C,EAAO0C,EAAQ,CAAC,EAAE,UAAU,CAAC,EAE7B1C,EAAOyC,EAAe,WAAa,SAAW,MAAQ,MAGnD,CAAE,SAAAL,EAAU,KAAApC,CAAI,CACzB,EAtBaG,EAAA,uBAAsBqC,GA6B5B,IAAMI,GAA+B,CAC1CH,EACAV,IAMkB,OAClB,IAAMK,EAAWL,EAAQ,SACnB/B,EAAO+B,EAAQ,KACfc,EAAgBJ,EAAe,OAC/BJ,EAASQ,EAAgBA,EAAc,YAAW,EAAK,MACvDjD,EAAU6C,EAAe,SAAW,CAAA,EACpCK,EAAYlD,EAAQ,YAAY,EAChCyB,EAA6B,CACjC,CAAC/B,EAAA,iBAAiB,KAAGa,EAAA,gBACnBsC,EACA7C,EACA,GAAGmC,EAAQ,SAAS,GAAG,EAEzB,CAACzC,EAAA,oBAAoB,EAAG+C,EACxB,CAAC/C,EAAA,oBAAoB,EAAGmD,EAAe,MAAQ,IAC/C,CAACnD,EAAA,sBAAsB,EAAG8C,EAC1B,CAAC9C,EAAA,kBAAkB,GAAGqD,EAAA/C,EAAQ,QAAI,MAAA+C,IAAA,OAAAA,EAAI,GAAGP,CAAQ,IAAIpC,CAAI,IAG3D,OAAI8C,IAAc,SAChBzB,EAAW/B,EAAA,wBAAwB,EAAIwD,GAElC,OAAO,OAAOzB,EAAYU,EAAQ,cAAc,CACzD,EA/Ba5B,EAAA,6BAA4ByC,GAqClC,IAAMG,GACXC,GACoB,CACpB,IAAMC,EAAqC,CAAA,EAC3C,OAAAA,EAAiB3D,EAAA,oBAAoB,EAAI0D,EAAe1D,EAAA,oBAAoB,EAC5E2D,EAAiB3D,EAAA,sBAAsB,EACrC0D,EAAe1D,EAAA,sBAAsB,EAEhC2D,CACT,EATa9C,EAAA,mCAAkC4C,GAexC,IAAMG,GAA4B,CACvC7C,EACAgB,IACQ,CACJhB,IACFgB,EAAW/B,EAAA,oBAAoB,EAAIe,EAC/BA,EAAK,YAAW,IAAO,OACzBgB,EAAW/B,EAAA,sBAAsB,EAAIA,EAAA,0BAErC+B,EAAW/B,EAAA,sBAAsB,EAAIA,EAAA,0BAG3C,EAZaa,EAAA,0BAAyB+C,GAmB/B,IAAMC,GACX1B,GACkB,CAClB,GAAM,CAAE,WAAAnB,EAAY,cAAA8C,EAAe,YAAAC,EAAa,OAAAC,CAAM,EAAK7B,EACrDJ,EAA6B,CAAA,EACnC,GAAIiC,EAAQ,CACV,GAAM,CAAE,cAAAC,EAAe,WAAAC,CAAU,EAAKF,EACtCjC,EAAW/B,EAAA,oBAAoB,EAAIiE,EACnClC,EAAW/B,EAAA,sBAAsB,EAAIkE,EAEvC,SAAArD,EAAA,mCAAkCsB,EAAUJ,CAAU,EAElDf,IACFe,EAAW/B,EAAA,yBAAyB,EAAIgB,EACxCe,EAAW5B,GAAA,eAAe,gBAAgB,GACxC2D,GAAiB,IACjB,YAAW,MAGfjD,EAAA,2BAA0BkD,EAAahC,CAAU,EAC1CA,CACT,EArBalB,EAAA,uCAAsCgD,GA2B5C,IAAMM,GACXT,GACoB,CACpB,IAAMC,EAAqC,CAAA,EAC3C,OAAAA,EAAiB3D,EAAA,sBAAsB,EACrC0D,EAAe1D,EAAA,sBAAsB,EACvC2D,EAAiB3D,EAAA,yBAAyB,EACxC0D,EAAe1D,EAAA,yBAAyB,EAC1C2D,EAAiB3D,EAAA,oBAAoB,EAAI0D,EAAe1D,EAAA,oBAAoB,EACrE2D,CACT,EAVa9C,EAAA,6CAA4CsD,GAiBlD,IAAMC,GAA+B,CAC1CtC,EACAW,IAKkB,CAClB,IAAMnC,EAAUwB,EAAQ,QAClB0B,EAAYlD,EAAQ,YAAY,EAChC+D,EAAM/D,EAAQ,iBAAiB,EAC/ByC,EAASjB,EAAQ,QAAU,MAC3BiC,EAAcjC,EAAQ,YACtBzB,EAAayB,EAAQ,IAAM5B,GAAI,MAAM4B,EAAQ,GAAG,EAAI,KACpDlB,EAAOP,GAAY,MAAQC,EAAQ,KACnCwC,EACJzC,GAAY,UACZO,GAAM,QAAQ,qBAAsB,IAAI,GACxC,YACI0D,EAAa7B,EAAQ,WACrBV,EAA6B,CACjC,CAAC/B,EAAA,iBAAiB,KAAGa,EAAA,gBACnBR,EACAC,EACA,GAAGmC,EAAQ,SAAS,GAAG,EAEzB,CAACzC,EAAA,kBAAkB,EAAGY,EACtB,CAACZ,EAAA,sBAAsB,EAAG8C,EAC1B,CAAC9C,EAAA,oBAAoB,EAAG+C,EACxB,CAAC/C,EAAA,oBAAoB,EAAGyC,EAAQ,WAGlC,OAAI,OAAO4B,GAAQ,WACjBtC,EAAW/B,EAAA,uBAAuB,EAAIqE,EAAI,MAAM,GAAG,EAAE,CAAC,GAGpD,OAAOC,GAAe,WACxBvC,EAAW/B,EAAA,yBAAyB,EAAIsE,GAGtCjE,IACF0B,EAAW/B,EAAA,oBAAoB,EAAIK,EAAW,MAAQ,KAGpDmD,IAAc,SAChBzB,EAAW/B,EAAA,wBAAwB,EAAIwD,MAEzC3C,EAAA,kCAAiCiB,EAASC,CAAU,KACpDlB,EAAA,2BAA0BkD,EAAahC,CAAU,EAC1C,OAAO,OAAOA,EAAYU,EAAQ,cAAc,CACzD,EAlDa5B,EAAA,6BAA4BuD,GAyDlC,IAAMG,GACXb,GACoB,CACpB,IAAMC,EAAqC,CAAA,EAC3C,OAAAA,EAAiB3D,EAAA,oBAAoB,EAAI0D,EAAe1D,EAAA,oBAAoB,EAC5E2D,EAAiB3D,EAAA,oBAAoB,EAAI0D,EAAe1D,EAAA,oBAAoB,EAC5E2D,EAAiB3D,EAAA,sBAAsB,EACrC0D,EAAe1D,EAAA,sBAAsB,EACvC2D,EAAiB3D,EAAA,oBAAoB,EAAI0D,EAAe1D,EAAA,oBAAoB,EAErE2D,CACT,EAXa9C,EAAA,mCAAkC0D,GAiBxC,IAAMC,GAAyC,CACpD1C,EACAK,IACkB,CAGlB,GAAM,CAAE,OAAA6B,CAAM,EAAKlC,EACb,CAAE,WAAAd,EAAY,cAAA8C,CAAa,EAAK3B,EAEhCsC,KAAcxE,GAAA,gBAAeF,GAAA,QAAQ,OAAM,CAAE,EAC7CgC,EAA6B,CAAA,EACnC,GAAIiC,EAAQ,CACV,GAAM,CAAE,aAAAU,EAAc,UAAAC,EAAW,cAAAV,EAAe,WAAAC,CAAU,EAAKF,EAC/DjC,EAAW/B,EAAA,oBAAoB,EAAI0E,EACnC3C,EAAW/B,EAAA,sBAAsB,EAAI2E,EACrC5C,EAAW/B,EAAA,oBAAoB,EAAIiE,EACnClC,EAAW/B,EAAA,sBAAsB,EAAIkE,EAEvC,OAAAnC,EAAW/B,EAAA,yBAAyB,EAAIgB,EACxCe,EAAW5B,GAAA,eAAe,gBAAgB,GACxC2D,GAAiB,IACjB,YAAW,EAETW,GAAa,OAASxE,GAAA,QAAQ,MAAQwE,EAAY,QAAU,SAC9D1C,EAAW/B,EAAA,mBAAmB,EAAIyE,EAAY,OAEzC1C,CACT,EA3BalB,EAAA,uCAAsC2D,GAiC5C,IAAMI,GACXlB,GACoB,CACpB,IAAMC,EAAqC,CAAA,EAC3C,OAAAA,EAAiB3D,EAAA,yBAAyB,EACxC0D,EAAe1D,EAAA,yBAAyB,EAC1C2D,EAAiB3D,EAAA,sBAAsB,EACrC0D,EAAe1D,EAAA,sBAAsB,EACnC0D,EAAe1D,EAAA,mBAAmB,IAAM,SAC1C2D,EAAiB3D,EAAA,mBAAmB,EAAI0D,EAAe1D,EAAA,mBAAmB,GAErE2D,CACT,EAZa9C,EAAA,6CAA4C+D,GAczD,SAAgBC,GAAc5B,EAA8B3C,EAAiB,CAC3E,IAAMwE,EAAoB,IAAI,IAC9B,QAASC,EAAI,EAAGC,EAAM1E,EAAQ,OAAQyE,EAAIC,EAAKD,IAAK,CAClD,IAAME,EAAiB3E,EAAQyE,CAAC,EAAE,YAAW,EAC7CD,EAAkB,IAAIG,EAAgBA,EAAe,QAAQ,KAAM,GAAG,CAAC,EAGzE,MAAO,CACLvD,EACAwD,IACE,CACF,QAAWD,KAAkBH,EAAkB,KAAI,EAAI,CACrD,IAAMK,EAAQD,EAAUD,CAAc,EAEtC,GAAIE,IAAU,OACZ,SAGF,IAAMC,EAAmBN,EAAkB,IAAIG,CAAc,EACvDI,EAAM,QAAQpC,CAAI,WAAWmC,CAAgB,GAE/C,OAAOD,GAAU,SACnBzD,EAAK,aAAa2D,EAAK,CAACF,CAAK,CAAC,EACrB,MAAM,QAAQA,CAAK,EAC5BzD,EAAK,aAAa2D,EAAKF,CAAK,EAE5BzD,EAAK,aAAa2D,EAAK,CAACF,CAAK,CAAC,EAGpC,CACF,CA9BAtE,EAAA,cAAAgE,wGCrjBaS,GAAA,QAAU,WCjBvB,IAAAC,GAAAC,EAAA,kBAAAC,MCAA,IAAAC,GAAAC,EAAA,kBAAAC,MCAA,IAsBYC,GAtBZC,GAAAC,EAAA,kBAAAC,KAsBA,SAAYH,EAAc,CACxBA,EAAAA,EAAA,YAAA,CAAA,EAAA,cACAA,EAAAA,EAAA,MAAA,CAAA,EAAA,QACAA,EAAAA,EAAA,OAAA,CAAA,EAAA,SACAA,EAAAA,EAAA,OAAA,CAAA,EAAA,SACAA,EAAAA,EAAA,OAAA,CAAA,EAAA,SACAA,EAAAA,EAAA,MAAA,CAAA,EAAA,QACAA,EAAAA,EAAA,OAAA,CAAA,EAAA,SACAA,EAAAA,EAAA,OAAA,CAAA,EAAA,SACAA,EAAAA,EAAA,OAAA,CAAA,EAAA,SACAA,EAAAA,EAAA,KAAA,CAAA,EAAA,OACAA,EAAAA,EAAA,MAAA,EAAA,EAAA,QACAA,EAAAA,EAAA,MAAA,EAAA,EAAA,QACAA,EAAAA,EAAA,MAAA,EAAA,EAAA,QACAA,EAAAA,EAAA,KAAA,EAAA,EAAA,OACAA,EAAAA,EAAA,MAAA,EAAA,EAAA,QACAA,EAAAA,EAAA,MAAA,EAAA,EAAA,QACAA,EAAAA,EAAA,MAAA,EAAA,EAAA,QACAA,EAAAA,EAAA,MAAA,EAAA,EAAA,QACAA,EAAAA,EAAA,OAAA,EAAA,EAAA,SACAA,EAAAA,EAAA,OAAA,EAAA,EAAA,SACAA,EAAAA,EAAA,OAAA,EAAA,EAAA,SACAA,EAAAA,EAAA,MAAA,EAAA,EAAA,QACAA,EAAAA,EAAA,OAAA,EAAA,EAAA,SACAA,EAAAA,EAAA,OAAA,EAAA,EAAA,SACAA,EAAAA,EAAA,OAAA,EAAA,EAAA,QACF,GA1BYA,KAAAA,GAAc,CAAA,EAAA,ICtB1B,IAAAI,GAAAC,EAAA,kBAAAC,MCAA,IAAAC,GAAAC,EAAA,kBAAAC,MCAA,IAmBAC,GAIaC,GAvBbC,GAAAC,EAAA,kBAAAC,IAmBAJ,GAAA,UAAA,CAAA,SAAAA,GAAA,CAEA,CADE,OAAAA,EAAA,UAAA,KAAA,SAAKK,EAAqB,CAAS,EACrCL,CAAA,EAFA,EAIaC,GAAc,IAAID,KCvB/B,IAqBAM,GAUaC,GA/BbC,GAAAC,EAAA,kBAAAC,IAmBAC,KAEAL,GAAA,UAAA,CAAA,SAAAA,GAAA,CAQA,CAPE,OAAAA,EAAA,UAAA,UAAA,SACEM,EACAC,EACAC,EAAoC,CAEpC,OAAO,IAAIC,EACb,EACFT,CAAA,EARA,EAUaC,GAAuB,IAAID,KC/BxC,IAkBaU,GAlBbC,GAAAC,EAAA,kBAAAC,IAkBaH,GAAc,OAAO,YAAe,SAAW,WAAa,SClBzE,IAAAI,GAAAC,EAAA,kBAAAC,IAgBAC,OChBA,IAAAC,GAAAC,EAAA,kBAAAC,IAgBAC,OCoBM,SAAUC,GACdC,EACAC,EACAC,EAAW,CAEX,OAAO,SAACC,EAAe,CACrB,OAAAA,IAAYH,EAAkBC,EAAWC,CAAzC,CACJ,CA3CA,IAmBaE,GAOAC,GA0BAC,GApDbC,GAAAC,EAAA,kBAAAC,IAiBAC,KAEaN,GAAsB,OAAO,IAAI,8BAA8B,EAO/DC,GAAUM,GA0BVL,GAAsC,ICpDnD,IA2BAM,GA3BAC,GAAAC,EAAA,kBAAAC,IAgBAC,KAOAC,KAIAL,GAAA,UAAA,CAGE,SAAAA,GAAA,CAAuB,CAET,OAAAA,EAAA,YAAd,UAAA,CACE,OAAK,KAAK,YACR,KAAK,UAAY,IAAIA,GAGhB,KAAK,SACd,EAEOA,EAAA,UAAA,wBAAP,SAA+BM,EAAwB,CACrD,OAAIC,GAAQC,EAAmB,EACtB,KAAK,kBAAiB,GAG/BD,GAAQC,EAAmB,EAAIC,GAC7BC,GACAJ,EACAK,EAAoB,EAGfL,EACT,EAOON,EAAA,UAAA,kBAAP,UAAA,SACE,OACEY,GAAAC,EAAAN,GAAQC,EAAmB,KAAC,MAAAK,IAAA,OAAA,OAAAA,EAAA,KAA5BN,GAA+BG,EAAmC,KAAC,MAAAE,IAAA,OAAAA,EACnED,EAEJ,EAOOX,EAAA,UAAA,UAAP,SACEc,EACAC,EACAC,EAAuB,CAEvB,OAAO,KAAK,kBAAiB,EAAG,UAAUF,EAAMC,EAASC,CAAO,CAClE,EAGOhB,EAAA,UAAA,QAAP,UAAA,CACE,OAAOO,GAAQC,EAAmB,CACpC,EACFR,CAAA,EAxDA,IC3BA,IAyBaiB,GAzBbC,GAAAC,EAAA,kBAAAC,IAgBAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,KAEAC,KACaX,GAAOY,GAAQ,YAAW,ICCjC,SAAUC,GACdC,EACAC,EACAC,EACAC,EAA+B,CAE/B,QAASC,EAAI,EAAGC,EAAIL,EAAiB,OAAQI,EAAIC,EAAGD,IAAK,CACvD,IAAME,EAAkBN,EAAiBI,CAAC,EACtCH,GACFK,EAAgB,kBAAkBL,CAAc,EAE9CC,GACFI,EAAgB,iBAAiBJ,CAAa,EAE5CC,GAAkBG,EAAgB,mBACpCA,EAAgB,kBAAkBH,CAAc,EAM7CG,EAAgB,UAAS,EAAG,SAC/BA,EAAgB,OAAM,EAG5B,CAMM,SAAUC,GACdP,EAAmC,CAEnCA,EAAiB,QAAQ,SAAAM,EAAe,CAAI,OAAAA,EAAgB,QAAO,CAAvB,CAAyB,CACvE,CA7DA,IAAAE,GAAAC,EAAA,kBAAAC,MC8BM,SAAUC,GACdC,EAA0B,SAEpBC,EAAiBD,EAAQ,gBAAkBE,GAAM,kBAAiB,EAClEC,EAAgBH,EAAQ,eAAiBI,GAAQ,iBAAgB,EACjEC,EAAiBL,EAAQ,gBAAkBM,GAAK,kBAAiB,EACjEC,GAAmBC,GAAAC,EAAAT,EAAQ,oBAAgB,MAAAS,IAAA,OAAA,OAAAA,EAAE,KAAI,KAAE,MAAAD,IAAA,OAAAA,EAAI,CAAA,EAE7D,OAAAE,GACEH,EACAN,EACAE,EACAE,CAAc,EAGT,UAAA,CACLM,GAAwBJ,CAAgB,CAC1C,CACF,CAhDA,IAAAK,GAAAC,EAAA,kBAAAC,IAgBAC,IACAA,KACAC,OClBA,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,SAASC,GAAYC,EAAU,CAC7B,OAAO,OAAOA,GAAa,UAC7B,CAGA,IAAIC,GAAS,QAAQ,MAAM,KAAK,OAAO,EAIvC,SAASC,GAAgBC,EAAKC,EAAMC,EAAO,CACzC,IAAIC,EAAa,CAAC,CAACH,EAAIC,CAAI,GAAKD,EAAI,qBAAqBC,CAAI,EAC7D,OAAO,eAAeD,EAAKC,EAAM,CAC/B,aAAc,GACd,WAAYE,EACZ,SAAU,GACV,MAAOD,CACT,CAAC,CACH,CAGA,SAASE,GAASC,EAAS,CACrBA,GAAWA,EAAQ,SAChBT,GAAWS,EAAQ,MAAM,EACzBP,GAASO,EAAQ,OADWP,GAAO,4CAA4C,EAGxF,CAEA,SAASQ,GAAMC,EAAQN,EAAMO,EAAS,CACpC,GAAI,CAACD,GAAU,CAACA,EAAON,CAAI,EAAG,CAC5BH,GAAO,wBAA0BG,EAAO,UAAU,EAClD,MACF,CAEA,GAAI,CAACO,EAAS,CACZV,GAAO,qBAAqB,EAC5BA,GAAQ,IAAI,MAAM,EAAG,KAAK,EAC1B,MACF,CAEA,GAAI,CAACF,GAAWW,EAAON,CAAI,CAAC,GAAK,CAACL,GAAWY,CAAO,EAAG,CACrDV,GAAO,+CAA+C,EACtD,MACF,CAEA,IAAIW,EAAWF,EAAON,CAAI,EACtBS,EAAUF,EAAQC,EAAUR,CAAI,EAEpC,OAAAF,GAAeW,EAAS,aAAcD,CAAQ,EAC9CV,GAAeW,EAAS,WAAY,UAAY,CAC1CH,EAAON,CAAI,IAAMS,GAASX,GAAeQ,EAAQN,EAAMQ,CAAQ,CACrE,CAAC,EACDV,GAAeW,EAAS,YAAa,EAAI,EAEzCX,GAAeQ,EAAQN,EAAMS,CAAO,EAC7BA,CACT,CAEA,SAASC,GAAUC,EAASC,EAAOL,EAAS,CAC1C,GAAKI,EAIO,MAAM,QAAQA,CAAO,IAC/BA,EAAU,CAACA,CAAO,OALN,CACZd,GAAO,2CAA2C,EAClDA,GAAQ,IAAI,MAAM,EAAG,KAAK,EAC1B,MACF,CAIA,GAAI,EAAEe,GAAS,MAAM,QAAQA,CAAK,GAAI,CACpCf,GAAO,uDAAuD,EAC9D,MACF,CAEAc,EAAQ,QAAQ,SAAUL,EAAQ,CAChCM,EAAM,QAAQ,SAAUZ,EAAM,CAC5BK,GAAKC,EAAQN,EAAMO,CAAO,CAC5B,CAAC,CACH,CAAC,CACH,CAEA,SAASM,GAAQP,EAAQN,EAAM,CAC7B,GAAI,CAACM,GAAU,CAACA,EAAON,CAAI,EAAG,CAC5BH,GAAO,wBAAwB,EAC/BA,GAAQ,IAAI,MAAM,EAAG,KAAK,EAC1B,MACF,CAEA,GAAI,CAACS,EAAON,CAAI,EAAE,SAChBH,GAAO,mCAAqCG,EAAO,0BAA0B,MAE7E,QAAOM,EAAON,CAAI,EAAE,SAAS,CAEjC,CAEA,SAASc,GAAYH,EAASC,EAAO,CACnC,GAAKD,EAIO,MAAM,QAAQA,CAAO,IAC/BA,EAAU,CAACA,CAAO,OALN,CACZd,GAAO,2CAA2C,EAClDA,GAAQ,IAAI,MAAM,EAAG,KAAK,EAC1B,MACF,CAIA,GAAI,EAAEe,GAAS,MAAM,QAAQA,CAAK,GAAI,CACpCf,GAAO,yDAAyD,EAChE,MACF,CAEAc,EAAQ,QAAQ,SAAUL,EAAQ,CAChCM,EAAM,QAAQ,SAAUZ,EAAM,CAC5Ba,GAAOP,EAAQN,CAAI,CACrB,CAAC,CACH,CAAC,CACH,CAEAG,GAAQ,KAAOE,GACfF,GAAQ,SAAWO,GACnBP,GAAQ,OAASU,GACjBV,GAAQ,WAAaW,GAErBrB,GAAO,QAAUU,KCxHjB,IA4BAY,MAWAC,GAvCAC,GAAAC,EAAA,kBAAAC,IAgBAC,IAWAA,KACAL,GAAyB,8NAWzBC,GAAA,UAAA,CAWE,SAAAA,EACkBK,EACAC,EAChBC,EAAkB,CAFF,KAAA,oBAAAF,EACA,KAAA,uBAAAC,EAqBR,KAAA,MAAgB,QAEhB,KAAA,QAAkB,UAElB,KAAA,UAAoB,YAEpB,KAAA,YAAsB,cAtB9B,KAAK,QAAOE,GAAA,CACV,QAAS,EAAI,EACVD,CAAM,EAGX,KAAK,MAAQE,GAAK,sBAAsB,CACtC,UAAWJ,EACZ,EAED,KAAK,QAAUK,GAAM,UAAUL,EAAqBC,CAAsB,EAC1E,KAAK,OAASK,GAAQ,SAASN,EAAqBC,CAAsB,EAC1E,KAAK,QAAUM,GAAK,UAAUP,EAAqBC,CAAsB,EACzE,KAAK,yBAAwB,CAC/B,CAYA,cAAA,eAAcN,EAAA,UAAA,QAAK,KAAnB,UAAA,CACE,OAAO,KAAK,MACd,kCAMOA,EAAA,UAAA,iBAAP,SAAwBa,EAA4B,CAClD,KAAK,OAASA,EAAc,SAC1B,KAAK,oBACL,KAAK,sBAAsB,EAG7B,KAAK,yBAAwB,CAC/B,EAGA,OAAA,eAAcb,EAAA,UAAA,SAAM,KAApB,UAAA,CACE,OAAO,KAAK,OACd,kCAMOA,EAAA,UAAA,kBAAP,SAAyBc,EAA8B,CACrD,KAAK,QAAUA,EAAe,UAC5B,KAAK,oBACL,KAAK,sBAAsB,CAE/B,EAUOd,EAAA,UAAA,qBAAP,UAAA,OACQe,GAAaC,EAAA,KAAK,KAAI,KAAE,MAAAA,IAAA,OAAAA,EAAI,CAAA,EAClC,OAAK,MAAM,QAAQD,CAAU,EAItBA,EAHE,CAACA,CAAU,CAItB,EAKUf,EAAA,UAAA,yBAAV,UAAA,CAEA,EAGOA,EAAA,UAAA,UAAP,UAAA,CACE,OAAO,KAAK,OACd,EAMOA,EAAA,UAAA,UAAP,SAAiBO,EAAkB,CAGjC,KAAK,QAAOC,GAAA,CAAA,EAAQD,CAAM,CAC5B,EAMOP,EAAA,UAAA,kBAAP,SAAyBiB,EAA8B,CACrD,KAAK,QAAUA,EAAe,UAC5B,KAAK,oBACL,KAAK,sBAAsB,CAE/B,EAGA,OAAA,eAAcjB,EAAA,UAAA,SAAM,KAApB,UAAA,CACE,OAAO,KAAK,OACd,kCAyBUA,EAAA,UAAA,0BAAV,SACEkB,EACAC,EACAC,EACAC,EAA+B,CAE/B,GAAKH,EAIL,GAAI,CACFA,EAAYE,EAAMC,CAAI,QACfC,EAAG,CACV,KAAK,MAAM,MACT,oEACA,CAAE,YAAWH,CAAA,EACbG,CAAC,EAGP,EACFtB,CAAA,EA9KA,ICvCA,IAAAuB,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,IAAIC,GAAK,EAAQ,IAAI,EAIrBF,GAAO,QAAUE,GAAG,SAAW,UAAmB,CAC9C,IAAIC,EAAO,QAAQ,IAAI,KACnBC,EAAO,QAAQ,IAAI,SAAW,QAAQ,IAAI,MAAQ,QAAQ,IAAI,OAAS,QAAQ,IAAI,SAEvF,OAAI,QAAQ,WAAa,QACd,QAAQ,IAAI,aAAe,QAAQ,IAAI,UAAY,QAAQ,IAAI,UAAYD,GAAQ,KAG1F,QAAQ,WAAa,SACdA,IAASC,EAAO,UAAYA,EAAO,MAG1C,QAAQ,WAAa,QACdD,IAAS,QAAQ,OAAO,IAAM,EAAI,QAAWC,EAAO,SAAWA,EAAO,MAG1ED,GAAQ,IACnB,ICvBA,IAAAE,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAAAD,GAAO,QAAU,UAAY,CAEzB,IAAIE,EAAwB,MAAM,kBAClC,MAAM,kBAAoB,SAAUC,EAAGC,EAAO,CAAE,OAAOA,CAAO,EAC9D,IAAIA,EAAS,IAAI,MAAM,EAAG,MAC1B,aAAM,kBAAoBF,EACnBE,EAAM,CAAC,EAAE,YAAY,CAChC,ICPA,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,IAAIC,GAAY,QAAQ,WAAa,QAGjCC,GACA,6HAEAC,GAAQ,CAAC,EAEb,SAASC,GAAeC,EAAU,CAChC,OAAOH,GAAe,KAAKG,CAAQ,EAAE,MAAM,CAAC,CAC9C,CAEAF,GAAM,MAAQ,SAASG,EAAY,CACjC,GAAI,OAAOA,GAAe,SACxB,MAAM,IAAI,UACN,gDAAkD,OAAOA,CAC7D,EAEF,IAAIC,EAAWH,GAAeE,CAAU,EACxC,GAAI,CAACC,GAAYA,EAAS,SAAW,EACnC,MAAM,IAAI,UAAU,iBAAmBD,EAAa,GAAG,EAEzD,MAAO,CACL,KAAMC,EAAS,CAAC,EAChB,IAAKA,EAAS,CAAC,IAAMA,EAAS,CAAC,EAAIA,EAAS,CAAC,EAAIA,EAAS,CAAC,EAAE,MAAM,EAAG,EAAE,EACxE,KAAMA,EAAS,CAAC,EAChB,IAAKA,EAAS,CAAC,EACf,KAAMA,EAAS,CAAC,CAClB,CACF,EAMA,IAAIC,GACA,8DACAC,GAAQ,CAAC,EAGb,SAASC,GAAeL,EAAU,CAChC,OAAOG,GAAY,KAAKH,CAAQ,EAAE,MAAM,CAAC,CAC3C,CAGAI,GAAM,MAAQ,SAASH,EAAY,CACjC,GAAI,OAAOA,GAAe,SACxB,MAAM,IAAI,UACN,gDAAkD,OAAOA,CAC7D,EAEF,IAAIC,EAAWG,GAAeJ,CAAU,EACxC,GAAI,CAACC,GAAYA,EAAS,SAAW,EACnC,MAAM,IAAI,UAAU,iBAAmBD,EAAa,GAAG,EAGzD,MAAO,CACL,KAAMC,EAAS,CAAC,EAChB,IAAKA,EAAS,CAAC,EAAE,MAAM,EAAG,EAAE,EAC5B,KAAMA,EAAS,CAAC,EAChB,IAAKA,EAAS,CAAC,EACf,KAAMA,EAAS,CAAC,CAClB,CACF,EAGIN,GACFF,GAAO,QAAUI,GAAM,MAEvBJ,GAAO,QAAUU,GAAM,MAEzBV,GAAO,QAAQ,MAAQU,GAAM,MAC7BV,GAAO,QAAQ,MAAQI,GAAM,QC1E7B,IAAAQ,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAAA,IAAIC,GAAO,EAAQ,MAAM,EACrBC,GAAQD,GAAK,OAAS,KAEtBE,GAAqB,SAA4BC,EAAeC,EAAS,CACzE,IAAIC,EAAS,IACR,eAAgB,KAAKF,CAAa,EACnCE,EAAS,GACD,QAAS,KAAKF,CAAa,IACnCE,EAAS,QAKb,QAFIC,EAAQ,CAACH,CAAa,EACtBI,EAASN,GAAME,CAAa,EACzBI,EAAO,MAAQD,EAAMA,EAAM,OAAS,CAAC,GACxCA,EAAM,KAAKC,EAAO,GAAG,EACrBA,EAASN,GAAMM,EAAO,GAAG,EAG7B,OAAOD,EAAM,OAAO,SAAUE,EAAMC,EAAO,CACvC,OAAOD,EAAK,OAAOJ,EAAQ,IAAI,SAAUM,EAAW,CAChD,OAAOV,GAAK,QAAQK,EAAQI,EAAOC,CAAS,CAChD,CAAC,CAAC,CACN,EAAG,CAAC,CAAC,CACT,EAEAZ,GAAO,QAAU,SAA0Ba,EAAOC,EAAMC,EAAS,CAC7D,IAAIT,EAAUQ,GAAQA,EAAK,gBACrB,CAAC,EAAE,OAAOA,EAAK,eAAe,EAC9B,CAAC,cAAc,EAErB,GAAIA,GAAQ,OAAOA,EAAK,OAAU,WAC9B,OAAOA,EAAK,MACRC,EACAF,EACA,UAAY,CAAE,OAAOT,GAAmBS,EAAOP,CAAO,CAAG,EACzDQ,CACJ,EAGJ,IAAIJ,EAAON,GAAmBS,EAAOP,CAAO,EAC5C,OAAOQ,GAAQA,EAAK,MAAQJ,EAAK,OAAOI,EAAK,KAAK,EAAIJ,CAC1D,ICzCA,IAAAM,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAIA,IAAMC,GAAO,EAAQ,MAAM,EAE3BF,GAAO,QAAU,SAAUG,EAAGC,EAAM,CAGlC,GAFAA,EAAOA,GAAQ,CAAC,EAEZA,EAAK,qBAAuB,CAAC,QAAQ,SAAS,IAChD,OAAOA,EAST,GAAM,CAAC,WAAAC,CAAU,EAAI,EAAQ,QAAQ,EAE/BC,EAAmB,CAACC,EAASC,IAAY,CAE7C,IAAMC,EAAQF,EAAQ,MAAM,8BAA8B,EAC1D,GAAI,CAACE,EACH,MAAM,IAAI,MAAM,+GAA+GF,CAAO,IAAI,EAGxIC,EAAQ,OAAOA,EAAQ,OAAS,CAAC,IAAM,MACzCA,EAAUN,GAAK,KAAKM,EAAS,GAAG,GAElC,IAAME,EAAML,EAAWG,CAAO,EAC9B,GAAIE,IAAQ,KACV,OAGF,IAAIC,EACJ,GAAI,CACFA,EAAeD,EAAI,qBAAqB,GAAGD,EAAM,CAAC,CAAC,gBAAiBD,EAAS,CAAC,iBAAkB,EAAK,CAAC,CACxG,MAAc,CACZ,OAAO,IACT,CAEA,GAAIG,IAAiB,KACnB,MAAM,IAAI,MAAM,iDAAiDF,EAAM,CAAC,CAAC,qBAAqB,EAGhG,IAAMG,EAAcV,GAAK,QAAQS,CAAY,EAGvCE,EAAkB,OAAOJ,EAAM,CAAC,EAAM,IACxCP,GAAK,KAAKU,EAAaH,EAAM,CAAC,CAAC,EAC/BG,EAEJ,MAAO,CAAC,YAAAA,EAAa,gBAAAC,CAAe,CACtC,EAEMC,EAA0B,CAACP,EAASQ,IAAU,CAClD,QAASC,EAAI,EAAGA,EAAID,EAAM,OAAQC,IAAK,CACrC,IAAMC,EAAaX,EAAiBC,EAASQ,EAAMC,CAAC,CAAC,EACrD,GAAIC,GAAcD,IAAMD,EAAM,OAAS,EACrC,OAAOE,CAEX,CAEA,OAAO,IACT,EAEMC,EAAgB,MAAM,QAAQd,EAAK,KAAK,EAAIA,EAAK,MAAQ,CAAC,EAE1De,EAAkB,CAACZ,EAASC,EAASY,EAAehB,IAAS,CACjE,IAAMiB,EAAc,CAACb,CAAO,EAAE,OAAOU,CAAa,EAC5CD,EAAaH,EAAwBP,EAASc,CAAW,EAC/D,OAAIJ,GAAc,KACTG,EAAc,EAEhB,CAACH,EAAW,eAAe,CACpC,EAEMF,EAAQ,CAACR,EAASC,EAASc,EAAoBlB,IAAS,CAC5D,IAAMiB,EAAc,CAACb,CAAO,EAAE,OAAOU,CAAa,EAC5CD,EAAaH,EAAwBP,EAASc,CAAW,EAC/D,GAAIJ,GAAc,KAChB,OAAOK,EAAmB,EAAE,OAAOJ,CAAa,EAGlD,IAAIK,EAAcrB,GAAK,QAAQe,EAAW,WAAW,EAGrD,OAAIV,EAAQ,MAAM,WAAW,IAC3BgB,EAAcrB,GAAK,QAAQqB,CAAW,GAEjC,CAACA,CAAW,CACrB,EAIIC,EAAmB,GAEvB,OAAKpB,EAAK,wBACRA,EAAK,gBAAkB,SAAUG,EAASC,EAASY,EAAehB,EAAM,CACtEoB,EAAmB,GACnB,GAAI,CACF,OAAOL,EAAgBZ,EAASC,EAASY,EAAehB,CAAI,CAC9D,QAAE,CACAoB,EAAmB,EACrB,CACF,GAGFpB,EAAK,MAAQ,SAAUG,EAASC,EAASc,EAAoBlB,EAAM,CACjE,OAAIoB,EACKF,EAAmB,EAAE,OAAOJ,CAAa,EAE3CH,EAAMR,EAASC,EAASc,EAAoBlB,CAAI,CACzD,EAEOA,CACT,ICtHA,IAAAqB,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAIA,IAAIC,GAAgB,kDAChBC,GAAQ,OAAO,UAAU,SACzBC,GAAM,KAAK,IACXC,GAAW,oBAEXC,GAAW,SAAkBC,EAAGC,EAAG,CAGnC,QAFIC,EAAM,CAAC,EAEFC,EAAI,EAAGA,EAAIH,EAAE,OAAQG,GAAK,EAC/BD,EAAIC,CAAC,EAAIH,EAAEG,CAAC,EAEhB,QAASC,EAAI,EAAGA,EAAIH,EAAE,OAAQG,GAAK,EAC/BF,EAAIE,EAAIJ,EAAE,MAAM,EAAIC,EAAEG,CAAC,EAG3B,OAAOF,CACX,EAEIG,GAAQ,SAAeC,EAASC,EAAQ,CAExC,QADIL,EAAM,CAAC,EACFC,EAAII,GAAU,EAAGH,EAAI,EAAGD,EAAIG,EAAQ,OAAQH,GAAK,EAAGC,GAAK,EAC9DF,EAAIE,CAAC,EAAIE,EAAQH,CAAC,EAEtB,OAAOD,CACX,EAEIM,GAAQ,SAAUN,EAAKO,EAAQ,CAE/B,QADIC,EAAM,GACDP,EAAI,EAAGA,EAAID,EAAI,OAAQC,GAAK,EACjCO,GAAOR,EAAIC,CAAC,EACRA,EAAI,EAAID,EAAI,SACZQ,GAAOD,GAGf,OAAOC,CACX,EAEAjB,GAAO,QAAU,SAAckB,EAAM,CACjC,IAAIC,EAAS,KACb,GAAI,OAAOA,GAAW,YAAchB,GAAM,MAAMgB,CAAM,IAAMd,GACxD,MAAM,IAAI,UAAUH,GAAgBiB,CAAM,EAyB9C,QAvBIC,EAAOR,GAAM,UAAW,CAAC,EAEzBS,EACAC,EAAS,UAAY,CACrB,GAAI,gBAAgBD,EAAO,CACvB,IAAIE,EAASJ,EAAO,MAChB,KACAb,GAASc,EAAM,SAAS,CAC5B,EACA,OAAI,OAAOG,CAAM,IAAMA,EACZA,EAEJ,IACX,CACA,OAAOJ,EAAO,MACVD,EACAZ,GAASc,EAAM,SAAS,CAC5B,CAEJ,EAEII,EAAcpB,GAAI,EAAGe,EAAO,OAASC,EAAK,MAAM,EAChDK,EAAY,CAAC,EACRf,EAAI,EAAGA,EAAIc,EAAad,IAC7Be,EAAUf,CAAC,EAAI,IAAMA,EAKzB,GAFAW,EAAQ,SAAS,SAAU,oBAAsBN,GAAMU,EAAW,GAAG,EAAI,2CAA2C,EAAEH,CAAM,EAExHH,EAAO,UAAW,CAClB,IAAIO,EAAQ,UAAiB,CAAC,EAC9BA,EAAM,UAAYP,EAAO,UACzBE,EAAM,UAAY,IAAIK,EACtBA,EAAM,UAAY,IACtB,CAEA,OAAOL,CACX,ICnFA,IAAAM,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,IAAIC,GAAiB,KAErBF,GAAO,QAAU,SAAS,UAAU,MAAQE,KCJ5C,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,IAAIC,GAAO,SAAS,UAAU,KAC1BC,GAAU,OAAO,UAAU,eAC3BC,GAAO,KAGXJ,GAAO,QAAUI,GAAK,KAAKF,GAAMC,EAAO,ICPxC,IAAAE,GAAAC,EAAA,CAAAC,GAAAC,KAAA,CAAAA,GAAA,SACC,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,gBAAiB,QACjB,qBAAsB,QACtB,YAAe,OACf,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,eAAkB,oBAClB,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,cAAiB,GACjB,qBAAsB,CAAC,mBAAoB,OAAO,EAClD,QAAW,SACX,eAAgB,CAAC,mBAAoB,OAAO,EAC5C,QAAW,GACX,eAAgB,CAAC,mBAAoB,OAAO,EAC5C,UAAa,GACb,iBAAkB,CAAC,mBAAoB,OAAO,EAC9C,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,aAAgB,cAChB,UAAa,MACb,MAAS,GACT,aAAc,CAAC,mBAAoB,OAAO,EAC1C,oBAAuB,CAAC,mBAAoB,SAAS,EACrD,2BAA4B,CAAC,mBAAoB,OAAO,EACxD,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,eAAgB,QAChB,oBAAqB,QACrB,OAAU,YACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,SAAY,MACZ,GAAM,GACN,UAAW,CAAC,mBAAoB,OAAO,EACvC,cAAe,CAAC,kBAAmB,OAAO,EAC1C,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,YAAe,YACf,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,aAAgB,YAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,aAAgB,YAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,eAAkB,YAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,eAAkB,YAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,aAAgB,YAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,KAAQ,GACR,YAAa,CAAC,mBAAoB,OAAO,EACzC,MAAS,SACT,aAAc,CAAC,mBAAoB,OAAO,EAC1C,MAAS,GACT,aAAc,CAAC,mBAAoB,OAAO,EAC1C,UAAa,OACb,iBAAkB,CAAC,mBAAoB,OAAO,EAC9C,qBAAsB,CAAC,OAAO,EAC9B,0BAA2B,CAAC,OAAO,EACnC,UAAa,MACb,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,4BAA6B,iBAC7B,2CAA4C,iBAC5C,yCAA0C,iBAC1C,GAAM,GACN,UAAW,CAAC,mBAAoB,OAAO,EACvC,KAAQ,GACR,YAAa,CAAC,mBAAoB,OAAO,EACzC,aAAc,UACd,kBAAmB,QACnB,aAAc,UACd,kBAAmB,QACnB,WAAc,SACd,kBAAmB,CAAC,mBAAoB,OAAO,EAC/C,QAAW,OACX,eAAgB,CAAC,mBAAoB,OAAO,EAC5C,SAAY,SACZ,gBAAiB,CAAC,mBAAoB,OAAO,EAC7C,YAAe,GACf,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,SAAY,GACZ,gBAAiB,CAAC,mBAAoB,OAAO,EAC7C,oBAAqB,QACrB,yBAA0B,QAC1B,KAAQ,GACR,YAAa,CAAC,mBAAoB,OAAO,EACzC,QAAW,mBACX,eAAkB,WAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,kBAAqB,WACrB,yBAA0B,CAAC,mBAAoB,OAAO,EACtD,aAAgB,WAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,oBAAuB,WACvB,2BAA4B,CAAC,mBAAoB,OAAO,EACxD,iBAAoB,WACpB,wBAAyB,CAAC,mBAAoB,OAAO,EACrD,iBAAoB,WACpB,wBAAyB,CAAC,mBAAoB,OAAO,EACrD,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,mBAAoB,UACpB,wBAAyB,UACzB,kBAAmB,QACnB,uBAAwB,QACxB,aAAc,UACd,kBAAmB,UACnB,eAAkB,GAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,IAAO,CAAC,kBAAmB,QAAQ,EACnC,WAAY,CAAC,mBAAoB,OAAO,EACxC,iBAAkB,oBAClB,sBAAuB,CAAC,mBAAoB,UAAW,OAAO,EAC9D,mBAAoB,UACpB,wBAAyB,UACzB,YAAa,CAAC,mBAAoB,OAAO,EACzC,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,kBAAmB,QACnB,uBAAwB,QACxB,YAAe,aACf,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,YAAe,oBACf,UAAa,YACb,iBAAkB,CAAC,mBAAoB,OAAO,EAC9C,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,aAAgB,QAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,KAAQ,GACR,YAAa,CAAC,mBAAoB,OAAO,EACzC,aAAc,UACd,kBAAmB,QACnB,qBAAsB,gBACtB,mBAAoB,CAAC,gBAAiB,gBAAgB,EACtD,qBAAsB,CAAC,gBAAiB,gBAAgB,EACxD,qBAAsB,CAAC,gBAAiB,gBAAgB,EACxD,qBAAsB,CAAC,gBAAiB,gBAAgB,EACxD,wBAAyB,CAAC,gBAAiB,gBAAgB,EAC3D,qBAAsB,CAAC,gBAAiB,gBAAgB,EACxD,GAAM,OACN,UAAW,CAAC,mBAAoB,OAAO,EACvC,GAAM,GACN,UAAW,CAAC,mBAAoB,OAAO,EACvC,KAAQ,CAAC,oBAAqB,mBAAoB,OAAO,EACzD,YAAa,CAAC,mBAAoB,OAAO,EACzC,eAAkB,UAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,KAAQ,SACR,YAAa,CAAC,mBAAoB,OAAO,CAC1C,IC/JA,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,IAAIC,GAAS,KAEb,SAASC,GAAkBC,EAASC,EAAW,CAM9C,QALIC,EAAYF,EAAQ,MAAM,GAAG,EAC7BG,EAAQF,EAAU,MAAM,GAAG,EAC3BG,EAAKD,EAAM,OAAS,EAAIA,EAAM,CAAC,EAAI,IACnCE,GAAgBF,EAAM,OAAS,EAAIA,EAAM,CAAC,EAAIA,EAAM,CAAC,GAAG,MAAM,GAAG,EAE5DG,EAAI,EAAGA,EAAI,EAAG,EAAEA,EAAG,CAC3B,IAAIC,EAAM,SAASL,EAAUI,CAAC,GAAK,EAAG,EAAE,EACpCE,EAAM,SAASH,EAAaC,CAAC,GAAK,EAAG,EAAE,EAC3C,GAAIC,IAAQC,EAGZ,OAAIJ,IAAO,IACHG,EAAMC,EAEVJ,IAAO,KACHG,GAAOC,EAER,EACR,CACA,OAAOJ,IAAO,IACf,CAEA,SAASK,GAAaT,EAASU,EAAO,CACrC,IAAIC,EAAaD,EAAM,MAAM,QAAQ,EACrC,GAAIC,EAAW,SAAW,EACzB,MAAO,GAER,QAASL,EAAI,EAAGA,EAAIK,EAAW,OAAQ,EAAEL,EACxC,GAAI,CAACP,GAAkBC,EAASW,EAAWL,CAAC,CAAC,EAC5C,MAAO,GAGT,MAAO,EACR,CAEA,SAASM,GAAgBC,EAAaC,EAAgB,CACrD,GAAI,OAAOA,GAAmB,UAC7B,OAAOA,EAGR,IAAId,EAAU,OAAOa,EAAgB,IAClC,QAAQ,UAAY,QAAQ,SAAS,KACrCA,EAEH,GAAI,OAAOb,GAAY,SACtB,MAAM,IAAI,UAAU,OAAOa,EAAgB,IAAc,2CAA6C,+CAA+C,EAGtJ,GAAIC,GAAkB,OAAOA,GAAmB,SAAU,CACzD,QAASR,EAAI,EAAGA,EAAIQ,EAAe,OAAQ,EAAER,EAC5C,GAAIG,GAAaT,EAASc,EAAeR,CAAC,CAAC,EAC1C,MAAO,GAGT,MAAO,EACR,CACA,OAAOG,GAAaT,EAASc,CAAc,CAC5C,CAEA,IAAIC,GAAO,KAEXnB,GAAO,QAAU,SAAgBoB,EAAGH,EAAa,CAChD,OAAOf,GAAOiB,GAAMC,CAAC,GAAKJ,GAAgBC,EAAaE,GAAKC,CAAC,CAAC,CAC/D,ICpEA,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAAA,IAAIC,GAAK,EAAQ,IAAI,EACjBC,GAAa,KACbC,GAAO,EAAQ,MAAM,EACrBC,GAAS,KACTC,GAAmB,KACnBC,GAAmB,KACnBC,GAAS,KAETC,GAAa,QAAQ,WAAa,SAAWP,GAAG,UAAY,OAAOA,GAAG,SAAS,QAAW,WAAaA,GAAG,SAAS,OAASA,GAAG,SAE/HQ,GAAUP,GAAW,EACrBQ,GAAe,UAAY,CAC3B,MAAO,CACHP,GAAK,KAAKM,GAAS,eAAe,EAClCN,GAAK,KAAKM,GAAS,iBAAiB,CACxC,CACJ,EAEIE,GAAgB,SAAgBC,EAAMC,EAAI,CAC1CZ,GAAG,KAAKW,EAAM,SAAUE,EAAKC,EAAM,CAC/B,OAAKD,EAGDA,EAAI,OAAS,UAAYA,EAAI,OAAS,UAAkBD,EAAG,KAAM,EAAK,EACnEA,EAAGC,CAAG,EAHFD,EAAG,KAAME,EAAK,OAAO,GAAKA,EAAK,OAAO,CAAC,CAItD,CAAC,CACL,EAEIC,GAAe,SAAqBC,EAAKJ,EAAI,CAC7CZ,GAAG,KAAKgB,EAAK,SAAUH,EAAKC,EAAM,CAC9B,OAAKD,EAGDA,EAAI,OAAS,UAAYA,EAAI,OAAS,UAAkBD,EAAG,KAAM,EAAK,EACnEA,EAAGC,CAAG,EAHFD,EAAG,KAAME,EAAK,YAAY,CAAC,CAI1C,CAAC,CACL,EAEIG,GAAkB,SAAkBC,EAAGN,EAAI,CAC3CL,GAAWW,EAAG,SAAUC,EAAaC,EAAU,CACvCD,GAAeA,EAAY,OAAS,SAAUP,EAAGO,CAAW,EAC3DP,EAAG,KAAMO,EAAcD,EAAIE,CAAQ,CAC5C,CAAC,CACL,EAEIC,GAAgB,SAAuBC,EAAUJ,EAAGK,EAAMX,EAAI,CAC1DW,GAAQA,EAAK,mBAAqB,GAClCD,EAASJ,EAAGN,CAAE,EAEdA,EAAG,KAAMM,CAAC,CAElB,EAEIM,GAAqB,SAA4BC,EAAUC,EAASd,EAAI,CACxEa,EAASC,EAAS,SAAUC,EAAaC,EAAM,CAC3C,GAAID,EAAaf,EAAGe,CAAW,MAE3B,IAAI,CACA,IAAIE,EAAM,KAAK,MAAMD,CAAI,EACzBhB,EAAG,KAAMiB,CAAG,CAChB,MAAkB,CACdjB,EAAG,IAAI,CACX,CAER,CAAC,CACL,EAEIkB,GAAuB,SAA8BZ,EAAGa,EAAOR,EAAM,CAErE,QADIS,EAAO5B,GAAiB2B,EAAOR,EAAML,CAAC,EACjC,EAAI,EAAG,EAAIc,EAAK,OAAQ,IAC7BA,EAAK,CAAC,EAAI9B,GAAK,KAAK8B,EAAK,CAAC,EAAGd,CAAC,EAElC,OAAOc,CACX,EAEAlC,GAAO,QAAU,SAAiBoB,EAAGe,EAASC,EAAU,CACpD,IAAItB,EAAKsB,EACLX,EAAOU,EAKX,GAJI,OAAOA,GAAY,aACnBrB,EAAKW,EACLA,EAAO,CAAC,GAER,OAAOL,GAAM,SAAU,CACvB,IAAIL,EAAM,IAAI,UAAU,wBAAwB,EAChD,OAAO,QAAQ,SAAS,UAAY,CAChCD,EAAGC,CAAG,CACV,CAAC,CACL,CAEAU,EAAOlB,GAAiBa,EAAGK,CAAI,EAE/B,IAAIY,EAASZ,EAAK,QAAUb,GACxB0B,EAAcb,EAAK,aAAeR,GAClCU,EAAWF,EAAK,UAAYvB,GAAG,SAC/BsB,EAAWC,EAAK,UAAYN,GAC5BoB,EAAcd,EAAK,aAAeC,GACtC,GAAID,EAAK,UAAYA,EAAK,YAAa,CACnC,IAAIe,EAAc,IAAI,UAAU,sDAAsD,EACtF,OAAO,QAAQ,SAAS,UAAY,CAChC1B,EAAG0B,CAAW,CAClB,CAAC,CACL,CACA,IAAIC,EAAkBhB,EAAK,gBAEvBiB,EAAajB,EAAK,YAAc,CAAC,KAAK,EACtCkB,EAAqBlB,EAAK,qBAAuB,GACjDmB,EAAUnB,EAAK,SAAWrB,GAAK,QAAQC,GAAO,CAAC,EAC/CwC,EAASpB,EAAK,UAAYmB,EAE9BnB,EAAK,MAAQA,EAAK,OAASd,GAAa,EAGxC,IAAImC,EAAgB1C,GAAK,QAAQwC,CAAO,EAExCrB,GACIC,EACAsB,EACArB,EACA,SAAUV,EAAKgC,EAAW,CAClBhC,EAAKD,EAAGC,CAAG,EACViC,EAAKD,CAAS,CACvB,CACJ,EAEA,IAAIE,EACJ,SAASD,EAAKJ,EAAS,CACnB,GAAK,0CAA2C,KAAKxB,CAAC,EAClD6B,EAAM7C,GAAK,QAAQwC,EAASxB,CAAC,GACzBA,IAAM,KAAOA,IAAM,MAAQA,EAAE,MAAM,EAAE,IAAM,OAAK6B,GAAO,KACtD,MAAO,KAAK7B,CAAC,GAAK6B,IAAQL,EAC3BM,EAAgBD,EAAKxB,EAAK,QAAS0B,CAAM,EACtCC,EAAWH,EAAKxB,EAAK,QAAS0B,CAAM,MACxC,IAAIR,GAAsBnC,GAAOY,CAAC,EACrC,OAAON,EAAG,KAAMM,CAAC,EACdiC,GAAgBjC,EAAGwB,EAAS,SAAU7B,EAAKuC,EAAGvB,EAAK,CACtD,GAAIhB,EAAKD,EAAGC,CAAG,MACV,IAAIuC,EACL,OAAO/B,GAAcC,EAAU8B,EAAG7B,EAAM,SAAUV,GAAKwC,GAAO,CACtDxC,GACAD,EAAGC,EAAG,EAEND,EAAG,KAAMyC,GAAOxB,CAAG,CAE3B,CAAC,EAED,IAAIyB,EAAc,IAAI,MAAM,uBAAyBpC,EAAI,WAAayB,EAAS,GAAG,EAClFW,EAAY,KAAO,mBACnB1C,EAAG0C,CAAW,EAEtB,CAAC,EACL,CAEA,SAASL,EAAOpC,EAAK0C,EAAG1B,EAAK,CACrBhB,EAAKD,EAAGC,CAAG,EACN0C,EAAG3C,EAAG,KAAM2C,EAAG1B,CAAG,EACtBmB,EAAgBD,EAAK,SAAUlC,EAAK2C,EAAG3B,GAAK,CAC7C,GAAIhB,EAAKD,EAAGC,CAAG,UACN2C,EACLnC,GAAcC,EAAUkC,EAAGjC,EAAM,SAAUV,GAAK4C,GAAO,CAC/C5C,GACAD,EAAGC,EAAG,EAEND,EAAG,KAAM6C,GAAO5B,EAAG,CAE3B,CAAC,MACE,CACH,IAAIyB,GAAc,IAAI,MAAM,uBAAyBpC,EAAI,WAAayB,EAAS,GAAG,EAClFW,GAAY,KAAO,mBACnB1C,EAAG0C,EAAW,CAClB,CACJ,CAAC,CACL,CAEA,SAASJ,EAAWhC,EAAGwC,EAAYxB,EAAU,CACzC,IAAIyB,EAAoBD,EACpB9C,EAAKsB,EACL,OAAOyB,GAAsB,aAC7B/C,EAAK+C,EACLA,EAAoB,QAGxB,IAAIC,GAAO,CAAC,EAAE,EAAE,OAAOpB,CAAU,EACjCqB,GAAKD,GAAM1C,EAAGyC,CAAiB,EAE/B,SAASE,GAAKD,GAAM1C,GAAG4C,GAAa,CAChC,GAAIF,GAAK,SAAW,EAAG,OAAOhD,EAAG,KAAM,OAAWkD,EAAW,EAC7D,IAAInD,GAAOO,GAAI0C,GAAK,CAAC,EAEjB/B,GAAMiC,GACNjC,GAAKkC,GAAM,KAAMlC,EAAG,EACnBmC,EAAQ9D,GAAK,QAAQS,EAAI,EAAGoD,EAAK,EAEtC,SAASA,GAAMlD,GAAKoD,GAAMjD,GAAK,CAE3B,GADAa,GAAMoC,GACFpD,GAAK,OAAOD,EAAGC,EAAG,EACtB,GAAIG,IAAOa,IAAON,EAAK,WAAY,CAC/B,IAAI2C,GAAQhE,GAAK,SAASc,GAAKL,EAAI,EAC/BwD,GAAMD,GAAM,MAAM,EAAGA,GAAM,OAASN,GAAK,CAAC,EAAE,MAAM,EAClDQ,GAAI7C,EAAK,WAAWM,GAAKX,GAAGiD,EAAG,EACnC,GAAIC,GAAG,OAAOP,GACV,CAAC,EAAE,EAAE,OAAOrB,EAAW,MAAM,CAAC,EAC9BtC,GAAK,QAAQc,GAAKoD,EAAC,EACnBvC,EACJ,CACJ,CACAM,EAAOxB,GAAM0D,EAAI,CACrB,CACA,SAASA,GAAKxD,GAAKyD,GAAI,CACnB,GAAIzD,GAAK,OAAOD,EAAGC,EAAG,EACtB,GAAIyD,GAAI,OAAO1D,EAAG,KAAMD,GAAMkB,EAAG,EACjCgC,GAAKD,GAAK,MAAM,CAAC,EAAG1C,GAAGW,EAAG,CAC9B,CACJ,CACJ,CAEA,SAASmC,EAAQhD,EAAKJ,EAAI,CAKtB,GAJII,IAAQ,IAAMA,IAAQ,KACtB,QAAQ,WAAa,SAAY,cAAe,KAAKA,CAAG,GAGvD,2BAA4B,KAAKA,CAAG,EAAG,OAAOJ,EAAG,IAAI,EAE1DS,GAAcC,EAAUN,EAAKO,EAAM,SAAUgD,EAAWC,EAAQ,CAC5D,GAAID,EAAW,OAAOP,EAAQ9D,GAAK,QAAQc,CAAG,EAAGJ,CAAE,EACnD,IAAIc,EAAUxB,GAAK,KAAKsE,EAAQ,cAAc,EAC9CrC,EAAOT,EAAS,SAAUb,GAAKyD,GAAI,CAE/B,GAAI,CAACA,GAAI,OAAON,EAAQ9D,GAAK,QAAQc,CAAG,EAAGJ,CAAE,EAE7CyB,EAAYZ,EAAUC,EAAS,SAAUb,GAAK4D,GAAU,CAChD5D,IAAKD,EAAGC,EAAG,EAEf,IAAIgB,GAAM4C,GAEN5C,IAAON,EAAK,gBACZM,GAAMN,EAAK,cAAcM,GAAKH,CAAO,GAEzCd,EAAG,KAAMiB,GAAKb,CAAG,CACrB,CAAC,CACL,CAAC,CACL,CAAC,CACL,CAEA,SAASgC,EAAgB9B,EAAGwD,EAAwBxC,EAAU,CAC1D,IAAItB,EAAKsB,EACLyC,EAAOD,EACP,OAAOC,GAAS,aAChB/D,EAAK+D,EACLA,EAAOpD,EAAK,SAGhBF,GAAcC,EAAUJ,EAAGK,EAAM,SAAUgD,GAAWC,GAAQ,CAC1D,GAAID,GAAW,OAAO3D,EAAG2D,EAAS,EAClC,IAAI7C,GAAUxB,GAAK,KAAKsE,GAAQ,cAAc,EAC9CrC,EAAOT,GAAS,SAAUb,GAAKyD,GAAI,CAC/B,GAAIzD,GAAK,OAAOD,EAAGC,EAAG,EACtB,GAAI,CAACyD,GAAI,OAAOpB,EAAWhD,GAAK,KAAKgB,EAAG,OAAO,EAAGyD,EAAM/D,CAAE,EAE1DyB,EAAYZ,EAAUC,GAAS,SAAUb,GAAK4D,GAAU,CACpD,GAAI5D,GAAK,OAAOD,EAAGC,EAAG,EAEtB,IAAIgB,GAAM4C,GAMV,GAJI5C,IAAON,EAAK,gBACZM,GAAMN,EAAK,cAAcM,GAAKH,EAAO,GAGrCG,IAAOA,GAAI,KAAM,CACjB,GAAI,OAAOA,GAAI,MAAS,SAAU,CAC9B,IAAI+C,GAAY,IAAI,UAAU,iBAAc/C,GAAI,KAAO,gCAA2B,EAClF,OAAA+C,GAAU,KAAO,uBACVhE,EAAGgE,EAAS,CACvB,EACI/C,GAAI,OAAS,KAAOA,GAAI,OAAS,QACjCA,GAAI,KAAO,SAEfqB,EAAWhD,GAAK,QAAQgB,EAAGW,GAAI,IAAI,EAAGA,GAAK,SAAUhB,GAAK0C,GAAG1B,GAAK,CAC9D,GAAIhB,GAAK,OAAOD,EAAGC,EAAG,EACtB,GAAI0C,GAAG,OAAO3C,EAAG,KAAM2C,GAAG1B,EAAG,EAC7B,GAAI,CAACA,GAAK,OAAOqB,EAAWhD,GAAK,KAAKgB,EAAG,OAAO,EAAGW,GAAKjB,CAAE,EAE1D,IAAII,GAAMd,GAAK,QAAQgB,EAAGW,GAAI,IAAI,EAClCmB,EAAgBhC,GAAKa,GAAK,SAAUhB,GAAKuC,GAAGvB,GAAK,CAC7C,GAAIhB,GAAK,OAAOD,EAAGC,EAAG,EACtB,GAAIuC,GAAG,OAAOxC,EAAG,KAAMwC,GAAGvB,EAAG,EAC7BqB,EAAWhD,GAAK,KAAKgB,EAAG,OAAO,EAAGW,GAAKjB,CAAE,CAC7C,CAAC,CACL,CAAC,EACD,MACJ,CAEAsC,EAAWhD,GAAK,KAAKgB,EAAG,QAAQ,EAAGW,GAAKjB,CAAE,CAC9C,CAAC,CACL,CAAC,CACL,CAAC,CACL,CAEA,SAASiE,EAAYjE,EAAIoB,EAAM,CAC3B,GAAIA,EAAK,SAAW,EAAG,OAAOpB,EAAG,KAAM,MAAS,EAChD,IAAII,EAAMgB,EAAK,CAAC,EAEhBI,EAAYlC,GAAK,QAAQc,CAAG,EAAG8D,CAAK,EAEpC,SAASA,EAAMjE,GAAKiE,GAAO,CACvB,GAAIjE,GAAK,OAAOD,EAAGC,EAAG,EACtB,GAAI,CAACiE,GAAO,OAAOD,EAAYjE,EAAIoB,EAAK,MAAM,CAAC,CAAC,EAChDkB,EAAWlC,EAAKO,EAAK,QAAS0B,CAAM,CACxC,CAEA,SAASA,EAAOpC,GAAK0C,GAAG1B,GAAK,CACzB,GAAIhB,GAAK,OAAOD,EAAGC,EAAG,EACtB,GAAI0C,GAAG,OAAO3C,EAAG,KAAM2C,GAAG1B,EAAG,EAC7BmB,EAAgBhC,EAAKO,EAAK,QAASwD,EAAK,CAC5C,CAEA,SAASA,GAAMlE,GAAKuC,GAAGvB,GAAK,CACxB,GAAIhB,GAAK,OAAOD,EAAGC,EAAG,EACtB,GAAIuC,GAAG,OAAOxC,EAAG,KAAMwC,GAAGvB,EAAG,EAC7BgD,EAAYjE,EAAIoB,EAAK,MAAM,CAAC,CAAC,CACjC,CACJ,CACA,SAASmB,GAAgBjC,EAAGa,EAAOnB,EAAI,CACnC,IAAIoE,EAAQ,UAAY,CAAE,OAAOlD,GAAqBZ,EAAGa,EAAOR,CAAI,CAAG,EACvEsD,EACIjE,EACA2B,EAAkBA,EAAgBrB,EAAGa,EAAOiD,EAAOzD,CAAI,EAAIyD,EAAM,CACrE,CACJ,CACJ,ICxUA,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,CAAAA,GAAA,SACC,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,gBAAiB,QACjB,qBAAsB,QACtB,YAAe,OACf,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,eAAkB,oBAClB,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,cAAiB,GACjB,qBAAsB,CAAC,mBAAoB,OAAO,EAClD,QAAW,SACX,eAAgB,CAAC,mBAAoB,OAAO,EAC5C,QAAW,GACX,eAAgB,CAAC,mBAAoB,OAAO,EAC5C,UAAa,GACb,iBAAkB,CAAC,mBAAoB,OAAO,EAC9C,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,aAAgB,cAChB,UAAa,MACb,MAAS,GACT,aAAc,CAAC,mBAAoB,OAAO,EAC1C,oBAAuB,CAAC,mBAAoB,SAAS,EACrD,2BAA4B,CAAC,mBAAoB,OAAO,EACxD,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,eAAgB,QAChB,oBAAqB,QACrB,OAAU,YACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,SAAY,MACZ,GAAM,GACN,UAAW,CAAC,mBAAoB,OAAO,EACvC,cAAe,CAAC,kBAAmB,OAAO,EAC1C,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,YAAe,YACf,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,aAAgB,YAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,aAAgB,YAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,eAAkB,YAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,eAAkB,YAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,aAAgB,YAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,KAAQ,GACR,YAAa,CAAC,mBAAoB,OAAO,EACzC,MAAS,SACT,aAAc,CAAC,mBAAoB,OAAO,EAC1C,MAAS,GACT,aAAc,CAAC,mBAAoB,OAAO,EAC1C,UAAa,OACb,iBAAkB,CAAC,mBAAoB,OAAO,EAC9C,qBAAsB,CAAC,OAAO,EAC9B,0BAA2B,CAAC,OAAO,EACnC,UAAa,MACb,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,4BAA6B,iBAC7B,2CAA4C,iBAC5C,yCAA0C,iBAC1C,GAAM,GACN,UAAW,CAAC,mBAAoB,OAAO,EACvC,KAAQ,GACR,YAAa,CAAC,mBAAoB,OAAO,EACzC,aAAc,UACd,kBAAmB,QACnB,aAAc,UACd,kBAAmB,QACnB,WAAc,SACd,kBAAmB,CAAC,mBAAoB,OAAO,EAC/C,QAAW,OACX,eAAgB,CAAC,mBAAoB,OAAO,EAC5C,SAAY,SACZ,gBAAiB,CAAC,mBAAoB,OAAO,EAC7C,YAAe,GACf,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,SAAY,GACZ,gBAAiB,CAAC,mBAAoB,OAAO,EAC7C,oBAAqB,QACrB,yBAA0B,QAC1B,KAAQ,GACR,YAAa,CAAC,mBAAoB,OAAO,EACzC,QAAW,mBACX,eAAkB,WAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,kBAAqB,WACrB,yBAA0B,CAAC,mBAAoB,OAAO,EACtD,aAAgB,WAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,oBAAuB,WACvB,2BAA4B,CAAC,mBAAoB,OAAO,EACxD,iBAAoB,WACpB,wBAAyB,CAAC,mBAAoB,OAAO,EACrD,iBAAoB,WACpB,wBAAyB,CAAC,mBAAoB,OAAO,EACrD,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,mBAAoB,UACpB,wBAAyB,UACzB,kBAAmB,QACnB,uBAAwB,QACxB,aAAc,UACd,kBAAmB,UACnB,eAAkB,GAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,IAAO,CAAC,kBAAmB,QAAQ,EACnC,WAAY,CAAC,mBAAoB,OAAO,EACxC,iBAAkB,oBAClB,sBAAuB,CAAC,mBAAoB,UAAW,OAAO,EAC9D,YAAa,CAAC,mBAAoB,OAAO,EACzC,OAAU,GACV,cAAe,CAAC,mBAAoB,OAAO,EAC3C,kBAAmB,QACnB,uBAAwB,QACxB,YAAe,aACf,mBAAoB,CAAC,mBAAoB,OAAO,EAChD,YAAe,oBACf,UAAa,YACb,iBAAkB,CAAC,mBAAoB,OAAO,EAC9C,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,aAAgB,QAChB,oBAAqB,CAAC,mBAAoB,OAAO,EACjD,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,IAAO,GACP,WAAY,CAAC,mBAAoB,OAAO,EACxC,KAAQ,GACR,YAAa,CAAC,mBAAoB,OAAO,EACzC,aAAc,UACd,kBAAmB,QACnB,qBAAsB,gBACtB,mBAAoB,CAAC,gBAAiB,gBAAgB,EACtD,qBAAsB,CAAC,gBAAiB,gBAAgB,EACxD,qBAAsB,CAAC,gBAAiB,gBAAgB,EACxD,qBAAsB,CAAC,gBAAiB,gBAAgB,EACxD,wBAAyB,CAAC,gBAAiB,gBAAgB,EAC3D,qBAAsB,CAAC,gBAAiB,gBAAgB,EACxD,GAAM,OACN,UAAW,CAAC,mBAAoB,OAAO,EACvC,GAAM,GACN,UAAW,CAAC,mBAAoB,OAAO,EACvC,KAAQ,CAAC,oBAAqB,mBAAoB,OAAO,EACzD,YAAa,CAAC,mBAAoB,OAAO,EACzC,eAAkB,UAClB,sBAAuB,CAAC,mBAAoB,OAAO,EACnD,KAAQ,SACR,YAAa,CAAC,mBAAoB,OAAO,CAC1C,IC7JA,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,IAAIC,GAAe,KACfC,GAAO,KAEPC,GAAO,CAAC,EACZ,IAASC,MAAOF,GACR,OAAO,UAAU,eAAe,KAAKA,GAAME,EAAG,IAC9CD,GAAKC,EAAG,EAAIH,GAAaG,EAAG,GAF3B,IAAAA,GAKTL,GAAO,QAAUI,KCXjB,IAAAE,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAAA,IAAIC,GAAe,KAEnBF,GAAO,QAAU,SAAgBG,EAAG,CAChC,OAAOD,GAAaC,CAAC,CACzB,ICJA,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAAA,IAAIC,GAAS,KACTC,GAAK,EAAQ,IAAI,EACjBC,GAAO,EAAQ,MAAM,EACrBC,GAAa,KACbC,GAAS,KACTC,GAAmB,KACnBC,GAAmB,KAEnBC,GAAa,QAAQ,WAAa,SAAWN,GAAG,cAAgB,OAAOA,GAAG,aAAa,QAAW,WAAaA,GAAG,aAAa,OAASA,GAAG,aAE3IO,GAAUL,GAAW,EACrBM,GAAe,UAAY,CAC3B,MAAO,CACHP,GAAK,KAAKM,GAAS,eAAe,EAClCN,GAAK,KAAKM,GAAS,iBAAiB,CACxC,CACJ,EAEIE,GAAgB,SAAgBC,EAAM,CACtC,GAAI,CACA,IAAIC,EAAOX,GAAG,SAASU,EAAM,CAAE,eAAgB,EAAM,CAAC,CAC1D,OAASE,EAAG,CACR,GAAIA,IAAMA,EAAE,OAAS,UAAYA,EAAE,OAAS,WAAY,MAAO,GAC/D,MAAMA,CACV,CACA,MAAO,CAAC,CAACD,IAASA,EAAK,OAAO,GAAKA,EAAK,OAAO,EACnD,EAEIE,GAAe,SAAqBC,EAAK,CACzC,GAAI,CACA,IAAIH,EAAOX,GAAG,SAASc,EAAK,CAAE,eAAgB,EAAM,CAAC,CACzD,OAASF,EAAG,CACR,GAAIA,IAAMA,EAAE,OAAS,UAAYA,EAAE,OAAS,WAAY,MAAO,GAC/D,MAAMA,CACV,CACA,MAAO,CAAC,CAACD,GAAQA,EAAK,YAAY,CACtC,EAEII,GAAsB,SAAsBC,EAAG,CAC/C,GAAI,CACA,OAAOV,GAAWU,CAAC,CACvB,OAASC,EAAa,CAClB,GAAIA,EAAY,OAAS,SACrB,MAAMA,CAEd,CACA,OAAOD,CACX,EAEIE,GAAoB,SAA2BC,EAAcH,EAAGI,EAAM,CACtE,OAAIA,GAAQA,EAAK,mBAAqB,GAC3BD,EAAaH,CAAC,EAElBA,CACX,EAEIK,GAAyB,SAAgCC,EAAcC,EAAS,CAChF,IAAIC,EAAOF,EAAaC,CAAO,EAC/B,GAAI,CACA,IAAIE,EAAM,KAAK,MAAMD,CAAI,EACzB,OAAOC,CACX,MAAkB,CAAC,CACvB,EAEIC,GAAuB,SAA8BV,EAAGW,EAAOP,EAAM,CAErE,QADIQ,EAAOxB,GAAiBuB,EAAOP,EAAMJ,CAAC,EACjC,EAAI,EAAG,EAAIY,EAAK,OAAQ,IAC7BA,EAAK,CAAC,EAAI3B,GAAK,KAAK2B,EAAK,CAAC,EAAGZ,CAAC,EAElC,OAAOY,CACX,EAEA/B,GAAO,QAAU,SAAqBmB,EAAGa,EAAS,CAC9C,GAAI,OAAOb,GAAM,SACb,MAAM,IAAI,UAAU,wBAAwB,EAEhD,IAAII,EAAOf,GAAiBW,EAAGa,CAAO,EAElCC,EAASV,EAAK,QAAUX,GACxBa,EAAeF,EAAK,cAAgBpB,GAAG,aACvC+B,EAAcX,EAAK,aAAeP,GAClCM,EAAeC,EAAK,cAAgBL,GACpCiB,EAAkBZ,EAAK,iBAAmBC,GAC9C,GAAID,EAAK,cAAgBA,EAAK,gBAC1B,MAAM,IAAI,UAAU,8DAA8D,EAEtF,IAAIa,EAAkBb,EAAK,gBAEvBc,EAAad,EAAK,YAAc,CAAC,KAAK,EACtCe,EAAqBf,EAAK,qBAAuB,GACjDgB,EAAUhB,EAAK,SAAWnB,GAAK,QAAQE,GAAO,CAAC,EAC/CkC,EAASjB,EAAK,UAAYgB,EAE9BhB,EAAK,MAAQA,EAAK,OAASZ,GAAa,EAGxC,IAAI8B,EAAgBpB,GAAkBC,EAAclB,GAAK,QAAQmC,CAAO,EAAGhB,CAAI,EAE/E,GAAK,0CAA2C,KAAKJ,CAAC,EAAG,CACrD,IAAIuB,EAAMtC,GAAK,QAAQqC,EAAetB,CAAC,GACnCA,IAAM,KAAOA,IAAM,MAAQA,EAAE,MAAM,EAAE,IAAM,OAAKuB,GAAO,KAC3D,IAAIC,EAAIC,EAAeF,CAAG,GAAKG,EAAoBH,CAAG,EACtD,GAAIC,EAAG,OAAOtB,GAAkBC,EAAcqB,EAAGpB,CAAI,CACzD,KAAO,IAAIe,GAAsBpC,GAAOiB,CAAC,EACrC,OAAOA,EAEP,IAAI2B,EAAIC,EAAoB5B,EAAGsB,CAAa,EAC5C,GAAIK,EAAG,OAAOzB,GAAkBC,EAAcwB,EAAGvB,CAAI,EAGzD,IAAIyB,EAAM,IAAI,MAAM,uBAAyB7B,EAAI,WAAaqB,EAAS,GAAG,EAC1E,MAAAQ,EAAI,KAAO,mBACLA,EAEN,SAASJ,EAAe,EAAG,CACvB,IAAIhB,EAAMqB,EAAQ7C,GAAK,QAAQ,CAAC,CAAC,EAEjC,GAAIwB,GAAOA,EAAI,KAAOA,EAAI,KAAOL,EAAK,WAAY,CAC9C,IAAI2B,EAAQ9C,GAAK,SAASwB,EAAI,IAAK,CAAC,EAChCuB,GAAI5B,EAAK,WAAWK,EAAI,IAAK,EAAGsB,CAAK,EACrCC,KACA,EAAI/C,GAAK,QAAQwB,EAAI,IAAKuB,EAAC,EAEnC,CAEA,GAAIlB,EAAO,CAAC,EACR,OAAO,EAGX,QAASmB,EAAI,EAAGA,EAAIf,EAAW,OAAQe,IAAK,CACxC,IAAIvC,EAAO,EAAIwB,EAAWe,CAAC,EAC3B,GAAInB,EAAOpB,CAAI,EACX,OAAOA,CAEf,CACJ,CAEA,SAASoC,EAAQhC,EAAK,CAClB,GAAI,EAAAA,IAAQ,IAAMA,IAAQ,MACtB,UAAQ,WAAa,SAAY,cAAe,KAAKA,CAAG,IAGvD,4BAA4B,KAAKA,CAAG,EAEzC,KAAIS,EAAUtB,GAAK,KAAKiB,GAAkBC,EAAcL,EAAKM,CAAI,EAAG,cAAc,EAElF,GAAI,CAACU,EAAOP,CAAO,EACf,OAAOuB,EAAQ7C,GAAK,QAAQa,CAAG,CAAC,EAGpC,IAAIW,EAAMO,EAAgBV,EAAcC,CAAO,EAE/C,OAAIE,GAAOL,EAAK,gBAEZK,EAAML,EAAK,cAAcK,EAAkBX,CAAG,GAG3C,CAAE,IAAKW,EAAK,IAAKX,CAAI,EAChC,CAEA,SAAS4B,EAAoB,EAAG,CAC5B,IAAInB,EAAUtB,GAAK,KAAKiB,GAAkBC,EAAc,EAAGC,CAAI,EAAG,eAAe,EACjF,GAAIU,EAAOP,CAAO,EAAG,CACjB,GAAI,CACA,IAAIE,EAAMO,EAAgBV,EAAcC,CAAO,CACnD,MAAY,CAAC,CAOb,GALIE,GAAOL,EAAK,gBAEZK,EAAML,EAAK,cAAcK,EAAkB,CAAC,GAG5CA,GAAOA,EAAI,KAAM,CACjB,GAAI,OAAOA,EAAI,MAAS,SAAU,CAC9B,IAAIyB,GAAY,IAAI,UAAU,iBAAczB,EAAI,KAAO,gCAA2B,EAClF,MAAAyB,GAAU,KAAO,uBACXA,EACV,EACIzB,EAAI,OAAS,KAAOA,EAAI,OAAS,QACjCA,EAAI,KAAO,SAEf,GAAI,CACA,IAAIe,EAAIC,EAAexC,GAAK,QAAQ,EAAGwB,EAAI,IAAI,CAAC,EAChD,GAAIe,EAAG,OAAOA,EACd,IAAIG,EAAID,EAAoBzC,GAAK,QAAQ,EAAGwB,EAAI,IAAI,CAAC,EACrD,GAAIkB,EAAG,OAAOA,CAClB,MAAY,CAAC,CACjB,CACJ,CAEA,OAAOF,EAAexC,GAAK,KAAK,EAAG,QAAQ,CAAC,CAChD,CAEA,SAAS2C,EAAoB,EAAGjB,EAAO,CAInC,QAHIwB,EAAQ,UAAY,CAAE,OAAOzB,GAAqB,EAAGC,EAAOP,CAAI,CAAG,EACnEQ,GAAOK,EAAkBA,EAAgB,EAAGN,EAAOwB,EAAO/B,CAAI,EAAI+B,EAAM,EAEnEF,EAAI,EAAGA,EAAIrB,GAAK,OAAQqB,IAAK,CAClC,IAAInC,EAAMc,GAAKqB,CAAC,EAChB,GAAIlB,EAAY9B,GAAK,QAAQa,CAAG,CAAC,EAAG,CAChC,IAAI0B,EAAIC,EAAe3B,CAAG,EAC1B,GAAI0B,EAAG,OAAOA,EACd,IAAIG,EAAID,EAAoB5B,CAAG,EAC/B,GAAI6B,EAAG,OAAOA,CAClB,CACJ,CACJ,CACJ,IC/MA,IAAAS,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAAA,IAAIC,GAAQ,KACZA,GAAM,KAAO,KACbA,GAAM,OAAS,KACfA,GAAM,KAAO,KAEbF,GAAO,QAAUE,KCLjB,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,IAAIC,GAAO,EAAQ,MAAM,EAEzBF,GAAO,QAAU,SAAUG,EAAM,CAC/B,IAAIC,EAAWD,EAAK,MAAMD,GAAK,GAAG,EAC9BG,EAAQD,EAAS,YAAY,cAAc,EAC/C,GAAIC,IAAU,IACTD,EAASC,EAAQ,CAAC,EACvB,KAAIC,EAASF,EAASC,EAAQ,CAAC,EAAE,CAAC,IAAM,IACpCE,EAAOD,EAASF,EAASC,EAAQ,CAAC,EAAI,IAAMD,EAASC,EAAQ,CAAC,EAAID,EAASC,EAAQ,CAAC,EACpFG,EAASF,EAAS,EAAI,EAC1B,MAAO,CACL,KAAMC,EACN,QAASH,EAAS,MAAM,EAAGC,EAAQG,CAAM,EAAE,KAAKN,GAAK,GAAG,EACxD,KAAME,EAAS,MAAMC,EAAQG,CAAM,EAAE,KAAKN,GAAK,GAAG,CACpD,EACF,ICjBA,IAAAO,GAAAC,EAAA,CAAAC,GAAAC,KAAA,CAAAA,GAAA,SACE,KAAQ,wBACR,QAAW,QACX,YAAe,mDACf,KAAQ,WACR,MAAS,mBACT,aAAgB,CACd,MAAS,SACT,2BAA4B,SAC5B,QAAW,SACb,EACA,gBAAmB,CACjB,cAAe,SACf,oBAAqB,SACrB,2BAA4B,SAC5B,kBAAmB,SACnB,cAAe,SACf,SAAY,SACZ,WAAc,SACd,OAAU,SACV,SAAY,UACZ,KAAQ,SACV,EACA,QAAW,CACT,KAAQ,+DACR,YAAa,WACb,YAAa,iBACb,aAAc,mCAChB,EACA,WAAc,CACZ,KAAQ,MACR,IAAO,0DACT,EACA,SAAY,CACV,UACA,OACA,OACA,UACA,WACA,QACA,SACA,cACA,SACA,MACF,EACA,MAAS,CACP,OACF,EACA,OAAU,+DACV,QAAW,MACX,KAAQ,CACN,IAAO,yDACT,EACA,SAAY,0DACZ,QAAW,CACT,KAAQ,SACV,CACF,ICzDA,IAAAC,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAEA,IAAMC,GAAO,EAAQ,MAAM,EACrBC,GAAS,EAAQ,QAAQ,EACzBC,GAAU,KACVC,GAAQ,KAAiB,uBAAuB,EAChDC,GAAwB,KAK9BN,GAAO,QAAUO,GACjBP,GAAO,QAAQ,KAAOO,GAQtB,IAAIC,GACJ,GAAIL,GAAO,UACTK,GAASL,GAAO,cACX,CACL,GAAM,CAACM,EAAOC,CAAK,EAAI,QAAQ,SAAS,KAAK,MAAM,GAAG,EAAE,IAAI,MAAM,EAC9DD,IAAU,GAAKC,EAAQ,EAMzBF,GAASG,GACHA,IAAe,QACV,GAIF,CAAC,CAACP,GAAQ,KAAKO,CAAU,EAGlCH,GAASG,GAGA,CAAC,CAACP,GAAQ,KAAKO,CAAU,CAGtC,CAGA,IAAMC,GAAY,wBAeZC,GAAN,KAAmB,CACjB,aAAe,CACb,KAAK,YAAc,IAAI,IACvB,KAAK,cAAgB,OAAO,aAAa,CAC3C,CAEA,IAAKC,EAAUC,EAAW,CACxB,GAAI,KAAK,YAAY,IAAID,CAAQ,EAC/B,MAAO,GACF,GAAKC,EAIV,MAAO,GAJc,CACrB,IAAMC,EAAMC,EAAQ,MAAMH,CAAQ,EAClC,MAAO,CAAC,EAAEE,GAAO,KAAK,iBAAiBA,EACzC,CAGF,CAEA,IAAKF,EAAUC,EAAW,CACxB,IAAMG,EAAgB,KAAK,YAAY,IAAIJ,CAAQ,EACnD,GAAII,IAAkB,OACpB,OAAOA,EACF,GAAI,CAACH,EAAW,CACrB,IAAMC,EAAMC,EAAQ,MAAMH,CAAQ,EAClC,OAAQE,GAAOA,EAAI,KAAK,aAAa,CACvC,CACF,CAEA,IAAKF,EAAUf,EAASgB,EAAW,CAC7BA,EACF,KAAK,YAAY,IAAID,EAAUf,CAAO,EAC7Be,KAAYG,EAAQ,MAC7BA,EAAQ,MAAMH,CAAQ,EAAE,KAAK,aAAa,EAAIf,GAE9CM,GAAM,6DAA8DS,CAAQ,EAC5E,KAAK,YAAY,IAAIA,EAAUf,CAAO,EAE1C,CACF,EAEA,SAASQ,GAAMY,EAASC,EAASC,EAAW,CAC1C,GAAK,kBAAgBd,IAAiB,OAAO,IAAIA,GAAKY,EAASC,EAASC,CAAS,EAUjF,GATI,OAAOF,GAAY,YACrBE,EAAYF,EACZA,EAAU,KACVC,EAAU,MACD,OAAOA,GAAY,aAC5BC,EAAYD,EACZA,EAAU,MAGR,OAAOjB,GAAO,kBAAqB,WAAY,CACjD,QAAQ,MAAM,iFAAkF,OAAOA,GAAO,gBAAgB,EAC9H,QAAQ,MAAM,mEAAoE,QAAQ,QAAS,KAA0B,KAAK,GAAG,EACrI,MACF,CAEA,KAAK,OAAS,IAAIU,GAElB,KAAK,UAAY,GACjB,KAAK,aAAeV,GAAO,UAAU,QAErC,IAAMmB,EAAO,KACPC,EAAW,IAAI,IACfC,EAAYJ,EAAUA,EAAQ,YAAc,GAAO,GACnDK,EAAe,MAAM,QAAQN,CAAO,EAE1Cd,GAAM,0BAA0B,EAEhC,KAAK,SAAWF,GAAO,UAAU,QAAU,SAAUuB,EAAI,CACvD,OAAIJ,EAAK,YAAc,IAIrBjB,GAAM,iDAAiD,EAChDiB,EAAK,aAAa,MAAM,KAAM,SAAS,GAGzCK,EAAe,KAAK,KAAM,UAAW,EAAK,CACnD,EAEI,OAAO,QAAQ,kBAAqB,aACtC,KAAK,sBAAwB,QAAQ,iBACrC,KAAK,kBAAoB,QAAQ,iBAAmB,SAAUD,EAAI,CAChE,OAAIJ,EAAK,YAAc,IAIrBjB,GAAM,kEAAkE,EACjEiB,EAAK,sBAAsB,MAAM,KAAM,SAAS,GAGlDK,EAAe,KAAK,KAAM,UAAW,EAAI,CAClD,GAIF,SAASA,EAAgBC,EAAMC,EAAU,CACvC,IAAMH,EAAKE,EAAK,CAAC,EACXE,EAAOtB,GAAOkB,CAAE,EAClBZ,EACJ,GAAIgB,GAIF,GAHAhB,EAAWY,EAGPA,EAAG,WAAW,OAAO,EAAG,CAC1B,IAAMK,EAAkBL,EAAG,MAAM,CAAC,EAC9BlB,GAAOuB,CAAe,IACxBjB,EAAWiB,EAEf,MACK,IAAIF,EAIT,OAAAxB,GAAM,2DAA2D,EAC1DiB,EAAK,sBAAsB,MAAM,KAAMM,CAAI,EAElD,GAAI,CACFd,EAAWX,GAAO,iBAAiBuB,EAAI,IAAI,CAC7C,OAASM,EAAY,CASnB,OAAA3B,GAAM,0EAA2EqB,EAAIM,EAAW,OAAO,EAChGV,EAAK,aAAa,MAAM,KAAMM,CAAI,CAC3C,EAGF,IAAIjB,EAAYsB,EAKhB,GAHA5B,GAAM,yCAA4CyB,IAAS,GAAO,OAAS,WAAYJ,EAAIZ,CAAQ,EAG/FQ,EAAK,OAAO,IAAIR,EAAUgB,CAAI,IAAM,GACtC,OAAAzB,GAAM,8CAA+CS,CAAQ,EACtDQ,EAAK,OAAO,IAAIR,EAAUgB,CAAI,EAKvC,IAAMI,EAAaX,EAAS,IAAIT,CAAQ,EACpCoB,IAAe,IACjBX,EAAS,IAAIT,CAAQ,EAGvB,IAAMf,EAAU8B,EACZP,EAAK,sBAAsB,MAAM,KAAMM,CAAI,EAC3CN,EAAK,aAAa,MAAM,KAAMM,CAAI,EAGtC,GAAIM,IAAe,GACjB,OAAA7B,GAAM,mEAAoES,CAAQ,EAC3Ef,EAOT,GAFAwB,EAAS,OAAOT,CAAQ,EAEpBgB,IAAS,GAAM,CACjB,GAAIL,IAAiB,IAAQN,EAAQ,SAASL,CAAQ,IAAM,GAC1D,OAAAT,GAAM,4CAA6CS,CAAQ,EACpDf,EAETY,EAAaG,CACf,SAAWW,IAAiB,IAAQN,EAAQ,SAASL,CAAQ,EAAG,CAE9D,IAAMqB,EAAajC,GAAK,MAAMY,CAAQ,EACtCH,EAAawB,EAAW,KACxBF,EAAUE,EAAW,GACvB,KAAO,CACL,IAAMC,EAAO9B,GAAsBQ,CAAQ,EAC3C,GAAIsB,IAAS,OACX,OAAA/B,GAAM,+BAAgCS,CAAQ,EACvCf,EAETY,EAAayB,EAAK,KAClBH,EAAUG,EAAK,QAKf,IAAMC,EAAiBC,GAAkBF,CAAI,EAE7C/B,GAAM,sEAAuEM,EAAYe,EAAIW,EAAgBJ,CAAO,EAEpH,IAAIM,EAAa,GACjB,GAAId,EAAc,CAYhB,GAXI,CAACC,EAAG,WAAW,GAAG,GAAKP,EAAQ,SAASO,CAAE,IAM5Cf,EAAae,EACba,EAAa,IAIX,CAACpB,EAAQ,SAASR,CAAU,GAAK,CAACQ,EAAQ,SAASkB,CAAc,EACnE,OAAOtC,EAGLoB,EAAQ,SAASkB,CAAc,GAAKA,IAAmB1B,IAEzDA,EAAa0B,EACbE,EAAa,GAEjB,CAEA,GAAI,CAACA,EAAY,CAEf,IAAIC,EACJ,GAAI,CACFA,EAAMpC,GAAQ,KAAKO,EAAY,CAAE,QAAAsB,CAAQ,CAAC,CAC5C,MAAY,CACV,OAAA5B,GAAM,+BAAgCM,CAAU,EAChDW,EAAK,OAAO,IAAIR,EAAUf,EAAS+B,CAAI,EAChC/B,CACT,CAEA,GAAIyC,IAAQ1B,EAEV,GAAIU,IAAc,GAEhBb,EAAaA,EAAaT,GAAK,IAAMA,GAAK,SAAS+B,EAASnB,CAAQ,EACpET,GAAM,oDAAqDM,CAAU,MAErE,QAAAN,GAAM,+CAAgDmC,CAAG,EACzDlB,EAAK,OAAO,IAAIR,EAAUf,EAAS+B,CAAI,EAChC/B,CAGb,CACF,CAIAuB,EAAK,OAAO,IAAIR,EAAUf,EAAS+B,CAAI,EACvCzB,GAAM,2BAA4BM,CAAU,EAC5C,IAAM8B,EAAiBpB,EAAUtB,EAASY,EAAYsB,CAAO,EAC7D,OAAAX,EAAK,OAAO,IAAIR,EAAU2B,EAAgBX,CAAI,EAE9CzB,GAAM,uBAAwBM,CAAU,EACjC8B,CACT,CACF,CAEAlC,GAAK,UAAU,OAAS,UAAY,CAClC,KAAK,UAAY,GAEb,KAAK,WAAaJ,GAAO,UAAU,SACrCA,GAAO,UAAU,QAAU,KAAK,aAChCE,GAAM,2BAA2B,GAEjCA,GAAM,6BAA6B,EAGjC,QAAQ,mBAAqB,SAC3B,KAAK,oBAAsB,QAAQ,kBACrC,QAAQ,iBAAmB,KAAK,sBAChCA,GAAM,4CAA4C,GAElDA,GAAM,8CAA8C,EAG1D,EAEA,SAASiC,GAAmBF,EAAM,CAChC,IAAMM,EAAiBxC,GAAK,MAAQ,IAAMkC,EAAK,KAAK,MAAMlC,GAAK,GAAG,EAAE,KAAK,GAAG,EAAIkC,EAAK,KACrF,OAAOlC,GAAK,MAAM,KAAKkC,EAAK,KAAMM,CAAc,EAAE,QAAQ9B,GAAW,EAAE,CACzE,ICpVA,aAkBa+B,GAKbC,GAmBAC,GA1CAC,GAAAC,EAAA,kBAAAC,mxBAkBaL,GAAsB,IAKnCC,GAAA,UAAA,CAAA,SAAAA,GAAA,CACE,KAAA,MAAqD,CAAA,EACrD,KAAA,SAA4C,IAAI,GAClD,CAAA,OAAAA,CAAA,EAHA,EAmBAC,GAAA,UAAA,CAAA,SAAAA,GAAA,CACU,KAAA,MAA4B,IAAID,GAChC,KAAA,SAAmB,CAgE7B,CAzDE,OAAAC,EAAA,UAAA,OAAA,SAAOI,EAAY,SACbC,EAAW,KAAK,UAEpB,QAA6BC,EAAAC,GAAAH,EAAK,WAAW,MAAMN,EAAmB,CAAC,EAAAU,EAAAF,EAAA,KAAA,EAAA,CAAAE,EAAA,KAAAA,EAAAF,EAAA,KAAA,EAAE,CAApE,IAAMG,EAAcD,EAAA,MACnBE,EAAWL,EAAS,SAAS,IAAII,CAAc,EAC9CC,IACHA,EAAW,IAAIX,GACfM,EAAS,SAAS,IAAII,EAAgBC,CAAQ,GAEhDL,EAAWK,oGAEbL,EAAS,MAAM,KAAK,CAAE,KAAID,EAAE,WAAY,KAAK,UAAU,CAAE,CAC3D,EAUAJ,EAAA,UAAA,OAAA,SACEW,EACAC,EAAsE,SAAtEJ,EAAAI,IAAA,OAAoE,CAAA,EAAEA,EAApEC,EAAsBL,EAAA,uBAAEM,EAAQN,EAAA,SAE9BH,EAAW,KAAK,MACdU,EAAuC,CAAA,EACzCC,EAAY,OAEhB,QAA6BC,EAAAV,GAAAI,EAAW,MAAMb,EAAmB,CAAC,EAAAoB,EAAAD,EAAA,KAAA,EAAA,CAAAC,EAAA,KAAAA,EAAAD,EAAA,KAAA,EAAE,CAA/D,IAAMR,EAAcS,EAAA,MACjBR,EAAWL,EAAS,SAAS,IAAII,CAAc,EACrD,GAAI,CAACC,EAAU,CACbM,EAAY,GACZ,MAEGF,GACHC,EAAQ,KAAI,MAAZA,EAAOI,GAAA,CAAA,EAAAC,GAASV,EAAS,KAAK,EAAA,EAAA,CAAA,EAEhCL,EAAWK,oGAOb,OAJII,GAAYE,GACdD,EAAQ,KAAI,MAAZA,EAAOI,GAAA,CAAA,EAAAC,GAASf,EAAS,KAAK,EAAA,EAAA,CAAA,EAG5BU,EAAQ,SAAW,EACd,CAAA,EAELA,EAAQ,SAAW,EACd,CAACA,EAAQ,CAAC,EAAE,IAAI,GAErBF,GACFE,EAAQ,KAAK,SAACM,EAAG,EAAC,CAAK,OAAAA,EAAE,WAAa,EAAE,UAAjB,CAA2B,EAE7CN,EAAQ,IAAI,SAACH,EAAQ,KAANR,EAAIQ,EAAA,KAAO,OAAAR,CAAA,CAAI,EACvC,EACFJ,CAAA,EAlEA,ICxBA,UAAYsB,OAAU,OAuGtB,SAASC,GAAwBC,EAAwB,CACvD,OAAY,SAAQC,GAChBD,EAAiB,MAAW,MAAG,EAAE,KAAKC,EAAmB,EACzDD,CACN,CA7HA,IAiBAE,MAeMC,GAqBNC,GArDAC,GAAAC,EAAA,kBAAAC,IAiBAL,GAAqB,QAErBM,kTAaML,GAAU,CACd,YACA,QACA,aACA,SACA,WACA,MACA,MAAM,SAAAM,EAAE,CAER,OAAO,OAAO,OAAOA,CAAE,GAAM,UAC/B,CAAC,EAWDL,GAAA,UAAA,CAIE,SAAAA,GAAA,CAHQ,KAAA,gBAAkC,IAAIM,GAI5C,KAAK,YAAW,CAClB,CAEQ,OAAAN,EAAA,UAAA,YAAR,UAAA,CAAA,IAAAO,EAAA,KACE,IAAI,QAEF,KACA,CAAE,UAAW,EAAI,EACjB,SAACC,EAASC,EAAMC,EAAO,SAEfC,EAAuBhB,GAAwBc,CAAI,EAEnDG,EAAUL,EAAK,gBAAgB,OAAOI,EAAsB,CAChE,uBAAwB,GAIxB,SAAUD,IAAY,OACvB,MAED,QAA4BG,EAAAC,GAAAF,CAAO,EAAAG,EAAAF,EAAA,KAAA,EAAA,CAAAE,EAAA,KAAAA,EAAAF,EAAA,KAAA,EAAE,CAAxB,IAAAG,EAASD,EAAA,MAAA,UACpBP,EAAUQ,EAAUR,EAASC,EAAMC,CAAO,oGAG5C,OAAOF,CACT,CAAC,CAEL,EASAR,EAAA,UAAA,SAAA,SAASiB,EAAoBD,EAAsB,CACjD,IAAME,EAAS,CAAE,WAAUD,EAAE,UAASD,CAAA,EACtC,YAAK,gBAAgB,OAAOE,CAAM,EAC3BA,CACT,EAOOlB,EAAA,YAAP,UAAA,OAGE,OAAID,GAAgB,IAAIC,EAEhB,KAAK,WACXmB,EAAA,KAAK,aAAS,MAAAA,IAAA,OAAAA,EAAI,IAAInB,CAC1B,EACFA,CAAA,EA5DA,ICrDA,IAAAoB,GAAAC,EAAAC,IAAA,cAAAC,IAIA,IAAMC,GAAc,CAAC,EACfC,GAAU,IAAI,QACdC,GAAa,IAAI,IACjBC,GAAS,CAAC,EAEVC,GAAe,CACnB,IAAKC,EAAQC,EAAMC,EAAO,CACxB,OAAON,GAAQ,IAAII,CAAM,EAAEC,CAAI,EAAEC,CAAK,CACxC,EAEA,eAAgBF,EAAQG,EAAUC,EAAY,CAC5C,GAAK,EAAE,UAAWA,GAChB,MAAM,IAAI,MAAM,qEAAqE,EAGvF,OAAOR,GAAQ,IAAII,CAAM,EAAEG,CAAQ,EAAEC,EAAW,KAAK,CACvD,CACF,EAEA,SAASC,GAAUJ,EAAMK,EAAWC,EAAKC,EAAW,CAClDX,GAAW,IAAII,EAAMO,CAAS,EAC9BZ,GAAQ,IAAIU,EAAWC,CAAG,EAC1B,IAAME,EAAQ,IAAI,MAAMH,EAAWP,EAAY,EAC/CJ,GAAY,QAAQe,GAAQA,EAAKT,EAAMQ,CAAK,CAAC,EAC7CX,GAAO,KAAK,CAACG,EAAMQ,CAAK,CAAC,CAC3B,CAEAhB,GAAQ,SAAWY,GACnBZ,GAAQ,YAAcE,GACtBF,GAAQ,WAAaI,GACrBJ,GAAQ,OAASK,KClCjB,IAAAa,GAAAC,EAAA,CAAAC,GAAAC,KAAA,cAAAC,IAIA,IAAMC,GAAO,EAAQ,MAAM,EACrBC,GAAQ,KACR,CAAE,cAAAC,EAAc,EAAI,EAAQ,KAAK,EAEjC,CACJ,YAAAC,GACA,WAAAC,GACA,OAAAC,EACF,EAAI,KAEJ,SAASC,GAASC,EAAM,CACtBJ,GAAY,KAAKI,CAAI,EACrBF,GAAO,QAAQ,CAAC,CAACG,EAAMC,CAAS,IAAMF,EAAKC,EAAMC,CAAS,CAAC,CAC7D,CAEA,SAASC,GAAYH,EAAM,CACzB,IAAMI,EAAQR,GAAY,QAAQI,CAAI,EAClCI,EAAQ,IACVR,GAAY,OAAOQ,EAAO,CAAC,CAE/B,CAEA,SAASC,GAAYC,EAAQJ,EAAWD,EAAMM,EAAS,CACrD,IAAMC,EAAaF,EAAOJ,EAAWD,EAAMM,CAAO,EAC9CC,GAAcA,IAAeN,IAC/BA,EAAU,QAAUM,EAExB,CAEA,SAASC,GAAMC,EAASC,EAASL,EAAQ,CACvC,GAAK,kBAAgBG,IAAiB,OAAO,IAAIA,GAAKC,EAASC,EAASL,CAAM,EAC1E,OAAOI,GAAY,YACrBJ,EAASI,EACTA,EAAU,KACVC,EAAU,MACD,OAAOA,GAAY,aAC5BL,EAASK,EACTA,EAAU,MAEZ,IAAMC,EAAYD,EAAUA,EAAQ,YAAc,GAAO,GAEzD,KAAK,UAAY,CAACV,EAAMC,IAAc,CACpC,IAAMW,EAAWZ,EACXa,EAAYb,EAAK,WAAW,OAAO,EACrCM,EAEJ,GAAIO,EACFb,EAAOA,EAAK,QAAQ,SAAU,EAAE,MAC3B,CACL,GAAIA,EAAK,WAAW,SAAS,EAC3B,GAAI,CACFA,EAAON,GAAcM,CAAI,CAC3B,MAAY,CAAC,CAEf,IAAMc,EAAUrB,GAAMO,CAAI,EACtBc,IACFd,EAAOc,EAAQ,KACfR,EAAUQ,EAAQ,QAEtB,CAEA,GAAIL,GACF,QAAWM,KAAcN,EACvB,GAAIM,IAAef,EAAM,CACvB,GAAIM,GACF,GAAIK,EACFX,EAAOA,EAAOR,GAAK,IAAMA,GAAK,SAASc,EAASZ,GAAckB,CAAQ,CAAC,UAEnE,CAACN,EAAQ,SAASV,GAAW,IAAIgB,CAAQ,CAAC,EAAG,SAGrDR,GAAWC,EAAQJ,EAAWD,EAAMM,CAAO,CAC7C,OAGFF,GAAWC,EAAQJ,EAAWD,EAAMM,CAAO,CAE/C,EAEAR,GAAQ,KAAK,SAAS,CACxB,CAEAU,GAAK,UAAU,OAAS,UAAY,CAClCN,GAAW,KAAK,SAAS,CAC3B,EAEAZ,GAAO,QAAUkB,GACjBlB,GAAO,QAAQ,KAAOkB,GACtBlB,GAAO,QAAQ,QAAUQ,GACzBR,GAAO,QAAQ,WAAaY,KCtEtB,SAAUc,GACdC,EACAC,EACAC,EAA8B,CAE9B,IAAIC,EACAC,EACJ,GAAI,CACFA,EAASJ,EAAO,QACTK,EAAG,CACVF,EAAQE,UAGR,GADAJ,EAASE,EAAOC,CAAM,EAClBD,GAAS,CAACD,EAEZ,MAAMC,EAGR,OAAOC,EAEX,CAOM,SAAgBE,GACpBN,EACAC,EACAC,EAA8B,mIAKnB,CAAA,EAAMF,EAAO,CAAE,SAAxB,OAAAI,EAASG,EAAA,KAAA,iCAETJ,EAAQK,eAGR,GADAP,EAASE,EAAOC,CAAM,EAClBD,GAAS,CAACD,EAEZ,MAAMC,EAGR,MAAA,CAAA,EAAOC,CAAW,wBAOhB,SAAUK,GAAUC,EAAa,CACrC,OACE,OAAOA,GAAS,YAChB,OAAQA,EAAqB,YAAe,YAC5C,OAAQA,EAAqB,UAAa,YACzCA,EAAqB,YAAc,EAExC,CAlFA,UAAAC,GAAAC,EAAA,kBAAAC,k2CCiBA,UAAYC,OAAU,OACtB,OAAS,SAASC,OAAiB,OAiBnC,OAAS,gBAAAC,OAAoB,KAmU7B,SAASC,GACPC,EACAC,EACAC,EAA2B,CAE3B,OAAI,OAAOD,EAAY,IAEdD,EAAkB,SAAS,GAAG,EAGhCA,EAAkB,KAAK,SAAAG,EAAgB,CAC5C,SAAO,cAAUF,EAASE,EAAkB,CAAE,kBAAiBD,CAAA,CAAE,CACnE,CAAC,CACH,CAnXA,IAmBAE,GACAC,GAOAC,GAOAC,SAOAC,GAzCAC,GAAAC,EAAA,kBAAAC,IAmBAP,GAA0B,QAC1BC,GAAmD,QACnDI,KACAG,KAKAN,GAAmC,QAKnCO,IAEAN,GAAoC,QAEpCO,6wBAKAN,GAAA,SAAAO,EAAA,CAGUC,GAAAR,EAAAO,CAAA,EASR,SAAAP,EACES,EACAC,EACAC,EAAkB,CAHpB,IAAAC,EAKEL,EAAA,KAAA,KAAME,EAAqBC,EAAwBC,CAAM,GAAC,KAVpDC,EAAA,OAAmC,CAAA,EACnCA,EAAA,6BACNC,GAA4B,YAAW,EACjCD,EAAA,SAAW,GA8BAA,EAAA,MAAqB,SAACE,EAAeC,EAAMC,EAAO,CAInE,GAHIC,GAAUH,EAAcC,CAAI,CAAC,GAC/BH,EAAK,QAAQE,EAAeC,CAAI,EAE7B1B,GAAU,QAAQyB,CAAa,EAE7B,CACL,IAAMI,KAAU,SAAK,OAAO,OAAO,CAAA,EAAIJ,CAAa,EAAGC,EAAMC,CAAO,EAEpE,OAAO,OAAO,eAAeF,EAAeC,EAAM,CAChD,MAAOG,EACR,MAND,UAAO,SAAKJ,EAAeC,EAAMC,CAAO,CAQ5C,EAEmBJ,EAAA,QAAyB,SAACE,EAAeC,EAAI,CAC9D,OAAK1B,GAAU,QAAQyB,CAAa,EAG3B,OAAO,eAAeA,EAAeC,EAAM,CAChD,MAAOD,EAAcC,CAAI,EAC1B,KAJM,WAAOD,EAAeC,CAAI,CAMrC,EAEmBH,EAAA,UAA6B,SAC9CO,EACAC,EACAJ,EAAO,CAEP,GAAKG,EAGO,MAAM,QAAQA,CAAkB,IAC1CA,EAAqB,CAACA,CAAkB,OAJjB,CACvBE,GAAK,MAAM,2CAA2C,EACtD,OAKF,GAAI,EAAED,GAAS,MAAM,QAAQA,CAAK,GAAI,CACpCC,GAAK,MAAM,uDAAuD,EAClE,OAGFF,EAAmB,QAAQ,SAAAL,EAAa,CACtCM,EAAM,QAAQ,SAAAL,EAAI,CAChBH,EAAK,MAAME,EAAeC,EAAMC,CAAO,CACzC,CAAC,CACH,CAAC,CACH,EAEmBJ,EAAA,YAAiC,SAClDO,EACAC,EAAK,CAEL,GAAKD,EAGO,MAAM,QAAQA,CAAkB,IAC1CA,EAAqB,CAACA,CAAkB,OAJjB,CACvBE,GAAK,MAAM,2CAA2C,EACtD,OAKF,GAAI,EAAED,GAAS,MAAM,QAAQA,CAAK,GAAI,CACpCC,GAAK,MAAM,uDAAuD,EAClE,OAGFF,EAAmB,QAAQ,SAAAL,EAAa,CACtCM,EAAM,QAAQ,SAAAL,EAAI,CAChBH,EAAK,QAAQE,EAAeC,CAAI,CAClC,CAAC,CACH,CAAC,CACH,EA3FE,IAAIO,EAAUV,EAAK,KAAI,EAEvB,OAAIU,GAAW,CAAC,MAAM,QAAQA,CAAO,IACnCA,EAAU,CAACA,CAAO,GAGpBV,EAAK,SAAYU,GAAiD,CAAA,EAE9DV,EAAK,SAAS,SAAW,GAC3BS,GAAK,MACH,oDACE,IAAIT,EAAK,oBAAmB,IAAIA,EAAK,uBAAsB,KAC3D,2BAA2B,EAI7BA,EAAK,QAAQ,SACfA,EAAK,OAAM,GAEf,CA0EQ,OAAAZ,EAAA,UAAA,wBAAR,UAAA,CAAA,IAAAY,EAAA,KACE,KAAK,SAAS,QAAQ,SAACW,EAAuC,CACpD,IAAAR,EAASQ,EAAM,KACvB,GAAI,CACF,IAAMC,EAAiBC,EAAQ,QAAQV,CAAI,EACvCU,EAAQ,MAAMD,CAAc,GAE9BZ,EAAK,MAAM,KACT,UAAUG,EAAI,2BAA2BH,EAAK,oBAAmB,gEAAgEG,CAAM,OAGrI,EAGV,CAAC,CACH,EAEQf,EAAA,UAAA,uBAAR,SAA+B0B,EAAe,CAC5C,GAAI,CACF,IAAMC,EAAOrC,GAAkB,QAAKoC,EAAS,cAAc,EAAG,CAC5D,SAAU,OACX,EACKjC,EAAU,KAAK,MAAMkC,CAAI,EAAE,QACjC,OAAO,OAAOlC,GAAY,SAAWA,EAAU,YACjC,CACd4B,GAAK,KAAK,4BAA6BK,CAAO,EAIlD,EAEQ1B,EAAA,UAAA,WAAR,SACEuB,EACAK,EACAb,EACAW,EAAuB,CAJzB,IAAAd,EAAA,OAME,GAAI,CAACc,EACH,OAAI,OAAOH,EAAO,OAAU,aAC1BA,EAAO,cAAgBK,EACnB,KAAK,WACP,KAAK,MAAM,MACT,wEACA,CACE,OAAQL,EAAO,KAChB,EAEIA,EAAO,MAAMK,CAAO,GAGxBA,EAGT,IAAMnC,EAAU,KAAK,uBAAuBiC,CAAO,EAEnD,GADAH,EAAO,cAAgB9B,EACnB8B,EAAO,OAASR,EAElB,OACExB,GAAYgC,EAAO,kBAAmB9B,EAAS8B,EAAO,iBAAiB,GAEnE,OAAOA,EAAO,OAAU,aAC1BA,EAAO,cAAgBK,EACnB,KAAK,WACP,KAAK,MAAM,MACT,4DACA,CACE,OAAQL,EAAO,KACf,QAASA,EAAO,cAChB,QAAOG,EACR,EAEIH,EAAO,MAAMK,EAASL,EAAO,aAAa,GAIhDK,EAGT,IAAMC,GAAQC,EAAAP,EAAO,SAAK,MAAAO,IAAA,OAAAA,EAAI,CAAA,EACxBC,EAAsB,aAAUhB,CAAI,EACpCiB,EAAgCH,EACnC,OAAO,SAAA,EAAC,CAAI,OAAA,EAAE,OAASE,CAAX,CAAyB,EACrC,OAAO,SAAA,EAAC,CACP,OAAAxC,GAAY,EAAE,kBAAmBE,EAAS8B,EAAO,iBAAiB,CAAlE,CAAmE,EAEvE,OAAOS,EAA8B,OAAU,SAACC,EAAgBC,EAAI,CAElE,OADAA,EAAK,cAAgBD,EACjBrB,EAAK,UACPA,EAAK,MAAM,MACT,wEACA,CACE,OAAQW,EAAO,KACf,QAASA,EAAO,cAChB,SAAUW,EAAK,KACf,QAAOR,EACR,EAIIQ,EAAK,MAAMD,EAAgBV,EAAO,aAAa,GAEjDU,CACT,EAAGL,CAAO,CACZ,EAEO5B,EAAA,UAAA,OAAP,UAAA,iBAAAY,EAAA,KACE,GAAI,MAAK,SAMT,IAHA,KAAK,SAAW,GAGZ,KAAK,OAAO,OAAS,EAAG,KAC1B,QAAqBuB,EAAAC,GAAA,KAAK,QAAQ,EAAAC,EAAAF,EAAA,KAAA,EAAA,CAAAE,EAAA,KAAAA,EAAAF,EAAA,KAAA,EAAE,CAA/B,IAAMG,EAAMD,EAAA,MACX,OAAOC,EAAO,OAAU,YAAcA,EAAO,gBAC/C,KAAK,MAAM,MACT,8EACA,CACE,OAAQA,EAAO,KACf,QAASA,EAAO,cACjB,EAEHA,EAAO,MAAMA,EAAO,cAAeA,EAAO,aAAa,OAEzD,QAAmBC,GAAAC,EAAA,OAAAJ,GAAAE,EAAO,KAAK,GAAAG,EAAAF,EAAA,KAAA,EAAA,CAAAE,EAAA,KAAAA,EAAAF,EAAA,KAAA,EAAE,CAA5B,IAAML,EAAIO,EAAA,MACTP,EAAK,gBACP,KAAK,MAAM,MACT,mFACA,CACE,OAAQI,EAAO,KACf,QAASA,EAAO,cAChB,SAAUJ,EAAK,KAChB,EAEHA,EAAK,MAAMA,EAAK,cAAeI,EAAO,aAAa,wMAIzD,OAGF,KAAK,wBAAuB,iBACjBI,EAAM,CACf,IAAMC,EAAiB,SAACf,EAASb,GAAMW,EAAO,CAC5C,OAAOd,EAAK,WAA2B8B,EAAQd,EAASb,GAAMW,CAAO,CACvE,EACMkB,EAAyB,SAAChB,EAASb,GAAMW,EAAO,CACpD,OAAOd,EAAK,WAA2B8B,EAAQd,EAASb,GAAMW,CAAO,CACvE,EAKMmB,EAAY,cAAWH,EAAO,IAAI,EACpC,IAAI,GAAAI,KAAY,CAACJ,EAAO,IAAI,EAAG,CAAE,UAAW,EAAI,EAAIE,CAAS,EAC7DG,EAAK,6BAA6B,SAASL,EAAO,KAAME,CAAS,EAErEG,EAAK,OAAO,KAAKF,CAAI,EACrB,IAAMG,EAAU,IAAI,GAAAC,KAClB,CAACP,EAAO,IAAI,EACZ,CAAE,UAAW,EAAK,EACVC,CAAM,EAEhBI,EAAK,OAAO,KAAKC,CAAO,cArB1B,QAAqBE,EAAAd,GAAA,KAAK,QAAQ,EAAAe,EAAAD,EAAA,KAAA,EAAA,CAAAC,EAAA,KAAAA,EAAAD,EAAA,KAAA,EAAA,CAA7B,IAAMR,EAAMS,EAAA,QAANT,CAAM,qGAuBnB,EAEO1C,EAAA,UAAA,QAAP,UAAA,aACE,GAAK,KAAK,SAGV,MAAK,SAAW,OAEhB,QAAqBoD,EAAAhB,GAAA,KAAK,QAAQ,EAAAD,EAAAiB,EAAA,KAAA,EAAA,CAAAjB,EAAA,KAAAA,EAAAiB,EAAA,KAAA,EAAE,CAA/B,IAAMC,EAAMlB,EAAA,MACX,OAAOkB,EAAO,SAAY,YAAcA,EAAO,gBACjD,KAAK,MAAM,MACT,+EACA,CACE,OAAQA,EAAO,KACf,QAASA,EAAO,cACjB,EAEHA,EAAO,QAAQA,EAAO,cAAeA,EAAO,aAAa,OAE3D,QAAmBhB,GAAAiB,EAAA,OAAAlB,GAAAiB,EAAO,KAAK,GAAAd,EAAAF,EAAA,KAAA,EAAA,CAAAE,EAAA,KAAAA,EAAAF,EAAA,KAAA,EAAE,CAA5B,IAAMH,EAAIK,EAAA,MACTL,EAAK,gBACP,KAAK,MAAM,MACT,oFACA,CACE,OAAQmB,EAAO,KACf,QAASA,EAAO,cAChB,SAAUnB,EAAK,KAChB,EAEHA,EAAK,QAAQA,EAAK,cAAemB,EAAO,aAAa,yMAI7D,EAEOrD,EAAA,UAAA,UAAP,UAAA,CACE,OAAO,KAAK,QACd,EACFA,CAAA,EAxTUuD,EAAuB,IC5BjC,OAAS,aAAAC,OAAiB,OAhB1B,IAAAC,GAAAC,EAAA,kBAAAC,MCAA,IAAAC,GAAAC,EAAA,kBAAAC,IAeAC,KACAC,OChBA,IAAAC,GAAAC,EAAA,kBAAAC,IAgBAC,OChBA,IAqBAC,GArBAC,GAAAC,EAAA,kBAAAC,IAqBAH,GAAA,UAAA,CAIE,SAAAA,EACSI,EACAC,EAEAC,EAEAC,EACPC,EAAmC,CAN5B,KAAA,KAAAJ,EACA,KAAA,kBAAAC,EAEA,KAAA,MAAAC,EAEA,KAAA,QAAAC,EAGP,KAAK,MAAQC,GAAS,CAAA,CACxB,CACF,OAAAR,CAAA,EAfA,ICrBA,IAmBAS,GAnBAC,GAAAC,EAAA,kBAAAC,IAiBAC,KAEAJ,GAAA,UAAA,CAIE,SAAAA,EACEK,EACOC,EAEAC,EAEAC,EAA8D,CAJ9D,KAAA,kBAAAF,EAEA,KAAA,MAAAC,EAEA,KAAA,QAAAC,EAEP,KAAK,KAAOC,GAAUJ,CAAI,CAC5B,CACF,OAAAL,CAAA,EAdA,ICnBA,IAAAU,GAAAC,EAAA,kBAAAC,MCAA,IAAAC,GAAAC,EAAA,kBAAAC,MCAA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,yBAAAE,GAAA,wCAAAC,GAAA,kCAAAC,GAAA,cAAAC,GAAA,6BAAAC,GAAA,2BAAAC,GAAA,gCAAAC,KAAA,IAAAC,GAAAC,EAAA,kBAAAC,IAgBAC,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,sHCPA,IAAAC,EAAA,WAgBAC,GAAA,aASAC,GAAA,KACAC,GAAA,EAAA,KAAA,EASAC,EAAA,KACAC,GAAA,KACAC,GAAA,aAKAC,GAAA,aACAC,GAAA,EAAA,QAAA,EACAC,GAAA,aAKaC,GAAb,cAAyCJ,GAAA,mBAA8C,CAOrF,YAAYK,EAAoC,CAAA,EAAE,CAChD,MAAM,sCAAuCN,GAAA,QAASM,CAAM,EAN7C,KAAA,cAA+B,IAAI,QAOlD,KAAK,eAAiB,KAAK,qBAAoB,CACjD,CAEmB,0BAAwB,CACzC,KAAK,6BAA+B,KAAK,MAAM,gBAC7C,uBACA,CACE,YAAa,kDACb,KAAM,KACN,UAAWX,EAAA,UAAU,OACtB,EAEH,KAAK,6BAA+B,KAAK,MAAM,gBAC7C,uBACA,CACE,YAAa,mDACb,KAAM,KACN,UAAWA,EAAA,UAAU,OACtB,CAEL,CAES,UAAUW,EAAoC,CAAA,EAAE,CACvD,MAAM,UAAUA,CAAM,EACtB,KAAK,eAAiB,KAAK,qBAAoB,CACjD,CAEA,MAAI,CAIF,MAAO,CAAC,KAAK,yBAAwB,EAAI,KAAK,wBAAuB,CAAE,CACzE,CAEQ,yBAAuB,CAC7B,OAAO,IAAIL,GAAA,oCACT,OACA,CAAC,GAAG,EACHM,IACC,KAAK,MACHA,EACA,UACA,KAAK,iCAAiC,MAAM,CAAC,EAE/C,KAAK,MACHA,EACA,MACA,KAAK,6BAA6BA,EAAc,OAAO,CAAC,EAE1D,KAAK,MACHA,EAAc,OAAO,UACrB,OACA,KAAK,iCAAiC,MAAM,CAAC,EAExCA,GAERA,GAAuB,CAClBA,IAAkB,SAEtB,KAAK,QAAQA,EAAe,SAAS,EACrC,KAAK,QAAQA,EAAe,KAAK,EACjC,KAAK,QAAQA,EAAc,OAAO,UAAW,MAAM,EACrD,CAAC,CAEL,CAEQ,0BAAwB,CAC9B,OAAO,IAAIN,GAAA,oCACT,QACA,CAAC,GAAG,EACHM,IACC,KAAK,MACHA,EACA,UACA,KAAK,sCAAsC,OAAO,CAAC,EAErD,KAAK,MACHA,EACA,MACA,KAAK,kCAAkCA,EAAc,OAAO,CAAC,EAE/D,KAAK,MACHA,EAAc,OAAO,UACrB,OACA,KAAK,iCAAiC,OAAO,CAAC,EAEzCA,GAERA,GAAwB,CACnBA,IAAkB,SAEtB,KAAK,QAAQA,EAAe,SAAS,EACrC,KAAK,QAAQA,EAAe,KAAK,EACjC,KAAK,QAAQA,EAAc,OAAO,UAAW,MAAM,EACrD,CAAC,CAEL,CAKU,iCAAiCC,EAA2B,CACpE,OACEC,GAEO,KAAK,yBAAyBD,EAAWC,CAAQ,CAE5D,CAMU,iCAAiCD,EAA2B,CACpE,OAAQC,GACC,KAAK,yBAAyBD,EAAWC,CAAQ,CAE5D,CAEU,6BACRC,EAGuB,CAEvB,OAAQC,GAWC,SAELC,KAAeC,EAAqB,CACpC,IAAMC,EAAMJ,EAAcE,EAAS,GAAGC,CAAI,EAC1C,OAAAC,EAAI,IAAG,EACAA,CACT,CAEJ,CAGQ,sCAAsCN,EAA2B,CACvE,OAAQC,GAAgE,CACtE,IAAMM,EAAkB,KACxB,OAAO,SAELH,KACGC,EAAqB,OAGxB,OACEL,IAAc,SACd,OAAOI,GAAY,YACnBI,EAAAJ,GAAS,eAAW,MAAAI,IAAA,OAAA,OAAAA,EAAE,QAAS,QAE/BJ,EAAU,OAAO,OAAO,CAAA,EAAIA,CAAO,EACnCG,EAAgB,mBAAmBH,CAAO,GAErCG,EAAgB,iCAAiCP,CAAS,EAC/DC,CAAQ,EACRG,EAAS,GAAGC,CAAI,CACpB,CACF,CACF,CAEQ,mBAAmBD,EAA6B,CACtDA,EAAQ,SAAWA,EAAQ,UAAY,SACvCA,EAAQ,KAAOA,EAAQ,MAAQ,GACjC,CAGQ,kCACNF,EAIuB,CAEvB,OAAQD,GAAgE,CACtE,IAAMM,EAAkB,KACxB,OAAO,SAELH,KACGC,EAAqB,CAExB,OAAOE,EAAgB,6BAA6BL,CAAa,EAC/DD,CAAQ,EACRG,EAAS,GAAGC,CAAI,CACpB,CACF,CACF,CAUQ,oBACNI,EACAC,EACAC,EACAC,EAAkC,CAE9B,KAAK,UAAS,EAAG,aACnB,KAAK,iBAAiBF,EAAMD,CAAO,EAMrC,IAAII,EAAmB,GAOvB,OAAAJ,EAAQ,gBACN,WACCK,GAA0D,CACzD,KAAK,MAAM,MAAM,+BAA+B,EAC5CL,EAAQ,cAAc,UAAU,GAAK,GACvCK,EAAS,OAAM,EAEjB,IAAMC,EACJxB,EAAM,uCAAuCuB,CAAQ,EACvDJ,EAAK,cAAcK,CAAkB,EACrCH,EAAmB,OAAO,OACxBA,EACArB,EAAM,6CAA6CwB,CAAkB,CAAC,EAGpE,KAAK,UAAS,EAAG,cACnB,KAAK,kBAAkBL,EAAMI,CAAQ,EAGvC,KAAK,eAAe,OAAO,sBAAsBJ,EAAMM,GACrDP,EAAQ,UAAUO,CAAM,CAAC,EAE3B,KAAK,eAAe,OAAO,uBACzBN,EACAM,GAAUF,EAAS,QAAQE,CAAM,CAAC,EAGpC7B,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAI2B,CAAQ,EAEvC,IAAMG,EAAa,IAAK,CAEtB,GADA,KAAK,MAAM,MAAM,0BAA0B,EACvCJ,EACF,OAEFA,EAAmB,GACnB,IAAIK,EAEAJ,EAAS,SAAW,CAACA,EAAS,SAChCI,EAAS,CAAE,KAAM/B,EAAA,eAAe,KAAK,EAErC+B,EAAS,CACP,KAAM3B,EAAM,oBACVJ,EAAA,SAAS,OACT2B,EAAS,UAAU,GAKzBJ,EAAK,UAAUQ,CAAM,EAEjB,KAAK,UAAS,EAAG,gCACnBzB,GAAA,wBACE,IACE,KAAK,UAAS,EAAG,4BACfiB,EACAD,EACAK,CAAQ,EAEZ,IAAK,CAAE,EACP,EAAI,EAIR,KAAK,eACHJ,EACAvB,EAAA,SAAS,OACTwB,EACAC,CAAgB,CAEpB,EAEAE,EAAS,GAAG,MAAOG,CAAU,EAEzB5B,GAAO,GAAG,QAAQ,QAAS,QAAQ,GACrCyB,EAAS,GAAG,QAASG,CAAU,EAEjCH,EAAS,GAAGnB,GAAA,aAAewB,GAAc,CACvC,KAAK,MAAM,MAAM,6BAA8BA,CAAK,EAChD,CAAAN,IAGJA,EAAmB,GACnBtB,EAAM,iBAAiBmB,EAAMS,CAAK,EAClCT,EAAK,UAAU,CACb,KAAMvB,EAAA,eAAe,MACrB,QAASgC,EAAM,QAChB,EACD,KAAK,eACHT,EACAvB,EAAA,SAAS,OACTwB,EACAC,CAAgB,EAEpB,CAAC,CACH,CAAC,EAEHH,EAAQ,GAAG,QAAS,IAAK,CACvB,KAAK,MAAM,MAAM,oCAAoC,EACjD,EAAAA,EAAQ,SAAWI,KAGvBA,EAAmB,GACnB,KAAK,eAAeH,EAAMvB,EAAA,SAAS,OAAQwB,EAAWC,CAAgB,EACxE,CAAC,EACDH,EAAQ,GAAGd,GAAA,aAAewB,GAAc,CACtC,KAAK,MAAM,MAAM,qCAAsCA,CAAK,EACxD,CAAAN,IAGJA,EAAmB,GACnBtB,EAAM,iBAAiBmB,EAAMS,CAAK,EAClC,KAAK,eAAeT,EAAMvB,EAAA,SAAS,OAAQwB,EAAWC,CAAgB,EACxE,CAAC,EAED,KAAK,MAAM,MAAM,mCAAmC,EAC7CH,CACT,CAEQ,yBACNT,EACAC,EAAwD,CAExD,IAAMM,EAAkB,KACxB,OAAO,SAELa,KACGf,EAAe,CAGlB,GAAIe,IAAU,UACZ,OAAOnB,EAAS,MAAM,KAAM,CAACmB,EAAO,GAAGf,CAAI,CAAC,EAG9C,IAAMI,EAAUJ,EAAK,CAAC,EAChBS,EAAWT,EAAK,CAAC,EACjBgB,EAAWZ,EAAQ,KACrBnB,GAAI,MAAMmB,EAAQ,GAAG,EAAE,UAAY,IAEjCa,EAASb,EAAQ,QAAU,MAMjC,GAJAF,EAAgB,MAAM,MACpB,GAAGP,CAAS,kCAAkC,EAI9CT,EAAM,UACJ8B,EACAd,EAAgB,UAAS,EAAG,oBAC3BgB,GACChB,EAAgB,MAAM,MAAM,qCAAsCgB,CAAC,CAAC,MAExE9B,GAAA,wBACE,IAAK,CAAA,IAAAe,EAAAgB,EACH,OAAAA,GAAAhB,EAAAD,EAAgB,UAAS,GAAG,6BAAyB,MAAAiB,IAAA,OAAA,OAAAA,EAAA,KAAAhB,EAAGC,CAAO,CAAC,EACjEc,GAAc,CACTA,GAAK,MACPhB,EAAgB,MAAM,MACpB,2CACAgB,CAAC,CAGP,EACA,EAAI,EAGN,OAAOpC,EAAA,QAAQ,QAAKC,GAAA,iBAAgBD,EAAA,QAAQ,OAAM,CAAE,EAAG,KACrDA,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAIsB,CAAO,EACtCtB,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAI2B,CAAQ,EAChCb,EAAS,MAAM,KAAM,CAACmB,EAAO,GAAGf,CAAI,CAAC,EAC7C,EAGH,IAAMoB,EAAUhB,EAAQ,QAElBiB,EAAiBnC,EAAM,6BAA6BkB,EAAS,CACjE,UAAWT,EACX,WAAYO,EAAgB,UAAS,EAAG,WACxC,eAAgBA,EAAgB,mBAC9BE,EACAF,EAAgB,UAAS,EAAG,qBAAqB,EAEpD,EAEKoB,EAA2B,CAC/B,KAAMxC,EAAA,SAAS,OACf,WAAYuC,GAGRf,KAAYvB,GAAA,QAAM,EAClBwB,EACJrB,EAAM,mCAAmCmC,CAAc,EAEnDE,EAAMzC,EAAA,YAAY,QAAQA,EAAA,aAAcsC,CAAO,EAC/Cf,EAAOH,EAAgB,eAAee,EAAQK,EAAaC,CAAG,EAC9DC,EAA2B,CAC/B,KAAMnC,GAAA,QAAQ,KACd,KAAAgB,GAGF,OAAOvB,EAAA,QAAQ,QACbO,GAAA,gBAAeP,EAAA,MAAM,QAAQyC,EAAKlB,CAAI,EAAGmB,CAAW,EACpD,IAAK,CACH1C,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAIsB,CAAO,EACtCtB,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAI2B,CAAQ,EAEnCP,EAAgB,UAAS,EAAG,aAC9BA,EAAgB,iBAAiBG,EAAMD,CAAO,EAE5CF,EAAgB,UAAS,EAAG,cAC9BA,EAAgB,kBAAkBG,EAAMI,CAAQ,EAGlDP,EAAgB,eAAe,OAAO,sBACpCG,EACAM,GAAUP,EAAQ,QAAQO,CAAM,CAAC,EAInC,IAAIc,EAAW,GACf,OAAAhB,EAAS,GAAG,QAAS,IAAK,CACpBgB,GAGJvB,EAAgB,wBACdE,EACAK,EACAJ,EACAE,EACAD,CAAS,CAEb,CAAC,EACDG,EAAS,GAAGnB,GAAA,aAAeoC,GAAY,CACrCD,EAAW,GACXvB,EAAgB,uBACdG,EACAE,EACAD,EACAoB,CAAG,CAEP,CAAC,KAEMtC,GAAA,wBACL,IAAMQ,EAAS,MAAM,KAAM,CAACmB,EAAO,GAAGf,CAAI,CAAC,EAC3Cc,GAAQ,CACN,GAAIA,EACF,MAAA5B,EAAM,iBAAiBmB,EAAMS,CAAK,EAClCZ,EAAgB,eACdG,EACAvB,EAAA,SAAS,OACTwB,EACAC,CAAgB,EAEZO,CAEV,CAAC,CAEL,CAAC,CAEL,CACF,CAEQ,yBACNnB,EACAC,EAAkC,CAElC,IAAMM,EAAkB,KACxB,OAAO,SAELH,KACGC,EAAe,CAElB,GAAI,CAACd,EAAM,mBAAmBa,CAAO,EACnC,OAAOH,EAAS,MAAM,KAAM,CAACG,EAAS,GAAGC,CAAI,CAAC,EAEhD,IAAM2B,EACJ,OAAO3B,EAAK,CAAC,GAAM,WAClB,OAAOD,GAAY,UAAYA,aAAmBd,GAAI,KAClDe,EAAK,MAAK,EACX,OACA,CAAE,OAAA4B,EAAQ,SAAAZ,EAAU,OAAAC,EAAQ,cAAAY,CAAa,EAAK3C,EAAM,eACxDa,EACA4B,CAAY,EAOd,GACEhC,IAAc,QACdX,GAAO,GAAG,QAAQ,QAAS,OAAO,GAClC6C,EAAc,WAAa,SAE3B,OAAOjC,EAAS,MAAM,KAAM,CAACiC,EAAe,GAAG7B,CAAI,CAAC,EAGtD,GACEd,EAAM,UACJ0C,EAASZ,EACTd,EAAgB,UAAS,EAAG,mBAC3BgB,GACChB,EAAgB,MAAM,MAAM,oCAAqCgB,CAAC,CAAC,MAEvE9B,GAAA,wBACE,IAAK,SACH,OAAA+B,GAAAhB,EAAAD,EACG,UAAS,GACT,6BAAyB,MAAAiB,IAAA,OAAA,OAAAA,EAAA,KAAAhB,EAAG0B,CAAa,GAC7CX,GAAc,CACTA,GAAK,MACPhB,EAAgB,MAAM,MACpB,2CACAgB,CAAC,CAGP,EACA,EAAI,EAGN,OAAOtB,EAAS,MAAM,KAAM,CAACiC,EAAe,GAAG7B,CAAI,CAAC,EAGtD,GAAM,CAAE,SAAA8B,EAAU,KAAAC,CAAI,EAAK7C,EAAM,uBAAuB2C,CAAa,EAE/DG,EAAa9C,EAAM,6BAA6B2C,EAAe,CACnE,UAAAlC,EACA,KAAAoC,EACA,SAAAD,EACA,eAAgB5B,EAAgB,mBAC9B2B,EACA3B,EAAgB,UAAS,EAAG,qBAAqB,EAEpD,EAEKI,KAAYvB,GAAA,QAAM,EAClBwB,EACJrB,EAAM,mCAAmC8C,CAAU,EAE/CV,EAA2B,CAC/B,KAAMxC,EAAA,SAAS,OACf,WAAAkD,GAEI3B,EAAOH,EAAgB,eAAee,EAAQK,CAAW,EAEzDW,EAAgBnD,EAAA,QAAQ,OAAM,EAC9BoD,EAAiBpD,EAAA,MAAM,QAAQmD,EAAe5B,CAAI,EAExD,OAAKwB,EAAc,QAKjBA,EAAc,QAAU,OAAO,OAAO,CAAA,EAAIA,EAAc,OAAO,EAJ/DA,EAAc,QAAU,CAAA,EAM1B/C,EAAA,YAAY,OAAOoD,EAAgBL,EAAc,OAAO,EAEjD/C,EAAA,QAAQ,KAAKoD,EAAgB,IAAK,CAKvC,IAAMC,EAAKnC,EAAKA,EAAK,OAAS,CAAC,EAC3B,OAAOmC,GAAO,aAChBnC,EAAKA,EAAK,OAAS,CAAC,EAAIlB,EAAA,QAAQ,KAAKmD,EAAeE,CAAE,GAGxD,IAAM/B,KAA8BhB,GAAA,wBAClC,IAAMQ,EAAS,MAAM,KAAM,CAACiC,EAAe,GAAG7B,CAAI,CAAC,EACnDc,GAAQ,CACN,GAAIA,EACF,MAAA5B,EAAM,iBAAiBmB,EAAMS,CAAK,EAClCZ,EAAgB,eACdG,EACAvB,EAAA,SAAS,OACTwB,EACAC,CAAgB,EAEZO,CAEV,CAAC,EAGH,OAAAZ,EAAgB,MAAM,MACpB,GAAGP,CAAS,kCAAkC,EAEhDb,EAAA,QAAQ,KAAKmD,EAAe7B,CAAO,EAC5BF,EAAgB,oBACrBE,EACAC,EACAC,EACAC,CAAgB,CAEpB,CAAC,CACH,CACF,CAEQ,wBACNH,EACAK,EACAJ,EACAE,EACAD,EAAiB,CAEjB,IAAM0B,EAAa9C,EAAM,uCACvBkB,EACAK,CAAQ,EAEVF,EAAmB,OAAO,OACxBA,EACArB,EAAM,6CAA6C8C,CAAU,CAAC,EAGhE,KAAK,eAAe,OAAO,uBAAuB3B,EAAMM,GACtDF,EAAS,UAAUE,CAAM,CAAC,EAG5BN,EAAK,cAAc2B,CAAU,EAAE,UAAU,CACvC,KAAM9C,EAAM,oBAAoBJ,EAAA,SAAS,OAAQ2B,EAAS,UAAU,EACrE,EAED,IAAM2B,EAAQJ,EAAWzC,GAAA,mBAAmB,EACxC6C,GACF/B,EAAK,WAAW,GAAGD,EAAQ,QAAU,KAAK,IAAIgC,CAAK,EAAE,EAGnD,KAAK,UAAS,EAAG,gCACnBhD,GAAA,wBACE,IACE,KAAK,UAAS,EAAG,4BACfiB,EACAD,EACAK,CAAQ,EAEZ,IAAK,CAAE,EACP,EAAI,EAIR,KAAK,eAAeJ,EAAMvB,EAAA,SAAS,OAAQwB,EAAWC,CAAgB,CACxE,CAEQ,uBACNF,EACAE,EACAD,EACAQ,EAAU,CAEV5B,EAAM,iBAAiBmB,EAAMS,CAAK,EAClC,KAAK,eAAeT,EAAMvB,EAAA,SAAS,OAAQwB,EAAWC,CAAgB,CACxE,CAEQ,eACN8B,EACAtC,EACAwB,EAAMzC,EAAA,QAAQ,OAAM,EAAE,CAMtB,IAAMwD,EACJvC,EAAQ,OAASjB,EAAA,SAAS,OACtB,KAAK,UAAS,EAAG,8BACjB,KAAK,UAAS,EAAG,8BAEnBuB,EACEkC,EAAczD,EAAA,MAAM,QAAQyC,CAAG,EAErC,OAAIe,IAAkB,IAAQC,IAAgB,OAC5ClC,EAAOvB,EAAA,MAAM,gBAAgBA,EAAA,oBAAoB,EACxCwD,IAAkB,IAAQC,GAAa,YAAW,EAAG,SAC9DlC,EAAOkC,EAEPlC,EAAO,KAAK,OAAO,UAAUgC,EAAMtC,EAASwB,CAAG,EAEjD,KAAK,cAAc,IAAIlB,CAAI,EACpBA,CACT,CAEQ,eACNA,EACAmC,EACAlC,EACAC,EAAkC,CAElC,GAAI,CAAC,KAAK,cAAc,IAAIF,CAAI,EAC9B,OAGFA,EAAK,IAAG,EACR,KAAK,cAAc,OAAOA,CAAI,EAG9B,IAAMoC,KAAW1D,GAAA,yBAAqBA,GAAA,gBAAeuB,KAAWvB,GAAA,QAAM,CAAE,CAAC,EACrEyD,IAAa1D,EAAA,SAAS,OACxB,KAAK,6BAA6B,OAAO2D,EAAUlC,CAAgB,EAC1DiC,IAAa1D,EAAA,SAAS,QAC/B,KAAK,6BAA6B,OAAO2D,EAAUlC,CAAgB,CAEvE,CAEQ,kBACNF,EACAI,EAAoD,IAEpDrB,GAAA,wBACE,IAAM,KAAK,UAAS,EAAG,aAAciB,EAAMI,CAAQ,EACnD,IAAK,CAAE,EACP,EAAI,CAER,CAEQ,iBACNJ,EACAD,EAAkD,IAElDhB,GAAA,wBACE,IAAM,KAAK,UAAS,EAAG,YAAaiB,EAAMD,CAAO,EACjD,IAAK,CAAE,EACP,EAAI,CAER,CAEQ,mBACNA,EACAsC,EAA8B,CAE9B,GAAI,OAAOA,GAAa,WACtB,SAAOtD,GAAA,wBACL,IAAMsD,EAAStC,CAAO,EACtB,IAAK,CAAE,EACP,EAAI,CAGV,CAEQ,sBAAoB,6BAC1B,IAAMX,EAAS,KAAK,UAAS,EAE7B,MAAO,CACL,OAAQ,CACN,sBAAuBP,EAAM,cAC3B,WACAyD,GAAAxB,GAAAhB,EAAAV,EAAO,2BAAuB,MAAAU,IAAA,OAAA,OAAAA,EAAE,UAAM,MAAAgB,IAAA,OAAA,OAAAA,EAAE,kBAAc,MAAAwB,IAAA,OAAAA,EAAI,CAAA,CAAE,EAE9D,uBAAwBzD,EAAM,cAC5B,YACA0D,GAAAC,GAAAC,EAAArD,EAAO,2BAAuB,MAAAqD,IAAA,OAAA,OAAAA,EAAE,UAAM,MAAAD,IAAA,OAAA,OAAAA,EAAE,mBAAe,MAAAD,IAAA,OAAAA,EAAI,CAAA,CAAE,GAGjE,OAAQ,CACN,sBAAuB1D,EAAM,cAC3B,WACA6D,GAAAC,GAAAC,EAAAxD,EAAO,2BAAuB,MAAAwD,IAAA,OAAA,OAAAA,EAAE,UAAM,MAAAD,IAAA,OAAA,OAAAA,EAAE,kBAAc,MAAAD,IAAA,OAAAA,EAAI,CAAA,CAAE,EAE9D,uBAAwB7D,EAAM,cAC5B,YACAgE,GAAAC,GAAAC,EAAA3D,EAAO,2BAAuB,MAAA2D,IAAA,OAAA,OAAAA,EAAE,UAAM,MAAAD,IAAA,OAAA,OAAAA,EAAE,mBAAe,MAAAD,IAAA,OAAAA,EAAI,CAAA,CAAE,GAIrE,GA5xBFG,GAAA,oBAAA7D,KChEA,IAAA8D,GAAAC,EAAAC,IAAA,cAAAC,IACA,OAAO,eAAeD,GAAS,aAAc,CAAE,MAAO,EAAK,CAAC,0ZCe5DE,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,gHCHA,IAAYC,IAAZ,SAAYA,EAAgB,CAC1BA,EAAA,OAAA,SACAA,EAAA,WAAA,aACAA,EAAA,gBAAA,iBACF,GAJYA,GAAAC,GAAA,mBAAAA,GAAA,iBAAgB,CAAA,EAAA,8GCA5B,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,aAAA,eACAA,EAAA,aAAA,cACF,GAHYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,uICQbC,GAAA,cAA+B,OAAO,uBAAuB,EAkB7DA,GAAA,uBAAyB,0MCnBtC,IAAAC,GAAA,KACAC,GAAA,KACAC,GAAA,KAWaC,GAAiB,CAACC,EAAyBC,IAAkB,CACpE,MAAM,QAAQD,EAAQF,GAAA,sBAAsB,CAAC,IAAM,IACrD,OAAO,eAAeE,EAASF,GAAA,uBAAwB,CACrD,WAAY,GACZ,MAAO,CAAA,EACR,EAECG,IAAU,QACbD,EAAQF,GAAA,sBAAsB,EAAe,KAAKG,CAAK,CAC1D,EATaC,GAAA,eAAcH,GAgBpB,IAAMI,GAAmB,CAC9BC,EACAC,IAKID,EAAM,OAAS,SACV,CACL,WAAY,CACV,CAACP,GAAA,eAAe,YAAY,EAAGQ,EAC/B,CAACR,GAAA,eAAe,YAAY,EAAGD,GAAA,iBAAiB,QAElD,KAAM,YAAYS,CAAS,IAEpBD,EAAM,OAAS,iBACjB,CACL,WAAY,CACV,CAACP,GAAA,eAAe,YAAY,EAAGQ,GAAa,kBAC5C,CAACR,GAAA,eAAe,YAAY,EAAGD,GAAA,iBAAiB,iBAElD,KAAM,kBAAkBQ,EAAM,KAAO,MAAMC,CAAS,GAAK,EAAE,IAGtD,CACL,WAAY,CACV,CAACR,GAAA,eAAe,YAAY,EAAGO,EAAM,KACrC,CAACP,GAAA,eAAe,YAAY,EAAGD,GAAA,iBAAiB,YAElD,KAAM,gBAAgBQ,EAAM,IAAI,IA7BzBF,GAAA,iBAAgBC,GAwC7B,IAAMG,GAAmB,CACvBC,EACAC,IACW,CACX,GAAI,OAAOA,GAAY,SACrB,OAAOA,IAAYD,EACd,GAAIC,aAAmB,OAC5B,OAAOA,EAAQ,KAAKD,CAAQ,EACvB,GAAI,OAAOC,GAAY,WAC5B,OAAOA,EAAQD,CAAQ,EAEvB,MAAM,IAAI,UAAU,oCAAoC,CAE5D,EAUaE,GAAiB,CAC5BC,EACAC,EACAC,IACW,OACX,GACE,MAAM,QAAQA,GAAQ,gBAAgB,IACtC,GAAAC,EAAAD,GAAQ,oBAAgB,MAAAC,IAAA,SAAAA,EAAE,SAASF,CAAI,GAEvC,MAAO,GAET,GAAI,MAAM,QAAQC,GAAQ,YAAY,IAAM,GAAO,MAAO,GAC1D,GAAI,CACF,QAAWJ,KAAWI,EAAQ,aAC5B,GAAIN,GAAiBI,EAAMF,CAAO,EAChC,MAAO,QAGD,EAIZ,MAAO,EACT,EAvBaN,GAAA,eAAcO,GA+BpB,IAAMK,GACXC,GAEAA,aAAiB,MACb,CAACA,EAAOA,EAAM,OAAO,EACrB,CAAC,OAAOA,CAAK,EAAG,OAAOA,CAAK,CAAC,EALtBb,GAAA,kBAAiBY,GAavB,IAAME,GACXC,GAEI,MAAM,QAAQA,EAAK,CAAC,CAAC,EAChBA,EAAK,CAAC,EAAE,IAAIC,GAAOC,GAAwBD,CAAG,GAAK,EAAE,EAAE,KAAK,GAAG,EAGjEC,GAAwBF,EAAK,CAAC,CAAC,EAP3Bf,GAAA,aAAYc,GAUzB,IAAMG,GAA2BD,GAAyB,CACxD,GAAI,OAAOA,GAAQ,SACjB,OAAOA,EAGT,GAAIA,aAAe,QAAU,OAAOA,GAAQ,SAC1C,OAAOA,EAAI,SAAQ,CAIvB,+HCjKaE,GAAA,gBAAkB,SAClBA,GAAA,aAAe,6JCF5B,IAAAC,GAAA,aACAC,GAAA,WASAC,GAAA,KACAC,GAAA,KACAC,GAAA,KAOAC,GAAA,KACAC,GAAA,aAMAC,GAAA,aACAC,GAAA,KASaC,GAAb,cAA4CH,GAAA,mBAAmB,CAC7D,YAAYI,EAAuC,CAAA,EAAE,CACnD,MAAML,GAAA,aAAcA,GAAA,gBAAiBK,CAAM,CAC7C,CAES,UAAUA,EAAuC,CAAA,EAAE,CAC1D,KAAK,QAAU,OAAO,OAAO,CAAA,EAAIA,CAAM,CACzC,CAES,WAAS,CAChB,OAAO,KAAK,OACd,CAEA,MAAI,CACF,MAAO,CACL,IAAIJ,GAAA,oCACF,UACA,CAAC,YAAY,EACbK,GAAgB,CACd,IAAMC,EAAcD,EAAc,OAElC,SAAIL,GAAA,WAAUM,EAAY,KAAK,GAC7B,KAAK,QAAQA,EAAa,OAAO,EAEnC,KAAK,MAAMA,EAAa,QAAS,KAAK,eAAc,CAAE,KAElDN,GAAA,WAAUM,EAAY,GAAG,GAC3B,KAAK,QAAQA,EAAa,KAAK,EAGjC,KAAK,MAAMA,EAAa,MAAO,KAAK,mBAAkB,CAAS,KAE3DN,GAAA,WAAUK,EAAc,YAAY,GAAG,GACzC,KAAK,QAAQA,EAAc,YAAa,KAAK,EAE/C,KAAK,MACHA,EAAc,YACd,MAEA,KAAK,gBAAe,CAAS,EAExBA,CACT,EACAA,GAAgB,CACd,GAAIA,IAAkB,OAAW,OACjC,IAAMC,EAAcD,EAAc,OAClC,KAAK,QAAQC,EAAa,OAAO,EACjC,KAAK,QAAQA,EAAa,KAAK,EAC/B,KAAK,QAAQD,EAAc,YAAa,KAAK,CAC/C,CAAC,EAGP,CAKQ,gBAAc,CACpB,IAAME,EAAkB,KACxB,OAAO,SAAUC,EAAiC,CAChD,OAAO,YAEFC,EAAiC,CAEpC,IAAMC,EAAQF,EAAS,MAAM,KAAMC,CAAI,EACjCE,EAAQ,KAAK,MAAM,KAAK,MAAM,OAAS,CAAC,EAC9C,OAAAJ,EAAgB,YAAYI,KAAOb,GAAA,cAAaW,CAAI,CAAC,EAC9CC,CACT,CACF,CACF,CAKQ,oBAAkB,CACxB,IAAMH,EAAkB,KACxB,OAAO,SAAUC,EAA+B,CAC9C,OAAO,YAEFC,EAAiC,CAEpC,IAAMC,EAAQF,EAAS,MAAM,KAAMC,CAAI,EACjCE,EAAQ,KAAK,MAAM,KAAK,MAAM,OAAS,CAAC,EAC9C,OAAAJ,EAAgB,YAAYI,KAAOb,GAAA,cAAaW,CAAI,CAAC,EAC9CC,CACT,CACF,CACF,CAKQ,iBAAe,CACrB,IAAMH,EAAkB,KACxB,OAAO,SAAUC,EAAoC,CACnD,OAAO,YAEFC,EAAiC,CAEpC,IAAMC,EAAQF,EAAS,MAAM,KAAMC,CAAI,EACjCE,EAAQ,KAAK,QAAQ,MAAM,KAAK,QAAQ,MAAM,OAAS,CAAC,EAC9D,OAAAJ,EAAgB,YAAYI,KAAOb,GAAA,cAAaW,CAAI,CAAC,EAC9CC,CACT,CACF,CACF,CAGQ,YAENC,EACAC,EAAkB,CAElB,IAAML,EAAkB,KAEpBI,EAAMT,GAAA,aAAa,IAAM,KAC7BS,EAAMT,GAAA,aAAa,EAAI,GAEvB,KAAK,MAAMS,EAAO,SAAUH,GAAW,CAErC,GAAIA,EAAS,SAAW,EAAG,OAAOA,EAElC,IAAMK,EAAU,SAEdC,EACAC,EAAqB,IAErBjB,GAAA,gBAAegB,EAAKF,CAAS,EAC7B,IAAMF,EAASI,EAAIZ,GAAA,sBAAsB,EACtC,OAAOc,GAAQA,IAAS,KAAOA,IAAS,IAAI,EAC5C,KAAK,EAAE,EAEP,QAAQ,UAAW,GAAG,EAEnBC,EAAyB,CAC7B,CAAChB,GAAA,mBAAmB,EAAGS,EAAM,OAAS,EAAIA,EAAQ,KAE9CQ,KAAWpB,GAAA,kBAAiBa,EAAOC,CAAS,EAC5CO,EAAOD,EAAS,WACpBrB,GAAA,eAAe,YAAY,EAGvBuB,KAAc1B,GAAA,gBAAeC,GAAA,QAAQ,OAAM,CAAE,EAMnD,GALIyB,GAAa,OAAS1B,GAAA,QAAQ,OAChC0B,EAAY,MAAQV,GAAS,QAI3BZ,GAAA,gBAAeoB,EAAS,KAAMC,EAAMZ,EAAgB,OAAO,EAC7D,OAAIY,IAASvB,GAAA,iBAAiB,YAC3BkB,EAAIZ,GAAA,sBAAsB,EAAe,IAAG,EAExCM,EAAS,MAAM,KAAM,SAAS,EAGvC,GAAIb,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,IAAM,OACtC,OAAOa,EAAS,MAAM,KAAM,SAAS,EAGvC,IAAMa,EAAWd,EAAgB,aAC/B,CACE,QAASO,EACT,UAAWK,EACX,MAAAT,GAEFQ,EAAS,IAAI,EAETI,EAAOf,EAAgB,OAAO,UAAUc,EAAU,CACtD,WAAY,OAAO,OAAOJ,EAAYC,EAAS,UAAU,EAC1D,EAEGX,EAAgB,UAAS,EAAG,gBAC9BP,GAAA,wBACE,IACEO,EAAgB,UAAS,EAAG,YAAae,EAAM,CAC7C,QAASR,EACT,UAAWK,EACX,MAAAT,EACD,EACHa,GAAI,CACEA,GACF5B,GAAA,KAAK,MAAM,+CAAgD4B,CAAC,CAEhE,EACA,EAAI,EAIR,IAAIC,EAAe,GAEjBN,EAAS,WAAWrB,GAAA,eAAe,YAAY,IAC/CD,GAAA,iBAAiB,aAEjB0B,EAAK,IAAG,EACRE,EAAe,IAGjB,IAAMC,EAAmB,IAAK,CACxBD,IAAiB,KACnBA,EAAe,GACfF,EAAK,IAAG,EAEZ,EAGMb,EAAO,MAAM,KAAK,SAAS,EAC3BiB,EAAcjB,EAAK,UAAUkB,GAAO,OAAOA,GAAQ,UAAU,EAC/DD,GAAe,IACjB,UAAUA,CAAW,EAAI,UAAA,OAGvB,IAAME,EAAa,UAAU,CAAC,EACxBC,EAAU,CAAC,CAAC,OAAW,KAAM,QAAS,QAAQ,EAAE,SACpDD,CAAU,EAEZ,GAAI,CAACJ,GAAgBK,EAAS,CAC5B,GAAM,CAACC,EAAOC,CAAO,KAAIjC,GAAA,mBAAkB8B,CAAU,EACrDN,EAAK,gBAAgBQ,CAAK,EAC1BR,EAAK,UAAU,CACb,KAAM3B,GAAA,eAAe,MACrB,QAAAoC,EACD,EAGH,OAAIP,IAAiB,KACnBA,EAAe,IACfQ,EAAAlB,EAAI,OAAG,MAAAkB,IAAA,QAAAA,EAAE,eAAe,SAAUP,CAAgB,EAClDH,EAAK,IAAG,GAEJR,EAAI,OAASe,GAChBf,EAAIZ,GAAA,sBAAsB,EAAe,IAAG,EAE9BO,EAAKiB,CAAW,EACjB,MAAM,KAAM,SAAS,CACvC,GAGF,GAAI,CACF,OAAOlB,EAAS,MAAM,KAAM,SAAS,QAC9ByB,EAAU,CACjB,GAAM,CAACH,EAAOC,CAAO,KAAIjC,GAAA,mBAAkBmC,CAAQ,EACnD,MAAAX,EAAK,gBAAgBQ,CAAK,EAC1BR,EAAK,UAAU,CACb,KAAM3B,GAAA,eAAe,MACrB,QAAAoC,EACD,EACKE,UAQDT,GACHT,EAAI,KAAK,SAAUU,CAAgB,EAGzC,EAMA,cAAO,KAAKjB,CAAQ,EAAE,QAAQ0B,GAAM,CAClC,OAAO,eAAerB,EAASqB,EAAK,CAClC,KAAG,CACD,OAAO1B,EAAS0B,CAAG,CACrB,EACA,IAAIC,EAAK,CACP3B,EAAS0B,CAAG,EAAIC,CAClB,EACD,CACH,CAAC,EAEMtB,CACT,CAAC,EACH,CAEA,aAAauB,EAA0BC,EAAmB,OACxD,IAAMC,EAAO,KAAK,UAAS,EAAG,aAE9B,GAAI,EAAEA,aAAgB,UACpB,OAAOD,EAGT,GAAI,CACF,OAAOL,EAAAM,EAAKF,EAAMC,CAAW,KAAC,MAAAL,IAAA,OAAAA,EAAIK,QAC3BE,EAAK,CACZ,OAAA5C,GAAA,KAAK,MACH,gEACA4C,CAAG,EAEEF,EAEX,GAxSFG,GAAA,uBAAArC,8eCpCAsC,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,8ICHA,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,aAAA,eACAA,EAAA,aAAA,eACAA,EAAA,UAAA,YACAA,EAAA,YAAA,aACF,GALYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,EAO1B,IAAYC,IAAZ,SAAYA,EAAY,CACtBA,EAAA,WAAA,aACAA,EAAA,gBAAA,iBACF,GAHYA,GAAAD,GAAA,eAAAA,GAAA,aAAY,CAAA,EAAA,EAKxB,IAAYE,IAAZ,SAAYA,EAAY,CACtBA,EAAA,WAAA,aACAA,EAAA,gBAAA,iBACF,GAHYA,GAAAF,GAAA,eAAAA,GAAA,aAAY,CAAA,EAAA,wNCZXG,GAAA,kBAAoB,OAC/B,2DAA2D,EAOhDA,GAAA,iBAAmB,IAAI,IAAI,CACtC,YACA,YACA,aACA,gBACA,mBACA,aACA,SACA,aACA,UACD,0JClBD,IAAAC,GAAA,WACAC,GAAA,KAWA,SAAgBC,GACdC,EACAC,EACAC,EACAC,EAA6B,CAAA,EAAE,CAE/B,IAAMC,EAAOH,EAAO,UAAUC,EAAU,CAAE,WAAYC,CAAc,CAAE,EAEhEE,EAAgBL,EAAMF,GAAA,iBAAiB,GAAK,CAAA,EAClD,OAAAO,EAAM,KAAKD,CAAI,EAGf,OAAO,eAAeJ,EAAOF,GAAA,kBAAmB,CAC9C,WAAY,GACZ,aAAc,GACd,MAAOO,EACR,EAEMD,CACT,CAnBAE,GAAA,UAAAP,GA0BA,SAAgBQ,GAAQP,EAA2BQ,EAAS,CAC1D,IAAMH,EAAQL,EAAMF,GAAA,iBAAiB,GAAK,CAAA,EAErCO,EAAM,SAGXA,EAAM,QAAQD,GAAO,CACfI,IACFJ,EAAK,UAAU,CACb,KAAMP,GAAA,eAAe,MACrB,QAASW,EAAI,QACd,EACDJ,EAAK,gBAAgBI,CAAG,GAE1BJ,EAAK,IAAG,CACV,CAAC,EACD,OAAOJ,EAAMF,GAAA,iBAAiB,EAChC,CAjBAQ,GAAA,QAAAC,GAyCA,SAAgBE,GACdC,EACAC,EACAC,EAA8B,CAE9B,IAAIC,EACAC,EACJ,GAAI,CACFA,EAASJ,EAAO,EAEZK,GAAUD,CAAM,GAClBA,EAAO,KACLE,GAAOL,EAAS,OAAWK,CAAG,EAC9BR,GAAOG,EAASH,CAAG,CAAC,QAGjBS,EAAG,CACVJ,EAAQI,UAER,GAAI,CAACF,GAAUD,CAAM,IACnBH,EAASE,EAAOC,CAAM,EAClBD,GAAS,CAACD,GAEZ,MAAMC,EAIV,OAAOC,EAEX,CA7BAR,GAAA,mCAAAG,GA+BA,SAASM,GAAaG,EAAmB,OACvC,OACG,OAAOA,GAAQ,UACdA,GACA,QAAOC,EAAA,OAAO,yBAAyBD,EAAK,MAAM,KAAC,MAAAC,IAAA,OAAA,OAAAA,EAAE,QACnD,YACJ,EAEJ,+HCrHaC,GAAA,gBAAkB,SAClBA,GAAA,aAAe,+KCF5B,IAAAC,GAAA,WACAC,GAAA,aACAC,GAAA,aAKAC,GAAA,aAOAC,GAAA,KACAC,GAAA,KAOAC,GAAA,KAKAC,GAAA,KAEaC,GAAA,eAAiB,YAG9B,IAAaC,GAAb,cAA4CP,GAAA,mBAAmB,CAC7D,YAAYQ,EAAuC,CAAA,EAAE,CACnD,MAAMH,GAAA,aAAcA,GAAA,gBAAiBG,CAAM,CAC7C,CAES,UAAUA,EAAuC,CAAA,EAAE,CAC1D,KAAK,QAAU,OAAO,OAAO,CAAA,EAAIA,CAAM,CACzC,CAES,WAAS,CAChB,OAAO,KAAK,OACd,CAEA,MAAI,CACF,MAAO,CACL,IAAIR,GAAA,oCACF,UACA,CAAC,YAAY,EACbS,GACS,KAAK,kBAAkBA,CAAa,CAC5C,EAGP,CAEQ,gBAAc,CACpB,IAAMC,EAAkB,KACxB,OAAO,SACLC,EACAC,EACAC,EAA6B,CAE7B,GAAI,CAACH,EAAgB,UAAS,EAC5B,OAAOG,EAAI,EAEbH,EAAgB,MAAME,EAAO,OAAQF,EAAgB,WAAU,CAAE,EAEjE,IAAMI,EAAaH,EAEbI,KAAchB,GAAA,gBAAeD,GAAA,QAAQ,OAAM,CAAE,EAC7CkB,EAAYF,EAAW,aACzBA,EAAW,aAAa,IACxBH,EAAQ,WACRK,GAAaD,GAAa,OAAShB,GAAA,QAAQ,OAC7CgB,EAAY,MAAQC,GAEtBH,EAAI,CACN,CACF,CAEQ,aACNI,EACAC,EACAC,EACAC,EAA6B,CAE7B,IAAMV,EAAkB,KACxB,YAAK,MAAM,MAAM,yCAAyC,EAEnD,YAAwBW,EAAe,CAC5C,GAAI,CAACX,EAAgB,UAAS,EAC5B,OAAOS,EAAS,MAAM,KAAME,CAAI,EAGlC,IAAMC,EAAOH,EAAS,MAAQF,GAAcX,GAAA,eACtCiB,EAAW,GAAGpB,GAAA,aAAa,UAAU,MAAMmB,CAAI,GAE/CV,EAAQS,EAAK,CAAC,EAEdG,KAAOpB,GAAA,WAAUQ,EAAOF,EAAgB,OAAQa,EAAU,CAC9D,CAACpB,GAAA,eAAe,YAAY,EAAGA,GAAA,aAAa,WAC5C,CAACA,GAAA,eAAe,WAAW,EAAGc,EAC9B,CAACd,GAAA,eAAe,SAAS,EAAGe,EAC7B,EAEKO,EACJL,GACCC,EAAKA,EAAK,OAAS,CAAC,EACvB,OAAII,IACFJ,EAAKA,EAAK,OAAS,CAAC,EAAI,YACnBK,EAA6C,IAEhDtB,GAAA,SAAQQ,CAAK,EACba,EAAS,MAAM,KAAMC,CAAQ,CAC/B,GAGK5B,GAAA,QAAQ,KAAKA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAI0B,CAAI,EAAG,OAClDpB,GAAA,oCACL,IACSe,EAAS,MAAM,KAAME,CAAI,EAElCM,GAAM,CACAA,aAAe,QACjBH,EAAK,UAAU,CACb,KAAM1B,GAAA,eAAe,MACrB,QAAS6B,EAAI,QACd,EACDH,EAAK,gBAAgBG,CAAG,GAGrBP,MACHhB,GAAA,SAAQQ,CAAK,CAEjB,CAAC,CAEJ,CACH,CACF,CAEQ,cAAY,CAGlB,IAAMF,EAAkB,KACxB,YAAK,MAAM,MAAM,0CAA0C,EAEpD,SACLS,EAAoC,CAEpC,OAAO,YAAsCE,EAAS,CACpD,IAAMC,EAAOD,EAAK,CAAC,EACbO,EAAUP,EAAK,CAAC,EAChBJ,EAAa,KAAK,WACxB,GAAI,CAACf,GAAA,iBAAiB,IAAIoB,CAAI,EAC5B,OAAOH,EAAS,MAAM,KAAME,CAAI,EAGlC,IAAMD,EACJ,OAAOC,EAAKA,EAAK,OAAS,CAAC,GAAM,YACjCO,EAAQ,YAAY,OAAS,gBAE/B,OAAOT,EAAS,MAAM,KAAM,CAC1BG,EACAZ,EAAgB,aACdO,EACAK,EACAM,EACAR,CAAoB,EAEd,CACZ,CACF,CACF,CAEQ,kBAAkBX,EAEzB,CACC,IAAMC,EAAkB,KAExB,SAASmB,KAAkCR,EAAS,CAClD,IAAMS,EAAuBrB,EAAc,QAAQ,MAAM,KAAMY,CAAI,EACnE,OAAAS,EAAI,QAAQ,YAAapB,EAAgB,eAAc,CAAE,EACzDoB,EAAI,QAAQ,aAAcpB,EAAgB,gBAAe,CAAE,EAE3DA,EAAgB,MAAMoB,EAAK,UAAWpB,EAAgB,aAAY,CAAE,EAE7DoB,CACT,CAEA,OAAAD,EAAQ,QAAUA,EAClBA,EAAQ,QAAUA,EACXA,CACT,CAEQ,YAAU,CAChB,IAAMnB,EAAkB,KACxB,YAAK,MAAM,MAAM,sCAAsC,EAEhD,SACLS,EAA4B,CAE5B,OAAO,YAAqCE,EAAS,CACnD,IAAMU,EAAkBV,EAAK,CAAC,EAE9B,OAAKX,EAAgB,UAAS,KAIvBV,GAAA,wBACL,IACSmB,EAAS,MAAM,KAAME,CAAI,EAElCM,GAAM,CACA,CAACA,GAAOI,aAAsB,QAChCJ,EAAMI,MAER3B,GAAA,SAAQ,KAAMuB,CAAG,CACnB,CAAC,EAZMR,EAAS,MAAM,KAAME,CAAI,CAcpC,CACF,CACF,CAEQ,iBAAe,CACrB,IAAMX,EAAkB,KACxB,YAAK,MAAM,MAAM,sCAAsC,EAEhD,SAELC,EACAC,EACAC,EAA6B,SAE7B,GAAI,CAACH,EAAgB,UAAS,EAC5B,OAAOG,EAAI,EAEb,IAAMC,EAAaH,EAEbiB,IACJI,EAAAlB,EAAW,gBAAY,MAAAkB,IAAA,OAAA,OAAAA,EAAE,YAAWC,EAAAnB,EAAW,WAAO,MAAAmB,IAAA,OAAA,OAAAA,EAAE,SAEpDC,EAAcN,GAAS,KAAK,WAAW,QAAQ,EACjDA,EAAQ,KAAK,OAAO,CAAC,EACrBA,GAAS,KACPL,EAAW,GAAGpB,GAAA,aAAa,eAAe,MAC9C+B,GAAe,KAAK,YAAc5B,GAAA,cACpC,GAEM6B,EAA6B,CACjC,CAAChC,GAAA,eAAe,WAAW,EAAG,KAAK,WACnC,CAACA,GAAA,eAAe,YAAY,EAAGA,GAAA,aAAa,gBAC5C,CAACF,GAAA,mBAAmB,EAAGa,EAAW,aAC9BA,EAAW,aAAa,IACxBH,EAAQ,YAEVuB,IACFC,EAAehC,GAAA,eAAe,YAAY,EAAI+B,GAEhD,IAAMV,KAAOpB,GAAA,WACXQ,EACAF,EAAgB,OAChBa,EACAY,CAAc,EAGhB,OAAIzB,EAAgB,UAAS,EAAG,gBAC9BV,GAAA,wBACE,IAAMU,EAAgB,UAAS,EAAG,YAAac,EAAM,CAAE,QAAAb,CAAO,CAAE,EAChEyB,GAAI,CACEA,GACF1B,EAAgB,MAAM,MAAM,sBAAuB0B,CAAC,CAExD,EACA,EAAI,EAIDtC,GAAA,QAAQ,KAAKA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAI0B,CAAI,EAAG,IAAK,CAC9DX,EAAI,CACN,CAAC,CACH,CACF,GA3PFP,GAAA,uBAAAC,2ZChCA8B,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,+ICFA,IAAYC,IAAZ,SAAYA,EAAqB,CAC/BA,EAAA,MAAA,QACAA,EAAA,SAAA,WACAA,EAAA,aAAA,cACF,GAJYA,GAAAC,GAAA,wBAAAA,GAAA,sBAAqB,CAAA,EAAA,EAMjC,IAAYC,IAAZ,SAAYA,EAAS,CACnBA,EAAA,IAAA,QACAA,EAAA,IAAA,QACAA,EAAA,KAAA,IACAA,EAAA,OAAA,IACAA,EAAA,IAAA,IACAA,EAAA,QAAA,IACAA,EAAA,QAAA,IACAA,EAAA,OAAA,MACAA,EAAA,MAAA,IACAA,EAAA,OAAA,IACAA,EAAA,GAAA,IACAA,EAAA,UAAA,IACAA,EAAA,UAAA,IACAA,EAAA,QAAA,IACAA,EAAA,KAAA,IACAA,EAAA,QAAA,IACAA,EAAA,KAAA,OACAA,EAAA,IAAA,MACAA,EAAA,MAAA,QACAA,EAAA,OAAA,SACAA,EAAA,aAAA,cACAA,EAAA,QAAA,SACF,GAvBYA,GAAAD,GAAA,YAAAA,GAAA,UAAS,CAAA,EAAA,EAyBrB,IAAYE,IAAZ,SAAYA,EAAS,CACnBA,EAAA,QAAA,kBACAA,EAAA,MAAA,gBACAA,EAAA,QAAA,kBACAA,EAAA,SAAA,mBACAA,EAAA,gBAAA,yBACAA,EAAA,aAAA,qBACF,GAPYA,GAAAF,GAAA,YAAAA,GAAA,UAAS,CAAA,EAAA,8GChCrB,IAAYG,IAAZ,SAAYA,EAAc,CACxBA,EAAA,OAAA,iBACAA,EAAA,WAAA,qBACAA,EAAA,WAAA,qBACAA,EAAA,WAAA,qBACAA,EAAA,eAAA,yBACAA,EAAA,eAAA,yBACAA,EAAA,UAAA,qBACAA,EAAA,sBAAA,0BACF,GATYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,+ICCbC,GAAA,oBAAsB,OAAO,IAAI,uBAAuB,EAExDA,GAAA,yBAA2B,OAAO,IAC7C,4BAA4B,uHCM9B,IAAAC,GAAA,KAGaC,GAAA,wBACX,qRCZF,IAAAC,GAAA,WACAC,GAAA,KACAC,GAAA,KACAC,GAAA,KAWMC,GAAmB,OAAO,OAAOH,GAAA,qBAAqB,EAG/CI,GAAaC,GACjB,OAAOA,GAAO,MAAS,WADnBC,GAAA,UAASF,GAKtB,IAAMG,GAAgBF,GACb,OAAOA,GAAS,UAAYA,IAAU,KAI/C,SAASG,GAA0BC,EAAgBC,EAAaC,EAAa,CACvE,MAAM,QAAQA,CAAQ,EACxBA,EAAS,QAAQ,CAACN,EAAOO,IAAO,CAC9BJ,GAA0BC,EAAM,GAAGC,CAAG,IAAIE,CAAG,GAAIP,CAAK,CACxD,CAAC,EACQM,aAAoB,OAC7B,OAAO,QAAQA,CAAQ,EAAE,QAAQ,CAAC,CAACE,EAAWR,CAAK,IAAK,CACtDG,GAA0BC,EAAM,GAAGC,CAAG,IAAIG,CAAS,GAAIR,CAAK,CAC9D,CAAC,EAEDI,EAAK,aAAa,GAAGR,GAAA,eAAe,SAAS,GAAG,OAAOS,CAAG,CAAC,GAAIC,CAAQ,CAE3E,CAGA,SAAgBG,GACdL,EACAM,EAAsC,CAEtC,OAAO,QAAQA,CAAc,EAAE,QAAQ,CAAC,CAACL,EAAKL,CAAK,IAAK,CACtDG,GAA0BC,EAAMC,EAAKL,CAAK,CAC5C,CAAC,CACH,CAPAC,GAAA,2BAAAQ,GASA,SAAgBE,GACdP,EACAQ,EACAC,EACAC,EACAC,EAAY,CAEZ,IAAMC,EAASC,GAAsBL,EAAKC,EAAaC,EAAOC,CAAG,EACjEX,EAAK,aAAaR,GAAA,eAAe,OAAQoB,CAAM,CACjD,CATAf,GAAA,cAAAU,GAWA,SAASO,GACPC,EACAC,EACAC,EACAC,EACAC,EAAc,CAKd,IAAIC,EAAQC,GAASJ,EAAcE,CAAI,EAEnCG,EAAY,GAEhB,GAAI,CAACF,EAAO,CACVE,EAAY,GACZ,IAAMC,EAASC,GAAeP,EAAcE,CAAI,EAEhDC,EAAQ,CACN,OAAAG,EACA,KAAME,GACJV,EACAC,EACAC,EACAC,EACAC,EACAI,EAAO,IAAI,EAEb,MAAO,MAGTG,GAAST,EAAcE,EAAMC,CAAK,EAGpC,MAAO,CAAE,UAAAE,EAAW,MAAAF,CAAK,CAC3B,CAEA,SAASK,GACPV,EACAC,EACAC,EACAC,EACAC,EACAQ,EAAqB,SAErB,IAAMC,EAAiC,CACrC,CAACpC,GAAA,eAAe,UAAU,EAAG0B,EAAK,UAClC,CAAC1B,GAAA,eAAe,UAAU,EAAG2B,EAAK,KAAK,GAAG,EAC1C,CAAC3B,GAAA,eAAe,UAAU,EAAG0B,EAAK,WAAW,SAAQ,GAGjDlB,EAAOe,EAAO,UAClB,GAAGxB,GAAA,UAAU,OAAO,IAAIqC,EAAWpC,GAAA,eAAe,UAAU,CAAC,GAC7D,CACE,WAAAoC,GAEFD,EAAarC,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,EAAIqC,CAAU,EAAI,MAAS,EAGxEE,EAAWZ,EAAaxB,GAAA,wBAAwB,EAAE,OAClDqC,EAAYZ,EAAK,WAAW,KAChCY,GAAaA,EAAU,OAAS,OAAO,EAGzC,OAAIA,GACFvB,GACEP,EACA6B,EAAS,IACTb,EAAS,EAAG,aACZe,EAAAD,EAAU,OAAG,MAAAC,IAAA,OAAA,OAAAA,EAAE,OACfC,EAAAF,EAAU,OAAG,MAAAE,IAAA,OAAA,OAAAA,EAAE,GAAG,EAIfhC,CACT,CAEA,SAAgBiC,GAAQjC,EAAgBkC,EAAa,CAC/CA,GACFlC,EAAK,gBAAgBkC,CAAK,EAE5BlC,EAAK,IAAG,CACV,CALAH,GAAA,QAAAoC,GAOA,SAAgBE,GACdN,EACAO,EAA6B,CAE7B,GAAI,GAACP,GAAY,CAAC,MAAM,QAAQA,EAAS,WAAW,GAIpD,OAAIO,EACKP,EAAS,YACb,OACCQ,GAAa,CAAA,IAAAN,EACX,OAAArC,GAAiB,SAAQqC,EAACM,KAAkB,MAAAN,IAAA,OAAA,OAAAA,EAAE,SAAS,IAAM,EAAE,CAAA,EAElE,KAAKM,GAAa,CAAA,IAAAN,EAAAC,EAAC,OAAAI,MAAkBJ,GAAAD,EAACM,KAAkB,MAAAN,IAAA,OAAA,OAAAA,EAAE,QAAI,MAAAC,IAAA,OAAA,OAAAA,EAAE,MAAK,CAAA,EAEjEH,EAAS,YAAY,KAC1BQ,GAAa,CAAA,IAAAN,EACX,OAAArC,GAAiB,SAAQqC,EAACM,KAAkB,MAAAN,IAAA,OAAA,OAAAA,EAAE,SAAS,IAAM,EAAE,CAAA,CAGvE,CArBAlC,GAAA,aAAAsC,GAuBA,SAAST,GAAST,EAAmBE,EAAgBC,EAAmB,CACtE,OAAQH,EAAaxB,GAAA,wBAAwB,EAAE,OAAO0B,EAAK,KAAK,GAAG,CAAC,EAClEC,CACJ,CAEA,SAASC,GAASJ,EAAmBE,EAAc,CACjD,OAAOF,EAAaxB,GAAA,wBAAwB,EAAE,OAAO0B,EAAK,KAAK,GAAG,CAAC,CACrE,CAEA,SAASK,GAAeP,EAAmBE,EAAc,CACvD,QAASmB,EAAInB,EAAK,OAAS,EAAGmB,EAAI,EAAGA,IAAK,CACxC,IAAMlB,EAAQC,GAASJ,EAAcE,EAAK,MAAM,EAAGmB,CAAC,CAAC,EAErD,GAAIlB,EACF,OAAOA,EAIX,MAAO,CACL,KAAMH,EAAaxB,GAAA,wBAAwB,EAAE,KAEjD,CAEA,SAAS8C,GAAYC,EAAqBrB,EAAiB,CACzD,IAAMsB,EAAsB,CAAA,EACxBC,EAAgCvB,EACpC,KAAOuB,GAAM,CACX,IAAIzC,EAAMyC,EAAK,IAEXF,GAAc,OAAOvC,GAAQ,WAC/BA,EAAM,KAERwC,EAAU,KAAK,OAAOxC,CAAG,CAAC,EAC1ByC,EAAOA,EAAK,KAEd,OAAOD,EAAU,QAAO,CAC1B,CAEA,SAASE,GAAYL,EAAS,CAC5B,OAAOM,GAAW;EAAMN,CAAC,CAC3B,CAEA,SAASO,GAAYP,EAAS,CAC5B,OAAOM,GAAW,IAAKN,CAAC,CAC1B,CAEA,SAASM,GAAWE,EAAcC,EAAU,CAC1C,IAAIC,EAAO,GACX,QAASV,EAAI,EAAGA,EAAIS,EAAIT,IACtBU,GAAQF,EAEV,OAAOE,CACT,CAEA,IAAMC,GAA6B,CACjC1D,GAAA,UAAU,MACVA,GAAA,UAAU,OACVA,GAAA,UAAU,IACVA,GAAA,UAAU,cAGZ,SAAgBsB,GACdL,EACAC,EAAc,GACdyC,EACAC,EAAiB,SAEjB,IAAIvC,EAAS,GAEb,GAAIJ,GAAK,WAAY,CACnB,IAAME,EAAQ,OAAOwC,GAAe,SAAWA,EAAa1C,EAAI,MAC1DG,EAAM,OAAOwC,GAAa,SAAWA,EAAW3C,EAAI,IAEtD4C,EAAkC5C,EAAI,WAAW,KACjD6C,EAAmC,EACvC,KAAOD,GAAM,CACX,GAAIA,EAAK,MAAQ1C,EAAO,CACtB0C,EAAOA,EAAK,KACZC,EAAeD,GAAM,KACrB,SAEF,GAAIA,EAAK,IAAMzC,EAAK,CAClByC,EAAOA,EAAK,KACZC,EAAeD,GAAM,KACrB,SAEF,IAAIxD,EAAQwD,EAAK,OAASA,EAAK,KAC3BE,EAAQ,GACR,CAAC7C,GAAewC,GAAiB,QAAQG,EAAK,IAAI,GAAK,IAEzDxD,EAAQ,KAENwD,EAAK,OAAS7D,GAAA,UAAU,SAC1BK,EAAQ,IAAIA,CAAK,KAEfwD,EAAK,OAAS7D,GAAA,UAAU,MAC1BK,EAAQ,IAENwD,EAAK,KAAOC,GACdzC,GAAU+B,GAAYS,EAAK,KAAOC,CAAa,EAC/CA,EAAeD,EAAK,KACpBE,EAAQT,GAAYO,EAAK,OAAS,CAAC,GAE/BA,EAAK,SAASrB,EAAAqB,EAAK,QAAI,MAAArB,IAAA,OAAA,OAAAA,EAAE,QAC3BuB,EAAQT,GAAYO,EAAK,SAASpB,EAAAoB,EAAK,QAAI,MAAApB,IAAA,OAAA,OAAAA,EAAE,MAAO,EAAE,GAG1DpB,GAAU0C,EAAQ1D,EACdwD,IACFA,EAAOA,EAAK,OAKlB,OAAOxC,CACT,CAtDAf,GAAA,sBAAAgB,GAwDA,SAAgB0C,GACdC,EACAzC,EACAC,EAAmD,CAEnD,GACE,CAACwC,GACD,OAAOA,EAAK,WAAc,YAC1BA,EAAK/D,GAAA,mBAAmB,EAExB,OAEF,IAAMgE,EAASD,EAAK,UAAS,EAE7BA,EAAK/D,GAAA,mBAAmB,EAAI,GAE5B,OAAO,KAAKgE,CAAM,EAAE,QAAQxD,GAAM,CAChC,IAAMmB,EAAQqC,EAAOxD,CAAG,EAExB,GAAKmB,IAIDA,EAAM,UACRA,EAAM,QAAUsC,GAAkB3C,EAAQC,EAAWI,EAAM,OAAO,GAGhEA,EAAM,MAAM,CACd,IAAIuC,EAAqBvC,EAAM,KAE/B,KAAOuC,EAAc,QACnBA,EAAgBA,EAAc,OAEhCJ,GAAWI,EAAe5C,EAAQC,CAAS,EAE/C,CAAC,CACH,CApCAnB,GAAA,WAAA0D,GAsCA,IAAMK,GAAyB,CAC7BC,EACAC,EACAC,IACE,CACGA,IAGLF,EAAY,gBAAgBC,CAAG,EAC/BD,EAAY,UAAU,CACpB,KAAMvE,GAAI,eAAe,MACzB,QAASwE,EAAI,QACd,EACDD,EAAY,IAAG,EACjB,EAEMG,GAA2B,CAC/BH,EACAE,IACE,CACGA,GAGLF,EAAY,IAAG,CACjB,EAEA,SAAgBH,GACd3C,EACAC,EACAiD,EAGAC,EAAoB,GAAK,CAEzB,GACGC,EAAqC1E,GAAA,mBAAmB,GACzD,OAAOwE,GAAkB,WAEzB,OAAOA,EAGT,SAASE,EAEPvD,EACAwD,EACAnD,EACAC,EAAqC,CAErC,GAAI,CAAC+C,EACH,OAEF,IAAMI,EAASrD,EAAS,EAIxB,GACEqD,EAAO,2BACPH,IACCpE,GAAac,CAAM,GAAK,OAAOA,GAAW,aAKvC,OAHcA,EAAeM,EAAK,SAAS,GAGvB,WACtB,OAAO+C,EAAc,KAAK,KAAMrD,EAAQwD,EAAMnD,EAAcC,CAAI,EAIpE,GAAI,CAACD,EAAaxB,GAAA,wBAAwB,EACxC,OAAOwE,EAAc,KAAK,KAAMrD,EAAQwD,EAAMnD,EAAcC,CAAI,EAElE,IAAMC,EAAOoB,GAAY8B,EAAO,WAAYnD,GAAQA,EAAK,IAAI,EACvDoD,EAAQnD,EAAK,OAAQoD,GAAc,OAAOA,GAAS,QAAQ,EAAE,OAE/DnD,EACA2C,EAAgB,GACpB,GAAIM,EAAO,OAAS,GAAKA,EAAO,MAAQC,EACtClD,EAAQI,GAAeP,EAAcE,CAAI,MACpC,CACL,IAAMqD,EAAW1D,GACfC,EACAC,EACAC,EACAC,EACAC,CAAI,EAENC,EAAQoD,EAAS,MACjBT,EAAgBS,EAAS,UAG3B,OAAOlF,GAAI,QAAQ,KACjBA,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,EAAI8B,EAAM,IAAI,EAClD,IAAK,CACH,GAAI,CACF,IAAMqD,EAAMR,EAAc,KACxB,KACArD,EACAwD,EACAnD,EACAC,CAAI,EAEN,SAAIrB,GAAA,WAAU4E,CAAG,EACRA,EAAI,KACRC,IACCV,GAAyB5C,EAAM,KAAM2C,CAAa,EAC3CW,GAERZ,GAAc,CACb,MAAAF,GAAuBxC,EAAM,KAAM0C,EAAKC,CAAa,EAC/CD,CACR,CAAC,GAGHE,GAAyB5C,EAAM,KAAM2C,CAAa,EAC3CU,SAEFX,EAAU,CACjB,MAAAF,GAAuBxC,EAAM,KAAM0C,EAAKC,CAAa,EAC/CD,EAEV,CAAC,CAEL,CAEC,OAAAK,EAAqC1E,GAAA,mBAAmB,EAAI,GAEtD0E,CACT,CArGAtE,GAAA,kBAAA6D,gIC9VaiB,GAAA,gBAAkB,SAClBA,GAAA,aAAe,6JCF5B,IAAAC,GAAA,WACAC,GAAA,aAQAC,GAAA,KACAC,GAAA,KACAC,GAAA,KAEAC,GAAA,KAYAC,GAAA,KAUAC,GAAA,KAKMC,GAA+C,CACnD,WAAY,GACZ,MAAO,GACP,YAAa,GACb,mBAAoB,IAGhBC,GAAoB,CAAC,cAAc,EAE5BC,GAAb,cAA4CT,GAAA,mBAAmB,CAC7D,YAAYU,EAAuC,CAAA,EAAE,CACnD,MACEJ,GAAA,aACAA,GAAA,gBACA,OAAO,OAAO,CAAA,EAAIC,GAAgBG,CAAM,CAAC,CAE7C,CAEQ,YAAU,CAChB,OAAO,KAAK,OACd,CAES,UAAUA,EAAuC,CAAA,EAAE,CAC1D,KAAK,QAAU,OAAO,OAAO,CAAA,EAAIH,GAAgBG,CAAM,CACzD,CAEU,MAAI,CACZ,IAAMC,EAAS,IAAIX,GAAA,oCACjB,UACAQ,EAAiB,EAEnB,OAAAG,EAAO,MAAM,KAAK,KAAK,oBAAmB,CAAE,EAC5CA,EAAO,MAAM,KAAK,KAAK,mBAAkB,CAAE,EAC3CA,EAAO,MAAM,KAAK,KAAK,qBAAoB,CAAE,EAEtCA,CACT,CAEQ,qBAAmB,CACzB,OAAO,IAAIX,GAAA,8BACT,+BACAQ,GAGCI,OACKZ,GAAA,WAAUY,EAAc,OAAO,GACjC,KAAK,QAAQA,EAAe,SAAS,EAEvC,KAAK,MACHA,EACA,UACA,KAAK,cAAcA,EAAc,oBAAoB,CAAC,EAEjDA,GAETA,GAAgB,CACVA,GACF,KAAK,QAAQA,EAAe,SAAS,CAEzC,CAAC,CAEL,CAEQ,oBAAkB,CACxB,OAAO,IAAIZ,GAAA,8BACT,6BACAQ,GACCI,OACKZ,GAAA,WAAUY,EAAc,KAAK,GAC/B,KAAK,QAAQA,EAAe,OAAO,EAErC,KAAK,MAAMA,EAAe,QAAS,KAAK,YAAW,CAAE,EAC9CA,GAERA,GAAsC,CACjCA,GACF,KAAK,QAAQA,EAAe,OAAO,CAEvC,CAAC,CAEL,CAEQ,sBAAoB,CAC1B,OAAO,IAAIZ,GAAA,8BACT,iCACAQ,GACAI,OACMZ,GAAA,WAAUY,EAAc,QAAQ,GAClC,KAAK,QAAQA,EAAe,UAAU,EAExC,KAAK,MAAMA,EAAe,WAAY,KAAK,eAAc,CAAE,EACpDA,GAETA,GAAgB,CACVA,GACF,KAAK,QAAQA,EAAe,UAAU,CAE1C,CAAC,CAEL,CAEQ,cACNC,EAAiE,CAEjE,IAAMC,EAAkB,KACxB,OAAO,SAAiBC,EAAQ,CAC9B,OAAO,UAAqB,CAG1B,IAAIC,EAGJ,GAAI,UAAU,QAAU,EAAG,CACzB,IAAMC,EAAO,UACbD,EAAgBF,EAAgB,iBAC9BG,EAAK,CAAC,EACNA,EAAK,CAAC,EACNA,EAAK,CAAC,EACNA,EAAK,CAAC,EACNA,EAAK,CAAC,EACNA,EAAK,CAAC,EACNA,EAAK,CAAC,EACNA,EAAK,CAAC,EACNJ,CAAoB,MAEjB,CACL,IAAMI,EAAO,UAAU,CAAC,EACxBD,EAAgBF,EAAgB,iBAC9BG,EAAK,OACLA,EAAK,SACLA,EAAK,UACLA,EAAK,aACLA,EAAK,eACLA,EAAK,cACLA,EAAK,cACLA,EAAK,aACLJ,CAAoB,EAIxB,IAAMK,KAAYb,GAAA,cAChBW,EAAc,SACdA,EAAc,aAAa,EAGvBG,EAAOL,EAAgB,mBAC3BI,EACAF,CAAa,EAGf,OAAAA,EAAc,aAAab,GAAA,wBAAwB,EAAI,CACrD,OAAQa,EAAc,SAClBA,EAAc,UACbA,EAAc,SACbb,GAAA,wBAAwB,EAE1B,OACJ,KAAAgB,EACA,OAAQ,CAAA,GAGHpB,GAAA,QAAQ,KAAKA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAIoB,CAAI,EAAG,OAClDnB,GAAA,wBAGL,IACUe,EAAoC,MAAM,KAAM,CACtDC,EACD,EAEH,CAACI,EAAKC,IAAU,CACdP,EAAgB,uBAAuBK,EAAMC,EAAKC,CAAM,CAC1D,CAAC,CAEJ,CACH,CACF,CACF,CAEQ,uBACNF,EACAC,EACAC,EAAqD,CAErD,IAAMX,EAAS,KAAK,WAAU,EAC9B,GAAIW,IAAW,QAAaD,EAAK,IAC/Bf,GAAA,SAAQc,EAAMC,CAAG,EACjB,OAGF,MAAIf,GAAA,WAAUgB,CAAM,EACjBA,EAAiD,KAChDC,GAAa,CACX,GAAI,OAAOZ,EAAO,cAAiB,WAAY,IAC7CL,GAAA,SAAQc,CAAI,EACZ,OAEF,KAAK,qBAAqBA,EAAMG,CAAU,CAC5C,EACAC,GAAQ,IACNlB,GAAA,SAAQc,EAAMI,CAAK,CACrB,CAAC,MAEE,CACL,GAAI,OAAOb,EAAO,cAAiB,WAAY,IAC7CL,GAAA,SAAQc,CAAI,EACZ,OAEF,KAAK,qBAAqBA,EAAME,CAAsC,EAE1E,CAEQ,qBACNF,EACAE,EAAoC,CAEpC,IAAMX,EAAS,KAAK,WAAU,KAC9BV,GAAA,wBACE,IAAK,CACHU,EAAO,aAAaS,EAAME,CAAM,CAClC,EACAD,GAAM,CACAA,GACF,KAAK,MAAM,MAAM,8BAA+BA,CAAG,KAGrDf,GAAA,SAAQc,EAAM,MAAS,CACzB,EACA,EAAI,CAER,CAEQ,aAAW,CACjB,IAAML,EAAkB,KACxB,OAAO,SAAeC,EAAQ,CAC5B,OAAO,SAELS,EACAC,EAAmC,CAEnC,OAAOX,EAAgB,OAAO,KAAMC,EAAUS,EAAQC,CAAO,CAC/D,CACF,CACF,CAEQ,gBAAc,CACpB,IAAMX,EAAkB,KACxB,OAAO,SAAkBC,EAAsB,CAC7C,OAAO,SAELW,EACAC,EACAC,EACAH,EACAI,EAAgC,CAEhC,OAAOf,EAAgB,UACrB,KACAC,EACAW,EACAC,EACAC,EACAC,EACAJ,CAAO,CAEX,CACF,CACF,CAEQ,OACNK,EACAf,EACAS,EACAC,EAAmC,CAEnC,IAAMf,EAAS,KAAK,WAAU,EACxBS,EAAO,KAAK,OAAO,UAAUlB,GAAA,UAAU,KAAK,EAElD,OAAOF,GAAA,QAAQ,KAAKA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAIoB,CAAI,EAAG,OAClDnB,GAAA,wBAGL,IACSe,EAAS,KAAKe,EAAKN,EAAQC,CAAO,EAE3C,CAACL,EAAKC,IAAU,CACVA,OACgBhB,GAAA,cAAagB,CAAM,EAG1BA,EAAO,QAChBhB,GAAA,eAAcc,EAAME,EAAO,IAAKX,EAAO,WAAW,EAFlDS,EAAK,WAAWlB,GAAA,UAAU,YAAY,MAK1CI,GAAA,SAAQc,EAAMC,CAAG,CACnB,CAAC,CAEJ,CACH,CAEQ,UACNU,EACAf,EACAW,EACAC,EACAC,EACAC,EACAJ,EAAgC,CAEhC,IAAMN,EAAO,KAAK,OAAO,UAAUlB,GAAA,UAAU,SAAU,CAAA,CAAE,EAEzD,OAAOF,GAAA,QAAQ,KAAKA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAIoB,CAAI,EAAG,OAClDnB,GAAA,wBACL,IACSe,EAAS,KACde,EACAJ,EACAC,EACAC,EACAH,EACAI,CAAQ,EAGZ,CAACT,EAAKW,IAAU,CACTJ,EAAY,KACfR,EAAK,WAAWlB,GAAA,UAAU,eAAe,EAEvC8B,GAAUA,EAAO,QACnBZ,EAAK,gBAAgB,CACnB,KAAMjB,GAAA,eAAe,sBACrB,QAAS,KAAK,UAAU6B,CAAM,EAC/B,KAEH1B,GAAA,SAAQc,EAAMC,CAAG,CACnB,CAAC,CAEJ,CACH,CAEQ,mBACNF,EACAF,EAAyC,OAEzC,IAAMN,EAAS,KAAK,WAAU,EAExBS,EAAO,KAAK,OAAO,UAAUlB,GAAA,UAAU,QAAS,CAAA,CAAE,EACxD,GAAIiB,EAAW,CACb,GAAM,CAAE,UAAWc,EAAe,KAAMC,CAAQ,EAC9Cf,EAEFC,EAAK,aAAajB,GAAA,eAAe,eAAgB8B,CAAa,EAE9D,IAAME,EAAgBD,GAAU,MAK5BC,GACFf,EAAK,aAAajB,GAAA,eAAe,eAAgBgC,CAAa,EAC9Df,EAAK,WAAW,GAAGa,CAAa,IAAIE,CAAa,EAAE,GAEnDf,EAAK,WAAWa,CAAa,MAE1B,CACL,IAAIE,EAAgB,IAChBlB,EAAc,gBAChBkB,EAAgB,KAAKlB,EAAc,aAAa,MAElDkB,EAAgB9B,GAAA,wBAAwB,QACtC,kBACA8B,CAAa,EAEff,EAAK,aAAajB,GAAA,eAAe,eAAgBgC,CAAa,EAGhE,MAAI,GAAAC,EAAAnB,EAAc,YAAQ,MAAAmB,IAAA,SAAAA,EAAE,QAC1B9B,GAAA,eAAcc,EAAMH,EAAc,SAAS,IAAKN,EAAO,WAAW,EAGhEM,EAAc,gBAAkBN,EAAO,gBACzCL,GAAA,4BAA2Bc,EAAMH,EAAc,cAAc,EAGxDG,CACT,CAEQ,iBACNO,EACAU,EACAC,EACAC,EACAC,EACAL,EACAM,EACAC,EACA5B,EAAiE,CAMjE,GAJKyB,IACHA,EAAe,CAAA,GAIfA,EAAanC,GAAA,wBAAwB,GACrC,KAAK,WAAU,EAAG,mBAElB,MAAO,CACL,OAAAuB,EACA,SAAAU,EACA,UAAAC,EACA,aAAAC,EACA,eAAAC,EACA,cAAAL,EACA,cAAAM,EACA,aAAAC,GAIJ,IAAMC,EAAyBF,GAAiB,KAG1CG,EAA0BH,GAAiB3B,EACjD,OAAA2B,KAAgBnC,GAAA,mBACd,KAAK,OACL,KAAK,WAAW,KAAK,IAAI,EACzBsC,EACAD,CAAsB,EAGpBhB,OACFrB,GAAA,YACEqB,EAAO,aAAY,EACnB,KAAK,OACL,KAAK,WAAW,KAAK,IAAI,CAAC,KAE5BrB,GAAA,YACEqB,EAAO,gBAAe,EACtB,KAAK,OACL,KAAK,WAAW,KAAK,IAAI,CAAC,GAIvB,CACL,OAAAA,EACA,SAAAU,EACA,UAAAC,EACA,aAAAC,EACA,eAAAC,EACA,cAAAL,EACA,cAAAM,EACA,aAAAC,EAEJ,GA1bFG,GAAA,uBAAAnC,8eCjDAoC,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,kHCmJA,IAAYC,IAAZ,SAAYA,EAAkB,CAC5BA,EAAA,eAAA,gBACAA,EAAA,gBAAA,gBACAA,EAAA,UAAA,WACAA,EAAA,MAAA,QACAA,EAAA,UAAA,YACAA,EAAA,QAAA,SACF,GAPYA,GAAAC,GAAA,qBAAAA,GAAA,mBAAkB,CAAA,EAAA,+HCnJjBC,GAAA,gBAAkB,SAClBA,GAAA,aAAe,6JCH5B,IAAAC,EAAA,WAOAC,EAAA,aAOAC,GAAA,aAYAC,GAAA,KAYAC,GAAA,KAIaC,GAAb,MAAaC,UAA+BL,EAAA,mBAAmB,CAM7D,YAAYM,EAAuC,CAAA,EAAE,CACnD,MAAMH,GAAA,aAAcA,GAAA,gBAAiBG,CAAM,CAC7C,CAES,0BAAwB,CAC/B,KAAK,kBAAoB,KAAK,MAAM,oBAClC,8BACA,CACE,YACE,0FACF,KAAM,eACP,CAEL,CAEA,MAAI,CACF,GAAM,CACJ,kBAAmBC,EACnB,oBAAqBC,CAAmB,EACtC,KAAK,wBAAuB,EAE1B,CAAE,eAAAC,EAAgB,iBAAAC,CAAgB,EAAK,KAAK,qBAAoB,EAChE,CACJ,0BAAAC,EACA,yBAAAC,EACA,oBAAAC,CAAmB,EACjB,KAAK,wBAAuB,EAC1B,CAAE,sBAAAC,EAAuB,wBAAAC,CAAuB,EACpD,KAAK,4BAA2B,EAC5B,CAAE,gBAAAC,EAAiB,kBAAAC,CAAiB,EAAK,KAAK,sBAAqB,EAEzE,MAAO,CACL,IAAIjB,EAAA,oCACF,UACA,CAAC,YAAY,EACb,OACA,OACA,CACE,IAAIA,EAAA,8BACF,yCACA,CAAC,YAAY,EACbO,EACAC,CAAmB,EAEtB,EAEH,IAAIR,EAAA,oCACF,UACA,CAAC,YAAY,EACb,OACA,OACA,CACE,IAAIA,EAAA,8BACF,iCACA,CAAC,cAAc,EACfW,EACAE,CAAmB,EAErB,IAAIb,EAAA,8BACF,iCACA,CAAC,YAAY,EACbY,EACAC,CAAmB,EAErB,IAAIb,EAAA,8BACF,sCACA,CAAC,cAAc,EACfc,EACAC,CAAuB,EAEzB,IAAIf,EAAA,8BACF,8BACA,CAAC,YAAY,EACbS,EACAC,CAAgB,EAElB,IAAIV,EAAA,8BACF,0BACA,CAAC,YAAY,EACbgB,EACAC,CAAiB,EAEpB,EAGP,CAEQ,yBAAuB,CAC7B,MAAO,CACL,kBAAoBC,OAEdlB,EAAA,WAAUkB,EAAc,MAAM,GAChC,KAAK,QAAQA,EAAe,QAAQ,EAEtC,KAAK,MACHA,EACA,SACA,KAAK,qBAAqB,QAAQ,CAAC,KAGjClB,EAAA,WAAUkB,EAAc,MAAM,GAChC,KAAK,QAAQA,EAAe,QAAQ,EAEtC,KAAK,MACHA,EACA,SACA,KAAK,qBAAqB,QAAQ,CAAC,KAGjClB,EAAA,WAAUkB,EAAc,MAAM,GAChC,KAAK,QAAQA,EAAe,QAAQ,EAEtC,KAAK,MACHA,EACA,SACA,KAAK,qBAAqB,QAAQ,CAAC,KAGjClB,EAAA,WAAUkB,EAAc,OAAO,GACjC,KAAK,QAAQA,EAAe,SAAS,EAEvC,KAAK,MAAMA,EAAe,UAAW,KAAK,mBAAkB,CAAE,KAE1DlB,EAAA,WAAUkB,EAAc,KAAK,GAC/B,KAAK,QAAQA,EAAe,OAAO,EAErC,KAAK,MAAMA,EAAe,QAAS,KAAK,gBAAe,CAAE,KAErDlB,EAAA,WAAUkB,EAAc,OAAO,GACjC,KAAK,QAAQA,EAAe,SAAS,EAEvC,KAAK,MAAMA,EAAe,UAAW,KAAK,kBAAiB,CAAE,EACtDA,GAET,oBAAsBA,GAAqB,CACrCA,IAAkB,SACtB,KAAK,QAAQA,EAAe,QAAQ,EACpC,KAAK,QAAQA,EAAe,QAAQ,EACpC,KAAK,QAAQA,EAAe,QAAQ,EACpC,KAAK,QAAQA,EAAe,SAAS,EACrC,KAAK,QAAQA,EAAe,OAAO,EACnC,KAAK,QAAQA,EAAe,SAAS,EACvC,EAEJ,CAEQ,uBAAqB,CAC3B,MAAO,CACL,gBAAkBA,OACZlB,EAAA,WAAUkB,EAAc,OAAO,GACjC,KAAK,QAAQA,EAAe,SAAS,EAEvC,KAAK,MACHA,EAAc,kBAAkB,UAChC,UACA,KAAK,qBAAoB,CAAE,KAGzBlB,EAAA,WAAUkB,EAAc,OAAO,GACjC,KAAK,QAAQA,EAAe,SAAS,EAEvC,KAAK,MACHA,EAAc,kBAAkB,UAChC,UACA,KAAK,qBAAoB,CAAE,EAEtBA,GAET,kBAAoBA,GAAqB,CACnCA,IAAkB,YAClBlB,EAAA,WAAUkB,EAAc,OAAO,GACjC,KAAK,QAAQA,EAAe,SAAS,KAEnClB,EAAA,WAAUkB,EAAc,OAAO,GACjC,KAAK,QAAQA,EAAe,SAAS,EAEzC,EAEJ,CAEQ,sBAAoB,CAC1B,IAAMC,EAAkB,KACxB,OAAQC,GACC,UAAqB,CAC1B,IAAMC,EAAyB,KAAK,SAAS,OACvCC,EAAUF,EAAS,KAAK,IAAI,EAC5BG,EAAwB,KAAK,SAAS,OAE5C,OAAIF,IAA2BE,EAE7BJ,EAAgB,kBAAkB,IAAI,EAAG,CACvC,MAAO,OACP,YAAaA,EAAgB,UAC9B,EACQE,EAAyB,IAAME,IAExCJ,EAAgB,kBAAkB,IAAI,GAAI,CACxC,MAAO,OACP,YAAaA,EAAgB,UAC9B,EACDA,EAAgB,kBAAkB,IAAI,EAAG,CACvC,MAAO,OACP,YAAaA,EAAgB,UAC9B,GAEIG,CACT,CAEJ,CAEQ,sBAAoB,CAC1B,IAAMH,EAAkB,KACxB,OAAQC,GACC,SAAiCE,EAAsB,CAC5D,IAAME,EAAaJ,EAAS,KAAK,KAAME,CAAO,EAE9C,OAAAH,EAAgB,kBAAkB,IAAI,GAAI,CACxC,MAAO,OACP,YAAaA,EAAgB,UAC9B,EACDA,EAAgB,kBAAkB,IAAI,EAAG,CACvC,MAAO,OACP,YAAaA,EAAgB,UAC9B,EACMK,CACT,CAEJ,CAEQ,6BAA2B,CACjC,MAAO,CACL,sBAAwBN,GAAsB,CAC5C,IAAMO,EAAgBP,EAAc,eAAe,UAEnD,SAAIlB,EAAA,WAAUyB,EAAc,QAAQ,GAClC,KAAK,QAAQA,EAAe,UAAU,EAGxC,KAAK,MACHA,EACA,WACA,KAAK,6BAA4B,CAAE,EAE9BP,CACT,EACA,wBAA0BA,GAAuB,CAC3CA,IAAkB,QAEtB,KAAK,QAAQA,EAAc,eAAe,UAAW,UAAU,CACjE,EAEJ,CAEQ,sBAAoB,CAC1B,MAAO,CACL,eAAiBA,OACXlB,EAAA,WAAUkB,EAAc,OAAO,GACjC,KAAK,QAAQA,EAAe,SAAS,EAGvC,KAAK,MAAMA,EAAe,UAAW,KAAK,qBAAoB,CAAE,EACzDA,GAET,iBAAmBA,GAAqB,CAClCA,IAAkB,QAEtB,KAAK,QAAQA,EAAe,SAAS,CACvC,EAEJ,CAIQ,8BAA4B,CAClC,OAAQE,GACC,SAAwCM,EAAa,CAC1D,IAAMC,EAAkB5B,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAI2B,CAAQ,EAC/D,OAAON,EAAS,KAAK,KAAMO,CAAe,CAC5C,CAEJ,CAEQ,sBAAoB,CAC1B,IAAMR,EAAkB,KAExB,OACEC,GAEO,SAELQ,EACAF,EAAa,CAIb,GAAIN,EAAS,SAAW,EAAG,CACzB,IAAMS,EAAUT,EAAyC,KACvD,KACAQ,CAAO,EAET,OAAIC,GAAU,OAAOA,EAAO,MAAS,YACnCA,EAAO,KACL,IAAMV,EAAgB,YAAYS,CAAO,EAEzC,IAAG,EAAY,EAGZC,EAIT,IAAMF,EAAkB,SAAUG,EAAUC,EAAS,CACnD,GAAID,GAAO,CAACC,EAAM,CAChBL,EAASI,EAAKC,CAAI,EAClB,OAEFZ,EAAgB,YAAYS,CAAO,EACnCF,EAASI,EAAKC,CAAI,CACpB,EAEA,OAAQX,EAA0C,KAChD,KACAQ,EACAD,CAAe,CAEnB,CAEJ,CAGQ,yBAAuB,CAC7B,MAAO,CACL,0BAA4BT,OAEtBlB,EAAA,WAAUkB,EAAc,WAAW,UAAU,OAAO,GACtD,KAAK,QAAQA,EAAc,WAAW,UAAW,SAAS,EAG5D,KAAK,MACHA,EAAc,WAAW,UACzB,UACA,KAAK,2BAA0B,CAAE,EAE5BA,GAET,yBAA2BA,OAErBlB,EAAA,WAAUkB,EAAc,WAAW,UAAU,OAAO,GACtD,KAAK,QAAQA,EAAc,WAAW,UAAW,SAAS,EAG5D,KAAK,MACHA,EAAc,WAAW,UACzB,UACA,KAAK,0BAAyB,CAAE,EAE3BA,GAET,oBAAsBA,GAAuB,CACvCA,IAAkB,QACtB,KAAK,QAAQA,EAAc,WAAW,UAAW,SAAS,CAC5D,EAEJ,CAGQ,qBAAqBc,EAA6C,CACxE,IAAMb,EAAkB,KACxB,OAAQC,GACC,SAELa,EACAC,EACAC,EACAP,EACAF,EAAmB,CAEnB,IAAMU,EAAcrC,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EAC5CsC,EACJ,OAAOT,GAAY,WAAaA,EAAUF,EAC5C,GACE,CAACU,GACD,OAAOC,GAAkB,YACzB,OAAOF,GAAQ,SAEf,OAAI,OAAOP,GAAY,WACdR,EAAS,KAAK,KAAMa,EAAQC,EAAIC,EAAKP,CAAO,EAE5CR,EAAS,KAAK,KAAMa,EAAQC,EAAIC,EAAKP,EAASF,CAAQ,EAGjE,IAAMY,EAAOnB,EAAgB,OAAO,UAClC,WAAWa,CAAa,GACxB,CACE,KAAMjC,EAAA,SAAS,OAChB,EAGHoB,EAAgB,sBACdmB,EACAJ,EACAD,EAEAE,EAAI,CAAC,EACLH,CAAa,EAEf,IAAML,EAAkBR,EAAgB,UAAUmB,EAAMD,CAAa,EAErE,OAAI,OAAOT,GAAY,WACdR,EAAS,KAAK,KAAMa,EAAQC,EAAIC,EAAKR,CAAe,EAEpDP,EAAS,KAAK,KAAMa,EAAQC,EAAIC,EAAKP,EAASD,CAAe,CAExE,CAEJ,CAGQ,oBAAkB,CACxB,IAAMR,EAAkB,KACxB,OAAQC,GACC,SAELa,EACAC,EACAK,EACAX,EACAF,EAAmB,CAEnB,IAAMU,EAAcrC,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EAC5CsC,EACJ,OAAOT,GAAY,WAAaA,EAAUF,EAC5C,GACE,CAACU,GACD,OAAOC,GAAkB,YACzB,OAAOE,GAAQ,SAEf,OAAI,OAAOX,GAAY,WACdR,EAAS,KAAK,KAAMa,EAAQC,EAAIK,EAAKX,CAAO,EAE5CR,EAAS,KAAK,KAAMa,EAAQC,EAAIK,EAAKX,EAASF,CAAQ,EAGjE,IAAMc,EAAcnC,EAAuB,gBAAgBkC,CAAG,EACxDE,EACJD,IAAgBtC,GAAA,mBAAmB,QAAU,UAAYsC,EACrDF,EAAOnB,EAAgB,OAAO,UAAU,WAAWsB,CAAI,GAAI,CAC/D,KAAM1C,EAAA,SAAS,OAChB,EACK2C,EACJF,IAAgBtC,GAAA,mBAAmB,QAAU,OAAYsC,EAC3DrB,EAAgB,sBAAsBmB,EAAMJ,EAAID,EAAQM,EAAKG,CAAS,EACtE,IAAMf,EAAkBR,EAAgB,UAAUmB,EAAMD,CAAa,EAErE,OAAI,OAAOT,GAAY,WACdR,EAAS,KAAK,KAAMa,EAAQC,EAAIK,EAAKZ,CAAe,EAEpDP,EAAS,KAAK,KAAMa,EAAQC,EAAIK,EAAKX,EAASD,CAAe,CAExE,CAEJ,CAGQ,4BAA0B,CAChC,IAAMR,EAAkB,KACxB,OAAQC,GACC,SAELc,EACAK,EACAX,EACAF,EAAa,CAEb,IAAMU,EAAcrC,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EAC5CsC,EAAgBX,EAChBc,EAAc,OAAO,KAAKD,CAAG,EAAE,CAAC,EAEtC,GACE,OAAOF,GAAkB,YACzB,OAAOE,GAAQ,UACfA,EAAI,UACJA,EAAI,MAEJ,OAAOnB,EAAS,KAAK,KAAMc,EAAIK,EAAKX,EAASF,CAAQ,EAGvD,IAAIY,EACAF,IACFE,EAAOnB,EAAgB,OAAO,UAAU,WAAWqB,CAAW,GAAI,CAChE,KAAMzC,EAAA,SAAS,OAChB,EACDoB,EAAgB,sBACdmB,EACA,KACAJ,EACAK,EACAC,CAAW,GAGf,IAAMb,EAAkBR,EAAgB,UACtCmB,EACAD,EACA,KAAK,GACLG,CAAW,EAGb,OAAOpB,EAAS,KAAK,KAAMc,EAAIK,EAAKX,EAASD,CAAe,CAC9D,CAEJ,CAEQ,2BAAyB,CAC/B,IAAMR,EAAkB,KACxB,OAAQC,GACC,YAEFuB,EAAgD,CAEnD,GAAM,CAACT,EAAIK,CAAG,EAAII,EACZP,EAAcrC,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EAC5CyC,EAAc,OAAO,KAAKD,CAAG,EAAE,CAAC,EAChCF,EAAgB,IAAG,GAEzB,GAAI,OAAOE,GAAQ,UAAYA,EAAI,UAAYA,EAAI,MACjD,OAAOnB,EAAS,MAAM,KAAMuB,CAAI,EAGlC,IAAIL,EACAF,IACFE,EAAOnB,EAAgB,OAAO,UAAU,WAAWqB,CAAW,GAAI,CAChE,KAAMzC,EAAA,SAAS,OAChB,EACDoB,EAAgB,sBACdmB,EACA,KACAJ,EACAK,EACAC,CAAW,GAIf,IAAMb,EAAkBR,EAAgB,UACtCmB,EACAD,EACA,KAAK,GACLG,CAAW,EAGPX,EAAST,EAAS,MAAM,KAAMuB,CAAI,EACxC,OAAAd,EAAO,KACJe,GAAajB,EAAgB,KAAMiB,CAAG,EACtCd,GAAaH,EAAgBG,CAAG,CAAC,EAG7BD,CACT,CAEJ,CAGQ,iBAAe,CACrB,IAAMV,EAAkB,KACxB,OAAQC,GACC,SAELa,EACAC,EACAK,EACAM,EACAjB,EACAF,EAAmB,CAEnB,IAAMU,EAAcrC,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EAC5CsC,EACJ,OAAOT,GAAY,WAAaA,EAAUF,EAC5C,GACE,CAACU,GACD,OAAOC,GAAkB,YACzB,OAAOE,GAAQ,SAEf,OAAI,OAAOX,GAAY,WACdR,EAAS,KAAK,KAAMa,EAAQC,EAAIK,EAAKM,EAAajB,CAAO,EAEzDR,EAAS,KACd,KACAa,EACAC,EACAK,EACAM,EACAjB,EACAF,CAAQ,EAId,IAAMY,EAAOnB,EAAgB,OAAO,UAAU,eAAgB,CAC5D,KAAMpB,EAAA,SAAS,OAChB,EACDoB,EAAgB,sBAAsBmB,EAAMJ,EAAID,EAAQM,EAAK,MAAM,EACnE,IAAMZ,EAAkBR,EAAgB,UAAUmB,EAAMD,CAAa,EAErE,OAAI,OAAOT,GAAY,WACdR,EAAS,KACd,KACAa,EACAC,EACAK,EACAM,EACAlB,CAAe,EAGVP,EAAS,KACd,KACAa,EACAC,EACAK,EACAM,EACAjB,EACAD,CAAe,CAGrB,CAEJ,CAGQ,mBAAiB,CACvB,IAAMR,EAAkB,KACxB,OAAQC,GACC,SAELa,EACAC,EACAW,EACAC,EACAlB,EACAF,EAAmB,CAEnB,IAAMU,EAAcrC,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EAC5CsC,EACJ,OAAOT,GAAY,WAAaA,EAAUF,EAC5C,GAAI,CAACU,GAAe,OAAOC,GAAkB,WAC3C,OAAI,OAAOT,GAAY,WACdR,EAAS,KACd,KACAa,EACAC,EACAW,EACAC,EACAlB,CAAO,EAGFR,EAAS,KACd,KACAa,EACAC,EACAW,EACAC,EACAlB,EACAF,CAAQ,EAId,IAAMY,EAAOnB,EAAgB,OAAO,UAAU,kBAAmB,CAC/D,KAAMpB,EAAA,SAAS,OAChB,EACDoB,EAAgB,sBACdmB,EACAJ,EACAD,EACAY,EAAY,IACZ,SAAS,EAEX,IAAMlB,EAAkBR,EAAgB,UAAUmB,EAAMD,CAAa,EAErE,OAAI,OAAOT,GAAY,WACdR,EAAS,KACd,KACAa,EACAC,EACAW,EACAC,EACAnB,CAAe,EAGVP,EAAS,KACd,KACAa,EACAC,EACAW,EACAC,EACAlB,EACAD,CAAe,CAGrB,CAEJ,CAMQ,OAAO,gBACboB,EAA6B,CAE7B,OAAIA,EAAQ,gBAAkB,OACrB7C,GAAA,mBAAmB,eACjB6C,EAAQ,gBAAkB,OAC5B7C,GAAA,mBAAmB,gBACjB6C,EAAQ,WAAa,OACvB7C,GAAA,mBAAmB,UACjB6C,EAAQ,QAAU,OACpB7C,GAAA,mBAAmB,MACjB6C,EAAQ,YAAc,OACxB7C,GAAA,mBAAmB,UAEnBA,GAAA,mBAAmB,OAE9B,CASQ,sBACNoC,EACAU,EACAd,EACAa,EACAL,EAAkB,CAElB,IAAIO,EAAMC,EACV,GAAIF,EAAe,CACjB,IAAMG,EACJ,OAAOH,EAAc,SAAY,SAC7BA,EAAc,QAAQ,MAAM,GAAG,EAC/B,GACFG,EAAU,SAAW,IACvBF,EAAOE,EAAU,CAAC,EAClBD,EAAOC,EAAU,CAAC,GAItB,IAAIC,EACAL,GAAS,WAAaA,EAAQ,UAAU,CAAC,EAC3CK,EAAaL,EAAQ,UAAU,CAAC,EACvBA,GAAS,QAClBK,EAAaL,EAAQ,QAErBK,EAAaL,EAGf,KAAK,sBACHT,EACAJ,EAAG,GACHA,EAAG,WACHe,EACAC,EACAE,EACAV,CAAS,CAEb,CASQ,sBACNJ,EACAJ,EACAmB,EACAN,EACAL,EAA8B,qBAG9B,IAAIO,EACAC,EACJ,GAAIG,GAAYA,EAAS,IACvBJ,GAAOK,GAAAC,EAAAF,EAAS,EAAE,WAAO,MAAAE,IAAA,OAAA,OAAAA,EAAE,QAAI,MAAAD,IAAA,OAAAA,EAAID,EAAS,EAAE,KAC9CH,GAAOM,GAACC,GAAAC,EAAAL,EAAS,EAAE,WAAO,MAAAK,IAAA,OAAA,OAAAA,EAAE,QAAI,MAAAD,IAAA,OAAAA,EAAIJ,EAAS,EAAE,QAAK,MAAAG,IAAA,OAAA,OAAAA,EAAE,SAAQ,EAC1DP,GAAQ,MAAQC,GAAQ,MAAM,CAChC,IAAMS,GAAUC,EAAAP,EAAS,eAAW,MAAAO,IAAA,OAAA,OAAAA,EAAE,QACtC,GAAID,EAAS,CACX,IAAME,EAAkBF,EAAQ,MAAM,GAAG,EACzCV,EAAOY,EAAgB,CAAC,EACxBX,EAAOW,EAAgB,CAAC,GAS9B,GAAM,CAACC,EAAQC,CAAY,EAAI7B,EAAG,SAAQ,EAAG,MAAM,GAAG,EAEhDkB,GAAaY,GAAAC,EAAAlB,GAAS,SAAK,MAAAkB,IAAA,OAAAA,EAAIlB,GAAS,KAAC,MAAAiB,IAAA,OAAAA,EAAIjB,EAEnD,KAAK,sBACHT,EACAwB,EACAC,EACAd,EACAC,EACAE,EACAV,CAAS,CAEb,CAEQ,sBACNJ,EACAwB,EACAC,EACAd,EACAC,EACAE,EACAV,EAA8B,CAW9B,GARAJ,EAAK,cAAc,CACjB,CAACrC,GAAA,kBAAkB,EAAGA,GAAA,uBACtB,CAACA,GAAA,gBAAgB,EAAG6D,EACpB,CAAC7D,GAAA,8BAA8B,EAAG8D,EAClC,CAAC9D,GAAA,qBAAqB,EAAGyC,EACzB,CAACzC,GAAA,6BAA6B,EAAG,aAAagD,CAAI,IAAIC,CAAI,IAAIY,CAAM,GACrE,EAEGb,GAAQC,EAAM,CAChBZ,EAAK,aAAarC,GAAA,uBAAwBgD,CAAI,EAC9C,IAAMiB,EAAa,SAAShB,EAAM,EAAE,EAC/B,MAAMgB,CAAU,GACnB5B,EAAK,aAAarC,GAAA,uBAAwBiE,CAAU,EAGxD,GAAI,CAACd,EAAY,OACjB,IAAMe,EACJ,OAAO,KAAK,QAAQ,uBAA0B,WAC1C,KAAK,QAAQ,sBACb,KAAK,8BAA8B,KAAK,IAAI,KAElDnE,EAAA,wBACE,IAAK,CACH,IAAMoE,EAAQD,EAAsBf,CAAU,EAC9Cd,EAAK,aAAarC,GAAA,sBAAuBmE,CAAK,CAChD,EACAtC,GAAM,CACAA,GACF,KAAK,MAAM,MAAM,2CAA4CA,CAAG,CAEpE,EACA,EAAI,CAER,CAEQ,8BAA8BsB,EAAmC,OAEvE,IAAMiB,EADsB,CAAC,EAAC,GAAAd,EAAA,KAAK,WAAO,MAAAA,IAAA,SAAAA,EAAE,2BAExCH,EACA,KAAK,gBAAgBA,CAAU,EACnC,OAAO,KAAK,UAAUiB,CAAS,CACjC,CAEQ,gBAAgBC,EAAc,CACpC,OAAI,MAAM,QAAQA,CAAK,EACdA,EAAM,IAAIC,GAAW,KAAK,gBAAgBA,CAAO,CAAC,EAGvD,OAAOD,GAAU,UAAYA,IAAU,KAClC,OAAO,YACZ,OAAO,QAAQA,CAAK,EAAE,IAAI,CAAC,CAACE,EAAKD,CAAO,IAAM,CAC5CC,EACA,KAAK,gBAAgBD,CAAO,EAC7B,CAAC,EAKC,GACT,CAOQ,uBAAuBjC,EAAYT,EAAqB,CAC9D,IAAMvB,EAAuC,KAAK,UAAS,EACvD,OAAOA,EAAO,cAAiB,eACjCN,EAAA,wBACE,IAAK,CACHM,EAAO,aAAcgC,EAAM,CAAE,KAAMT,CAAM,CAAE,CAC7C,EACAC,GAAM,CACAA,GACF,KAAK,MAAM,MAAM,8BAA+BA,CAAG,CAEvD,EACA,EAAI,CAGV,CAQQ,UACNQ,EACAD,EACAoC,EACAjC,EAAoB,CAIpB,IAAMkC,EAAgB3E,EAAA,QAAQ,OAAM,EAC9BoB,EAAkB,KACxB,OAAO,YAAiCwB,EAAe,CACrD,IAAMgC,EAAQhC,EAAK,CAAC,EACpB,GAAIL,EAAM,CACR,GAAIqC,aAAiB,MACnBrC,GAAM,UAAU,CACd,KAAMvC,EAAA,eAAe,MACrB,QAAS4E,EAAM,QAChB,MACI,CACL,IAAM9C,EAASc,EAAK,CAAC,EACrBxB,EAAgB,uBAAuBmB,EAAMT,CAAM,EAErDS,EAAK,IAAG,EAGV,OAAOvC,EAAA,QAAQ,KAAK2E,EAAe,KAC7BlC,IAAgB,eAClBrB,EAAgB,kBAAkB,IAAI,GAAI,CACxC,MAAO,OACP,YAAaA,EAAgB,UAC9B,EAEIkB,EAAc,MAAM,KAAMM,CAAI,EACtC,CACH,CACF,CACQ,YAAYf,EAAY,SAC9B,IAAMqB,GAAOM,EAAA3B,EAAQ,eAAW,MAAA2B,IAAA,OAAA,OAAAA,EAAE,KAC5BL,GAAOI,EAAA1B,EAAQ,eAAW,MAAA0B,IAAA,OAAA,OAAAA,EAAE,KAC5BsB,EAAWhD,EAAQ,OACnBiD,EAAW,aAAa5B,CAAI,IAAIC,CAAI,IAAI0B,CAAQ,GACtD,KAAK,UAAYC,CACnB,GAn8BFC,GAAA,uBAAA1E,mHCOA,IAAY2E,IAAZ,SAAYA,EAAkB,CAC5BA,EAAA,eAAA,gBACAA,EAAA,gBAAA,gBACAA,EAAA,UAAA,WACAA,EAAA,MAAA,QACAA,EAAA,QAAA,SACF,GANYA,GAAAC,GAAA,qBAAAA,GAAA,mBAAkB,CAAA,EAAA,0ZChD9BC,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,8KCFA,IAAAC,GAAA,WAGAC,GAAA,aACAC,GAAA,aAQA,SAAgBC,GACdC,EAAsB,CAEtB,MAAO,CACL,CAACF,GAAA,8BAA8B,EAAGE,EAAW,KAC7C,CAACF,GAAA,gBAAgB,EAAGE,EAAW,KAAK,KACpC,CAACF,GAAA,gBAAgB,EAAGE,EAAW,KAAK,KACpC,CAACF,GAAA,sBAAsB,EAAGE,EAAW,KAAK,KAC1C,CAACF,GAAA,sBAAsB,EAAGE,EAAW,KAAK,KAE9C,CAVAC,GAAA,4BAAAF,GAYA,SAASG,GAAeC,EAAYC,EAAa,CAAA,EAAE,CACjDD,EAAK,gBAAgBC,CAAK,EAE1BD,EAAK,UAAU,CACb,KAAMP,GAAA,eAAe,MACrB,QAAS,GAAGQ,EAAM,OAAO,IACvBA,EAAM,KAAO;uBAA0BA,EAAM,IAAI,GAAK,EACxD,GACD,CACH,CAEA,SAASC,GACPF,EACAG,EACAC,EACAC,EAAoC,OAAS,CAExCD,MAILV,GAAA,wBACE,IAAMU,EAAaJ,EAAM,CAAE,cAAAK,EAAe,SAAAF,CAAQ,CAAE,EACpDG,GAAI,CACEA,GACFb,GAAA,KAAK,MAAM,+CAAgDa,CAAC,CAEhE,EACA,EAAI,CAER,CAEA,SAAgBC,GACdC,EACAR,EACAI,EACAC,EAAoC,OAAS,CAE7C,OAAMG,aAAwB,QAMvBA,EACJ,KAAKL,IACJD,GAAkBF,EAAMG,EAAUC,EAAcC,CAAa,EACtDF,EACR,EACA,MAAMM,GAAM,CACX,MAAAV,GAAeC,EAAMS,CAAG,EAClBA,CACR,CAAC,EACA,QAAQ,IAAMT,EAAK,IAAG,CAAE,GAdzBE,GAAkBF,EAAMQ,EAAcJ,EAAcC,CAAa,EACjEL,EAAK,IAAG,EACDQ,EAaX,CAtBAV,GAAA,sBAAAS,GAwBA,SAAgBG,GACdC,EACAC,EACAC,EACAb,EACAc,EACAV,EACAC,EAAoC,OAAS,CAE7C,IAAIU,EAAwB,EAC5B,OAAID,EAAK,SAAW,IAClBC,EAAwB,GAG1BD,EAAKC,CAAqB,EAAI,CAACN,EAAYN,KACzCM,EACIV,GAAeC,EAAMS,CAAG,EACxBP,GAAkBF,EAAMG,EAAUC,EAAcC,CAAa,EAEjEL,EAAK,IAAG,EACDW,EAAUF,EAAKN,CAAQ,GAGzBS,EAAK,MAAMC,EAAcC,CAAI,CACtC,CAxBAhB,GAAA,uBAAAY,gIC9EaM,GAAA,gBAAkB,SAClBA,GAAA,aAAe,sLCH5B,IAAAC,GAAA,WACAC,GAAA,aAGAC,GAAA,KAKAC,GAAA,aAKAC,GAAA,KACAC,GAAA,aAMMC,GAA0B,CAC9B,SACA,YACA,aACA,OACA,UACA,yBACA,iBACA,QACA,WACA,QACA,SACA,mBACA,mBACA,oBACA,oBAMWC,GAAA,oBAAqC,OAAO,oBAAoB,EAE7E,IAAaC,GAAb,cAA6CL,GAAA,mBAAmB,CAG9D,YAAYM,EAAwC,CAAA,EAAE,CACpD,MAAML,GAAA,aAAcA,GAAA,gBAAiBK,CAAM,CAC7C,CAES,UAAUA,EAAwC,CAAA,EAAE,CAC3D,KAAK,QAAU,OAAO,OAAO,CAAA,EAAIA,CAAM,CACzC,CAEU,MAAI,CAOZ,OANe,IAAIN,GAAA,oCACjB,WACA,CAAC,YAAY,EACb,KAAK,MAAM,KAAK,IAAI,EACpB,KAAK,QAAQ,KAAK,IAAI,CAAC,CAG3B,CAEQ,MACNO,EACAC,EAAiC,CAEjC,YAAK,MACHD,EAAc,MAAM,UACpB,OACA,KAAK,oBAAoB,OAAQC,CAAa,CAAC,EAMjDD,EAAc,MAAM,UAAU,MAAQA,EAAc,MAAM,UAAU,KAEpE,KAAK,MACHA,EAAc,MAAM,UACpB,SACA,KAAK,oBAAoB,SAAUC,CAAa,CAAC,EAEnD,KAAK,MACHD,EAAc,MAAM,UACpB,OACA,KAAK,eAAeC,CAAa,CAAC,EAEpC,KAAK,MACHD,EAAc,UAAU,UACxB,OACA,KAAK,mBAAmBC,CAAa,CAAC,EAGxCL,GAAwB,QAASM,GAAoB,CACnD,KAAK,MACHF,EAAc,MAAM,UACpBE,EACA,KAAK,2BAA2BA,CAAQ,CAAC,CAE7C,CAAC,EACD,KAAK,MAAMF,EAAc,MAAO,YAAa,KAAK,oBAAmB,CAAE,EAEhEA,CACT,CAEQ,QAAQA,EAA8B,CAC5C,KAAK,QAAQA,EAAc,MAAM,UAAW,MAAM,EAElDA,EAAc,MAAM,UAAU,MAAQA,EAAc,MAAM,UAAU,KACpE,KAAK,QAAQA,EAAc,MAAM,UAAW,QAAQ,EACpD,KAAK,QAAQA,EAAc,MAAM,UAAW,MAAM,EAClD,KAAK,QAAQA,EAAc,UAAU,UAAW,MAAM,EAEtDJ,GAAwB,QAASM,GAAoB,CACnD,KAAK,QAAQF,EAAc,MAAM,UAAWE,CAAe,CAC7D,CAAC,EACD,KAAK,QAAQF,EAAc,MAAO,WAAW,CAC/C,CAEQ,mBAAmBC,EAAiC,CAC1D,IAAME,EAAO,KACb,OAAQC,GACC,SAAyBC,EAAmB,OACjD,GACEF,EAAK,QAAQ,mBACbb,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,IAAM,OAEpC,OAAOc,EAAkB,MAAM,KAAM,SAAS,EAGhD,IAAME,EAAa,KAAKT,GAAA,mBAAmB,EACrCU,EAAyB,CAAA,EAC3BJ,EAAK,QAAQ,wBACfI,EAAWZ,GAAA,qBAAqB,EAC9BQ,EAAK,QAAQ,sBAAsB,YAAa,CAC9C,QAAS,KAAK,QACd,kBAAmB,KAAK,UACzB,GAGL,IAAMK,EAAOL,EAAK,WAChB,KAAK,OAAO,YACZM,EAAA,KAAK,UAAM,MAAAA,IAAA,OAAA,OAAAA,EAAE,UACb,YACAF,EACAD,CAAU,EAGZ,OAAOH,EAAK,gBACVK,EACAJ,EACA,KACA,UACAC,EACAJ,CAAa,CAEjB,CAEJ,CAEQ,eAAeA,EAAiC,CACtD,IAAME,EAAO,KACb,OAAQO,GACC,SAAyBL,EAAmB,CACjD,GACEF,EAAK,QAAQ,mBACbb,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,IAAM,OAEpC,OAAOoB,EAAa,MAAM,KAAM,SAAS,EAG3C,IAAMJ,EAAa,KAAKT,GAAA,mBAAmB,EACrCU,EAAyB,CAAA,EAC3BJ,EAAK,QAAQ,wBACfI,EAAWZ,GAAA,qBAAqB,EAC9BQ,EAAK,QAAQ,sBAAsB,KAAK,GAAI,CAC1C,UAAW,KAAK,YAChB,QAAS,KAAK,QACd,QAAS,KAAK,QACd,OAAQ,KAAK,QACd,GAEL,IAAMK,EAAOL,EAAK,WAChB,KAAK,mBACL,KAAK,MAAM,UACX,KAAK,GACLI,EACAD,CAAU,EAGZ,OAAOH,EAAK,gBACVK,EACAE,EACA,KACA,UACAL,EACAJ,CAAa,CAEjB,CAEJ,CAEQ,oBAAoBU,EAAYV,EAAiC,CACvE,IAAME,EAAO,KACb,OAAQS,GACC,SAA2BC,EAAeR,EAAmB,CAClE,GACEF,EAAK,QAAQ,mBACbb,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,IAAM,OAEpC,OAAOsB,EAAwB,MAAM,KAAM,SAAS,EAGtD,IAAME,EAAsC,CAAE,SAAU,IAAI,EACxDD,GAAW,EAAEA,aAAmB,YAClCC,EAAiB,QAAUD,GAE7B,IAAMN,EAAyB,CAAA,EAC3BJ,EAAK,QAAQ,wBACfI,EAAWZ,GAAA,qBAAqB,EAC9BQ,EAAK,QAAQ,sBAAsBQ,EAAIG,CAAgB,GAE3D,IAAMN,EAAOL,EAAK,WAChB,KAAK,YAAY,WACjB,KAAK,YAAY,UACjBQ,EACAJ,CAAU,EAGZ,OAAIM,aAAmB,WACrBR,EAAWQ,EACXA,EAAU,QAGLV,EAAK,gBACVK,EACAI,EACA,KACA,UACAP,EACAJ,CAAa,CAEjB,CAEJ,CAMQ,qBAAmB,CACzB,IAAME,EAAO,KACb,OAAQY,GACC,UAA2B,CAChC,IAAMC,EAAc1B,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,EAC5C2B,EAAYd,EAAK,sBAAsB,IAC3CY,EAAS,MAAM,KAAM,SAAS,CAAC,EAEjC,OAAIE,IAAWA,EAAUpB,GAAA,mBAAmB,EAAImB,GACzCC,CACT,CAEJ,CAEQ,2BAA2Bf,EAAgB,CACjD,IAAMC,EAAO,KACb,OAAQY,GACC,UAA2B,CAChC,YAAKlB,GAAA,mBAAmB,EAAIP,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,EACnDa,EAAK,sBAAsB,IAChCY,EAAS,MAAM,KAAM,SAAS,CAAC,CAEnC,CAEJ,CAEQ,WACNG,EACAC,EACAC,EACAb,EACAD,EAAiB,CAEjB,OAAO,KAAK,OAAO,UACjB,YAAYa,CAAS,IAAIC,CAAS,GAClC,CACE,KAAM9B,GAAA,SAAS,OACf,WAAU,OAAA,OAAA,OAAA,OAAA,OAAA,OAAA,CAAA,EACLiB,CAAU,KACVf,GAAA,6BAA4B0B,CAAU,CAAC,EAAA,CAC1C,CAACvB,GAAA,qBAAqB,EAAGyB,EACzB,CAACzB,GAAA,kBAAkB,EAAG,UAAU,CAAA,GAGpCW,EAAahB,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAIgB,CAAU,EAAI,MAAS,CAExE,CAEQ,gBACNE,EACAa,EACAC,EACAC,EACAlB,EACAJ,EAAoC,OAAS,CAE7C,IAAME,EAAO,KACb,GAAIE,aAAoB,SACtB,OAAOF,EAAK,sBAAsB,OAChCX,GAAA,wBACEa,EACAgB,EACAC,EACAd,EACAe,EACApB,EAAK,QAAQ,aACbF,CAAa,CACd,EAEE,CACL,IAAMuB,EAAWrB,EAAK,sBAAsB,IAC1CkB,EAAK,MAAMC,EAAcC,CAAI,CAAC,EAEhC,SAAO/B,GAAA,uBACLgC,EACAhB,EACAL,EAAK,QAAQ,aACbF,CAAa,EAGnB,CAEQ,sBAAyBwB,EAAuC,OACtE,MAAI,GAAAhB,EAAA,KAAK,WAAO,MAAAA,IAAA,SAAAA,EAAE,gCACTnB,GAAA,QAAQ,QAAKC,GAAA,iBAAgBD,GAAA,QAAQ,OAAM,CAAE,EAAGmC,CAAgB,EAEhEA,EAAgB,CAE3B,GAzSF5B,GAAA,wBAAAC,KC3DA,IAAA4B,GAAAC,EAAAC,IAAA,cAAAC,IACA,OAAO,eAAeD,GAAS,aAAc,CAAE,MAAO,EAAK,CAAC,0ZCc5DE,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,8GCAA,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,aAAA,iBACF,GAFYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,8MCC1B,IAAAC,GAAA,aAoBA,SAAgBC,GACdC,EAA2C,CAE3C,GAAM,CAAE,KAAAC,EAAM,KAAAC,EAAM,SAAAC,EAAU,KAAAC,CAAI,EAAKC,GAAUL,CAAM,EACjDM,EAAa,SAASJ,EAAM,EAAE,EACpC,OAAK,MAAMI,CAAU,EASd,CACL,CAACR,GAAA,sBAAsB,EAAGG,EAC1B,CAACH,GAAA,6BAA6B,EAAGS,GAAcN,EAAMC,EAAMC,CAAQ,EACnE,CAACL,GAAA,gBAAgB,EAAGK,EACpB,CAACL,GAAA,gBAAgB,EAAGM,GAZb,CACL,CAACN,GAAA,sBAAsB,EAAGG,EAC1B,CAACH,GAAA,sBAAsB,EAAGQ,EAC1B,CAACR,GAAA,6BAA6B,EAAGS,GAAcN,EAAMC,EAAMC,CAAQ,EACnE,CAACL,GAAA,gBAAgB,EAAGK,EACpB,CAACL,GAAA,gBAAgB,EAAGM,EAS1B,CApBAI,GAAA,wBAAAT,GAsBA,SAASM,GAAUL,EAAW,CAC5B,GAAM,CAAE,KAAAC,EAAM,KAAAC,EAAM,SAAAC,EAAU,KAAAC,CAAI,EAC/BJ,GAAUA,EAAO,kBAAqBA,GAAU,CAAA,EACnD,MAAO,CAAE,KAAAC,EAAM,KAAAC,EAAM,SAAAC,EAAU,KAAAC,CAAI,CACrC,CAEA,SAASG,GACPN,EACAC,EACAC,EAA4B,CAE5B,IAAIM,EAAa,gBAAgBR,GAAQ,WAAW,GAEpD,OAAI,OAAOC,GAAS,WAClBO,GAAc,IAAIP,CAAI,IAGpB,OAAOC,GAAa,WACtBM,GAAc,IAAIN,CAAQ,IAGrBM,CACT,CAKA,SAAgBC,GAAeC,EAAoC,CACjE,OAAI,OAAOA,GAAU,SACZA,EAEAA,EAAM,GAEjB,CANAH,GAAA,eAAAE,GAQA,SAAgBE,GACdD,EACAE,EAAc,CAEd,OACSC,GADL,OAAOH,GAAU,SACSE,EAIAA,GAAUF,EAAM,MAJV,CAMtC,CAXAH,GAAA,YAAAI,GAmBA,SAAgBG,GAAYJ,EAAoC,CAC9D,OAAI,OAAOA,GAAU,SACZA,EAAM,IAERA,EAAM,MAAM,GAAG,EAAE,CAAC,CAC3B,CALAH,GAAA,YAAAO,GAOA,SAAgBD,GAAqBE,EAA+B,CAClE,OAAIA,EAAY,IAAIA,EAAI,SAAQ,CAAE,IAC3B,EACT,CAHAR,GAAA,qBAAAM,GAKA,SAAgBG,GAAYC,EAAqB,CAC/C,IAAMC,EAAID,EAAK,OAAO,iBAClBE,EAAW,GACf,OAAAA,GAAYD,EAAE,KAAO,UAAUA,EAAE,IAAI,MAAQ,GAC7CC,GAAYD,EAAE,KAAO,SAASA,EAAE,IAAI,KAAO,GAC3CC,GAAYD,EAAE,SAAW,cAAcA,EAAE,QAAQ,MAAQ,GACzDC,GAAYD,EAAE,KAAO,UAAUA,EAAE,IAAI,IAAM,GACtCA,EAAE,OACLC,EAAWA,EAAS,UAAU,EAAGA,EAAS,OAAS,CAAC,GAE/CA,EAAS,KAAI,CACtB,CAXAZ,GAAA,YAAAS,gIC5GaI,GAAA,gBAAkB,SAClBA,GAAA,aAAe,yJCF5B,IAAAC,GAAA,WAQAC,GAAA,aAKAC,GAAA,aAMAC,GAAA,KAEAC,GAAA,KAOAC,GAAA,KAQaC,GAAb,MAAaC,UAA6BN,GAAA,mBAAmB,CAM3D,YAAYO,EAAqC,CAAA,EAAE,CACjD,MAAMH,GAAA,aAAcA,GAAA,gBAAiBG,CAAM,EAC3C,KAAK,sBAAqB,CAC5B,CAES,iBAAiBC,EAA4B,CACpD,MAAM,iBAAiBA,CAAa,EACpC,KAAK,sBAAqB,CAC5B,CAEQ,uBAAqB,CAC3B,KAAK,kBAAoB,KAAK,MAAM,oBAClC,8BACA,CACE,YACE,0FACF,KAAM,eACP,CAEL,CAEU,MAAI,CACZ,MAAO,CACL,IAAIR,GAAA,oCACF,QACA,CAAC,YAAY,EACZS,OACKT,GAAA,WAAUS,EAAc,gBAAgB,GAC1C,KAAK,QAAQA,EAAe,kBAAkB,EAEhD,KAAK,MACHA,EACA,mBACA,KAAK,uBAAsB,CAAS,KAGlCT,GAAA,WAAUS,EAAc,UAAU,GACpC,KAAK,QAAQA,EAAe,YAAY,EAE1C,KAAK,MACHA,EACA,aACA,KAAK,iBAAgB,CAAS,KAG5BT,GAAA,WAAUS,EAAc,iBAAiB,GAC3C,KAAK,QAAQA,EAAe,mBAAmB,EAEjD,KAAK,MACHA,EACA,oBACA,KAAK,wBAAuB,CAAS,EAGhCA,GAERA,GAAoC,CAC/BA,IAAkB,SACtB,KAAK,QAAQA,EAAe,kBAAkB,EAC9C,KAAK,QAAQA,EAAe,YAAY,EACxC,KAAK,QAAQA,EAAe,mBAAmB,EACjD,CAAC,EAGP,CAGQ,wBAAsB,CAC5B,OAAQC,GAAsC,CAC5C,IAAMC,EAAa,KAEnB,OAAO,SACLC,EAAoD,CAEpD,IAAMC,EAAiBH,EAAyB,GAAG,SAAS,EAG5D,OAAAC,EAAW,MACTE,EACA,QACAF,EAAW,YAAYE,CAAc,CAAQ,EAGxCA,CACT,CACF,CACF,CAGQ,kBAAgB,CACtB,OAAQC,GAAgC,CACtC,IAAMH,EAAa,KACnB,OAAO,SAAoBI,EAAuC,CAChE,IAAMC,EAAOF,EAAmB,GAAG,SAAS,EAE5C,OAAAH,EAAW,MAAMK,EAAM,QAASL,EAAW,YAAYK,CAAI,CAAC,EAC5DL,EAAW,MACTK,EACA,gBACAL,EAAW,oBAAoBK,CAAI,CAAC,EAEtCL,EAAW,MAAMK,EAAM,MAAOL,EAAW,cAAcK,CAAI,CAAC,EAC5DL,EAAW,kBAAkBK,EAAML,EAAY,EAAE,EAE1CK,CACT,CACF,CACF,CACQ,cAAcA,EAAS,CAC7B,OAAQC,GAA6B,CACnC,IAAMN,EAAa,KACnB,OAAO,SAAaO,EAAkB,CACpC,IAAMC,EAAQH,EAAa,gBAAgB,OACrCI,EAASJ,EAAa,iBAAiB,OACvCK,EAAQF,EAAOC,EACfE,KAAWnB,GAAA,aAAYa,CAAI,EACjCL,EAAW,kBAAkB,IAAI,CAACU,EAAO,CACvC,MAAO,OACP,KAAMC,EACP,EACDX,EAAW,kBAAkB,IAAI,CAACS,EAAO,CACvC,MAAO,OACP,KAAME,EACP,EACDL,EAAgB,MAAMD,EAAM,SAAS,CACvC,CACF,CACF,CAGQ,yBAAuB,CAC7B,OAAQO,GAAuC,CAC7C,IAAMZ,EAAa,KACnB,OAAO,SAAoBI,EAAuC,CAChE,IAAMS,EAAUD,EAA0B,GAAG,SAAS,EAGtD,OAAAZ,EAAW,MACTa,EACA,gBACAb,EAAW,oBAAoBa,CAAO,CAAC,EAEzCb,EAAW,MAAMa,EAAS,MAAOb,EAAW,UAAUa,CAAO,CAAC,EAEvDA,CACT,CACF,CACF,CACQ,UAAUA,EAA+B,CAC/C,OAAQC,GAAyB,CAC/B,IAAMd,EAAa,KACnB,OAAO,SAAae,EAAYnB,EAAe,CAE7C,GAAI,CAACI,EAAW,SACd,OAAAA,EAAW,QAAQa,EAAS,KAAK,EAC1BC,EAAY,MAAMD,EAAS,SAAS,EAE7CC,EAAY,MAAMD,EAAS,SAAS,EACpC,IAAMG,EAAQH,EAAQ,OACtB,GAAIG,EAAO,CACT,IAAMC,EACJ,OAAOF,GAAO,SACV,YAAeF,EAAgB,QAC/B,OAAOE,CAAE,EAETV,EAAOW,EAAMC,CAAM,EAAE,KAC3BjB,EAAW,kBAAkBK,EAAML,EAAYe,CAAE,EAErD,CACF,CACF,CAGQ,oBAAoBV,EAA8C,CACxE,OAAQa,GAAmC,CACzC,IAAMlB,EAAa,KAEnB,OAAO,SACLmB,EACAC,EACAC,EAAc,CAGd,GAAI,CAACrB,EAAW,SACd,OAAAA,EAAW,QAAQK,EAAM,eAAe,EACjCa,EAAsB,MAAMb,EAAM,SAAS,EAGpD,GAAI,UAAU,SAAW,GAAK,OAAOc,GAAS,WAAY,CACxD,IAAMG,EAAUtB,EAAW,8BACzBmB,CAAiC,EAEnC,OAAOD,EAAsB,KAAKb,EAAMiB,CAAO,EAEjD,GAAI,UAAU,SAAW,GAAK,OAAOF,GAAS,WAAY,CACxD,IAAME,EAAUtB,EAAW,8BACzBoB,CAAiC,EAEnC,OAAOF,EAAsB,KAAKb,EAAMc,EAAMG,CAAO,EAEvD,GAAI,UAAU,SAAW,GAAK,OAAOD,GAAS,WAAY,CACxD,IAAMC,EAAUtB,EAAW,8BACzBqB,CAAiC,EAEnC,OAAOH,EAAsB,KAAKb,EAAMc,EAAMC,EAAME,CAAO,EAG7D,OAAOJ,EAAsB,MAAMb,EAAM,SAAS,CACpD,CACF,CACF,CAEQ,8BAA8BkB,EAA6B,CACjE,IAAMvB,EAAa,KACbwB,EAAgBpC,GAAA,QAAQ,OAAM,EACpC,OAAO,SAELqC,EACAC,EAAqC,CAEjCA,OAGGrC,GAAA,WAAUqC,EAAW,KAAK,GAC7B1B,EAAW,MACT0B,EACA,QACA1B,EAAW,YAAY0B,CAAU,CAAC,GAIpC,OAAOH,GAAO,YAChBnC,GAAA,QAAQ,KAAKoC,EAAeD,EAAI,KAAME,EAAKC,CAAU,CAEzD,CACF,CAEQ,YAAYA,EAAmD,CACrE,OAAQC,GAAqD,CAC3D,IAAM3B,EAAa,KAEnB,OAAO,SACL4B,EACAC,EACAC,EAAoC,CAEpC,GAAI,CAAC9B,EAAW,SACd,OAAAA,EAAW,QAAQ0B,EAAY,OAAO,EAC/BC,EAAc,MAAMD,EAAY,SAAS,EAGlD,IAAMK,EAAO/B,EAAW,OAAO,aAAUR,GAAA,aAAYoC,CAAK,EAAG,CAC3D,KAAMxC,GAAA,SAAS,OACf,WAAU,OAAA,OAAA,OAAA,OAAA,CAAA,EACLO,EAAqB,iBAAiB,KACtCH,GAAA,yBAAwBkC,EAAW,MAAM,CAAC,EAEhD,EAOD,GALAK,EAAK,aAAazC,GAAA,yBAAuBE,GAAA,gBAAeoC,CAAK,CAAC,EAG5D5B,EAAW,UAAS,EAEI,0BAA2B,CACnD,IAAIgC,EAEA,MAAM,QAAQH,CAAiB,EACjCG,EAASH,EACA,UAAU,CAAC,IACpBG,EAAS,CAACH,CAAiB,GAG7BE,EAAK,aACHxC,GAAA,eAAe,gBACfC,GAAA,aAAYoC,EAAOI,CAAM,CAAC,EAI9B,IAAMC,EAAU,MAAM,KAAK,SAAS,EAAE,UACpCC,GAAO,OAAOA,GAAQ,UAAU,EAG5BC,EAAgB/C,GAAA,QAAQ,OAAM,EAEpC,GAAI6C,IAAY,GAAI,CAClB,IAAMG,EAAoChD,GAAA,QAAQ,KAChDA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAI2C,CAAI,EACpC,IACSJ,EAAc,MAAMD,EAAY,SAAS,CACjD,EAEH,OAAAtC,GAAA,QAAQ,KAAK+C,EAAeC,CAAe,EAEpCA,EACJ,GAAG,QAASX,GACXM,EAAK,UAAU,CACb,KAAM3C,GAAA,eAAe,MACrB,QAASqC,EAAI,QACd,CAAC,EAEH,GAAG,MAAO,IAAK,CACdM,EAAK,IAAG,CACV,CAAC,MAEH,QAAA/B,EAAW,MACT,UACAiC,EACAjC,EAAW,oBAAoB+B,EAAMI,CAAa,CAAC,EAG9C/C,GAAA,QAAQ,KAAKA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAI2C,CAAI,EAAG,IAClDJ,EAAc,MAAMD,EAAY,SAAS,CACjD,CAEL,CACF,CACF,CAEQ,oBAAoBK,EAAYI,EAAsB,CAC5D,OAAQE,GACC,SACLZ,EACAa,EACAC,EAA+B,CAE/B,OAAId,GACFM,EAAK,UAAU,CACb,KAAM3C,GAAA,eAAe,MACrB,QAASqC,EAAI,QACd,EAEHM,EAAK,IAAG,EACD3C,GAAA,QAAQ,KAAK+C,EAAe,IACjCE,EAAiB,GAAG,SAAS,CAAC,CAElC,CAEJ,CACQ,kBACNhC,EACAL,EACAe,EAAU,CAGV,IAAMJ,EAAWI,MAAMvB,GAAA,aAAYa,CAAI,EAEvCA,EAAK,GAAG,aAAcqB,GAAa,CACjC1B,EAAW,kBAAkB,IAAI,EAAG,CAClC,MAAO,OACP,KAAMW,EACP,CACH,CAAC,EAEDN,EAAK,GAAG,UAAWqB,GAAa,CAC9B1B,EAAW,kBAAkB,IAAI,GAAI,CACnC,MAAO,OACP,KAAMW,EACP,EACDX,EAAW,kBAAkB,IAAI,EAAG,CAClC,MAAO,OACP,KAAMW,EACP,CACH,CAAC,EAEDN,EAAK,GAAG,UAAWqB,GAAa,CAC9B1B,EAAW,kBAAkB,IAAI,GAAI,CACnC,MAAO,OACP,KAAMW,EACP,EACDX,EAAW,kBAAkB,IAAI,EAAG,CAClC,MAAO,OACP,KAAMW,EACP,CACH,CAAC,CACH,GA7XF6B,GAAA,qBAAA9C,GACkBA,GAAA,kBAAoB,CAClC,CAACJ,GAAA,kBAAkB,EAAGA,GAAA,igBCtC1BmD,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,sHCDA,IAAAC,GAAA,WAMAC,GAAA,aAKA,SAASC,GAAmBC,EAAa,CACvC,IAAMC,EAA8BD,EAAM,QAAQ,IAAI,EACtD,GAAIC,GAA+B,EACjC,MAAO,GAIT,GADiCD,EAAM,QAAQ,IAAI,EACpB,EAC7B,MAAO,GAGT,IAAME,EAA2BF,EAAM,QAAQ,IAAI,EACnD,OAAOC,EAA8BC,CACvC,CAOA,SAASC,GAAwBC,EAAW,CAC1C,OAAO,mBAAmBA,CAAG,EAAE,QAC7B,WACAC,GAAK,IAAIA,EAAE,WAAW,CAAC,EAAE,SAAS,EAAE,EAAE,YAAW,CAAE,EAAE,CAEzD,CAEA,SAAgBC,GAAuBC,EAAYP,EAAa,CAO9D,GANI,OAAOA,GAAU,UAAYA,EAAM,SAAW,GAM9CD,GAAmBC,CAAK,EAC1B,OAAOA,EAGT,IAAMQ,EAAa,IAAIV,GAAA,0BACjBW,EAAqC,CAAA,EAC3CD,EAAW,OACTX,GAAA,MAAM,QAAQA,GAAA,aAAcU,CAAI,EAChCE,EACAZ,GAAA,oBAAoB,EAItB,IAAMa,EAAa,OAAO,KAAKD,CAAO,EAAE,KAAI,EAE5C,GAAIC,EAAW,SAAW,EACxB,OAAOV,EAGT,IAAMW,EAAgBD,EACnB,IAAIE,GAAM,CACT,IAAMC,EAAeV,GAAwBM,EAAQG,CAAG,CAAC,EACzD,MAAO,GAAGA,CAAG,KAAKC,CAAY,GAChC,CAAC,EACA,KAAK,GAAG,EAEX,MAAO,GAAGb,CAAK,MAAMW,CAAa,IACpC,CAlCAG,GAAA,uBAAAR,iKCrCA,IAAAS,GAAA,aAqCA,SAAgBC,GAAwBC,EAAc,CACpD,GAAM,CAAE,KAAAC,EAAM,KAAAC,EAAM,SAAAC,EAAU,KAAAC,CAAI,EAAKC,GAAUL,CAAM,EACjDM,EAAa,SAASJ,EAAM,EAAE,EACpC,OAAK,MAAMI,CAAU,EASd,CACL,CAACR,GAAA,sBAAsB,EAAGG,EAC1B,CAACH,GAAA,6BAA6B,EAAGS,GAAcN,EAAMC,EAAMC,CAAQ,EACnE,CAACL,GAAA,gBAAgB,EAAGK,EACpB,CAACL,GAAA,gBAAgB,EAAGM,GAZb,CACL,CAACN,GAAA,sBAAsB,EAAGG,EAC1B,CAACH,GAAA,sBAAsB,EAAGQ,EAC1B,CAACR,GAAA,6BAA6B,EAAGS,GAAcN,EAAMC,EAAMC,CAAQ,EACnE,CAACL,GAAA,gBAAgB,EAAGK,EACpB,CAACL,GAAA,gBAAgB,EAAGM,EAS1B,CAlBAI,GAAA,wBAAAT,GAoBA,SAASM,GAAUL,EAAW,CAC5B,GAAM,CAAE,KAAAC,EAAM,KAAAC,EAAM,SAAAC,EAAU,KAAAC,CAAI,EAC/BJ,GAAUA,EAAO,kBAAqBA,GAAU,CAAA,EACnD,MAAO,CAAE,KAAAC,EAAM,KAAAC,EAAM,SAAAC,EAAU,KAAAC,CAAI,CACrC,CAEA,SAASG,GACPN,EACAC,EACAC,EAA4B,CAE5B,IAAIM,EAAa,gBAAgBR,GAAQ,WAAW,GAEpD,OAAI,OAAOC,GAAS,WAClBO,GAAc,IAAIP,CAAI,IAGpB,OAAOC,GAAa,WACtBM,GAAc,IAAIN,CAAQ,IAGrBM,CACT,CAOA,SAAgBC,GACdC,EACAC,EAMAC,EAAc,CAEd,OAAI,OAAOF,GAAU,SACZE,EAASD,EAAOD,EAAOE,CAAM,EAAIF,EAIjCE,GAAWF,EAAuB,OACrCC,EAAOD,EAAM,IAAKE,GAAWF,EAAuB,MAAM,EAC1DA,EAAM,GAEd,CAnBAH,GAAA,eAAAE,GA2BA,SAAgBI,GAAYH,EAAoC,OAC9D,IAAMI,EAAW,OAAOJ,GAAU,SAAWA,EAAM,IAAMA,EAEzD,OAAOK,EAAAD,GAAU,MAAM,GAAG,KAAC,MAAAC,IAAA,OAAA,OAAAA,EAAG,CAAC,CACjC,CAJAR,GAAA,YAAAM,GAMO,IAAMG,GAAQC,GAAgB,CACnC,IAAIC,EAAS,GACb,MAAO,IAAIC,IAAmB,CAC5B,GAAI,CAAAD,EACJ,OAAAA,EAAS,GACFD,EAAG,GAAGE,CAAI,CACnB,CACF,EAPaZ,GAAA,KAAIS,gICvHJI,GAAA,gBAAkB,SAClBA,GAAA,aAAe,2JCF5B,IAAAC,GAAA,WACAC,GAAA,aAMAC,GAAA,aAKAC,GAAA,KAGAC,GAAA,KAMAC,GAAA,KAIaC,GAAb,MAAaC,UAA8BN,GAAA,mBAAmB,CAK5D,YAAYO,EAAsC,CAAA,EAAE,CAClD,MAAMH,GAAA,aAAcA,GAAA,gBAAiBG,CAAM,CAC7C,CAEU,MAAI,CACZ,MAAO,CACL,IAAIP,GAAA,oCACF,SACA,CAAC,YAAY,EACZQ,GAAsB,CACrB,IAAMC,EACJD,EAAc,WAAW,UAC3B,SAAIR,GAAA,WAAUS,EAAoB,KAAK,GACrC,KAAK,QAAQA,EAAqB,OAAO,EAE3C,KAAK,MACHA,EACA,QACA,KAAK,YAAYD,EAAc,OAAQ,EAAK,CAAQ,KAGlDR,GAAA,WAAUS,EAAoB,OAAO,GACvC,KAAK,QAAQA,EAAqB,SAAS,EAE7C,KAAK,MACHA,EACA,UACA,KAAK,YAAYD,EAAc,OAAQ,EAAI,CAAQ,EAG9CA,CACT,EACCA,GAAsB,CACrB,GAAIA,IAAkB,OAAW,OACjC,IAAMC,EACJD,EAAc,WAAW,UAC3B,KAAK,QAAQC,EAAqB,OAAO,EACzC,KAAK,QAAQA,EAAqB,SAAS,CAC7C,CAAC,EAGP,CAEQ,YAAYC,EAAoBC,EAAmB,CACzD,OAAQC,GAAqC,CAC3C,IAAMC,EAAa,KACnB,OAAO,SAELC,EACAC,EACAC,EAAoB,CAEpB,IAAMC,EACJJ,EAAW,QAETK,EACA,MAAM,QAAQH,CAAiB,EACjCG,EAASH,EACA,UAAU,CAAC,IACpBG,EAAS,CAACH,CAAiB,GAG7B,IAAMI,EAAON,EAAW,OAAO,aAAUV,GAAA,aAAYW,CAAK,EAAG,CAC3D,KAAMf,GAAI,SAAS,OACnB,WAAU,OAAA,OAAA,OAAA,OAAA,OAAA,OAAA,CAAA,EACLO,EAAsB,iBAAiB,KACvCH,GAAA,yBAAwB,KAAK,MAAM,CAAC,EAAA,CACvC,CAACF,GAAA,qBAAqB,KAAGE,GAAA,gBAAeW,EAAOJ,EAAQQ,CAAM,CAAC,CAAA,EAEjE,EAEG,CAACP,GAAcM,EAAiB,kCAClC,UAAU,CAAC,EAAIH,EACb,OAAOA,GAAU,YACbZ,GAAA,wBAAuBiB,EAAML,CAAK,EAClC,OAAO,OAAOA,EAAO,CACnB,OAAKZ,GAAA,wBAAuBiB,EAAML,EAAM,GAAG,EAC5C,GAGT,IAAMM,KAAUjB,GAAA,MAAK,CAACkB,EAAWC,IAAiB,CAC5CD,EACFF,EAAK,UAAU,CACb,KAAMpB,GAAI,eAAe,MACzB,QAASsB,EAAI,QACd,EAEG,OAAOJ,EAAiB,cAAiB,eAC3CjB,GAAA,wBACE,IAAK,CACHiB,EAAiB,aAAcE,EAAM,CACnC,aAAcG,EACf,CACH,EACAD,GAAM,CACAA,GACFR,EAAW,MAAM,KAAK,gCAAiCQ,CAAG,CAE9D,EACA,EAAI,EAKVF,EAAK,IAAG,CACV,CAAC,EAED,GAAI,UAAU,SAAW,EAAG,CACtB,OAAQL,EAAc,UAAa,YACrCD,EAAW,MACTC,EACA,WACAD,EAAW,oBAAoBO,CAAO,CAAC,EAI3C,IAAMG,EAAoCX,EAAc,MACtD,KACA,SAAS,EAIX,OAAAW,EACG,KAAK,QAASF,GAAM,CACnBD,EAAQC,CAAG,CACb,CAAC,EACA,KAAK,SAAUC,GAAU,CACxBF,EAAQ,OAAWE,CAAO,CAC5B,CAAC,EAEIC,EAGT,OAAI,OAAO,UAAU,CAAC,GAAM,WAC1BV,EAAW,MACT,UACA,EACAA,EAAW,oBAAoBO,CAAO,CAAC,EAEhC,OAAO,UAAU,CAAC,GAAM,YACjCP,EAAW,MACT,UACA,EACAA,EAAW,oBAAoBO,CAAO,CAAC,EAIpCR,EAAc,MAAM,KAAM,SAAS,CAC5C,CACF,CACF,CAEQ,oBAAoBQ,EAAiB,CAC3C,OAAQI,GACC,SACLH,EACAC,EACAG,EAAiC,CAEjC,OAAAL,EAAQC,EAAKC,CAAO,EACbE,EAAiB,GAAG,SAAS,CACtC,CAEJ,GAxKFE,GAAA,sBAAArB,GACkBA,GAAA,kBAAoB,CAClC,CAACJ,GAAA,kBAAkB,EAAGA,GAAA,igBC3B1B0B,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,uGCDA,IAAAC,GAAA,WAEaC,GAAU,CACrBC,EACAC,IACE,CACEA,IACFD,EAAK,gBAAgBC,CAAG,EACxBD,EAAK,UAAU,CACb,KAAMF,GAAA,eAAe,MACrB,QAASG,EAAI,QACd,GAEHD,EAAK,IAAG,CACV,EAZaE,GAAA,QAAOH,6HCMpB,IAAMI,GAAuB,CAC3B,CACE,MAAO,SACP,KAAM,GAER,CACE,MAAO,+DACP,KAAM,GAER,CACE,MAAO,8BACP,KAAM,GAER,CACE,MACE,mLACF,KAAM,KAgBGC,GAAsD,CACjEC,EACAC,IACE,SACF,GAAI,MAAM,QAAQA,CAAO,GAAKA,EAAQ,OAAQ,CAC5C,IAAMC,GACJC,GAAAC,EAAAN,GAAqB,KAAK,CAAC,CAAE,MAAAO,CAAK,IACzBA,EAAM,KAAKL,CAAO,CAC1B,KAAC,MAAAI,IAAA,OAAA,OAAAA,EAAE,QAAI,MAAAD,IAAA,OAAAA,EAAI,EACRG,EACJJ,GAAoB,EAAID,EAAQ,MAAM,EAAGC,CAAgB,EAAID,EAC/D,OAAIA,EAAQ,OAASK,EAAgB,QACnCA,EAAgB,KACd,IAAIL,EAAQ,OAASC,CAAgB,mBAAmB,EAGrD,GAAGF,CAAO,IAAIM,EAAgB,KAAK,GAAG,CAAC,GAEhD,OAAON,CACT,EAnBaO,GAAA,6BAA4BR,gICvC5BS,GAAA,gBAAkB,SAClBA,GAAA,aAAe,6JCF5B,IAAAC,GAAA,WACAC,GAAA,aAOAC,GAAA,aAQAC,GAAA,aACAC,GAAA,KACAC,GAAA,KACAC,GAAA,KAEMC,GAA+C,CACnD,kBAAmB,IAGRC,GAAb,cAA4CP,GAAA,mBAAmB,CAG7D,YAAYQ,EAAuC,CAAA,EAAE,CACnD,MACEH,GAAA,aACAA,GAAA,gBACA,OAAO,OAAO,CAAA,EAAIC,GAAgBE,CAAM,CAAC,CAE7C,CAEA,MAAI,CACF,MAAO,CACL,IAAIR,GAAA,oCACF,UACA,CAAC,YAAY,EACb,CAACS,EAAQC,IAA0B,CACjC,IAAMC,EACJF,EAAO,OAAO,WAAW,IAAM,SAC3BA,EAAO,QACPA,EACN,SAAIT,GAAA,WAAUW,EAAc,UAAU,WAAW,GAC/C,KAAK,QAAQA,EAAc,UAAW,aAAa,EAErD,KAAK,MACHA,EAAc,UACd,cACA,KAAK,kBAAkBD,CAAa,CAAC,KAEnCV,GAAA,WAAUW,EAAc,UAAU,OAAO,GAC3C,KAAK,QAAQA,EAAc,UAAW,SAAS,EAEjD,KAAK,MACHA,EAAc,UACd,UACA,KAAK,iBAAgB,CAAE,EAElBF,CACT,EACAA,GAAS,CACP,GAAIA,IAAW,OAAW,OAC1B,IAAME,EACJF,EAAO,OAAO,WAAW,IAAM,SAC3BA,EAAO,QACPA,EACN,KAAK,QAAQE,EAAc,UAAW,aAAa,EACnD,KAAK,QAAQA,EAAc,UAAW,SAAS,CACjD,CAAC,EAGP,CAKQ,kBAAkBD,EAAsB,CAC9C,OAAQE,GACC,KAAK,kBAAkBA,EAAUF,CAAa,CAEzD,CAEQ,kBAAgB,CACtB,OAAQE,GACC,KAAK,iBAAiBA,CAAQ,CAEzC,CAEQ,kBAAkBA,EAAoBF,EAAsB,CAClE,IAAMG,EAAkB,KACxB,OAAO,SAAgCC,EAAoB,CACzD,GAAI,UAAU,OAAS,GAAK,OAAOA,GAAQ,SACzC,OAAOF,EAAS,MAAM,KAAM,SAAS,EAEvC,IAAMJ,EACJK,EAAgB,UAAS,EACrBE,EACJP,GAAQ,uBAAyBJ,GAAA,6BAE7BY,EAAkBjB,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,IAAM,OAC5D,GAAIS,GAAQ,oBAAsB,IAAQQ,EACxC,OAAOJ,EAAS,MAAM,KAAM,SAAS,EAGvC,IAAMK,EAAOJ,EAAgB,OAAO,UAAUC,EAAI,KAAM,CACtD,KAAMf,GAAA,SAAS,OACf,WAAY,CACV,CAACE,GAAA,kBAAkB,EAAGA,GAAA,qBACtB,CAACA,GAAA,qBAAqB,EAAGc,EAAsBD,EAAI,KAAMA,EAAI,IAAI,GAEpE,EAEGN,GAAQ,gBACVN,GAAA,wBACE,IACEM,GAAQ,YAAaS,EAAM,CACzB,cAAAP,EACA,QAASI,EAAI,KACb,QAASA,EAAI,KACd,EACHI,GAAI,CACEA,GACFnB,GAAA,KAAK,MAAM,+CAAgDmB,CAAC,CAEhE,EACA,EAAI,EAIR,GAAM,CAAE,KAAAC,EAAM,KAAAC,CAAI,EAAK,KAAK,QAE5BH,EAAK,cAAc,CACjB,CAAChB,GAAA,sBAAsB,EAAGkB,EAC1B,CAAClB,GAAA,sBAAsB,EAAGmB,EAC1B,CAACnB,GAAA,6BAA6B,EAAG,WAAWkB,CAAI,IAAIC,CAAI,GACzD,EAED,GAAI,CACF,IAAMC,EAAST,EAAS,MAAM,KAAM,SAAS,EAEvCU,EAAcR,EAAI,QAExBA,EAAI,QAAU,SAAUO,EAAW,IACjCnB,GAAA,wBACE,IAAK,CAAA,IAAAqB,EAAC,OAAAA,EAAAf,GAAQ,gBAAY,MAAAe,IAAA,OAAA,OAAAA,EAAA,KAApBf,EAAuBS,EAAMH,EAAI,KAAMA,EAAI,KAAMO,CAAM,CAAC,EAC9DH,GAAI,CACEA,GACFnB,GAAA,KAAK,MAAM,gDAAiDmB,CAAC,CAEjE,EACA,EAAI,KAGNf,GAAA,SAAQc,EAAM,IAAI,EAClBK,EAAYD,CAAM,CACpB,EAEA,IAAMG,EAAaV,EAAI,OACvB,OAAAA,EAAI,OAAS,SAAUW,EAAU,IAC/BtB,GAAA,SAAQc,EAAMQ,CAAG,EACjBD,EAAWC,CAAG,CAChB,EAEOJ,QACAK,EAAY,CACnB,QAAAvB,GAAA,SAAQc,EAAMS,CAAK,EACbA,EAEV,CACF,CAEQ,iBAAiBd,EAAkB,CACzC,IAAMC,EAAkB,KACxB,OAAO,UAAA,CACL,IAAML,EACJK,EAAgB,UAAS,EACrBG,EAAkBjB,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,IAAM,OAC5D,GAAIS,GAAQ,oBAAsB,IAAQQ,EACxC,OAAOJ,EAAS,MAAM,KAAM,SAAS,EAGvC,IAAMK,EAAOJ,EAAgB,OAAO,UAAU,UAAW,CACvD,KAAMd,GAAA,SAAS,OACf,WAAY,CACV,CAACE,GAAA,kBAAkB,EAAGA,GAAA,qBACtB,CAACA,GAAA,qBAAqB,EAAG,WAE5B,EACK,CAAE,KAAAkB,EAAM,KAAAC,CAAI,EAAK,KAAK,QAE5BH,EAAK,cAAc,CACjB,CAAChB,GAAA,sBAAsB,EAAGkB,EAC1B,CAAClB,GAAA,sBAAsB,EAAGmB,EAC1B,CAACnB,GAAA,6BAA6B,EAAG,WAAWkB,CAAI,IAAIC,CAAI,GACzD,EACD,GAAI,CACF,IAAMO,EAASf,EAAS,MAAM,KAAM,SAAS,EAC7C,SAAAT,GAAA,SAAQc,EAAM,IAAI,EACXU,QACAD,EAAY,CACnB,QAAAvB,GAAA,SAAQc,EAAMS,CAAK,EACbA,EAEV,CACF,GAvLFE,GAAA,uBAAArB,8eCzBAsB,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,mHCDA,IAAAC,GAAA,aAQA,SAAgBC,GACdC,EACAC,EAAY,SAEZ,MAAO,CACL,CAACH,GAAA,kBAAkB,EAAGA,GAAA,qBACtB,CAACA,GAAA,sBAAsB,GAAGI,EAAAD,GAAS,UAAM,MAAAC,IAAA,OAAA,OAAAA,EAAE,KAC3C,CAACJ,GAAA,sBAAsB,GAAGK,EAAAF,GAAS,UAAM,MAAAE,IAAA,OAAA,OAAAA,EAAE,KAC3C,CAACL,GAAA,6BAA6B,EAC5BM,GAAiDJ,EAAMC,GAAS,GAAG,EAEzE,CAXAI,GAAA,oBAAAN,GAoBA,SAASK,GACPJ,EACAM,EAAa,CAEb,GAAI,OAAOA,GAAQ,SAInB,GAAI,CACF,IAAMC,EAAI,IAAI,IAAID,CAAG,EACrB,OAAAC,EAAE,aAAa,OAAO,UAAU,EAChCA,EAAE,SAAW,GACbA,EAAE,SAAW,GACNA,EAAE,WACFC,EAAK,CACZR,EAAK,MAAM,0CAA2CQ,CAAG,EAG7D,+HC7CaC,GAAA,gBAAkB,SAClBA,GAAA,aAAe,2JCF5B,IAAAC,GAAA,WAOAC,GAAA,aAMAC,GAAA,KACAC,GAAA,KAEAC,GAAA,KACAC,GAAA,aAGMC,GAAkB,OACtB,gDAAgD,EAE5CC,GAAwB,OAC5B,2DAA2D,EASvDC,GAA6C,CACjD,kBAAmB,IAGRC,GAAb,MAAaC,UAA6BT,GAAA,mBAAmB,CAK3D,YAAYU,EAAqC,CAAA,EAAE,CACjD,MAAMP,GAAA,aAAcA,GAAA,gBAAiBO,CAAM,CAC7C,CAES,UAAUA,EAAqC,CAAA,EAAE,CACxD,KAAK,QAAU,OAAO,OAAO,CAAA,EAAIH,GAAgBG,CAAM,CACzD,CAEU,MAAI,CAIZ,MAAO,CACL,KAAK,wCAAwC,eAAe,EAC5D,KAAK,wCAAwC,oBAAoB,EAErE,CAEQ,wCACNC,EAAuB,CAEvB,IAAMC,EAAsB,IAAIZ,GAAA,8BAC9B,GAAGW,CAAe,yBAClB,CAAC,QAAQ,EACT,CAACE,EAAoBC,IAA0B,CAC7C,IAAMC,EACJF,EAAc,0BAChB,GAAI,CAACE,EACH,YAAK,MAAM,MACT,4EAA4E,EAEvEF,EAKT,IAAMG,EAAkBF,GAAe,WAAW,MAAM,EACpD,qBACA,iBAGJ,SAAId,GAAA,WAAUa,IAAgBG,CAAe,CAAC,GAC5C,KAAK,QAAQH,EAAeG,CAAe,EAE7C,KAAK,MACHH,EACAG,EACA,KAAK,4BAA4BD,CAAyB,CAAC,EAGtDF,CACT,EACCA,GAAsB,IACjBb,GAAA,WAAUa,GAAe,kBAAkB,GAC7C,KAAK,QAAQA,EAAe,oBAAoB,KAE9Cb,GAAA,WAAUa,GAAe,cAAc,GACzC,KAAK,QAAQA,EAAe,gBAAgB,CAEhD,CAAC,EAGGI,EAAuB,IAAIjB,GAAA,8BAC/B,GAAGW,CAAe,oCAClB,CAAC,QAAQ,EACRE,GAAsB,OACrB,IAAMK,GACJC,EAAAN,GAAe,WAAO,MAAAM,IAAA,OAAA,OAAAA,EAAE,UAE1B,SAAInB,GAAA,WAAUkB,GAAkC,IAAI,GAClD,KAAK,QAAQA,EAAkC,MAAM,EAEvD,KAAK,MACHA,EACA,OACA,KAAK,2BAA0B,CAAE,KAG/BlB,GAAA,WAAUkB,GAAkC,UAAU,GACxD,KAAK,QAAQA,EAAkC,YAAY,EAE7D,KAAK,MACHA,EACA,aACA,KAAK,iCAAgC,CAAE,EAGlCL,CACT,EACCA,GAAsB,OACrB,IAAMK,GACJC,EAAAN,GAAe,WAAO,MAAAM,IAAA,OAAA,OAAAA,EAAE,aACtBnB,GAAA,WAAUkB,GAAkC,IAAI,GAClD,KAAK,QAAQA,EAAkC,MAAM,KAEnDlB,GAAA,WAAUkB,GAAkC,UAAU,GACxD,KAAK,QAAQA,EAAkC,YAAY,CAE/D,CAAC,EAGGE,EAAoB,IAAIpB,GAAA,8BAC5B,GAAGW,CAAe,4BAClB,CAAC,QAAQ,EACRE,GAAsB,OACrB,IAAMQ,GAAuBF,EAAAN,GAAe,WAAO,MAAAM,IAAA,OAAA,OAAAA,EAAE,UAOrD,OAAIE,GAAsB,WACpBrB,GAAA,WAAUqB,GAAsB,KAAK,GACvC,KAAK,QAAQA,EAAsB,OAAO,EAE5C,KAAK,MACHA,EACA,QACA,KAAK,0BAAyB,CAAE,GAGhCA,GAAsB,WACpBrB,GAAA,WAAUqB,GAAsB,KAAK,GACvC,KAAK,QAAQA,EAAsB,OAAO,EAE5C,KAAK,MACHA,EACA,QACA,KAAK,0BAAyB,CAAE,MAIhCrB,GAAA,WAAUqB,GAAsB,WAAW,GAC7C,KAAK,QAAQA,EAAsB,aAAa,EAElD,KAAK,MACHA,EACA,cACA,KAAK,gCAA+B,CAAE,EAGxC,KAAK,MACHA,EACA,UACA,KAAK,yBAAwB,CAAE,EAG1BR,CACT,EACCA,GAAsB,OACrB,IAAMQ,GAAuBF,EAAAN,GAAe,WAAO,MAAAM,IAAA,OAAA,OAAAA,EAAE,aACjDnB,GAAA,WAAUqB,GAAsB,KAAK,GACvC,KAAK,QAAQA,EAAsB,OAAO,KAExCrB,GAAA,WAAUqB,GAAsB,KAAK,GACvC,KAAK,QAAQA,EAAsB,OAAO,KAExCrB,GAAA,WAAUqB,GAAsB,WAAW,GAC7C,KAAK,QAAQA,EAAsB,aAAa,CAEpD,CAAC,EAGH,OAAO,IAAIrB,GAAA,oCACTW,EACA,CAAC,QAAQ,EACRE,GACQA,EAET,IAAK,CAAE,EACP,CAACD,EAAqBK,EAAsBG,CAAiB,CAAC,CAElE,CAIQ,4BAA4BL,EAAmC,CACrE,IAAMO,EAAS,KACf,OAAO,SAAwCC,EAAkB,CAC/D,OAAO,SAA4Cb,EAAW,OAC5D,KAAIS,EAAAT,GAAQ,aAAS,MAAAS,IAAA,OAAA,OAAAA,EAAE,QAAS,cAC9B,OAAOI,EAAS,MAAM,KAAM,SAAS,EAGvC,IAAMC,EAAed,EAAO,SAC5B,OAAAA,EAAO,SAAW,SAEhBe,EACAC,EAA4B,CAE5B,IAAMC,EAAwBZ,EAC5BU,EACAC,CAAI,EACJ,KACF,OAAOJ,EAAO,oBACZE,EACA,KACA,UACAG,CAAqB,CAEzB,EACOJ,EAAS,MAAM,KAAM,SAAS,CACvC,CACF,CACF,CAEQ,4BAA0B,CAChC,IAAMD,EAAS,KACf,OAAO,SAA0BC,EAAkB,CACjD,OAAO,UAAkB,CACvB,IAAMK,EAAUL,EAAS,MAAM,KAAM,SAAS,EAC9C,OAAI,OAAOK,GAAS,MAAS,YAC3BN,EAAO,MAAM,MACX,mEAAmE,EAE9DM,GAGFA,EACJ,KAAMC,GAAuB,CAC5B,IAAMC,EAAY,KAAKzB,EAAe,EACtC,OAAAiB,EAAO,0BAA0BQ,EAAWD,CAAQ,EAC7CA,CACT,CAAC,EACA,MAAOE,GAAc,CACpB,IAAMD,EAAY,KAAKzB,EAAe,EACtC,GAAI,CAACyB,EACHR,EAAO,MAAM,MACX,uDAAuD,MAEpD,CACL,IAAMU,EACJD,EAAI,YAAY,OAAS,kBACpBA,EAAwB,QACzB,IAAI,MAAMD,EAAU,MAAM,EAAE,KAAKC,CAAG,EAC1CT,EAAO,0BAA0BQ,EAAWE,CAAO,EAErD,OAAO,QAAQ,OAAOD,CAAG,CAC3B,CAAC,CACL,CACF,CACF,CAEQ,kCAAgC,CACtC,IAAMT,EAAS,KACf,OAAO,SAA2BC,EAAkB,CAClD,OAAO,SAAoCG,EAA4B,CACrE,OAAOJ,EAAO,oBAAoBC,EAAU,KAAM,UAAWG,CAAI,CACnE,CACF,CACF,CAEQ,2BAAyB,CAC/B,OAAO,SAA2BH,EAAkB,CAClD,OAAO,UAAmB,CACxB,IAAMU,EAAWV,EAAS,MAAM,KAAM,SAAS,EAC/C,OAAAU,EAAS3B,EAAqB,EAAI,KAAK,QAChC2B,CACT,CACF,CACF,CAEQ,iCAA+B,CACrC,IAAMX,EAAS,KACf,OAAO,SAA4BC,EAAkB,CACnD,OAAO,SAELG,EAA4B,CAE5B,OAAOJ,EAAO,oBAAoBC,EAAU,KAAM,UAAWG,CAAI,CACnE,CACF,CACF,CAEQ,0BAAwB,CAC9B,IAAMJ,EAAS,KACf,OAAO,SAAwBC,EAAkB,CAC/C,OAAO,UAAuB,CAC5B,IAAMW,EAAU,KAAK,QAEfC,KAAalC,GAAA,qBAAoB,KAAK,MAAOiC,CAAO,EAEpDE,EAAOd,EAAO,OAAO,UACzB,GAAGb,EAAqB,SAAS,WACjC,CACE,KAAMV,GAAA,SAAS,OACf,WAAAoC,EACD,EAOH,OAJYpC,GAAA,QAAQ,KAAKA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAIqC,CAAI,EAAG,IACvDb,EAAS,MAAM,IAAI,CAC3B,EAGE,KAAMc,IACLD,EAAK,IAAG,EACDC,EACR,EACA,MAAOC,IACNF,EAAK,gBAAgBE,CAAK,EAC1BF,EAAK,UAAU,CACb,KAAMrC,GAAA,eAAe,MACrB,QAASuC,EAAM,QAChB,EACDF,EAAK,IAAG,EACD,QAAQ,OAAOE,CAAK,EAC5B,CACL,CACF,CACF,CAEQ,oBACNC,EACAC,EACAC,EACAd,EAA6C,SAG7C,GADwB5B,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,IAAM,SACrC,GAAAoB,EAAA,KAAK,WAAO,MAAAA,IAAA,SAAAA,EAAE,mBACnC,OAAOoB,EAAa,MAAMC,EAAUC,CAAa,EAGnD,IAAMC,EAAgBF,EAAS,SAAWA,EAASlC,EAAqB,EAElEqC,EAAchB,EAAsB,CAAC,EACrCiB,EAAcjB,EAAsB,MAAM,CAAC,EAE3CkB,IACJC,EAAA,KAAK,WAAO,MAAAA,IAAA,OAAA,OAAAA,EAAE,wBAAyB5C,GAAA,6BAEnCiC,KAAalC,GAAA,qBAAoB,KAAK,MAAOyC,CAAa,EAEhE,GAAI,CACF,IAAMK,EAAcF,EAAsBF,EAAaC,CAAW,EAC9DG,GAAe,OACjBZ,EAAW/B,GAAA,qBAAqB,EAAI2C,SAE/BC,EAAG,CACV,KAAK,MAAM,MAAM,2CAA4CA,EAAG,CAC9D,YAAAL,EACD,EAGH,IAAMP,EAAO,KAAK,OAAO,UACvB,GAAG3B,EAAqB,SAAS,IAAIkC,CAAW,GAChD,CACE,KAAM5C,GAAA,SAAS,OACf,WAAAoC,EACD,EAGGc,EAAMlD,GAAA,QAAQ,KAAKA,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,EAAIqC,CAAI,EAAG,IACvDG,EAAa,MAAMC,EAAUC,CAAa,CAClD,EACD,GAAI,OAAOQ,GAAK,MAAS,WACvBA,EAAI,KACDpB,GAAqB,CACpB,KAAK,qBACHO,EACAO,EACAC,EACAf,EACA,MAAS,CAEb,EACCE,GAAY,CACX,KAAK,qBAAqBK,EAAMO,EAAaC,EAAa,KAAMb,CAAG,CACrE,CAAC,MAEE,CACL,IAAMmB,EAA0BD,EAGhCC,EAAwB7C,EAAe,EACrC6C,EAAwB7C,EAAe,GAAK,CAAA,EAC9C6C,EAAwB7C,EAAe,EAAG,KAAK,CAC7C,KAAA+B,EACA,YAAAO,EACA,YAAAC,EACD,EAEH,OAAOK,CACT,CAEQ,0BACNnB,EACAE,EAAkB,CAElB,GAAI,CAACF,EACH,OAAO,KAAK,MAAM,MAChB,uDAAuD,EAG3D,GAAIE,EAAQ,SAAWF,EAAU,OAC/B,OAAO,KAAK,MAAM,MAChB,kEAAkE,EAGtE,QAASqB,EAAI,EAAGA,EAAIrB,EAAU,OAAQqB,IAAK,CACzC,GAAM,CAAE,KAAAf,EAAM,YAAAO,EAAa,YAAAC,CAAW,EAAKd,EAAUqB,CAAC,EAChDC,EAAiBpB,EAAQmB,CAAC,EAC1B,CAACF,EAAKlB,CAAG,EACbqB,aAA0B,MACtB,CAAC,KAAMA,CAAc,EACrB,CAACA,EAAgB,MAAS,EAChC,KAAK,qBAAqBhB,EAAMO,EAAaC,EAAaK,EAAKlB,CAAG,EAEtE,CAEQ,qBACNK,EACAO,EACAC,EACAS,EACAf,EAAwB,CAExB,GAAI,CAACA,GAAS,KAAK,QAAQ,aACzB,GAAI,CACF,KAAK,QAAQ,aAAaF,EAAMO,EAAaC,EAAaS,CAAQ,QAC3DtB,EAAK,CACZ,KAAK,MAAM,MAAM,kCAAmCA,CAAG,EAGvDO,IACFF,EAAK,gBAAgBE,CAAK,EAC1BF,EAAK,UAAU,CAAE,KAAMrC,GAAA,eAAe,MAAO,QAASuC,GAAO,OAAO,CAAE,GAExEF,EAAK,IAAG,CACV,GAnbFkB,GAAA,qBAAA9C,GACkBA,GAAA,UAAY,mfCtC9B+C,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,+HCAaC,GAAA,gBAAkB,SAClBA,GAAA,aAAe,yJCF5B,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,QAAA,iBACAA,EAAA,KAAA,cACAA,EAAA,OAAA,gBACAA,EAAA,WAAA,oBACAA,EAAA,SAAA,kBACAA,EAAA,MAAA,eACAA,EAAA,aAAA,sBACAA,EAAA,OAAA,eACF,GATYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,wGCA1B,IAAYC,IAAZ,SAAYA,EAAQ,CAClBA,EAAA,aAAA,eACAA,EAAA,gBAAA,kBACAA,EAAA,gBAAA,SACF,GAJYA,GAAAC,GAAA,WAAAA,GAAA,SAAQ,CAAA,EAAA,0HCApB,IAAAC,GAAA,KAAS,OAAA,eAAAC,GAAA,iBAAA,CAAA,WAAA,GAAA,IAAA,UAAA,CAAA,OAAAD,GAAA,cAAc,CAAA,CAAA,EACvB,IAAAE,GAAA,KAAS,OAAA,eAAAD,GAAA,WAAA,CAAA,WAAA,GAAA,IAAA,UAAA,CAAA,OAAAC,GAAA,QAAQ,CAAA,CAAA,mHCDjB,IAAAC,GAAA,WACAC,GAAA,aAUAC,GAAA,KACAC,GAAA,aAKAC,GAAA,KAEMC,GAAoB,CAAC,aAAa,EAE3BC,GAAb,MAAaC,UAA4BN,GAAA,mBAAmB,CAM1D,YAAYO,EAAgC,CAAA,EAAE,CAC5C,MAAMN,GAAA,aAAcA,GAAA,gBAAiBM,CAAM,CAC7C,CAEA,MAAI,CACF,IAAMC,EAAS,IAAIR,GAAA,oCACjBM,EAAoB,UACpBF,EAAiB,EAGnB,OAAAI,EAAO,MAAM,KACX,KAAK,kCAAkCJ,EAAiB,EACxD,KAAK,6CAA6CA,EAAiB,CAAC,EAG/DI,CACT,CAEA,kCAAkCC,EAAkB,CAClD,OAAO,IAAIT,GAAA,8BACT,+BACAS,EACA,CAACC,EAAwBC,KACvB,KAAK,cACHD,EAAkB,kBAAkB,UACpC,SACAE,GAA4B,KAAK,OAAQD,CAAa,CAAC,EAElDD,GAERA,GAA0B,CACzB,KAAK,QAAQA,EAAkB,kBAAkB,UAAW,QAAQ,CACtE,CAAC,CAEL,CAEA,6CAA6CD,EAAkB,CAC7D,OAAO,IAAIT,GAAA,8BACT,kDACAS,EACA,CAACI,EAA6BF,KAC5B,KAAK,cACHE,EAAuB,uBAAuB,UAC9C,SACAC,GAAwB,KAAK,OAAQH,CAAa,CAAC,EAE9CE,GAERA,GAA+B,CAC9B,KAAK,QACHA,EAAuB,uBAAuB,UAC9C,QAAQ,CAEZ,CAAC,CAEL,CAEQ,cACNE,EACAC,EACAC,EAA+B,IAE3BjB,GAAA,WAAUe,EAAIC,CAAU,CAAC,GAC3B,KAAK,QAAQD,EAAKC,CAAU,EAE9B,KAAK,MAAMD,EAAKC,EAAYC,CAAO,CACrC,GAxEFC,GAAA,oBAAAb,GACkBA,GAAA,UAAY,eACZA,GAAA,kBAAoB,CAClC,UAAWA,GAAoB,WAwEnC,SAASO,GACPO,EACAR,EAAsB,CAEtB,OAAO,SAAoBS,EAAmC,CAC5D,OAAO,SAELC,GAGA,IAAMC,EAAOH,EAAO,UAAU,kBAAmB,CAC/C,WAAU,OAAA,OAAA,OAAA,OAAA,CAAA,EACLd,GAAoB,iBAAiB,EAAA,CACxC,CAACF,GAAA,eAAe,IAAI,EAAGA,GAAA,SAAS,aAChC,CAACA,GAAA,eAAe,OAAO,EAAGQ,EAC1B,CAACR,GAAA,eAAe,MAAM,EAAGkB,EAAW,IAAI,CAAA,EAE3C,EACKE,EAAcxB,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,EAAIuB,CAAI,EAEhE,OAAOvB,GAAI,QAAQ,KAAKwB,EAAa,SAAW,CAC9C,GAAI,CACF,OAAO,MAAMH,EAAS,MAAM,KAAM,SAAgB,QAC3CI,EAAQ,CACf,MAAMC,GAASH,EAAME,CAAC,UAEtBF,EAAK,IAAG,EAEZ,CAAC,CACH,CACF,CACF,CAEA,SAASR,GAAwBK,EAAoBR,EAAsB,CACzE,OAAO,SACLS,EAA0C,CAE1C,OAAO,SAELM,EACAC,EAAqC,CAErC,UAAU,CAAC,EAAIC,GAAkBT,EAAQR,EAAegB,CAAQ,EAChE,IAAME,EAAUT,EAAS,MAAM,KAAM,SAAgB,EAC/CU,EAAeH,EAAS,KACxBI,EACJL,EAAS,aAAeA,EAAS,YAAY,KACzCA,EAAS,YAAY,KACrB,kBACAM,EAAWF,EACb,GAAGC,CAAY,IAAID,CAAY,GAC/BC,EAEJ,OAAO,SAELE,EACAC,EACAC,EAAiC,SAEjC,IAAMb,EAAOH,EAAO,UAAUa,EAAU,CACtC,WAAU,OAAA,OAAA,OAAA,OAAA,CAAA,EACL3B,GAAoB,iBAAiB,EAAA,CACxC,CAACF,GAAA,eAAe,OAAO,EAAGQ,EAC1B,CAACR,GAAA,eAAe,IAAI,EAAGA,GAAA,SAAS,gBAChC,CAACD,GAAA,oBAAoB,EAAG+B,EAAI,OAC5B,CAAC/B,GAAA,iBAAiB,EAAG+B,EAAI,aAAeA,EAAI,IAC5C,CAAC/B,GAAA,mBAAmB,IAClBkC,EAAAH,EAAI,SAAK,MAAAG,IAAA,OAAA,OAAAA,EAAE,SAAQC,EAAAJ,EAAI,gBAAY,MAAAI,IAAA,OAAA,OAAAA,EAAE,MAAOJ,EAAI,WAClD,CAAC9B,GAAA,eAAe,UAAU,EAAG4B,EAC7B,CAAC5B,GAAA,eAAe,QAAQ,EAAG2B,CAAY,CAAA,EAE1C,EACKP,EAAcxB,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,EAAIuB,CAAI,EAEhE,OAAOvB,GAAI,QAAQ,KAAKwB,EAAa,SAAW,CAC9C,GAAI,CACF,OAAO,MAAMM,EAAQ,MAAM,KAAM,SAAgB,QAC1CL,EAAQ,CACf,MAAMC,GAASH,EAAME,CAAC,UAEtBF,EAAK,IAAG,EAEZ,CAAC,CACH,CACF,CACF,CACF,CAEA,SAASM,GACPT,EACAR,EACAkB,EAAiB,CAEjB,IAAMG,EAAWH,EAAQ,MAAQ,yBAC3BS,EAAU,CACd,WAAU,OAAA,OAAA,OAAA,OAAA,CAAA,EACLjC,GAAoB,iBAAiB,EAAA,CACxC,CAACF,GAAA,eAAe,OAAO,EAAGQ,EAC1B,CAACR,GAAA,eAAe,IAAI,EAAGA,GAAA,SAAS,gBAChC,CAACA,GAAA,eAAe,QAAQ,EAAG0B,EAAQ,IAAI,CAAA,GAGrCU,EAAiB,UAAA,CACrB,IAAMjB,EAAOH,EAAO,UAAUa,EAAUM,CAAO,EACzCf,EAAcxB,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,EAAIuB,CAAI,EAEhE,OAAOvB,GAAI,QAAQ,KAAKwB,EAAa,SAAW,CAC9C,GAAI,CACF,OAAO,MAAMM,EAAQ,MAAM,KAAM,SAAS,QACnCL,EAAQ,CACf,MAAMC,GAASH,EAAME,CAAC,UAEtBF,EAAK,IAAG,EAEZ,CAAC,CACH,EAEA,OAAIO,EAAQ,MACV,OAAO,eAAeU,EAAgB,OAAQ,CAAE,MAAOV,EAAQ,IAAI,CAAE,EAKvE,QAAQ,gBAAgBA,CAAO,EAAE,QAAQW,GAAc,CACrD,QAAQ,eACNA,EACA,QAAQ,YAAYA,EAAaX,CAAO,EACxCU,CAAc,CAElB,CAAC,EACMA,CACT,CAEA,IAAMd,GAAW,CAACH,EAAgBmB,KAChCnB,EAAK,gBAAgBmB,CAAK,EAC1BnB,EAAK,UAAU,CAAE,KAAMvB,GAAI,eAAe,MAAO,QAAS0C,EAAM,OAAO,CAAE,EAClEA,2ZCxOTC,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,8GCDA,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,UAAA,uBACAA,EAAA,QAAA,qBACAA,EAAA,oBAAA,oCACAA,EAAA,WAAA,0BACF,GALYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,yGCA1B,IAAYC,IAAZ,SAAYA,EAAS,CACnBA,EAAA,aAAA,WACAA,EAAA,QAAA,aACAA,EAAA,aAAA,iBACF,GAJYA,GAAAC,GAAA,YAAAA,GAAA,UAAS,CAAA,EAAA,+XCArB,IAAAC,GAAA,WASAC,GAAA,KACAC,GAAA,aAoBAC,GAAA,aACAC,GAAA,KAqBA,SAAgBC,GACdC,EACAC,EAA8C,CAK9C,GAAI,CAACA,EAAa,OAAOH,GAAA,UAAU,aAInC,IAAMI,EACJ,OAAOD,EAAY,MAAS,UAAYA,EAAY,KAChDA,EAAY,KACZE,GAA6BF,EAAY,IAAI,EAEnD,MAAO,GAAGH,GAAA,UAAU,YAAY,IAAII,CAAO,GAAGF,EAAS,IAAIA,CAAM,GAAK,EAAE,EAC1E,CAjBAI,EAAA,iBAAAL,GAmBA,SAASI,GAA6BE,EAAiB,CACrD,IAAMC,EAAoBD,EAAU,QAAQ,GAAG,EAC3CE,EACFD,IAAsB,GAClBD,EACAA,EAAU,MAAM,EAAGC,CAAiB,EAC1C,OAAAC,EAAaA,EAAW,YAAW,EAG5BA,EAAW,SAAS,GAAG,EAAIA,EAAW,MAAM,EAAG,EAAE,EAAIA,CAC9D,CAEA,SAAgBC,GAAoBC,EAAgC,CAClE,IAAMC,EAAOD,EAAO,MAAQ,YACtBE,EAAOF,EAAO,MAAQ,KACtBG,EAAWH,EAAO,UAAY,GACpC,MAAO,gBAAgBC,CAAI,IAAIC,CAAI,IAAIC,CAAQ,EACjD,CALAR,EAAA,oBAAAI,GAOA,SAASK,GAAQF,EAAwB,CAGvC,GAAI,OAAO,UAAUA,CAAI,EACvB,OAAOA,CAKX,CAEA,SAAgBG,GACdL,EAAgC,CAEhC,MAAO,CACL,CAACb,GAAA,kBAAkB,EAAGA,GAAA,0BACtB,CAACA,GAAA,gBAAgB,EAAGa,EAAO,SAC3B,CAACb,GAAA,6BAA6B,EAAGY,GAAoBC,CAAM,EAC3D,CAACb,GAAA,sBAAsB,EAAGa,EAAO,KACjC,CAACb,GAAA,sBAAsB,EAAGiB,GAAQJ,EAAO,IAAI,EAC7C,CAACb,GAAA,gBAAgB,EAAGa,EAAO,KAE/B,CAXAL,EAAA,oCAAAU,GAaA,SAAgBC,GAA8BN,EAA2B,CACvE,MAAO,CACL,CAACb,GAAA,kBAAkB,EAAGA,GAAA,0BACtB,CAACA,GAAA,gBAAgB,EAAGa,EAAO,SAC3B,CAACb,GAAA,6BAA6B,EAAGY,GAAoBC,CAAM,EAC3D,CAACb,GAAA,sBAAsB,EAAGa,EAAO,KACjC,CAACb,GAAA,sBAAsB,EAAGiB,GAAQJ,EAAO,IAAI,EAC7C,CAACb,GAAA,gBAAgB,EAAGa,EAAO,KAC3B,CAACd,GAAA,eAAe,mBAAmB,EAAGc,EAAO,kBAC7C,CAACd,GAAA,eAAe,UAAU,EAAGc,EAAO,UAExC,CAXAL,EAAA,8BAAAW,GAaA,SAAgBC,GACdC,EAA8C,CAE9C,OACEA,EAAsB,oBAAsB,IAC5CvB,GAAA,MAAM,QAAQA,GAAA,QAAQ,OAAM,CAAE,IAAM,MAExC,CAPAU,EAAA,0BAAAY,GAWA,SAAgBE,GAEdC,EACAF,EACAhB,EAAgE,CAGhE,GAAM,CAAE,qBAAAmB,CAAoB,EAAK,KAC3BpB,EAASoB,EAAqB,SAE9BC,EAAWtB,GAAiBC,EAAQC,CAAW,EAC/CqB,EAAOH,EAAO,UAAUE,EAAU,CACtC,KAAM3B,GAAA,SAAS,OACf,WAAYoB,GAAoCM,CAAoB,EACrE,EAED,GAAI,CAACnB,EACH,OAAOqB,EAQT,GAJIrB,EAAY,MACdqB,EAAK,aAAa1B,GAAA,sBAAuBK,EAAY,IAAI,EAIzDgB,EAAsB,2BACtB,MAAM,QAAQhB,EAAY,MAAM,EAEhC,GAAI,CACF,IAAMsB,EAAkBtB,EAAY,OAAO,IAAIuB,GACzCA,GAAS,KACJ,OACEA,aAAiB,OACnBA,EAAM,SAAQ,EACZ,OAAOA,GAAU,SACtB,OAAOA,EAAM,YAAe,WACvBA,EAAM,WAAU,EAElB,KAAK,UAAUA,CAAK,EAGpBA,EAAM,SAAQ,CAExB,EACDF,EAAK,aAAa3B,GAAA,eAAe,UAAW4B,CAAe,QACpDE,EAAG,CACV/B,GAAA,KAAK,MAAM,uBAAwBO,EAAY,OAAQwB,CAAC,EAK5D,OAAI,OAAOxB,EAAY,MAAS,UAC9BqB,EAAK,aAAa3B,GAAA,eAAe,QAASM,EAAY,IAAI,EAGrDqB,CACT,CAzDAlB,EAAA,kBAAAc,GA2DA,SAAgBQ,GACdC,EACAL,EACAM,EAAkE,CAE9D,OAAOD,EAAO,cAAiB,eACjC9B,GAAA,wBACE,IAAK,CACH8B,EAAO,aAAcL,EAAM,CACzB,KAAMM,EACP,CACH,EACAC,GAAM,CACAA,GACFnC,GAAA,KAAK,MAAM,8BAA+BmC,CAAG,CAEjD,EACA,EAAI,CAGV,CApBAzB,EAAA,sBAAAsB,GAsBA,SAAgBI,GACdb,EACAK,EACAS,EAAoB,CAEpB,OAAO,SAELF,EACAG,EAAW,CAEPH,EAEFP,EAAK,UAAU,CACb,KAAM5B,GAAA,eAAe,MACrB,QAASmC,EAAI,QACd,EAEDH,GAAsBT,EAAuBK,EAAMU,CAAG,EAGxDV,EAAK,IAAG,EACRS,EAAG,KAAK,KAAMF,EAAKG,CAAG,CACxB,CACF,CAvBA5B,EAAA,cAAA0B,GAyBA,SAAgBG,GACdX,EACAS,EAAkB,CAElB,OAAO,SAELF,EACAG,EACAE,EAAS,CAELL,GACFP,EAAK,UAAU,CACb,KAAM5B,GAAA,eAAe,MACrB,QAASmC,EAAI,QACd,EAEHP,EAAK,IAAG,EACRS,EAAG,KAAK,KAAMF,EAAKG,EAAKE,CAAI,CAC9B,CACF,CAnBA9B,EAAA,oBAAA6B,GAqBA,SAAgBE,GAA2Bb,EAAYS,EAAY,CACjE,OAAO,SAELF,EAAU,CAENA,GACFP,EAAK,UAAU,CACb,KAAM5B,GAAA,eAAe,MACrB,QAASmC,EAAI,QACd,EAEHP,EAAK,IAAG,EACRS,EAAG,MAAM,KAAM,SAAS,CAC1B,CACF,CAdA3B,EAAA,2BAAA+B,GAqBA,SAAgBC,GAAgBX,EAAU,CACxC,OAAO,OAAOA,GAAM,UAAYA,IAAM,MAAQ,YAAaA,EACvD,OAAQA,EAA4B,OAAO,EAC3C,MACN,CAJArB,EAAA,gBAAAgC,GAMA,SAAgBC,GAAuBC,EAAW,OAChD,OACE,OAAOA,GAAO,UACd,QAAOC,EAACD,KAAgC,MAAAC,IAAA,OAAA,OAAAA,EAAE,OAAS,QAEvD,CALAnC,EAAA,uBAAAiC,gICnSaG,GAAA,gBAAkB,SAClBA,GAAA,aAAe,mJCH5B,IAAAC,GAAA,aAOAC,EAAA,WAiBAC,GAAA,KACAC,GAAA,KACAC,GAAA,KACAC,GAAA,KAEaC,GAAb,cAAuCN,GAAA,mBAAmB,CACxD,YAAYO,EAAkC,CAAA,EAAE,CAC9C,MAAMH,GAAA,aAAcA,GAAA,gBAAiBG,CAAM,CAC7C,CAEU,MAAI,CACZ,IAAMC,EAAW,IAAIR,GAAA,oCACnB,KACA,CAAC,YAAY,EACZS,GAAe,CACd,IAAMC,EACJD,EAAO,OAAO,WAAW,IAAM,SAC3BA,EAAO,QACPA,EACN,SAAIT,GAAA,WAAUU,EAAc,OAAO,UAAU,KAAK,GAChD,KAAK,QAAQA,EAAc,OAAO,UAAW,OAAO,KAGlDV,GAAA,WAAUU,EAAc,OAAO,UAAU,OAAO,GAClD,KAAK,QAAQA,EAAc,OAAO,UAAW,SAAS,EAGxD,KAAK,MACHA,EAAc,OAAO,UACrB,QACA,KAAK,qBAAoB,CAAS,EAGpC,KAAK,MACHA,EAAc,OAAO,UACrB,UACA,KAAK,uBAAsB,CAAS,EAG/BD,CACT,EACCA,GAAe,CACd,IAAMC,EACJD,EAAO,OAAO,WAAW,IAAM,SAC3BA,EAAO,QACPA,KACFT,GAAA,WAAUU,EAAc,OAAO,UAAU,KAAK,GAChD,KAAK,QAAQA,EAAc,OAAO,UAAW,OAAO,CAExD,CAAC,EAGGC,EAAe,IAAIX,GAAA,oCACvB,UACA,CAAC,YAAY,EACZU,OACKV,GAAA,WAAUU,EAAc,UAAU,OAAO,GAC3C,KAAK,QAAQA,EAAc,UAAW,SAAS,EAEjD,KAAK,MACHA,EAAc,UACd,UACA,KAAK,qBAAoB,CAAS,EAE7BA,GAERA,GAAqC,IAChCV,GAAA,WAAUU,EAAc,UAAU,OAAO,GAC3C,KAAK,QAAQA,EAAc,UAAW,SAAS,CAEnD,CAAC,EAGH,MAAO,CAACF,EAAUG,CAAY,CAChC,CAES,UAAUJ,EAAkC,CAAA,EAAE,CACrD,KAAK,QAAU,OAAO,OAAO,CAAA,EAAIA,CAAM,CACzC,CAES,WAAS,CAChB,OAAO,KAAK,OACd,CAEQ,wBAAsB,CAC5B,IAAMK,EAAS,KACf,OAAQC,GACC,SAAuCC,EAAmB,CAC/D,GAAIZ,GAAM,0BAA0BU,EAAO,UAAS,CAAE,EACpD,OAAOC,EAAS,KAAK,KAAMC,CAAQ,EAGrC,IAAMC,EAAOH,EAAO,OAAO,UAAUP,GAAA,UAAU,QAAS,CACtD,KAAMJ,EAAA,SAAS,OACf,WAAYC,GAAM,oCAAoC,IAAI,EAC3D,EAED,GAAIY,EAAU,CACZ,IAAME,EAAaf,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EACjDa,EAAWZ,GAAM,2BAA2Ba,EAAMD,CAAQ,EACtDE,IACFF,EAAWb,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAIa,CAAQ,GAItD,IAAMG,EAAyBhB,EAAA,QAAQ,KACrCA,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,EAAIc,CAAI,EACpC,IACSF,EAAS,KAAK,KAAMC,CAAQ,CACpC,EAGH,OAAOI,GAAoBH,EAAME,CAAa,CAChD,CAEJ,CAEQ,sBAAoB,CAC1B,IAAML,EAAS,KACf,OAAQC,IACN,KAAK,MAAM,MAAM,oCAAoC,EAC9C,YAA0CM,EAAe,CAC9D,GAAIjB,GAAM,0BAA0BU,EAAO,UAAS,CAAE,EACpD,OAAOC,EAAS,MAAM,KAAMM,CAAa,EAU3C,IAAMC,EAAOD,EAAK,CAAC,EACbE,EAAmB,OAAOD,GAAS,SACnCE,EACJpB,GAAM,uBAAuBkB,CAAI,EAK7BG,EAAcF,EAChB,CACE,KAAMD,EACN,OAAQ,MAAM,QAAQD,EAAK,CAAC,CAAC,EAAIA,EAAK,CAAC,EAAI,QAE7CG,EACCF,EACD,OAEEI,EAAwBZ,EAAO,UAAS,EAExCG,EAAOb,GAAM,kBAAkB,KACnC,KACAU,EAAO,OACPY,EACAD,CAAW,EAiBb,GAZIC,EAAsB,kCACxBL,EAAK,CAAC,EAAIE,KACNlB,GAAA,wBAAuBY,EAAMK,CAAI,EACjCE,EACD,OAAA,OAAA,OAAA,OAAA,CAAA,EACMF,CAAI,EAAA,CACP,QAAMjB,GAAA,wBAAuBY,EAAMK,EAAK,IAAI,CAAC,CAAA,EAE/CD,EAAK,CAAC,GAIRA,EAAK,OAAS,EAAG,CACnB,IAAMH,EAAaf,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EACjD,GAAI,OAAOkB,EAAKA,EAAK,OAAS,CAAC,GAAM,WAEnCA,EAAKA,EAAK,OAAS,CAAC,EAAIjB,GAAM,cAC5BsB,EACAT,EACAI,EAAKA,EAAK,OAAS,CAAC,GAIlBH,IACFG,EAAKA,EAAK,OAAS,CAAC,EAAIlB,EAAA,QAAQ,KAC9BA,EAAA,QAAQ,OAAM,EACdkB,EAAKA,EAAK,OAAS,CAAC,CAAC,WAGhB,OAAOI,GAAa,UAAa,WAAY,CAEtD,IAAIT,EAAWZ,GAAM,cACnBU,EAAO,UAAS,EAChBG,EACAQ,EAAY,UAIVP,IACFF,EAAWb,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAIa,CAAQ,GAGnDK,EAAK,CAAC,EAAsC,SAAWL,GAK1D,OAAOU,EAAsB,aAAgB,YAC7CD,MAEAvB,GAAA,wBACE,IAAK,CAGH,GAAM,CAAE,SAAAyB,EAAU,KAAAC,EAAM,KAAAC,EAAM,KAAAC,CAAI,EAAK,KAAK,qBACtCC,EAAa,CAAE,SAAAJ,EAAU,KAAAC,EAAM,KAAAC,EAAM,KAAAC,CAAI,EAE/CJ,EAAsB,YAAaT,EAAM,CACvC,WAAAc,EACA,MAAO,CACL,KAAMN,EAAY,KAgBlB,OAAQA,EAAY,OACpB,KAAMA,EAAY,MAErB,CACH,EACAO,GAAM,CACAA,GACFlB,EAAO,MAAM,MAAM,2BAA4BkB,CAAG,CAEtD,EACA,EAAI,EAIR,IAAIC,EACJ,GAAI,CACFA,EAASlB,EAAS,MAAM,KAAMM,CAAa,QACpCa,EAAY,CAEnB,MAAAjB,EAAK,UAAU,CACb,KAAMd,EAAA,eAAe,MACrB,QAASC,GAAM,gBAAgB8B,CAAC,EACjC,EACDjB,EAAK,IAAG,EACFiB,EAIR,OAAID,aAAkB,QACbA,EACJ,KAAMA,GAEE,IAAI,QAAQE,GAAU,CAC3B/B,GAAM,sBAAsBU,EAAO,UAAS,EAAIG,EAAMgB,CAAM,EAC5DhB,EAAK,IAAG,EACRkB,EAAQF,CAAM,CAChB,CAAC,CACF,EACA,MAAOG,GACC,IAAI,QAAQ,CAACC,EAAGC,IAAU,CAC/BrB,EAAK,UAAU,CACb,KAAMd,EAAA,eAAe,MACrB,QAASiC,EAAM,QAChB,EACDnB,EAAK,IAAG,EACRqB,EAAOF,CAAK,CACd,CAAC,CACF,EAIEH,CACT,EAEJ,CAEQ,sBAAoB,CAC1B,IAAMnB,EAAS,KACf,OAAQyB,GACC,SAAuCvB,EAAyB,CACrE,GAAIZ,GAAM,0BAA0BU,EAAO,UAAS,CAAE,EACpD,OAAOyB,EAAgB,KAAK,KAAMvB,CAAe,EAInD,IAAMC,EAAOH,EAAO,OAAO,UAAUP,GAAA,UAAU,aAAc,CAC3D,KAAMJ,EAAA,SAAS,OACf,WAAYC,GAAM,8BAA8B,KAAK,OAAO,EAC7D,EAED,GAAIY,EAAU,CACZ,IAAME,EAAaf,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,CAAE,EACjDa,EAAWZ,GAAM,oBACfa,EACAD,CAAQ,EAGNE,IACFF,EAAWb,EAAA,QAAQ,KAAKA,EAAA,QAAQ,OAAM,EAAIa,CAAQ,GAItD,IAAMG,EAAyBhB,EAAA,QAAQ,KACrCA,EAAA,MAAM,QAAQA,EAAA,QAAQ,OAAM,EAAIc,CAAI,EACpC,IACSsB,EAAgB,KAAK,KAAMvB,CAAe,CAClD,EAGH,OAAOI,GAAoBH,EAAME,CAAa,CAChD,CAEJ,GApUFqB,GAAA,kBAAAhC,GAuUA,SAASY,GAAoBH,EAAYE,EAAsB,CAC7D,GAAI,EAAEA,aAAyB,SAC7B,OAAOA,EAGT,IAAMsB,EAAuBtB,EAC7B,OAAOhB,EAAA,QAAQ,KACbA,EAAA,QAAQ,OAAM,EACdsC,EACG,KAAKR,IACJhB,EAAK,IAAG,EACDgB,EACR,EACA,MAAOG,IACNnB,EAAK,UAAU,CACb,KAAMd,EAAA,eAAe,MACrB,QAASC,GAAM,gBAAgBgC,CAAK,EACrC,EACDnB,EAAK,IAAG,EACD,QAAQ,OAAOmB,CAAK,EAC5B,CAAC,CAER,6eCzXAM,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,+HCDaC,GAAA,gBAAkB,SAClBA,GAAA,aAAe,oNCAfC,GAAA,kBAAoB,aAQpBA,GAAA,eAAgC,OAAO,sBAAsB,EAiC7DA,GAAA,cAAgB,CAC3B,OAAQ,SACR,OAAQ,SACR,IAAK,cAGMA,GAAA,yBAA2B,IAAI,IAAI,CAC9C,YACA,gBACA,aACA,eACA,gBACA,gBACA,YACD,8GC1DD,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,UAAA,YACAA,EAAA,YAAA,mBACAA,EAAA,SAAA,iBACF,GAJYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,qQCE1B,IAAAC,GAAA,aAKAC,GAAA,KAOAC,GAAA,KAEA,SAAgBC,GAAiBC,EAAsB,CACrD,OAAKA,EAAkC,KAC7BA,EAAkC,KAElCA,EAA8B,IAAI,IAE9C,CANAC,GAAA,cAAAF,GAQO,IAAMG,GACXC,GAGE,OAAOA,GAAoB,UAC3BN,GAAA,yBAAyB,IAAIM,CAAe,EALnCF,GAAA,mBAAkBC,GASxB,IAAME,GACXD,GACwD,OACxD,IAAME,GAAQC,EAACH,KAAqD,MAAAG,IAAA,OAAA,OAAAA,EAAE,KACtE,OAAOD,IAAU,WAAaJ,GAAA,oBAAmBI,CAAK,CACxD,EALaJ,GAAA,uBAAsBG,GAO5B,IAAMG,GACXJ,GAGE,MAAM,QAAQA,CAAe,GAC7BA,EAAgB,QAAU,MAC1BF,GAAA,oBAAmBE,EAAgB,CAAC,CAAC,GACrC,OAAOA,EAAgB,CAAC,GAAM,WAPrBF,GAAA,iBAAgBM,GAWtB,IAAMC,GACXL,GAEO,CAAC,MAAM,QAAQA,CAAe,EAH1BF,GAAA,qBAAoBO,GAM1B,IAAMC,GAAmB,CAC9BC,EACAC,IAKIA,EACK,CACL,WAAY,CACV,CAACf,GAAA,mBAAmB,EAAGc,EAAM,KAC7B,CAACd,GAAA,oBAAoB,EAAGc,EAAM,OAC9B,CAACZ,GAAA,eAAe,SAAS,EAAGD,GAAA,cAAc,OAC1C,CAACC,GAAA,eAAe,WAAW,EAAGa,GAEhC,KAAM,GAAGA,CAAU,aAAaD,EAAM,IAAI,IAGvC,CACL,WAAY,CACV,CAACd,GAAA,mBAAmB,EAAGc,EAAM,KAC7B,CAACd,GAAA,oBAAoB,EAAGc,EAAM,OAC9B,CAACZ,GAAA,eAAe,SAAS,EAAGD,GAAA,cAAc,QAE5C,KAAM,WAAWa,EAAM,IAAI,IAxBlBT,GAAA,iBAAgBQ,GA4BtB,IAAMG,GAAiB,CAC5BC,EACAF,IAKIA,EACK,CACL,WAAY,CACV,CAACb,GAAA,eAAe,QAAQ,EAAGe,EAC3B,CAACf,GAAA,eAAe,SAAS,EAAGD,GAAA,cAAc,IAC1C,CAACC,GAAA,eAAe,WAAW,EAAGa,GAEhC,KAAM,GAAGA,CAAU,WAAWE,CAAQ,IAGnC,CACL,WAAY,CACV,CAACf,GAAA,eAAe,QAAQ,EAAGe,EAC3B,CAACf,GAAA,eAAe,SAAS,EAAGD,GAAA,cAAc,KAE5C,KAAM,SAASgB,CAAQ,IAtBdZ,GAAA,eAAcW,GA0BpB,IAAME,GACXC,GAEI,WAAYA,EACV,WAAYA,EAAU,OACjBA,EAAU,OAAO,OAEnBA,EAAU,OAEZA,EATId,GAAA,mBAAkBa,oHC9G/B,IAAAE,GAAA,WACAC,GAAA,aACAC,GAAA,aAQAC,GAAA,KACAC,GAAA,KAWAC,GAAA,KAYaC,GAAb,cAAyCJ,GAAA,mBAAmB,CAC1D,YAAYK,EAAgC,CAAA,EAAE,CAC5C,MAAMJ,GAAA,aAAcA,GAAA,gBAAiBI,CAAM,CAC7C,CAEU,MAAI,CACZ,OAAO,IAAIL,GAAA,oCACTE,GAAA,kBACA,CAAC,cAAc,EACdI,GAAe,CACd,IAAMC,EACJD,EAAO,OAAO,WAAW,IAAM,SAAWA,EAAO,QAAUA,EAC7D,SAAKN,GAAA,WAAUO,EAAc,MAAM,GACjC,KAAK,MACHA,EACA,SACA,KAAK,gBAAgB,KAAK,IAAI,CAAQ,KAIrCP,GAAA,WAAUO,EAAc,MAAM,GACjC,KAAK,MACHA,EACA,SACA,KAAK,gBAAgB,KAAK,IAAI,CAAQ,EAGnCA,CACT,EACCD,GAAe,CACd,IAAMC,EACJD,EAAO,OAAO,WAAW,IAAM,SAAWA,EAAO,QAAUA,EAC7D,KAAK,YAAY,CAACC,CAAa,EAAG,CAAC,SAAU,QAAQ,CAAC,CACxD,CAAC,CAEL,CASQ,gBACNC,EAAuD,CAEvD,IAAMC,EAAuC,KACvCC,EAAO,KACb,OAAO,SAAmCC,EAAyB,CACjE,IAAMC,EAAyBJ,EAAS,MAAM,KAAM,CAACG,CAAI,CAAC,EAE1D,OAAAD,EAAK,MAAME,EAAW,QAASC,GACtBJ,EAAgB,qBAAqB,KAAKA,CAAe,EAC9DI,CAAc,CAEjB,EAKDH,EAAK,MAAME,EAAW,MAAOE,GACpBL,EAAgB,mBAAmB,KAAKA,CAAe,EAE5DK,CAAyB,CAE5B,EAIDJ,EAAK,MACHE,EACA,WAEAH,EAAgB,wBAAwB,KAAKA,CAAe,CAAQ,EAE/DG,CACT,CACF,CASQ,wBACNJ,EAA6B,CAE7B,IAAMC,EAAuC,KAC7C,OAAO,SAELM,EACAC,EAAoC,CAEpC,GAAI,MAAM,QAAQD,CAAW,EAC3B,QAAWE,KAAaF,EAAa,CACnC,IAAMG,KAASf,GAAA,oBAAmBc,CAAS,EAC3CR,EAAgB,qBAAqBS,CAAM,MAExC,CACL,IAAMA,KAASf,GAAA,oBAAmBY,CAAW,EAC7CN,EAAgB,qBAAqBS,CAAM,EAE7C,OAAOV,EAAS,MAAM,KAAM,CAACO,EAAaC,CAAO,CAAC,CACpD,CACF,CAYQ,mBACNR,EACAW,EAAmB,CAEnB,IAAMV,EAAuC,KAE7C,OAAO,YAEFW,EAAiC,CAEpC,GAAI,MAAM,QAAQA,EAAK,CAAC,CAAC,EAAG,CAC1B,IAAMC,EAEoCD,EAAK,CAAC,EAChD,QAASE,EAAI,EAAGA,EAAID,EAAW,OAAQC,IAAK,CAC1C,IAAMC,EAAWF,EAAWC,CAAC,EAC7B,MAAInB,GAAA,oBAAmBoB,EAAS,IAAI,EAAG,CACrC,IAAMC,EACJD,EACIE,EAAUhB,EAAgB,gBAC9Be,EAAkB,OAClBD,EAAS,KACTJ,CAAU,EAEZK,EAAkB,OAASC,EAC3BJ,EAAWC,CAAC,EAAIE,GAGpB,OAAOhB,EAAS,MAAM,KAAMY,CAAI,aACvBjB,GAAA,kBAAiBiB,CAAI,EAAG,CACjC,IAAMM,EAAiCN,EACjCO,EAA6BD,EAAS,CAAC,EACvCD,EAAUhB,EAAgB,gBAC9BkB,EACAD,EAAS,CAAC,EACVP,CAAU,EAEZ,OAAOX,EAAS,MAAM,KAAM,CAACkB,EAAS,CAAC,EAAGD,EAASC,EAAS,CAAC,CAAC,CAAC,aACtDvB,GAAA,wBAAuBiB,EAAK,CAAC,CAAC,EAAG,CAC1C,IAAMI,EAAoBJ,EAAK,CAAC,EAC1BK,EAAUhB,EAAgB,gBAC9Be,EAAkB,OAClBA,EAAkB,KAClBL,CAAU,EAEZ,OAAAK,EAAkB,OAASC,EACpBjB,EAAS,KAAK,KAAMgB,CAAiB,EAE9C,OAAOhB,EAAS,MAAM,KAAMY,CAAI,CAClC,CACF,CAWQ,qBACNZ,EACAW,EAAmB,CAEnB,IAAMV,EAAuC,KAC7C,OAAO,SAELmB,EAA2B,CAE3B,GAAI,MAAM,QAAQA,CAAK,EACrB,QAAS,EAAI,EAAG,EAAIA,EAAM,OAAQ,IAAK,CACrC,IAAMC,EAAWpB,EAAgB,kBAAkB,KACjDA,EACAmB,EAAM,CAAC,EACPT,CAAU,EAEZS,EAAM,CAAC,EAAIC,OAGbD,EAAQnB,EAAgB,kBAAkB,KACxCA,EACAmB,EACAT,CAAU,EAGd,OAAOX,EAAS,MAAM,KAAM,CAACoB,CAAK,CAAC,CACrC,CACF,CAQQ,qBAAwBV,EAAsB,CACpD,IAAMT,EAAuC,KACvCU,KAAahB,GAAA,eAAce,CAAM,EACjCY,EAAaZ,EAAO,SACpBR,EAAO,KACPqB,EAAqB,SAAUC,EAAqBhB,EAAU,CAClE,OAAAN,EAAK,MAAMsB,EAAQ,QAASxB,GACnBC,EAAgB,qBAAqB,KAAKA,CAAe,EAC9DD,EACAW,CAAU,CAEb,EAKDT,EAAK,MAAMsB,EAAQ,MAAOlB,GACjBL,EAAgB,mBAAmB,KAAKA,CAAe,EAE5DK,EACAK,CAAU,CAEb,EACMW,EAAWE,EAAQhB,CAAO,CACnC,EACAE,EAAO,SAAWa,CACpB,CAaQ,gBACNJ,EACAM,EACAd,EAAmB,CAEnB,IAAMV,EAAuC,KAC7C,GAAIkB,aAAkB,MAAO,CAC3B,QAAS,EAAI,EAAG,EAAIA,EAAO,OAAQ,IACjCA,EAAO,CAAC,EAAIlB,EAAgB,gBAC1BkB,EAAO,CAAC,EACRM,CAAQ,EAGZ,OAAON,aACExB,GAAA,sBAAqBwB,CAAM,EACpC,OAAIA,EAAOzB,GAAA,cAAc,IAAM,GAAayB,GAC5CA,EAAOzB,GAAA,cAAc,EAAI,GAEc,kBAClCgC,EAAyC,CAE5C,GAAIpC,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,CAAE,IAAM,OAC9C,OAAO,MAAM6B,EAAO,MAAM,KAAMO,CAAM,EAExC,IAAMC,KAAWhC,GAAA,gBAAe8B,EAAUd,CAAU,EAC9CiB,EAAO3B,EAAgB,OAAO,UAAU0B,EAAS,KAAM,CAC3D,WAAYA,EAAS,WACtB,EACD,GAAI,CACF,OAAO,MAAMrC,GAAI,QAAQ,KAIvBA,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,EAAIsC,CAAI,EAC5CT,EACA,OACA,GAAGO,CAAM,QAEJG,EAAU,CACjB,MAAAD,EAAK,gBAAgBC,CAAG,EACxBD,EAAK,UAAU,CACb,KAAMtC,GAAI,eAAe,MACzB,QAASuC,EAAI,QACd,EACKA,UAEND,EAAK,IAAG,EAEZ,GAGF,OAAOT,CACT,CASQ,kBACNC,EACAT,EAAmB,OAEnB,IAAMV,EAAuC,KAC7C,GAAImB,EAAM1B,GAAA,cAAc,IAAM,GAAM,OAAO0B,EAC3CA,EAAM1B,GAAA,cAAc,EAAI,GAExB,IAAMoC,EAEuBR,GACpB,kBAAmBI,EAAyC,CACjE,GAAIpC,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,CAAE,IAAM,OAC9C,OAAO,MAAMgC,EAAW,KAAK,KAAM,GAAGI,CAAM,EAE9C,IAAMK,KAAcxC,GAAA,gBAAeD,GAAI,QAAQ,OAAM,CAAE,EACnDyC,GAAa,OAASxC,GAAA,QAAQ,OAChCwC,EAAY,MAAQX,EAAM,MAE5B,IAAMO,KAAWhC,GAAA,kBAAiByB,EAAOT,CAAU,EAC7CiB,EAAO3B,EAAgB,OAAO,UAAU0B,EAAS,KAAM,CAC3D,WAAYA,EAAS,WACtB,EACD,GAAI,CACF,OAAO,MAAMrC,GAAI,QAAQ,KACvBA,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,EAAIsC,CAAI,EAC5C,IAAMN,EAAW,KAAK,KAAM,GAAGI,CAAM,CAAC,QAEjCG,EAAU,CACjB,MAAAD,EAAK,gBAAgBC,CAAG,EACxBD,EAAK,UAAU,CACb,KAAMtC,GAAI,eAAe,MACzB,QAASuC,EAAI,QACd,EACKA,UAEND,EAAK,IAAG,EAEZ,EAGF,GAAI,OAAOR,EAAM,SAAY,WAC3BA,EAAM,QAAUU,EAAYV,EAAM,OAAgC,UACzD,OAAOA,EAAM,SAAY,WAAY,CAC9C,IAAMY,EAAaZ,EAAM,QACzBA,EAAM,QAAU,SAAUI,EAAM,CAC9B,IAAMhB,EAAUwB,EAAWR,CAAM,EACjC,OAAI,OAAOhB,EAAQ,SAAY,aAC7BA,EAAQ,QAAUsB,EAChBtB,EAAQ,OAAgC,GAGrCA,CACT,OACS,QAAOyB,EAAAb,EAAM,WAAO,MAAAa,IAAA,OAAA,OAAAA,EAAE,UAAY,aAC3Cb,EAAM,QAAQ,QAAUU,EACtBV,EAAM,QAAQ,OAAgC,GAGlD,OAAOA,CACT,GAvXFc,GAAA,oBAAAtC,2ZClCAuC,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,4GCCA,IAAYC,IAAZ,SAAYA,EAAY,CACtBA,EAAA,OAAA,SACAA,EAAA,WAAA,YACF,GAHYA,GAAAC,GAAA,eAAAA,GAAA,aAAY,CAAA,EAAA,+HCDXC,GAAA,gBAAkB,SAClBA,GAAA,aAAe,iJCH5B,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,SAAA,WACAA,EAAA,SAAA,UACF,GAHYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,uICA1B,IAAAC,GAAA,KAEAC,GAAA,KAEAC,GAAA,aAEaC,GAAwB,CACnCC,EACAC,EACAC,EACAC,IAIE,OACF,OAAID,EACK,CACL,WAAY,CACV,CAACL,GAAA,eAAe,QAAQ,EAAGM,GAAW,SAAQ,EAC9C,CAACN,GAAA,eAAe,QAAQ,EAAGD,GAAA,aAAa,OACxC,CAACE,GAAA,mBAAmB,EAAGK,GAAW,SAAQ,GAE5C,KAAMH,EAAQ,mBAAqB,YAAYG,CAAS,IAGnD,CACL,WAAY,CACV,CAACN,GAAA,eAAe,QAAQ,GAAGO,EAAAH,EAAM,QAAI,MAAAG,IAAA,OAAAA,EAAI,aACzC,CAACP,GAAA,eAAe,QAAQ,EAAGD,GAAA,aAAa,YAE1C,KAAM,gBAAgBK,EAAM,IAAI,GAGtC,EA3BaI,GAAA,sBAAqBN,GAmC3B,IAAMO,GAAiB,CAC5BC,EACAC,IACW,OACX,MAAO,CAAC,EACN,MAAM,QAAQA,GAAQ,gBAAgB,IACtC,GAAAJ,EAAAI,GAAQ,oBAAgB,MAAAJ,IAAA,SAAAA,EAAE,SAASG,CAAI,GAE3C,EARaF,GAAA,eAAcC,8GC1BdG,GAAA,cAA+B,OAAO,mBAAmB,kHCdtE,IAAAC,GAAA,WACAC,GAAA,aAQAC,GAAA,KACAC,GAAA,KACAC,GAAA,KACAC,GAAA,aACAC,GAAA,KAQaC,GAAb,cAAwCN,GAAA,mBAAmB,CACzD,YAAYO,EAAmC,CAAA,EAAE,CAC/C,MAAML,GAAA,aAAcA,GAAA,gBAAiBK,CAAM,CAC7C,CAES,UAAUA,EAAmC,CAAA,EAAE,CACtD,KAAK,QAAU,OAAO,OAAO,CAAA,EAAIA,CAAM,CACzC,CAES,WAAS,CAChB,OAAO,KAAK,OACd,CAEU,MAAI,CACZ,OAAO,IAAIP,GAAA,oCACT,MACA,CAAC,YAAY,EACZQ,GAAe,CACd,IAAMC,EACJD,EAAO,OAAO,WAAW,IAAM,SAC3BA,EAAO,QACPA,EACN,OAAIC,GAAiB,KACZA,MAELT,GAAA,WAAUS,EAAc,UAAU,GAAG,GACvC,KAAK,QAAQA,EAAc,UAAW,KAAK,EAE7C,KAAK,MACHA,EAAc,UACd,MACA,KAAK,gBAAgB,KAAK,IAAI,CAAC,EAE1BD,EACT,EACCA,GAAe,CACd,IAAMC,EACJD,EAAO,OAAO,WAAW,IAAM,SAC3BA,EAAO,QACPA,KACFR,GAAA,WAAUS,EAAc,UAAU,GAAG,GACvC,KAAK,QAAQA,EAAc,UAAW,KAAK,CAE/C,CAAC,CAEL,CAOQ,gBAAgBC,EAA4C,CAClE,IAAMC,EAAS,KACf,OAAO,SAAwBC,EAAiC,CAC9D,IAAIC,EACJ,OAAID,EAAmB,OACrBC,EAAkBF,EAAO,qBAAqBC,CAAkB,EAEhEC,EAAkBF,EAAO,YAAYC,EAAoB,EAAK,EAEzDF,EAAS,MAAM,KAAM,CAACG,CAAe,CAAC,CAC/C,CACF,CASQ,qBAAqBC,EAA4B,OACvDf,GAAI,KAAK,MAAM,+BAA+B,EAE9C,IAAMgB,EAASD,EAAc,OAEvBE,GAAcC,EAAAF,GAAQ,SAAK,MAAAE,IAAA,OAAAA,EAAI,CAAA,EACrC,QAAWC,KAAaF,EAAa,CACnC,IAAMG,EAAOD,EAAU,KACjBE,EAAYF,EAAU,MAC5B,QAASG,EAAI,EAAGA,EAAID,EAAU,OAAQC,IAAK,CACzC,IAAMC,EAAkCF,EAAUC,CAAC,EACnDD,EAAUC,CAAC,EAAI,KAAK,YAAYC,EAAkB,GAAMH,CAAI,GAIhE,OAAOL,CACT,CAWQ,YACNS,EACAC,EACAC,EAA2B,CAE3B,IAAMC,EAAYF,EAAWvB,GAAA,aAAa,OAASA,GAAA,aAAa,WAEhE,OACEsB,EAAgBlB,GAAA,aAAa,IAAM,OACnCF,GAAA,gBAAeuB,EAAW,KAAK,UAAS,CAAE,EAEnCH,EAGPA,EAAgB,YAAY,OAAS,qBACrCA,EAAgB,YAAY,OAAS,0BAErCxB,GAAI,KAAK,MAAM,+CAA+C,EACvDwB,IAGTA,EAAgBlB,GAAA,aAAa,EAAI,GAEjCN,GAAI,KAAK,MAAM,+BAA+B,EACvC,MAAO4B,EAAqBC,IAAkB,CAEnD,GADe7B,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,CAAE,IACtC,OACb,OAAOwB,EAAgBI,EAASC,CAAI,EAEtC,IAAMC,KAAW1B,GAAA,uBACfwB,EACAJ,EACAC,EACAC,CAAS,EAELK,EAAO,KAAK,OAAO,UAAUD,EAAS,KAAM,CAChD,WAAYA,EAAS,WACtB,EAEKE,KAAc3B,GAAA,gBAAeL,GAAI,QAAQ,OAAM,CAAE,EAEnDgC,GAAa,OAAS3B,GAAA,QAAQ,MAAQuB,EAAQ,gBAChDI,EAAY,MAAQJ,EAAQ,cAAc,SAAQ,GAGhD,KAAK,UAAS,EAAG,gBACnB3B,GAAA,wBACE,IACE,KAAK,UAAS,EAAG,YAAa8B,EAAM,CAClC,QAAAH,EACA,gBAAAJ,EACA,UAAAG,EACD,EACHM,GAAI,CACEA,GACFjC,GAAI,KAAK,MAAM,2CAA4CiC,CAAC,CAEhE,EACA,EAAI,EAIR,IAAMC,EAAalC,GAAI,MAAM,QAAQA,GAAI,QAAQ,OAAM,EAAI+B,CAAI,EAC/D,OAAO/B,GAAI,QAAQ,KAAKkC,EAAY,SAAW,CAC7C,GAAI,CACF,OAAO,MAAMV,EAAgBI,EAASC,CAAI,QACnCM,EAAU,CACjB,MAAAJ,EAAK,gBAAgBI,CAAG,EAClBA,UAENJ,EAAK,IAAG,EAEZ,CAAC,CACH,EACF,GA7KFK,GAAA,mBAAA7B,2ZCrBA8B,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,8ICFA,IAAYC,IAAZ,SAAYA,EAAc,CACxBA,EAAA,aAAA,eACAA,EAAA,aAAA,cACF,GAHYA,GAAAC,GAAA,iBAAAA,GAAA,eAAc,CAAA,EAAA,EAK1B,IAAYC,IAAZ,SAAYA,EAAY,CACtBA,EAAA,WAAA,aACAA,EAAA,gBAAA,iBACF,GAHYA,GAAAD,GAAA,eAAAA,GAAA,aAAY,CAAA,EAAA,EAKxB,IAAYE,IAAZ,SAAYA,EAAY,CACtBA,EAAA,WAAA,aACAA,EAAA,gBAAA,iBACF,GAHYA,GAAAF,GAAA,eAAAA,GAAA,aAAY,CAAA,EAAA,+HCTXG,GAAA,gBAAkB,SAClBA,GAAA,aAAe,6JCAfC,GAAA,uBAAwC,OACnD,2DAA2D,6JCJ7D,IAAAC,GAAA,WACAC,GAAA,KAEaC,GAAoBC,GAA2B,CACtD,MAAM,QAAQA,EAAQF,GAAA,sBAAsB,CAAC,IAAM,IACrD,OAAO,eAAeE,EAASF,GAAA,uBAAwB,CACrD,WAAY,GACZ,MAAO,CAAA,EACR,EAEHE,EAAQF,GAAA,sBAAsB,EAAE,KAAK,GAAG,EAExC,IAAMG,EAAcD,EAAQF,GAAA,sBAAsB,EAAE,OAEpD,MAAO,IAAK,CACNG,IAAgBD,EAAQF,GAAA,sBAAsB,EAAE,OAClDE,EAAQF,GAAA,sBAAsB,EAAE,IAAG,EAEnCD,GAAA,KAAK,KAAK,gDAAgD,CAE9D,CACF,EAlBaK,GAAA,iBAAgBH,GAoBtB,IAAMI,GAA2B,CACtCH,EACAI,IACE,CACEA,GACFJ,EAAQF,GAAA,sBAAsB,EAAE,OAAO,GAAI,EAAGM,CAAQ,CAE1D,EAPaF,GAAA,yBAAwBC,GAY9B,IAAME,GAAiBL,GACrBA,EAAQF,GAAA,sBAAsB,EAAE,OACrC,CAACQ,EAAKC,IAAQD,EAAI,QAAQ,OAAQ,EAAE,EAAIC,CAAG,EAFlCL,GAAA,cAAaG,yIClC1B,IAAAG,GAAA,WACAC,GAAA,aAGAC,GAAA,KAMAC,GAAA,KACAC,GAAA,aAMAC,GAAA,aACAC,GAAA,KAMaC,GAAA,eAAiB,YAG9B,IAAaC,GAAb,cAA4CJ,GAAA,mBAAmB,CAC7D,YAAYK,EAAgC,CAAA,EAAE,CAC5C,MAAMN,GAAA,aAAcA,GAAA,gBAAiBM,CAAM,CAC7C,CAEA,MAAI,CACF,MAAO,CACL,IAAIL,GAAA,oCACF,UACA,CAAC,YAAY,EACbM,GACS,KAAK,kBAAkBA,CAAa,CAC5C,EAGP,CAEQ,UAAUC,EAAkB,IAC7BP,GAAA,WAAUO,EAAW,GAAG,GAC3B,KAAK,MAAMA,EAAY,MAAO,KAAK,UAAU,KAAK,IAAI,CAAC,KAEpDP,GAAA,WAAUO,EAAW,MAAM,GAC9B,KAAK,MAAMA,EAAY,SAAU,KAAK,aAAa,KAAK,IAAI,CAAC,CAEjE,CAEQ,kBAAkBC,EAAsB,CAC9C,IAAMC,EAAkB,KACxB,OAAO,YAA2BC,EAAI,CACpC,IAAMC,EAAMH,EAAS,MAAM,KAAME,CAAI,EACrC,OAAAD,EAAgB,UAAUE,CAAG,EACtBA,CACT,CACF,CAEO,WAAWC,EAAoBC,EAAsB,CAC1D,OAAO,SAA0CC,EAAS,CACxD,IAAMC,EAASH,EAAK,MAAM,KAAM,CAACE,CAAG,CAAC,EACrC,OAAAD,EAAU,EACHE,CACT,CACF,CAEO,WAAWC,EAAmBC,EAA0B,CAC7D,IAAIC,EACAC,EACAC,EACAJ,GACFE,EAAcpB,GAAA,aAAa,gBAC3BsB,EAAkBtB,GAAA,aAAa,gBAC/BqB,EAAcH,IAEdE,EAAcpB,GAAA,aAAa,WAC3BsB,EAAkBtB,GAAA,aAAa,WAC/BqB,EAAcF,EAAW,MAAQd,GAAA,gBAEnC,IAAMkB,EAAW,GAAGD,CAAe,MAAMD,CAAW,GAC9CG,EAAuB,CAC3B,WAAY,CACV,CAACrB,GAAA,mBAAmB,EAAGe,EAAU,OAAS,EAAIA,EAAY,IAC1D,CAAClB,GAAA,eAAe,YAAY,EAAGoB,EAC/B,CAACpB,GAAA,eAAe,YAAY,EAAGqB,IAInC,OAAO,KAAK,OAAO,UAAUE,EAAUC,CAAO,CAChD,CAEO,iBACLN,EACAC,EAA0B,CAE1B,IAAMR,EAAkB,KAClBc,EAAoBN,EAAW,SAAW,EAEhD,SAASO,GAAiB,CACxB,GAAI,CAACf,EAAgB,UAAS,EAC5B,OAAQQ,EAAmB,MAAM,KAAM,SAAS,EAElD,GAAM,CAACQ,EAAWC,EAAWC,CAAU,EAAIJ,EACvC,CAAC,EAAG,EAAG,CAAC,EACR,CAAC,EAAG,EAAG,CAAC,EACNK,EAAM,UAAUH,CAAS,EACzBI,EAAM,UAAUH,CAAS,EACzBd,EAAO,UAAUe,CAAU,KAEjCzB,GAAA,0BAAyB0B,EAAKZ,CAAS,EAEvC,IAAMc,KAAcjC,GAAA,gBAAeD,GAAA,QAAQ,OAAM,CAAE,EAC/CoB,GAAac,GAAa,OAASjC,GAAA,QAAQ,OAC7CiC,EAAY,SAAQ5B,GAAA,eAAc0B,CAAG,GAGvC,IAAIP,EAAW,GACXL,EACFK,EAAW,qBAAqBL,CAAS,GAEzCK,EAAW,gBAAgBJ,EAAW,MAAQd,GAAA,cAAc,GAE9D,IAAM4B,EAAOtB,EAAgB,WAAWO,EAAWC,CAAU,EAC7DR,EAAgB,MAAM,MAAM,aAAcY,CAAQ,EAClD,IAAIW,EAAe,GAEnB,SAASnB,GAAU,CACZmB,EAKHvB,EAAgB,MAAM,MACpB,QAASsB,EAAa,IAAI,qBAAqB,GALjDC,EAAe,GACfvB,EAAgB,MAAM,MAAM,kBAAmBsB,EAAa,IAAI,EAAE,EAClEA,EAAK,IAAG,GAMVF,EAAI,eAAe,QAAShB,CAAU,CACxC,CAEA,OAAAgB,EAAI,YAAY,QAAShB,CAAU,EACnC,UAAUc,CAAU,EAAIlB,EAAgB,WAAWG,EAAMC,CAAU,EAE3DI,EAAmB,MAAM,KAAM,SAAS,CAClD,CAEA,cAAO,eAAeO,EAAmB,SAAU,CACjD,MAAOP,EAAW,OAClB,SAAU,GACV,aAAc,GACf,EAEMO,CACT,CAEO,UAAUhB,EAAuB,CACtC,IAAMC,EAAkB,KACxB,OAAO,YAA2BC,EAAa,CAC7C,IAAMO,EAAaP,EAAKA,EAAK,OAAS,CAAC,EACjCM,EAAaN,EAAKA,EAAK,OAAS,CAAC,GAAK,GAE5C,OAAAA,EAAKA,EAAK,OAAS,CAAC,EAAID,EAAgB,iBACtCO,EACAC,CAAU,EAGLT,EAAS,MAAM,KAAME,CAAgB,CAC9C,CACF,CAEO,aAAaF,EAA0B,CAC5C,IAAMC,EAAkB,KACxB,OAAO,UAAA,CACL,GAAM,CAACwB,EAAQC,CAAM,EAAI,CAAC,EAAG,CAAC,EACxBN,EAAM,UAAUK,CAAM,EACtBE,EAAM,UAAUD,CAAM,EACtBE,KAAgBlC,GAAA,kBAAiB0B,CAAG,EAE1C,OAAI,OAAOO,GAAQ,aACjB,UAAUD,CAAM,EAAIzB,EAAgB,UAClC0B,EACAC,CAAa,GAIT5B,EAAiB,MAAM,KAAM,SAAS,CAChD,CACF,CAEO,UAAU2B,EAAmBC,EAAyB,CAC3D,OAAO,YAA6C1B,EAAW,CAC7D,OAAA0B,EAAa,EACN,QAAQ,MAAMD,EAAK,KAAMzB,CAAI,CACtC,CACF,GA1KFP,GAAA,uBAAAC,2ZC3BAiC,GAAA,KAAAC,EAAA,EACAD,GAAA,KAAAC,EAAA,ICjBAC,IACA,IAAAC,GAAkB,UADlB,OAAOC,OAAa,eCApBC,IAEA,IAAAC,GAA8D,UAE9DC,GAAmB,UAJnB,OAAS,WAAAC,OAAe,YACxB,OAAS,kBAAAC,GAAgB,aAAAC,OAAiB,UCD1CC,IACA,IAAAC,GAA2B,UAC3BC,GAAmB,UAEZ,SAASC,GAAiBC,EAAmC,CAClE,GAAI,cAAW,YAAYA,CAAK,EAC9B,OAAOA,EAGT,IAAMC,EAAcD,aAAiB,MAAQ,GAAAE,QAAO,MAAMF,CAAK,EAAI,KACnE,OAAOC,EAAcF,GAAiBE,CAAW,EAAI,IACvD,CCXAE,IAEO,SAASC,GAAiBC,EAAuB,CACtD,MAAO,CACL,QAAS,CACP,QAASA,EAAU,OAAO,QAC1B,IAAKA,EAAU,OAAO,IACtB,OAAQA,EAAU,OAAO,OACzB,QAASA,EAAU,OAAO,QAC1B,KAAMA,EAAU,OAAO,IACzB,EACA,SAAU,CACR,KAAMA,EAAU,KAChB,QAASA,EAAU,QACnB,OAAQA,EAAU,UAAU,OAC5B,QAASA,EAAU,UAAU,QAC7B,KAAMA,EAAU,UAAU,IAC5B,CACF,CACF,CFZO,SAASC,GAAiBC,EAAoBC,EAAgB,CACnE,GAAI,CACF,IAAIC,EAAU,6BAA6B,IAAI,KAAK,EAAE,YAAY,CAAC;AAAA,EACnE,GAAID,aAAiB,MAAO,CAC1BC,GAAW;AAAA,EACXA,GAAW,GAAG,GAAAC,QAAO,UAAUF,CAAK,CAAC;AAAA,EACrCC,GAAW;AAAA,EACXA,GAAW,GAAG,KAAK,UAAU,GAAAC,QAAO,KAAKF,CAAK,EAAG,KAAM,CAAC,CAAC;AAAA,EAEzD,IAAMG,EAAYC,GAAiBJ,CAAK,EACpCG,IACFF,GAAW;AAAA,EACXA,GAAW,GAAG,KAAK,UAAUI,GAAiBF,CAAS,EAAG,KAAM,CAAC,CAAC;AAAA,EAEtE,CACAG,GAAUC,GAAQR,CAAU,EAAG,CAAE,UAAW,EAAK,CAAC,EAClDS,GAAeT,EAAYE,CAAO,CACpC,MAAQ,CAER,CACF,CAIA,IAAMQ,MAAkB,kBAAsC,IAAI,EG/BlEC,IAAA,IAAAC,GAAuC,UCAvCC,IACA,IAAAC,EAAkB,UAClBC,GAAsB,UCAtBC,IACA,SAASC,IAAI,SAACC,EAAA,CAAA,EAAAC,EAAA,EAAAA,EAAA,UAAA,OAAAA,IAAAD,EAAAC,CAAA,EAAA,UAAAA,CAAA,CAAsB,CACpC,SAASC,IAAa,CACpB,OAAI,OAAO,QAAY,IACd,IAAI,QAEJC,GAAY,CAEvB,CAaA,SAASA,IAAY,CACnB,MAAO,CACL,IAAKJ,GACL,OAAQA,GACR,IAAKA,GACL,IAAKA,GACL,IAAA,SAAIK,EAAI,CACN,MAAO,EACT,EAEJ,CAGA,IAAMC,GAAM,OAAO,UAAU,eACvBC,GAAM,SAAUC,EAAaC,EAAY,CAC7C,OAAOH,GAAI,KAAKE,EAAKC,CAAI,CAC3B,EAGA,SAASC,GAA4BC,EAAWC,EAAS,CAEvD,QAAWH,KAAQG,EACbL,GAAIK,EAAQH,CAAI,IACjBE,EAAeF,CAAI,EAAIG,EAAOH,CAAI,GAGvC,OAAOE,CACT,CAEA,IAAME,GAAmB,wBACnBC,GAAoB,wBACpBC,GAA+B,gBAC/BC,GAAsB,yCACtBC,GAAwC,2BAE9C,SAASC,GACPC,EACAC,EACAC,EAAgB,CAIhB,IAAIC,EAAmB,EAEjBC,EAAQJ,EAAQ,CAAC,EAAE,MAAMH,EAAmB,EAC9CO,IACFD,EAAmBC,EAAM,CAAC,EAAE,QAG9B,IAAMC,EAAW,uBAAuBF,EAAgB,IAClDG,EAAgB,IAAI,OAAOD,EAAU,GAAG,EAE1CJ,IACFD,EAAUA,EAAQ,MAAM,CAAC,GAGnB,IAAAO,EAAqDL,EAAO,QAAnDM,EAA4CN,EAAO,mBAA/BO,EAAwBP,EAAO,oBAC9DQ,EAAoB,OAAOH,GAAY,SACvCI,EAAIX,EAAQ,OACZY,EAAmBZ,EAAQ,IAAI,SAACa,EAAGC,EAAC,CAExC,OAAAD,EAAIA,EAAE,QAAQP,EAAe,IAAI,EAE7BQ,IAAM,GAAKN,IACbK,EAAIA,EAAE,QAAQnB,GAAkB,EAAE,GAGhCoB,IAAMH,EAAI,GAAKF,IACjBI,EAAIA,EAAE,QAAQlB,GAAmB,EAAE,GAGjCe,IACFG,EAAIA,EAAE,QAAQ,cAAe,SAACE,EAAC,CAAK,OAAAR,CAAA,CAAiB,GAEhDM,CACT,CAAC,EACD,OAAOD,CACT,CAEA,SAASI,GACPhB,EACAiB,EAA0B,CAG1B,QADIC,EAAM,GACDJ,EAAI,EAAGH,EAAIX,EAAQ,OAAQc,EAAIH,EAAGG,IACzCI,GAAOlB,EAAQc,CAAC,EACZA,EAAIH,EAAI,IACVO,GAAOD,EAAOH,CAAC,GAGnB,OAAOI,CACT,CAEA,SAASC,GAAuBN,EAAM,CACpC,OAAOzB,GAAIyB,EAAG,KAAK,GAAKzB,GAAIyB,EAAG,QAAQ,CACzC,CAQA,SAASO,GAAelB,EAAgB,CAEtC,IAAMmB,EAAuBrC,GAAa,EAQpCsC,EAAkCtC,GAAa,EAWrD,SAASuC,EACPC,EAAgD,SAChDP,EAAA,CAAA,EAAAlC,EAAA,EAAAA,EAAA,UAAA,OAAAA,IAAAkC,EAAAlC,EAAA,CAAA,EAAA,UAAAA,CAAA,EAGA,GAAIoC,GAAuBK,CAAgB,EAAG,CAC5C,IAAMxB,EAAUwB,EAGVvB,GACHgB,EAAO,CAAC,IAAMM,GAAWN,EAAO,CAAC,IAAMQ,KACxC3B,GAAsC,KAAKE,EAAQ,CAAC,CAAC,GACrDJ,GAA6B,KAAKI,EAAQ,CAAC,CAAC,EAGxC0B,EAAQzB,EACVqB,EACAD,EACAM,EAAgBD,EAAM,IAAI1B,CAAO,EAUrC,GATK2B,IACHA,EAAgB5B,GACdC,EACAC,EACAC,CAAO,EAETwB,EAAM,IAAI1B,EAAS2B,CAAa,GAG9BV,EAAO,SAAW,EACpB,OAAOU,EAAc,CAAC,EAGxB,IAAMC,EAAWZ,GACfW,EACA1B,EAA6CgB,EAAO,MAAM,CAAC,EAAIA,CAAM,EAGvE,OAAOW,MAGP,QAAOR,GACL7B,GAAOA,GAAO,CAAA,EAAIW,CAAO,EAAGsB,GAAoB,CAAA,CAAE,CAAC,CAGzD,CAEA,IAAMK,EAActC,GAAOgC,EAAS,CAClC,OAAA,SAAOO,EAAW,CAChB,OAAO/B,GAAc,CAAC+B,CAAG,EAAG,GAAO5B,CAAO,EAAE,CAAC,CAC/C,EACD,EAED,OAAO2B,CACT,CAEA,IAAMJ,GAAiBL,GAAe,CACpC,mBAAoB,GACpB,oBAAqB,GACtB,EAmDD,GAAI,OAAO,OAAW,IAGpB,GAAI,CACF,OAAO,QAAUW,GACjB,OAAO,eAAeA,GAAgB,aAAc,CAAE,MAAO,EAAI,CAAE,EAClEA,GAAuB,QAAUA,GACjCA,GAAuB,QAAUA,QACxB,CAAA,CCxQdC,IAAA,IAAAC,GAAkB,UAIX,IAAMC,EAIR,CAAC,CAAE,QAAAC,EAAS,YAAAC,EAAa,KAAAC,CAAK,IACjC,GAAAC,QAAA,cAACC,GAAA,CAAI,cAAc,UACjB,GAAAD,QAAA,cAACE,GAAA,CAAM,KAAK,SAASL,CAAQ,EAE5BC,GAAe,GAAAE,QAAA,cAACE,GAAA,CAAM,KAAK,WAAWJ,CAAY,EAElDC,GACC,GAAAC,QAAA,cAACC,GAAA,CAAI,WAAY,EAAG,UAAW,GAC7B,GAAAD,QAAA,cAACG,GAAA,IAAY,EACZ,OAAOJ,GAAS,SAAW,GAAAC,QAAA,cAACI,EAAA,KAAML,CAAK,EAAUA,CACpD,CAEJ,EAGWM,EAIR,CAAC,CAAE,QAAAR,EAAS,YAAAC,EAAa,KAAAC,CAAK,IACjC,GAAAC,QAAA,cAACJ,EAAA,CACC,QAASC,EACT,YAAaC,EACb,KACEC,GACA,oFAEJ,EF1BK,SAASO,GAAkBC,EAAuC,CACvE,SAAO,UAAMA,EAAM,CACjB,eAAgB,CAAC,CAAE,MAAAC,CAAM,IAChB,IACL,EAAAC,QAAA,gBAAAA,QAAA,cACE,EAAAA,QAAA,cAACC,EAAA,CAAK,KAAK,SAAQ,4DAEnB,EAECF,aAAiB,MAChB,EAAAC,QAAA,cAACC,EAAA,CAAK,KAAK,SAASF,EAAM,OAAQ,EAElC,EAAAC,QAAA,cAACC,EAAA,KAAM,KAAK,UAAUF,CAAK,CAAE,CAEjC,EAGJ,sBAAuB,IACd,IACL,EAAAC,QAAA,cAACE,EAAA,CAAmB,QAAQ,yEAAyE,EAGzG,qBAAsB,IACb,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,mEAAmE,EAGnG,4BAA6B,IACpB,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,4EAA4E,EAG5G,uBAAwB,IACf,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,gCAAgC,EAGhE,mCAAoC,CAAC,CAAE,OAAAC,CAAO,IACrC,IACL,EAAAH,QAAA,cAACI,EAAA,CACC,QAAS,0DAA0DD,CAAM,0BACzE,KAAK,4DACP,EAGJ,0CAA2C,IAClC,IACL,EAAAH,QAAA,cAACI,EAAA,CACC,QAAQ,+DACR,KAAK,gDACP,EAGJ,2BAA4B,CAAC,CAAE,MAAAC,CAAM,IAC5B,IACL,EAAAL,QAAA,cAACE,EAAA,CACC,QAAQ,2EACR,YAAa,yCAAyCG,CAAK,GAC7D,EAGJ,yBAA0B,IACjB,IACL,EAAAL,QAAA,cAACE,EAAA,CAAmB,QAAQ,gCAAgC,EAGhE,4BAA6B,CAAC,CAAE,MAAAI,EAAO,cAAAC,CAAc,IAAM,CACzD,IAAMC,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,oCAAoCG,CAAa,YAAYC,CAAY,GACpF,CAEJ,EACA,iCAAkC,CAAC,CACjC,eAAAE,EACA,cAAAC,EACA,cAAAC,CACF,IACS,IACL,EAAAZ,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,gBAAAA,QAAA,cAAE,oEAECW,EAAc,QAAK,EAAAX,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,iBAAe,EAAO,aAAW,IAC/DS,EAAe,GAClB,EAEF,KACE,EAAAV,QAAA,cAACC,EAAA,KAAK,iDAEJ,EAAAD,QAAA,cAACa,GAAA,IAAQ,EACT,EAAAb,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEW,CAAc,EAC1B,EAAAZ,QAAA,cAACa,GAAA,IAAQ,EAAE,oEAEb,EAEJ,EAGJ,oCAAqC,CAAC,CAAE,OAAAC,CAAO,IACtC,IACL,EAAAd,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,gBAAAA,QAAA,cAAE,uDACqD,IACrD,EAAAA,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEa,CAAO,EAAO,iCAC5B,EAEF,KACE,EAAAd,QAAA,cAACC,EAAA,KAAK,yDACmD,IACvD,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEa,CAAO,EAAO,SAC5B,EAEJ,EAGJ,sBAAuB,CAAC,CAAE,YAAAC,EAAa,YAAAC,CAAY,IAC1C,IACL,EAAAhB,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,gBAAAA,QAAA,cAAE,4EAEU,EAAAA,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,cAAY,EAAO,IAAC,EAAAD,QAAA,cAACa,GAAA,IAAQ,EAAE,YAC3C,EAAAb,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEc,CAAY,EAAO,qCAExC,EAAAf,QAAA,cAACa,GAAA,IAAQ,EACRG,EAAY,IAAI,CAACC,EAAYC,IAC5B,EAAAlB,QAAA,cAACC,EAAA,CAAK,IAAKiB,GACT,EAAAlB,QAAA,cAACa,GAAA,IAAQ,EAAE,KAAGI,CAChB,CACD,CACH,EAEF,KAAM,qEACR,EAGJ,qBAAsB,IACb,IACL,EAAAjB,QAAA,cAACI,EAAA,CACC,QAAS,kDACX,EAGJ,oBAAqB,IACZ,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAS,sBAAuB,EAE7D,0BAA2B,CAAC,CAAE,mBAAAe,CAAmB,IACxC,IACL,EAAAnB,QAAA,cAACI,EAAA,CACC,QAAS,yEACT,KAAM,4BACJe,EACI,OAAOA,CAAkB,GACzB,oCACN,GACF,EAGJ,oCAAqC,CAAC,CAAE,mBAAAA,CAAmB,IAClD,IACL,EAAAnB,QAAA,cAACI,EAAA,CACC,QAAS,+BAA+Be,CAAkB,+BAC5D,EAGJ,yBAA0B,IACjB,IACL,EAAAnB,QAAA,cAACE,EAAA,CAAmB,QAAQ,8CAA8C,EAG9E,2BAA4B,IACnB,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,6CAA6C,EAG7E,qBAAsB,IACb,IAAM,EAAAF,QAAA,cAACI,EAAA,CAAa,QAAQ,0BAA0B,EAE/D,qBAAsB,IACb,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,0BAA0B,EAE/D,qBAAsB,CAAC,CAAE,OAAAD,CAAO,IACvB,IAEH,EAAAH,QAAA,cAACI,EAAA,CACC,QAAS,sCAAsCD,CAAM,GACvD,EAIN,oBAAqB,CAAC,CAAE,MAAAiB,CAAM,IACrB,IAEH,EAAApB,QAAA,cAACI,EAAA,CACC,QAAS,6CAA6CgB,CAAK,GAC7D,EAIN,8BAA+B,IACtB,IACL,EAAApB,QAAA,cAACI,EAAA,CAAa,QAAQ,yCAAyC,EAGnE,uBAAwB,CAAC,CAAE,YAAAW,EAAa,MAAAT,CAAM,IAAM,CAClD,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,iCAAiCW,CAAW,YAAYP,CAAY,GAC/E,CAEJ,EACA,+BAAgC,IACvB,IACL,EAAAR,QAAA,cAACE,EAAA,CAAmB,QAAQ,qCAAqC,EAGrE,wBAAyB,CAAC,CAAE,MAAAI,CAAM,IAAM,CACtC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,0CAA0CI,CAAY,GACjE,CAEJ,EACA,wBAAyB,IAChB,IACL,EAAAR,QAAA,cAACI,EAAA,CACC,QAAS,EAAAJ,QAAA,gBAAAA,QAAA,cAAE,uCAAqC,EAChD,KACE,EAAAA,QAAA,cAACC,EAAA,KAAK,+FAGN,EAEJ,EAGJ,kBAAmB,CAAC,CAAE,eAAAS,CAAe,IAC5B,IACL,EAAAV,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,gBAAAA,QAAA,cACG,gCAAgCU,CAAc,OAC/C,EAAAV,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,aAAW,EAAO,GAC/B,EAEF,KAAM,kDACR,EAGJ,yBAA0B,CAAC,CAAE,YAAAc,EAAa,MAAAT,CAAM,IAAM,CACpD,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,mCAAmCW,CAAW,YAAYP,CAAY,GACjF,CAEJ,EACA,uBAAwB,CAAC,CAAE,SAAAa,CAAS,IAC3B,IACL,EAAArB,QAAA,cAACI,EAAA,CACC,QAAS,gDAAgDiB,CAAQ,GACnE,EAGJ,sBAAuB,IACd,IACL,EAAArB,QAAA,cAACI,EAAA,CAAa,QAAQ,gDAAgD,EAG1E,kBAAmB,CAAC,CAAE,KAAAkB,CAAK,IAClB,IACL,EAAAtB,QAAA,cAACI,EAAA,CAAa,QAAS,gCAAgCkB,CAAI,IAAK,EAGpE,mBAAoB,CAAC,CAAE,KAAAA,CAAK,IACnB,IACL,EAAAtB,QAAA,cAACI,EAAA,CAAa,QAAS,iCAAiCkB,CAAI,IAAK,EAGrE,wBAAyB,IAChB,IAAM,EAAAtB,QAAA,cAACI,EAAA,CAAa,QAAQ,mCAAmC,EAExE,mBAAoB,IACX,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,gGAAgG,EAG1H,+BAAgC,IACvB,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,gCAAgC,EAErE,iBAAkB,CAAC,CAAE,SAAAmB,EAAU,MAAAjB,CAAM,IAAM,CACzC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,kBAAkBmB,CAAQ,YAAYf,CAAY,GAC7D,CAEJ,EACA,gBAAiB,CAAC,CAAE,SAAAe,EAAU,MAAAjB,CAAM,IAAM,CACxC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,gCAAgCmB,CAAQ,YAAYf,CAAY,GAC3E,CAEJ,EACA,qBAAsB,IACb,IAAM,EAAAR,QAAA,cAACI,EAAA,CAAa,QAAS,6BAA8B,EAEpE,sBAAuB,CAAC,CAAE,eAAAoB,EAAgB,MAAAlB,CAAM,IAAM,CACpD,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,WAAWoB,CAAc,iDAAiDhB,CAAY,GACjG,CAEJ,EACA,4BAA6B,CAAC,CAAE,WAAAiB,CAAW,IAClC,IACL,EAAAzB,QAAA,cAACI,EAAA,CACC,QAAS,sCAAsCqB,CAAU,GAC3D,EAGJ,6BAA8B,CAAC,CAAE,WAAAA,CAAW,IACnC,IACL,EAAAzB,QAAA,cAACI,EAAA,CACC,QAAS,uCAAuCqB,CAAU,GAC5D,EAGJ,4BAA6B,CAAC,CAAE,WAAAA,CAAW,IAClC,IACL,EAAAzB,QAAA,cAACI,EAAA,CACC,QAAS,mCAAmCqB,CAAU,GACxD,EAGJ,kBAAmB,IACV,IACL,EAAAzB,QAAA,cAACI,EAAA,CACC,QAAQ,oDACR,YAAY,kDACZ,KAAK,0IACP,EAGJ,sBAAuB,CAAC,CAAE,OAAAsB,CAAO,IACxB,IACL,EAAA1B,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,gBAAAA,QAAA,cAAE,MACG,EAAAA,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,OAAK,EAAO,6BAA2B,IACrD,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEyB,CAAO,EAAO,GAC5B,EAEF,KACE,EAAA1B,QAAA,cAACC,EAAA,KAAK,2DACqD,IACzD,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,OAAK,EAAO,oBAAiB,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEyB,CAAO,EAAO,GAEpE,EAEJ,EAGJ,8BAA+B,CAAC,CAAE,WAAAD,CAAW,IACpC,IACL,EAAAzB,QAAA,cAACI,EAAA,CACC,QAAS,wCAAwCqB,CAAU,GAC7D,EAGJ,kCAAmC,CAAC,CAAE,WAAAA,CAAW,IACxC,IACL,EAAAzB,QAAA,cAACI,EAAA,CACC,QAAS,6CAA6CqB,CAAU,GAClE,EAGJ,4BAA6B,CAAC,CAAE,WAAAA,CAAW,IAClC,IACL,EAAAzB,QAAA,cAACI,EAAA,CACC,QAAS,sCAAsCqB,CAAU,GAC3D,EAGJ,6BAA8B,CAAC,CAAE,WAAAA,CAAW,IACnC,IACL,EAAAzB,QAAA,cAACI,EAAA,CACC,QAAS,uCAAuCqB,CAAU,GAC5D,EAGJ,yBAA0B,CAAC,CAAE,WAAAA,EAAY,SAAAE,CAAS,IACzC,IACL,EAAA3B,QAAA,cAACI,EAAA,CACC,QAASwB;AAAA,+CAC4BH,CAAU;AAAA;AAAA,cAE3CE,EAAS,OAAO,IAAIE,EAAc,EAAE,KAAK;AAAA,CAAI,CAAC,GAClD,KAAK,2EACP,EAGJ,iCAAkC,CAAC,CAAE,mBAAAC,EAAoB,SAAAH,CAAS,IACzD,IACL,EAAA3B,QAAA,cAACI,EAAA,CACC,QAASwB;AAAA,iDAC8BE,CAAkB;AAAA;AAAA,cAErDH,EAAS,OAAO,IAAIE,EAAc,EAAE,KAAK;AAAA,CAAI,CAAC,GAClD,KAAK,4EACP,EAGJ,mCAAoC,CAAC,CAAE,KAAAP,EAAM,SAAAK,CAAS,IAC7C,IACL,EAAA3B,QAAA,cAACI,EAAA,CACC,QAASwB;AAAA,+CAC4BN,CAAI;AAAA;AAAA,cAErCK,EAAS,OAAO,IAAIE,EAAc,EAAE,KAAK;AAAA,CAAI,CAAC,GAClD,KACE,EAAA7B,QAAA,cAACC,EAAA,KAAK,qBACc,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,cAAY,EAAO,aAClD,EAEJ,EAGJ,iBAAkB,IACT,IACL,EAAAD,QAAA,cAACI,EAAA,CAAa,QAAQ,2CAA2C,EAGrE,yBAA0B,CAAC,CAAE,MAAAE,CAAM,IAAM,CACvC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,kGAAkGI,CAAY,GACzH,CAEJ,EACA,qCAAsC,IAC7B,IACL,EAAAR,QAAA,cAACI,EAAA,CACC,QAAQ,+FACR,KAAK,4FACP,EAGJ,+BAAgC,CAAC,CAAE,sBAAA2B,EAAuB,UAAAC,CAAU,IAAM,CACxE,IAAIC,EACF,yEAEF,OAAIF,GAAuB,MAAM,SAC/BE,GAAgB,KACdF,EAAsB,YACxB,QAAQA,EAAsB,MAC3B,IAAKG,GAAM,GAAGF,EAAUE,EAAE,SAAS,CAAC,KAAKA,EAAE,YAAY,KAAK,EAC5D,KAAK,IAAI,CAAC,IAGR,IAAM,EAAAlC,QAAA,cAACI,EAAA,CAAa,QAAS6B,EAAc,CACpD,EACA,2BAA4B,IACnB,IACL,EAAAjC,QAAA,cAACI,EAAA,CACC,QAASwB;AAAA;AAAA;AAAA;AAAA,YAKX,EAGJ,mBAAoB,CAAC,CAAE,MAAAtB,CAAM,IAAM,CACjC,IAAME,EAAeC,GAAgBH,CAAK,EAE1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,iCAAiCI,CAAY,GACxD,CAEJ,EACA,sBAAuB,CAAC,CAAE,MAAAT,CAAM,IACvB,IACL,EAAAC,QAAA,cAACI,EAAA,CACC,QAAQ,4CACR,YAAaL,EACf,EAGJ,mBAAoB,IACX,IACL,EAAAC,QAAA,cAACI,EAAA,CAAa,QAAQ,qGAAqG,EAG/H,2BAA4B,CAAC,CAAE,OAAA+B,CAAO,IAAM,CAC1C,IAAMC,EAAQ,CAAC,CAAE,MAAAC,CAAM,IAAqC,CAC1D,IAAMC,EAAcC,MAClB,UAAMA,EAAM,CACV,KAAM,IAAM,OACZ,OAAQ,IAAM,SACd,cAAe,IAAM,cACrB,mBAAoB,IAAM,mBAC1B,kBAAmB,IAAM,kBACzB,iBAAkB,IAAM,iBACxB,MAAO,IAAM,QACb,SAAU,IAAM,UAClB,CAAC,EACH,OACE,EAAAvC,QAAA,cAACwC,GAAA,CAAI,cAAc,UACjB,EAAAxC,QAAA,cAACC,EAAA,KACC,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,gBAAc,EACxBoC,EAAM,EACT,EACA,EAAArC,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,aAAW,EACrBoC,EAAM,WAAW,IAAI,CAAC,CAAE,KAAAI,EAAM,KAAAnB,EAAM,KAAAiB,CAAK,IACxC,EAAAvC,QAAA,cAACC,EAAA,CAAK,IAAKqB,GAAM,IACbgB,EAAWC,CAAI,EAAE,KAAGE,EAAK,KAAGnB,EAAK,GACrC,CACD,EACD,EAAAtB,QAAA,cAACC,EAAA,KACC,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,iBAAe,EACzBoC,EAAM,WACT,CACF,CAEJ,EACMK,EACJ,EAAA1C,QAAA,cAACwC,GAAA,CAAI,cAAc,SAAS,OAAQ,GAClC,EAAAxC,QAAA,cAACC,EAAA,KAAK,oFAGN,EACCkC,EAAO,IAAKE,GACX,EAAArC,QAAA,cAACoC,EAAA,CAAM,MAAOC,EAAO,IAAKA,EAAM,GAAI,CACrC,CACH,EAGF,MAAO,IACL,EAAArC,QAAA,cAACI,EAAA,CACC,QAAQ,2FACR,KAAMsC,EACR,CAEJ,EACA,oBAAqB,IACZ,IACL,EAAA1C,QAAA,cAACE,EAAA,CAAmB,QAAQ,uCAAuC,EAGvE,yBAA0B,IACjB,IACL,EAAAF,QAAA,cAACI,EAAA,CAAa,QAAQ,4CAA4C,EAGtE,yBAA0B,IACjB,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,sGAAsG,EAGhI,6BAA8B,IACrB,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,gEAAgE,EAG1F,qBAAsB,IACb,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,gCAAgC,EAErE,uBAAwB,IACf,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,4BAA4B,EAEjE,yBAA0B,IACjB,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,oDAAoD,EAG9E,yBAA0B,CAAC,CAAE,SAAAuC,CAAS,IAC7B,IACL,EAAA3C,QAAA,cAACI,EAAA,CACC,QAAS,kBAAkBuC,CAAQ,wBACrC,EAGJ,gCAAiC,IACxB,IACL,EAAA3C,QAAA,cAACI,EAAA,CAAa,QAAQ,sCAAsC,EAGhE,gCAAiC,IACxB,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,sCAAsC,EAGhE,qBAAsB,CAAC,CAAE,cAAAwC,CAAc,IAC9B,IACL,EAAA5C,QAAA,cAACI,EAAA,CACC,QAAS,6BAA6BwC,CAAa,KACrD,EAGJ,6BAA8B,IACrB,IAAM,EAAA5C,QAAA,cAACI,EAAA,CAAa,QAAQ,mCAAmC,EAExE,sBAAuB,IACd,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,2BAA2B,EAEhE,kCAAmC,IAC1B,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,8CAA8C,EAGxE,oBAAqB,IACZ,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,kCAAkC,EAEvE,qBAAsB,IACb,IACL,EAAAJ,QAAA,cAACE,EAAA,CAAmB,QAAQ,qCAAqC,EAGrE,8BAA+B,IACtB,IACL,EAAAF,QAAA,cAACI,EAAA,CAAa,QAAQ,sCAAsC,EAGhE,4BAA6B,IACpB,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,uCAAuC,EAGjE,iCAAkC,IACzB,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,6CAA6C,EAGvE,wBAAyB,IAChB,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,mCAAmC,EAExE,yBAA0B,IACjB,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,gCAAgC,EAErE,uBAAwB,IACf,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,8BAA8B,EAEnE,mBAAoB,IACX,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,gCAAgC,EAErE,gBAAiB,IACR,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,mEAAmE,EAG7F,mBAAoB,IACX,IAAM,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,yBAAyB,EAE9D,0BAA2B,IAClB,IAAM,EAAAJ,QAAA,cAACE,EAAA,CAAmB,QAAQ,0BAA0B,EAErE,4BAA6B,CAAC,CAAE,KAAAoB,CAAK,IAC5B,IACL,EAAAtB,QAAA,cAACI,EAAA,CACC,QAAQ,+CACR,KAAM,mBAAmBkB,CAAI,mDAC/B,EAGJ,iBAAkB,CAAC,CAAE,MAAAhB,CAAM,IAAM,CAC/B,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,gBAAAA,QAAA,cAAE,mCAEA,EAAAA,QAAA,cAACa,GAAA,IAAQ,EACRL,CACH,EAEF,KAAM,qDACR,CAEJ,EACA,4BAA6B,IACpB,IACL,EAAAR,QAAA,cAACI,EAAA,CAAa,QAAQ,4CAA4C,EAGtE,0BAA2B,CAAC,CAAE,MAAAE,CAAM,IAAM,CACxC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,yCAAyCI,CAAY,GAChE,CAEJ,EACA,4BAA6B,CAAC,CAAE,MAAAF,CAAM,IAAM,CAC1C,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,0CAA0CI,CAAY,GACjE,CAEJ,EACA,sBAAuB,CAAC,CAAE,MAAAF,CAAM,IAAM,CACpC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,oCAAoCI,CAAY,GAC3D,CAEJ,EACA,uBAAwB,CAAC,CAAE,MAAAF,CAAM,IAAM,CACrC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CAAa,QAAS,+BAA+BI,CAAY,GAAI,CAE1E,EACA,6BAA8B,CAAC,CAAE,MAAAF,CAAM,IAAM,CAC3C,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,sCAAsCI,CAAY,GAC7D,CAEJ,EACA,qBAAsB,CAAC,CAAE,MAAAF,CAAM,IAAM,CACnC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CAAa,QAAS,6BAA6BI,CAAY,GAAI,CAExE,EACA,2BAA4B,CAAC,CAAE,MAAAF,CAAM,IAAM,CACzC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,qCAAqCI,CAAY,GAC5D,CAEJ,EACA,kBAAmB,CAAC,CAAE,SAAAe,EAAU,MAAAjB,CAAM,IAAM,CAC1C,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,iCAAiCmB,CAAQ,YAAYf,CAAY,GAC5E,CAEJ,EACA,qBAAsB,CAAC,CAAE,aAAAqC,CAAa,IAC7B,IACL,EAAA7C,QAAA,cAACI,EAAA,CACC,QAAS,4BAA4ByC,CAAY,GACjD,KAAK,8DACP,EAGJ,kBAAmB,CAAC,CAAE,MAAAvC,CAAM,IAAM,CAChC,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,yBAAyBI,CAAY,GAC9C,KAAK,kHACP,CAEJ,EACA,cAAe,CAAC,CAAE,IAAAsC,CAAI,IACb,IACL,EAAA9C,QAAA,cAACI,EAAA,CACC,QAAS,oBAAoB0C,CAAG,GAChC,KAAK,iDACP,EAGJ,uBAAwB,IACf,IACL,EAAA9C,QAAA,cAACI,EAAA,CAAa,QAAQ,wDAAwD,EAGlF,uBAAwB,IACf,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,oHAAoH,EAG9I,+BAAgC,IACvB,IACL,EAAAJ,QAAA,cAACI,EAAA,CACC,QAAQ,8GACR,KACE,EAAAJ,QAAA,cAACC,EAAA,KAAK,8BACuB,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,eAAa,CACrD,EAEJ,EAGJ,sCAAuC,IAC9B,IACL,EAAAD,QAAA,cAACI,EAAA,CAAa,QAAQ,+DAA+D,EAGzF,uBAAwB,IACf,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,uHAAuH,EAGjJ,0BAA2B,IAClB,IACL,EAAAJ,QAAA,cAACI,EAAA,CAAa,QAAQ,oDAAoD,EAG9E,yBAA0B,IACjB,IACL,EAAAJ,QAAA,cAACE,EAAA,CAAmB,QAAQ,yCAAyC,EAGzE,yBAA0B,IACjB,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,yCAAyC,EAGzE,yBAA0B,IACjB,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,+BAA+B,EAG/D,8BAA+B,IACtB,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,iDAAiD,EAGjF,wCAAyC,IAChC,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,oCAAoC,EAGpE,sBAAuB,CAAC,CAAE,WAAA6C,EAAY,cAAAC,CAAc,IAC3C,IACL,EAAAhD,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,cAACC,EAAA,KAAK,mBACY,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,UAAQ,EAAO,KAAG8C,EAAW,QAAM,IAC9D,EAAA/C,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,cAAY,EAAO,KAAG+C,EAAc,6BAEjD,EAEF,KACE,EAAAhD,QAAA,cAACC,EAAA,KAAK,gCACyB,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,cAAY,EAAO,8BAE7D,EAEJ,EAGJ,uBAAwB,IACf,IACL,EAAAD,QAAA,cAACE,EAAA,CAAmB,QAAQ,kDAAkD,EAGlF,0BAA2B,CAAC,CAAE,MAAA+C,EAAO,aAAAhB,CAAa,IACzC,IACL,EAAAjC,QAAA,cAACI,EAAA,CACC,QAAS,iCAAiC6C,CAAK,GAC/C,KAAMhB,EACR,EAGJ,4BAA6B,CAAC,CAAE,KAAAX,EAAM,aAAAW,CAAa,IAC1C,IACL,EAAAjC,QAAA,cAACI,EAAA,CACC,QAAS,mCAAmCkB,CAAI,GAChD,KAAMW,EACR,EAGJ,8BAA+B,CAAC,CAAE,iBAAAiB,EAAkB,aAAAjB,CAAa,IACxD,IACL,EAAAjC,QAAA,cAACI,EAAA,CACC,QAAS,uCAAuC8C,CAAgB,GAChE,KAAMjB,EACR,EAGJ,4BAA6B,CAAC,CAAE,QAAAkB,EAAS,aAAAlB,CAAa,IAC7C,IACL,EAAAjC,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,cAACC,EAAA,KAAK,yEAEW,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEkD,CAAQ,EAAO,gCACjClB,CACX,EAEF,KACE,EAAAjC,QAAA,cAACC,EAAA,KAAK,uCACiC,IACrC,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,0GAEX,CACF,EAEJ,EAGJ,kCAAmC,CAAC,CAAE,YAAAc,EAAa,aAAAqC,CAAa,IACvD,IACL,EAAApD,QAAA,cAACI,EAAA,CACC,QACE,EAAAJ,QAAA,cAACC,EAAA,KAAK,WACI,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEc,CAAY,EAAO,iCACjC,EAAAf,QAAA,cAACC,EAAA,CAAK,KAAI,IAAEmD,CAAa,EAAO,WAAS,IAC/C,EAAApD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,cAAY,EAAO,QAChC,EAEF,KACE,EAAAD,QAAA,cAACC,EAAA,KAAK,gCAC0B,IAC9B,EAAAD,QAAA,cAACC,EAAA,CAAK,KAAI,IAAC,qBAAmB,EAAO,+CAErC,EAAAD,QAAA,cAACa,GAAA,IAAQ,EAAE,2BACc,IACzB,EAAAb,QAAA,cAACqD,GAAA,CAAK,IAAI,mDAAmD,CAC/D,EAEJ,EAGJ,2BAA4B,IACnB,IACL,EAAArD,QAAA,cAACE,EAAA,CAAmB,QAAQ,+CAA+C,EAG/E,6BAA8B,IACrB,IAAM,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,8BAA8B,EAEzE,4BAA6B,IACpB,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,kCAAkC,EAGlE,aAAc,CAAC,CAAE,MAAAI,CAAM,IAAM,CAC3B,IAAME,EAAeC,GAAgBH,CAAK,EAC1C,MAAO,IACL,EAAAN,QAAA,cAACI,EAAA,CACC,QAAS,kCAAkCI,CAAY,GACvD,KAAM,0EACR,CAEJ,EACA,oCAAqC,IAC5B,IACL,EAAAR,QAAA,cAACE,EAAA,CAAmB,QAAQ,mDAAmD,EAGnF,iBAAkB,IACT,IACL,EAAAF,QAAA,cAACE,EAAA,CAAmB,QAAQ,sCAAsC,EAGtE,sBAAuB,CAAC,CAAE,QAAAoD,CAAQ,IACzB,IACL,EAAAtD,QAAA,cAACI,EAAA,CACC,QAAS,+DAA+DkD,CAAO,IAC/E,KAAM,mDACR,EAGJ,2BAA4B,IACnB,IACL,EAAAtD,QAAA,cAACE,EAAA,CAAmB,QAAS,oCAAqC,EAGtE,qBAAsB,IACb,IACL,EAAAF,QAAA,cAACE,EAAA,CACC,QAAS,6CACX,EAGJ,6BAA8B,IACrB,IACL,EAAAF,QAAA,cAACI,EAAA,CAAa,QAAS,qCAAsC,EAGjE,wBAAyB,IAChB,IACL,EAAAJ,QAAA,cAACI,EAAA,CACC,QAAS,4DACT,KAAM,kCACR,EAGJ,gCAAiC,CAAC,CAAE,KAAAkB,CAAK,IAChC,IACL,EAAAtB,QAAA,cAACI,EAAA,CACC,QAAS,yCAAyCkB,CAAI,IACtD,KAAM,4CACR,EAGJ,sBAAuB,IACd,IACL,EAAAtB,QAAA,cAACI,EAAA,CAAa,QAAS,8CAA+C,EAG1E,mCAAoC,IAC3B,IACL,EAAAJ,QAAA,cAACI,EAAA,CACC,QAAS,mDACX,EAGJ,qBAAsB,CAAC,CAAE,KAAAqC,CAAK,IACrB,IACL,EAAAzC,QAAA,cAACI,EAAA,CACC,QAAS,6CAA6CqC,CAAI,KAC5D,EAGJ,2BAA4B,CAAC,CAAE,aAAAc,CAAa,IACnC,IACL,EAAAvD,QAAA,cAACI,EAAA,CACC,QAAS,0CAA0CmD,CAAY,KACjE,EAGJ,sBAAuB,IACd,IACL,EAAAvD,QAAA,cAACI,EAAA,CACC,QAAS,kEACT,KAAM,uFACR,CAGN,CAAC,CACH,CAEA,SAASK,GAAgBH,EAAgB,CACvC,OAAOA,aAAiB,MAAQA,EAAM,QAAU,KAAK,UAAUA,CAAK,CACtE,CAEA,SAASuB,GAAeQ,EAAiB,CACvC,IAAMf,EAAOe,EAAM,KAAK,KAAK,GAAG,EAEhC,OAAKf,EAIE,OAAOA,CAAI,OAAOe,EAAM,OAAO,GAH7B,KAAKA,EAAM,OAAO,EAI7B,CD/hCO,IAAMmB,GAAyB,CAAC,CACrC,MAAOC,EACP,oBAAAC,CACF,OACS,YAAQ,IAAM,CACnB,IAAMC,EAAQC,GAAeH,CAAa,EAE1C,OAAOI,GAAiBF,CAAK,GAAKD,EAC9BA,KACA,kBAAcI,GAAkBH,EAAM,OAAO,CAAC,CACpD,EAAG,CAACF,EAAeC,CAAmB,CAAC,EIpBzCK,IAAA,IAAAC,GAAwC,UCAxCC,2CKKO,IAAMC,GAAyB,aACzBC,GAAoC,wBACpCC,GAA2C,+BAGjD,IAAMC,GAA4BC,GAAiB,eAAe,EAE5DC,GAA0CD,GAAiB,6BAA6B,EAExFE,GAAoCF,GAAiB,uBAAuB,EAE5EG,GAA8CH,GAAiB,iCAAiC,ECHtG,SAASI,GAAqBC,EAA6C,CAChF,OAAOA,EAAQ,SAASC,EAAyB,CACnD,CIHO,SAASC,GAAe,CAC7B,aAAAC,EACA,IAAAC,EACA,QAAAC,CACF,EAIe,CAEb,IAAMC,EAAYF,EAAMG,GAA4CH,CAAG,EAAI,OAMrEI,EAAiB,IAAIC,GAAY,EAAC,IAAIC,GAAmCP,GAAgB,EAAE,EAE3FQ,EAAoBL,EAAYE,EAAe,IAAII,GAAwBN,CAAS,EAAIE,EAI9F,OAAOH,IAAY,GAAQM,EAAkB,IAAIE,GAA0C,GAAG,EAAIF,CACpG,CC1BO,SAASG,GAAyCC,EAAqD,CAE5G,IAAMC,EAAad,GAAe,CAChC,aAAca,EAAmB,aACjC,IAAKA,EAAmB,IACxB,QAASA,EAAmB,OAChC,CAAG,EAUD,MARiC,CAC/B,QAASA,EAAmB,QAC5B,OAAQA,EAAmB,cAAgB,GAC3C,SAAU,GACV,WAAYA,EAAmB,QAAUE,GAAW,QAAUA,GAAW,KACzE,WAAAD,CACJ,CAGA,CG1BA,SAAAE,GAAAC,EAAA,CAAA,IAAAC,EAAAC,EAAAF,EAAA,CAAA,EAAAG,EAAA,EAAA,KAAAA,EAAAH,EAAA,QAAA,CAAA,IAAAI,EAAAJ,EAAAG,CAAA,EAAAE,EAAAL,EAAAG,EAAA,CAAA,EAAA,GAAAA,GAAA,GAAAC,IAAA,kBAAAA,IAAA,iBAAAF,GAAA,KAAA,OAAAE,IAAA,UAAAA,IAAA,kBAAAH,EAAAC,EAAAA,EAAAG,EAAAH,CAAA,IAAAE,IAAA,QAAAA,IAAA,kBAAAF,EAAAG,EAAA,IAAAC,IAAAJ,EAAA,KAAAD,EAAA,GAAAK,CAAA,CAAA,EAAAL,EAAA,OAAA,CAAA,OAAAC,CAAA,CAYO,SAASK,GAAoBC,EAA+C,CACjF,GAAM,CAAE,WAAAC,EAAY,WAAAC,CAAW,EAAIF,EAE7BG,EAAsBD,EAAaA,EAAW,IAAIE,EAAwC,IAAM,IAAM,GAM5G,GAAIH,IAAeI,GAAW,QAC5B,MAAO,GAGT,GAAIF,EACF,MAAO,GAIT,IAAMG,EAAYJ,EAAaA,EAAW,IAAIK,EAAsB,EAAI,OAClEC,EAAMF,EAAYG,GAAsCH,CAAS,EAAI,OAE3E,GAAIf,GAAA,CAAAiB,EAAG,iBAAAE,GAAAA,EAAE,OAAQ,CAAA,IAAI,OACnB,MAAO,GAET,GAAInB,GAAA,CAAAiB,EAAG,iBAAAG,GAAAA,EAAE,OAAQ,CAAA,IAAI,QACnB,MAAO,EAIX,CEEO,SAASC,GAA8BC,EAAgC,CAC5E,IAAMC,EAAcD,EAAK,YAAW,EAC9B,CAAE,QAAAE,EAAS,OAAAC,EAAQ,WAAAC,CAAA,EAAeH,EAIlCI,EAAYD,EAAaA,EAAW,IAAIE,EAAsB,EAAI,OAClEC,EAAgBF,EAAYG,GAAsCH,CAAS,EAAI,OAE/EI,EAAeL,GAAaA,EAAW,IAAIM,EAAiC,GAAK,OAEjFC,EAAUC,GAAoBX,CAAW,EAGzCY,EAAMN,GAAiBO,GAAkCC,GAAYf,CAAI,CAAC,EAEhF,MAAO,CACL,QAAAE,EACA,OAAAC,EACA,QAAAQ,EACA,aAAAF,EACA,IAAAI,CACJ,CACA,CY3DO,SAASG,MAAmCC,EAA2C,CAC5FC,GAAyB,CACvB,iBAAAD,CACJ,CAAG,CACH,SCHO,SAASE,GAAkBC,EAA6B,CAC7D,IAAMC,EAASC,GAAqBC,GAAQ,OAAM,CAAE,EAChDF,IACFA,EAAO,eAAiBD,EAE5B,KCRO,SAASI,GAAgBC,EAAYC,EAA0B,CACpED,EAAK,aAAaE,GAAkCD,CAAM,CAC5D,CCLAE,IACO,SAASC,GAAcC,EAAwC,CACpE,IAAMC,EAAWD,EAAe,UAAY,GACtCE,EAAWF,EAAe,UAAYA,EAAe,MAAQ,GAG7DG,EACJ,CAACH,EAAe,MAAQA,EAAe,OAAS,IAAMA,EAAe,OAAS,KAAO,eAAe,KAAKE,CAAQ,EAC7G,GACA,IAAIF,EAAe,IAAI,GACCI,EAAAJ,EAAA,KAAAA,EAAA,KAAA,IACA,MAAA,GAAAC,CAAA,KAAAC,CAAA,GAAAC,CAAA,GAAAC,CAAA,EACA,CCUhC,IAAMC,GAAmB,OAwDrBC,GAA4B,CAAA,EAC5BC,GAMSC,GAAiB,OAAO,OACnC,UAAkB,CAChB,GAAID,GACF,OAGF,IAAME,EAAwBH,GAAa,kBAAoB,uBAE/DC,GAAuB,IAAIE,EAAsB,CAC/C,GAAGC,EAAA,CAAAJ,GAAa,SAAAK,GAAAA,EAAA,gBAAe,iBAAAC,GAAAA,EAAE,mBAAmB,CAAA,EACpD,0BAA2BC,GAAW,CACpC,IAAMC,EAAMC,GAAcF,CAAO,EAEjC,GAAI,CAACC,EACH,MAAO,GAGT,GAAIE,GAAmBF,EAAKG,GAAS,CAAE,EACrC,MAAO,GAGT,IAAMC,EAA0BZ,GAAa,uBAC7C,MAAI,GAAAY,GAA2BA,EAAwBJ,EAAKD,CAAO,EAKpE,EAED,0BAA2BA,GAAW,CAGpC,IAAMM,EAAUN,EAAQ,IAElBO,EAASV,EAAA,CAAAG,EAAO,SAAAQ,GAAAA,EAAC,OAAM,iBAAAC,GAAAA,EAAE,YAAW,OAAAC,GAAAA,EAAE,CAAA,CAAA,EAE5C,GAAIH,IAAW,WAAaA,IAAW,OACrC,MAAO,GAGT,IAAMI,EAA0BlB,GAAa,uBAC7C,MAAI,GAAAa,GAAWK,GAA2BA,EAAwBL,EAASN,CAAO,EAKnF,EAED,8BAA+B,GAC/B,8BAA+B,GAC/B,YAAa,CAACY,EAAMC,IAAQ,CAK1B,GAJAC,GAAgBF,EAAM,qBAAqB,EAIvCG,GAAiBF,CAAG,EAAG,CACzBhB,EAAA,CAAAJ,GAAa,SAAAuB,GAAAA,EAAA,gBAAiB,iBAAAC,GAAAA,EAAA,YAAW,eAAAC,GAAAA,EAAGN,EAAMC,CAAG,CAAC,CAAA,EACtD,MACF,CAEA,IAAMM,EAASC,GAAwBR,CAAI,EAErCS,GAAkBF,EAAO,gBAAkBG,GAAiB,GAAI,MAAK,EACrEC,EAAQJ,EAAO,OAASK,GAAe,EAG7CH,EAAe,yBAAyB,CAAE,QAASR,CAAK,CAAA,EAExD,IAAMY,EAASrB,GAAS,EACpBqB,GAAUA,EAAO,WAAU,EAAG,qBAChCJ,EAAe,kBAAkB,CAAE,OAAQ,IAAM,CAAA,EAEnDK,GAAkBL,CAAc,EAChCM,GAAwBf,EAAMW,EAAOF,CAAc,EAKnD,IAAMO,GAAcf,EAAI,QAAU,OAAO,YAAW,EAC9CgB,EAAaC,GAAyBjB,EAAI,KAAO,GAAG,EAEpDkB,EAA4B,GAACH,CAAA,IAAAC,CAAA,GAEAR,EAAA,mBAAAU,CAAA,EAEAlC,EAAA,CAAAJ,GAAA,SAAAuC,GAAAA,EAAA,gBAAA,iBAAAC,GAAAA,EAAA,YAAA,eAAAC,GAAAA,EAAAtB,EAAAC,CAAA,CAAA,CAAA,CACA,EACA,aAAA,CAAAD,EAAAuB,IAAA,CACA,IAAAV,EAAArB,GAAA,EACAqB,GAAAA,EAAA,WAAA,EAAA,qBACA,aAAA,IAAA,CACAA,EAAA,uBAAA,CACA,CAAA,EAGA5B,EAAA,CAAAJ,GAAA,SAAA2C,GAAAA,EAAA,gBAAA,iBAAAC,GAAAA,EAAA,aAAA,eAAAC,GAAAA,EAAA1B,EAAAuB,CAAA,CAAA,CAAA,CACA,EACA,4BAAA,CACAvB,EACAZ,EACAuC,IACA,EACA,OAAA9C,GAAA,YAAA,IAAA,GAAAA,GAAA,cAEA+C,GAAAxC,EAAAuC,CAAA,EAGA1C,EAAA,CAAAJ,GAAA,SAAAgD,GAAAA,EAAA,gBAAA,iBAAAC,GAAAA,EAAA,4BAAA,eAAAC,GAAAA,EAAA/B,EAAAZ,EAAAuC,CAAA,CAAA,CAAA,CACA,CACA,CAAA,EAEAK,GAAAlD,EAAA,CACA,EACA,CACA,GAAAF,EACA,CACA,EAEAqD,GAAA,CAAAC,EAAA,CAAA,KACA,CACA,KAAAtD,GACA,WAAA,CACAC,GAAAqD,EACAnD,GAAA,CACA,CACA,GAOAoD,GAAAF,GAGA,SAAAL,GACAxC,EACAuC,EACA,CAEA,GAAA,CAAAxB,GAAAf,CAAA,EACA,OAGA,IAAAgD,EAAAC,GAAAjD,CAAA,EACAkD,GACA,CACA,SAAA,OACA,KAAA,CACA,YAAAX,EAAA,WACA,GAAAS,CACA,EACA,KAAA,MACA,EACA,CACA,MAAA,WACA,QAAAhD,EACA,SAAAuC,CACA,CACA,CACA,CAEA,SAAAU,GAAAjD,EAAA,CACA,GAAA,CAEA,IAAAmD,EAAAnD,EAAA,UAAA,MAAA,GAAAA,EAAA,KACAC,EAAA,IAAA,IAAAD,EAAA,KAAA,GAAAA,EAAA,QAAA,KAAAmD,CAAA,EAAA,EACAC,EAAAC,GAAApD,EAAA,SAAA,CAAA,EAEA+C,EAAA,CACA,IAAAM,GAAAF,CAAA,EACA,cAAApD,EAAA,QAAA,KACA,EAEA,OAAAoD,EAAA,SACAJ,EAAA,YAAA,EAAAI,EAAA,QAEAA,EAAA,OACAJ,EAAA,eAAA,EAAAI,EAAA,MAGAJ,CACA,MAAA,CACA,MAAA,CAAA,CACA,CACA,CAOA,SAAAjC,GAAAF,EAAA,CACA,MAAA,eAAAA,GAAA,eAAAA,GAAA,EAAA,WAAAA,IAAA,EAAA,eAAAA,EACA,SCvR3C0C,IAKO,IAAMC,GAAc,OAAA,iBAAA,KAAA,qBCLpB,IAAMC,GAAeC,GAAY,QAAQ,SAAS,IAAI,EAChDC,GAAaF,GAAa,MCyCvC,IAAMG,GAA+B,CAACC,EAA4B,CAAA,IAAO,CACvE,IAAMC,EAAe,OAAOD,EAAQ,YAAgB,IAAc,GAAOA,EAAQ,YAC3EE,EAA0BF,EAAQ,uBAExC,eAAeG,GAA2D,CAExE,GAAIC,GAAa,GAAI,CACnBC,IAAeC,EAAO,IAAI,sEAAsE,EAChG,MACF,CAEA,GAAI,CACF,IAAMC,EAAM,KAAM,QAAO,qBAA0C,EAC7D,CAAE,qBAAAC,CAAqB,EAAID,EAEjC,MAAME,UAAuCD,CAAqB,CAEzD,UAAU,CAAE,QAAAE,EAAS,SAAAC,CAAA,EAAsE,CAChG,OAAIV,GACFW,GAAsBF,EAASC,CAAQ,EAGlC,MAAM,UAAU,CAAE,QAAAD,EAAS,SAAAC,CAAU,CAAA,CAC9C,CACF,CAEA,OAAO,IAAIF,EAA+B,CACxC,kBAAoBC,GAA0B,CAC5C,IAAMG,EAAMC,GAAeJ,EAAQ,OAAQA,EAAQ,IAAI,EACjDK,EAAkB,CAACC,GAAiB,EAG1C,GAFqBd,GAA2BW,GAAOX,EAAwBW,CAAG,EAGhF,MAAO,GAKT,GAAIE,EAAiB,CACnB,IAAME,EAAMC,GAAQ,OAAM,EACpBC,EAAuC,CAAA,EAIvCC,EAAaC,GAAM,QAAQJ,CAAG,EAC9BK,EAAqBF,EACvBG,GAA8BH,CAAU,EACxCI,GAAe,EAAG,sBAAqB,EAErCC,EAAcC,GAAyCJ,CAAkB,EAE/EG,EAAY,WAAWE,EAAA,CAAEF,EAAW,SAAAG,GAAAA,EAAC,WAAU,iBAAAC,GAAAA,EAAE,IAAG,OAAAC,GAAAA,EAAC,aAAcjB,CAAG,CAAC,CAAA,EACvE,IAAMkB,EAAuBV,GAAM,eAAeJ,EAAKQ,CAAW,EAElEO,GAAY,OAAOD,EAAsBZ,CAAY,EAErD,IAAMc,EAAiBvB,EAAQ,QAC/B,OAAI,MAAM,QAAQuB,CAAc,EAC9B,OAAO,QAAQd,CAAY,EAAE,QAAQe,GAAWD,EAAe,KAAK,GAAGC,CAAO,CAAC,EAE/ExB,EAAQ,SAAW,OAAO,QAAQS,CAAY,EAC3C,IAAI,CAAC,CAACgB,EAAGC,CAAC,IAAM,GAACD,CAAA,KAAAC,CAAA;CAAA,EACA,KAAA,EAAA,EAIA,EACA,CAEA,MAAA,EACA,EACA,UAAA,CAAA,CAAA,KAAAC,CAAA,IAAA,CACAC,GAAAD,CAAA,CACA,CAEA,CAAA,CACA,OAAAE,EAAA,CAEAlC,IAAAC,EAAA,IAAA;EAAAiC,CAAA,CACA,CACA,CAEA,MAAA,CACA,KAAA,YACA,WAAA,CAEApC,EAAA,EAAA,KAAAqC,GAAA,CACAA,GACAC,GAAAD,CAAA,CAEA,CAAA,CACA,CACA,CACA,EAEAE,GAAA3C,GAGA,SAAAuC,GAAAD,EAAA,CACAM,GAAAN,EAAA,2BAAA,CACA,CAGA,SAAAzB,GAAAF,EAAAC,EAAA,CACA,IAAAiC,EAAAC,GAAAnC,CAAA,EAEAoC,GACA,CACA,SAAA,OACA,KAAA,CACA,YAAAnC,EAAA,WACA,GAAAiC,CACA,EACA,KAAA,MACA,EACA,CACA,MAAA,WACA,QAAAlC,EACA,SAAAC,CACA,CACA,CACA,CAEA,SAAAkC,GAAAnC,EAAA,CACA,GAAA,CACA,IAAAG,EAAA,IAAA,IAAAH,EAAA,KAAAA,EAAA,MAAA,EACAqC,EAAAC,GAAAnC,EAAA,SAAA,CAAA,EAEA+B,EAAA,CACA,IAAAK,GAAAF,CAAA,EACA,cAAArC,EAAA,QAAA,KACA,EAEA,OAAAqC,EAAA,SACAH,EAAA,YAAA,EAAAG,EAAA,QAEAA,EAAA,OACAH,EAAA,eAAA,EAAAG,EAAA,MAGAH,CACA,MAAA,CACA,MAAA,CAAA,CACA,CACA,CAGA,SAAA9B,GAAAoC,EAAAC,EAAA,IAAA,CACA,IAAAtC,EAAA,GAAAqC,CAAA,GAEA,OAAAA,EAAA,SAAA,GAAA,GAAAC,EAAA,WAAA,GAAA,EACA,GAAAtC,CAAA,GAAAsC,EAAA,MAAA,CAAA,CAAA,GAGA,CAAAD,EAAA,SAAA,GAAA,GAAA,CAAAC,EAAA,WAAA,GAAA,EACA,GAAAtC,CAAA,IAAAsC,EAAA,MAAA,CAAA,CAAA,GAGA,GAAAtC,CAAA,GAAAsC,CAAA,EACA,kCCtMlC,IAAMC,GAAmB,UAEnBC,GAAuB,KACpB,CACL,KAAMD,GACN,MAAME,EAAQ,CACZC,GAAiC,CAAC,CAAE,KAAAC,EAAM,MAAAC,CAAA,IAAY,CAChDC,GAAS,IAAOJ,GAIpBK,GACE,CACE,SAAU,UACV,MAAOC,GAAwBH,CAAK,EACpC,QAAc,UAAO,MAAM,OAAWD,CAAI,CACtD,EACU,CACE,MAAO,CAAC,GAAGA,CAAI,EACf,MAAAC,CACZ,CACA,CACA,CAAO,CACP,CACA,GAMaI,GAAuCR,gNCjBvCS,GAAgBC,GAAUC,EAAQ,EAClCC,GAAeF,GAAUG,EAAO,EAQvCC,GAAmB,UAenBC,GAA2B,CAACC,EAA0B,CAAA,IAAO,CACjE,IAAIC,EAEEC,EAAW,CACf,IAAK,GACL,GAAI,GACJ,OAAQ,GACR,QAAS,GACT,cAAe,GACf,GAAGF,CACP,EAGE,eAAeG,EAAWC,EAA8B,CAClDH,IAAkB,SACpBA,EAAgBI,EAAY,GAG9B,IAAMC,EAAiBC,GAAe,MAAMN,CAAa,EAEzD,OAAAG,EAAM,SAAW,CACf,GAAGA,EAAM,SACT,IAAK,CAAE,GAAGE,EAAe,IAAK,GAAAE,EAAA,CAAGJ,EAAK,SAAAK,GAAAA,EAAC,SAAQ,iBAAAC,GAAAA,EAAE,GAAA,CAAA,CAAK,EACtD,GAAI,CAAE,GAAGJ,EAAe,GAAI,GAAAE,EAAA,CAAGJ,EAAK,SAAAO,GAAAA,EAAC,SAAQ,iBAAAC,GAAAA,EAAE,EAAA,CAAA,CAAI,EACnD,OAAQ,CAAE,GAAGN,EAAe,OAAQ,GAAAE,EAAA,CAAGJ,EAAK,SAAAS,GAAAA,EAAC,SAAQ,iBAAAC,GAAAA,EAAE,MAAA,CAAA,CAAQ,EAC/D,QAAS,CAAE,GAAGR,EAAe,QAAS,GAAAE,EAAA,CAAGJ,EAAK,SAAAW,GAAAA,EAAC,SAAQ,iBAAAC,GAAAA,EAAE,OAAA,CAAA,CAAS,EAClE,eAAgB,CAAE,GAAGV,EAAe,eAAgB,GAAAE,EAAA,CAAGJ,EAAK,SAAAa,GAAAA,EAAC,SAAQ,iBAAAC,GAAAA,EAAE,cAAA,CAAA,CAAgB,CAC7F,EAEWd,CACT,CAGA,eAAeC,GAAkC,CAC/C,IAAMc,EAAqB,CAAA,EAc3B,GAZIjB,EAAS,KACXiB,EAAS,GAAK,MAAMC,GAAY,GAG9BlB,EAAS,MACXiB,EAAS,IAAME,GAAa,GAG1BnB,EAAS,SACXiB,EAAS,OAASG,GAAiBpB,EAAS,MAAM,GAGhDA,EAAS,QAAS,CACpB,IAAMqB,EAAUC,GAAiB,EAE7BD,IACFJ,EAAS,QAAUI,EAEvB,CAEA,OAAIrB,EAAS,gBACXiB,EAAS,eAAiBM,GAAuB,GAG5CN,CACT,CAEA,MAAO,CACL,KAAMrB,GACN,aAAaM,EAAO,CAClB,OAAOD,EAAWC,CAAK,CACxB,CACL,CACA,EAKasB,GAA2C3B,GAKxD,SAASQ,GAAeY,EAA8B,CAOpD,GAJIX,EAAA,CAAAW,EAAQ,iBAAAQ,GAAAA,EAAE,IAAG,iBAAAC,GAAAA,EAAE,UAAA,CAAA,IACjBT,EAAS,IAAI,WAAa,QAAQ,YAAW,EAAG,KAG9CX,EAAA,CAAAW,EAAU,iBAAAU,GAAAA,EAAA,IAAG,iBAAAC,GAAAA,EAAE,WAAY,CAAA,GAAG,OAAQ,QAAqC,iBAAoB,WAAY,CAC7G,IAAMC,EAAWvB,EAAA,CAAG,QAAqC,SAAAwB,GAAAA,EAAA,gBAAiB,eAAAC,GAAAA,EAAA,CAAE,CAAA,EACxEF,GAAc,OAChBZ,EAAS,IAAI,YAAcY,EAE/B,CAEA,OAAIvB,EAAA,CAAAW,EAAQ,iBAAAe,GAAAA,EAAE,OAAM,iBAAAC,GAAAA,EAAE,WAAA,CAAA,IACpBhB,EAAS,OAAO,YAAiB,WAAO,GAGnCA,CACT,CAgBA,eAAeC,IAAmC,CAChD,IAAMgB,EAAgB,YAAQ,EAC9B,OAAQA,EAAU,CAChB,IAAK,SACH,OAAOC,GAAa,EACtB,IAAK,QACH,OAAOC,GAAY,EACrB,QACE,MAAO,CACL,KAAMC,GAAeH,CAAU,GAAKA,EACpC,QAAY,WAAS,CAC7B,CACE,CACF,CAEA,SAASZ,IAAgD,CACvD,GAAI,CAEF,GAAI,OAAQ,QAAQ,SAA4B,KAAQ,SAEtD,OAOF,IAAMgB,EAAU,IAAI,KAAK,GAAG,EAE5B,GADgB,IAAI,KAAK,eAAe,KAAM,CAAE,MAAO,MAAA,CAAQ,EACnD,OAAOA,CAAO,IAAM,QAAS,CACvC,IAAMxC,EAAU,KAAK,eAAgB,EAAC,gBAAe,EAErD,MAAO,CACL,OAAQA,EAAQ,OAChB,SAAUA,EAAQ,QAC1B,CACI,CACA,MAAY,CAEd,CAGF,CAKO,SAASqB,IAA4B,CAC1C,IAAMoB,EAAa,QAAQ,YAAW,EAAG,IAGnCC,EAAyB,CAAE,eAFV,IAAI,KAAK,KAAK,IAAG,EAAK,QAAQ,OAAS,EAAE,GAAI,EAAE,YAAW,EAEhC,WAAAD,CAAA,EAEjD,GAAI,OAAQ,QAAqC,iBAAoB,WAAY,CAC/E,IAAMV,EAAWvB,EAAA,CAAG,QAAqC,SAAAmC,GAAAA,EAAA,gBAAiB,eAAAC,GAAAA,EAAA,CAAE,CAAA,EACxEb,GAAc,OAChBW,EAAW,YAAcX,EAE7B,CAEA,OAAOW,CACT,CAKO,SAASpB,GAAiBuB,EAAuD,CACtF,IAAMC,EAAwB,CAAA,EAG1BC,EACJ,GAAI,CACFA,EAAY,WAAa,UAAM,CAC/B,MAAU,CAEZ,CAgBA,GAXI,OAAOA,GAAW,WACpBD,EAAO,UAAY,IAAI,KAAK,KAAK,IAAM,EAAEC,EAAS,GAAI,EAAE,YAAW,GAGrED,EAAO,KAAU,QAAI,GAEjBD,IAAc,IAAQA,EAAU,UAClCC,EAAO,YAAiB,YAAQ,EAChCA,EAAO,YAAiB,WAAO,GAG7BD,IAAc,IAAQA,EAAU,IAAK,CACvC,IAAMG,EAAuC,QAAI,EAC3CC,EAAWD,GAAWA,EAAQ,CAAC,EACjCC,IACFH,EAAO,gBAAkBE,EAAQ,OACjCF,EAAO,gBAAkBG,EAAS,MAClCH,EAAO,oBAAsBG,EAAS,MAE1C,CAEA,OAAOH,CACT,CAGA,IAAMP,GAAiD,CACrD,IAAK,UACL,QAAS,UACT,QAAS,UACT,MAAO,QACP,MAAO,SACT,EAWMW,GAA8B,CAClC,CAAE,KAAM,iBAAkB,QAAS,CAAC,QAAQ,CAAG,EAC/C,CAAE,KAAM,iBAAkB,QAAS,CAAC,gBAAiB,QAAQ,CAAG,EAChE,CAAE,KAAM,iBAAkB,QAAS,CAAC,eAAe,CAAG,EACtD,CAAE,KAAM,eAAgB,QAAS,CAAC,YAAY,CAAG,EACjD,CAAE,KAAM,cAAe,QAAS,CAAC,eAAgB,YAAY,CAAG,EAChE,CAAE,KAAM,iBAAkB,QAAS,CAAC,QAAQ,CAAG,EAC/C,CAAE,KAAM,iBAAkB,QAAS,CAAC,QAAQ,CAAG,EAC/C,CAAE,KAAM,eAAgB,QAAS,CAAC,YAAY,CAAG,EACjD,CAAE,KAAM,iBAAkB,QAAS,CAAC,cAAc,CAAG,EACrD,CAAE,KAAM,iBAAkB,QAAS,CAAC,YAAY,CAAG,EACnD,CAAE,KAAM,iBAAkB,QAAS,CAAC,cAAc,CAAG,CACvD,EAGMC,GAEF,CACF,OAAQC,GAAWA,EACnB,KAAMA,GAAWC,GAAW,uBAAwBD,CAAO,EAC3D,OAAQA,GAAWC,GAAW,kBAAmBD,CAAO,EACxD,OAAQA,GAAWA,EACnB,OAAQA,GAAWC,GAAW,eAAgBD,CAAO,EACrD,KAAMA,GAAWC,GAAW,uBAAwBD,CAAO,EAC3D,IAAKA,GAAWC,GAAW,kBAAmBD,CAAO,EACrD,KAAMA,GAAWC,GAAW,mBAAoBD,CAAO,EACvD,OAAQA,GAAWC,GAAW,uBAAwBD,CAAO,CAC/D,EASA,SAASC,GAAWC,EAAeC,EAAkC,CACnE,IAAMC,EAAQF,EAAM,KAAKC,CAAI,EAC7B,OAAOC,EAAQA,EAAM,CAAC,EAAI,MAC5B,CAGA,eAAenB,IAAoC,CAIjD,IAAMoB,EAAwB,CAC5B,eAAmB,WAAS,EAC5B,KAAM,WACN,QAAS,MAAM,OAAU,WAAO,EAAG,MAAM,GAAG,EAAE,CAAC,CAAC,EAAI,CAAC,EACC,EAEA,GAAA,CAKA,IAAAC,EAAA,MAAA,IAAA,QAAA,CAAAC,EAAAC,IAAA,CACAC,GAAA,mBAAA,CAAAC,EAAAC,IAAA,CACA,GAAAD,EAAA,CACAF,EAAAE,CAAA,EACA,MACA,CACAH,EAAAI,CAAA,CACA,CAAA,CACA,CAAA,EAEAN,EAAA,KAAAJ,GAAA,yBAAAK,CAAA,EACAD,EAAA,QAAAJ,GAAA,4BAAAK,CAAA,EACAD,EAAA,MAAAJ,GAAA,0BAAAK,CAAA,CACA,MAAA,CAEA,CAEA,OAAAD,CACA,CAGA,SAAAO,GAAAC,EAAA,CACA,OAAAA,EAAA,MAAA,GAAA,EAAA,CAAA,EAAA,YAAA,CACA,CAGA,eAAA3B,IAAA,CAIA,IAAA4B,EAAA,CACA,eAAA,WAAA,EACA,KAAA,OACA,EAEA,GAAA,CAOA,IAAAC,EAAA,MAAAvE,GAAA,MAAA,EACAwE,EAAAlB,GAAA,KAAAmB,GAAAF,EAAA,SAAAE,EAAA,IAAA,CAAA,EACA,GAAA,CAAAD,EACA,OAAAF,EAOA,IAAAI,EAAAC,GAAA,OAAAH,EAAA,IAAA,EACAI,GAAA,MAAA/E,GAAA6E,EAAA,CAAA,SAAA,OAAA,CAAA,GAAA,YAAA,EAOA,CAAA,QAAAG,CAAA,EAAAL,EACAF,EAAA,KAAAO,EAAA,KAAAC,GAAAF,EAAA,QAAAR,GAAAU,CAAA,CAAA,GAAA,CAAA,GAAAD,EAAA,CAAA,EAKA,IAAAE,EAAAX,GAAAE,EAAA,IAAA,EACAA,EAAA,QAAA1D,EAAA,CAAA2C,GAAA,SAAAyB,GAAAA,EAAAD,CAAA,EAAA,eAAAE,GAAAA,EAAAL,CAAA,CAAA,CAAA,CACA,MAAA,CAEA,CAEA,OAAAN,CACA,CAKA,SAAAzC,IAAA,CACA,OAAA,QAAA,IAAA,OAEA,CACA,iBAAA,SACA,eAAA,QAAA,IAAA,aACA,EACA,QAAA,IAAA,WAEA,CACA,iBAAA,MACA,eAAA,QAAA,IAAA,WACA,iBAAA,QAAA,IAAA,iBACA,EACA,QAAA,IAAA,YAEA,CACA,iBAAA,KACA,EACA,QAAA,IAAA,iBAEA,CACA,iBAAA,gBACA,eAAA,QAAA,IAAA,gBACA,EACA,QAAA,IAAA,mBAAA,QAAA,IAAA,YAEA,CACA,iBAAA,QACA,eAAA,QAAA,IAAA,WACA,EACA,QAAA,IAAA,iBAEA,CACA,iBAAA,YACA,eAAA,QAAA,IAAA,gBACA,EACA,QAAA,IAAA,oBAEA,CACA,iBAAA,gBACA,eAAA,QAAA,IAAA,oBACA,mBAAA,QAAA,IAAA,mBACA,0BAAA,QAAA,IAAA,iBACA,EACA,QAAA,IAAA,QAEA,CACA,iBAAA,SACA,EACA,QAAA,IAAA,WAEA,CACA,iBAAA,SACA,eAAA,QAAA,IAAA,UACA,EACA,QAAA,IAAA,KAEA,CACA,iBAAA,QACA,EAEA,MAEA,kGCrd1D,IAAMqD,GAA0B,IAAIC,GAAuC,EAAE,EACvEC,GAAmC,IAAID,GAAkB,EAAE,EAC3DE,GAA2B,EAC3BC,GAAmB,eAIZC,GAAiC,IACjCC,GAAkC,IAsB/C,SAASC,GAAqDC,EAAQC,EAAQC,EAAgB,CAC5F,IAAMC,EAAQH,EAAI,IAAIC,CAAG,EAEzB,OAAIE,IAAU,QACZH,EAAI,IAAIC,EAAKC,CAAQ,EACdA,GAGFC,CACT,CAQA,SAASC,GAA8BC,EAAuB,CAO5D,MAJI,GAAAA,EAAK,WAAW,OAAO,GACvBA,EAAK,SAAS,SAAS,GACvBA,EAAK,SAAS,UAAU,GACxBA,EAAK,SAAS,UAAU,GACxBA,EAAK,WAAW,OAAO,EAE7B,CAKA,SAASC,GAA+BC,EAA4B,CAElE,OADIA,EAAM,SAAW,QAAaA,EAAM,OAAST,IAC7CS,EAAM,QAAU,QAAaA,EAAM,MAAQV,EAEjD,CAIA,SAASW,GAA0BC,EAAcC,EAA+B,CAC9E,IAAMR,EAAWV,GAAwB,IAAIiB,CAAI,EACjD,GAAIP,IAAa,OAAW,MAAO,GAEnC,QAASS,EAAID,EAAM,CAAC,EAAGC,GAAKD,EAAM,CAAC,EAAGC,IACpC,GAAIT,EAASS,CAAC,IAAM,OAClB,MAAO,GAIX,MAAO,EACT,CAMA,SAASC,GAAqBC,EAAiBC,EAAsC,CACnF,GAAI,CAACD,EAAM,OACT,MAAO,CAAA,EAGT,IAAIF,EAAI,EACFI,EAAOF,EAAM,CAAC,EAEpB,GAAI,OAAOE,GAAS,SAClB,MAAO,CAAA,EAGT,IAAIC,EAAUC,GAAiBF,EAAMD,CAAW,EAC1CI,EAAuB,CAAA,EAE7B,OAAa,CACX,GAAIP,IAAME,EAAM,OAAS,EAAG,CAC1BK,EAAI,KAAKF,CAAO,EAChB,KACF,CAGA,IAAMG,EAAON,EAAMF,EAAI,CAAC,EACxB,GAAI,OAAOQ,GAAS,SAClB,MAEEA,GAAQH,EAAQ,CAAC,EACnBA,EAAQ,CAAC,EAAIG,EAAOL,GAEpBI,EAAI,KAAKF,CAAO,EAChBA,EAAUC,GAAiBE,EAAML,CAAW,GAG9CH,GACF,CAEA,OAAOO,CACT,CAKA,SAASE,GAAwBf,EAAcgB,EAAyBC,EAA+C,CACrH,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAY,CAIvC,IAAMC,EAASC,GAAiBrB,CAAI,EAC9BsB,EAAaC,GAAgB,CACjC,MAAOH,CACb,CAAK,EAGGI,EAAa,EACbC,EAAoB,EAClBpB,EAAQW,EAAOS,CAAiB,EACtC,GAAIpB,IAAU,OAAW,CAEvBa,EAAO,EACP,MACF,CACA,IAAIQ,EAAarB,EAAM,CAAC,EACpBsB,EAAWtB,EAAM,CAAC,EAItB,SAASuB,EAAcC,EAAgB,CAErCxC,GAAiC,IAAIW,EAAM,CAAC,EAC5C8B,IAAeC,EAAO,MAAM,wBAAwB/B,CAAI,YAAY6B,CAAC,EAAC,EACAP,EAAA,MAAA,EACAA,EAAA,mBAAA,EACAJ,EAAA,CACA,CAIAE,EAAA,GAAA,QAAAQ,CAAA,EACAN,EAAA,GAAA,QAAAM,CAAA,EACAN,EAAA,GAAA,QAAAJ,CAAA,EAEAI,EAAA,GAAA,OAAAZ,GAAA,CAEA,GADAc,IACA,EAAAA,EAAAE,KAGAT,EAAAO,CAAA,EAAAQ,GAAAtB,EAAA,CAAA,EAEAc,GAAAG,GAAA,CACA,GAAAF,IAAAT,EAAA,OAAA,EAAA,CAEAM,EAAA,MAAA,EACAA,EAAA,mBAAA,EACA,MACA,CACAG,IACA,IAAApB,EAAAW,EAAAS,CAAA,EACA,GAAApB,IAAA,OAAA,CAEAiB,EAAA,MAAA,EACAA,EAAA,mBAAA,EACA,MACA,CACAI,EAAArB,EAAA,CAAA,EACAsB,EAAAtB,EAAA,CAAA,CACA,CACA,CAAA,CACA,CAAA,CACA,CASA,eAAA4B,GAAAC,EAAAC,EAAA,CAGA,IAAAC,EAAA,CAAA,EAEA,GAAAD,EAAA,GAAAE,EAAA,CAAAH,EAAA,SAAAI,GAAAA,EAAA,UAAA,iBAAAC,GAAAA,EAAA,MAAA,CAAA,GACA,QAAAC,KAAAN,EAAA,UAAA,OACA,GAAAG,EAAA,CAAAG,EAAA,SAAAC,GAAAA,EAAA,WAAA,iBAAAC,GAAAA,EAAA,OAAA,iBAAAC,GAAAA,EAAA,MAAA,CAAA,EAMA,QAAArC,EAAAkC,EAAA,WAAA,OAAA,OAAA,EAAAlC,GAAA,EAAAA,IAAA,CACA,IAAAJ,EAAAsC,EAAA,WAAA,OAAAlC,CAAA,EACAsC,EAAAP,EAAA,CAAAnC,EAAA,iBAAA2C,GAAAA,EAAA,QAAA,CAAA,EAEA,GACA,CAAA3C,GACA,OAAA0C,GAAA,UACA,OAAA1C,EAAA,QAAA,UACAH,GAAA6C,CAAA,GACA3C,GAAAC,CAAA,EAEA,SAGAkC,EAAAQ,CAAA,IACAR,EAAAQ,CAAA,EAAA,CAAA,GAEAR,EAAAQ,CAAA,EAAA,KAAA1C,EAAA,MAAA,CACA,EAIA,IAAA4C,EAAA,OAAA,KAAAV,CAAA,EACA,GAAAU,EAAA,QAAA,EACA,OAAAZ,EAGA,IAAAa,EAAA,CAAA,EACA,QAAA3C,KAAA0C,EAAA,CAEA,GAAAzD,GAAA,IAAAe,CAAA,EACA,SAGA,IAAA4C,EAAAZ,EAAAhC,CAAA,EACA,GAAA,CAAA4C,EACA,SAIAA,EAAA,KAAA,CAAAC,EAAAC,IAAAD,EAAAC,CAAA,EAEA,IAAAlC,EAAAT,GAAAyC,EAAAb,CAAA,EACA,GAAAnB,EAAA,MAAAmC,GAAAhD,GAAAC,EAAA+C,CAAA,CAAA,EACA,SAGA,IAAAC,EAAA1D,GAAAP,GAAAiB,EAAA,CAAA,CAAA,EACA2C,EAAA,KAAAhC,GAAAX,EAAAY,EAAAoC,CAAA,CAAA,CACA,CASA,GANA,MAAA,QAAA,IAAAL,CAAA,EAAA,MAAA,IAAA,CACAjB,IAAAC,EAAA,IAAA,mEAAA,CACA,CAAA,EAIAI,EAAA,GAAAE,EAAA,CAAAH,EAAA,SAAAmB,GAAAA,EAAA,UAAA,iBAAAC,GAAAA,EAAA,MAAA,CAAA,EACA,QAAAd,KAAAN,EAAA,UAAA,OACAM,EAAA,YAAAA,EAAA,WAAA,QAAAA,EAAA,WAAA,OAAA,OAAA,GACAe,GAAAf,EAAA,WAAA,OAAAL,EAAAhD,EAAA,EAKA,OAAA+C,CACA,CAIA,SAAAqB,GACAC,EACArB,EACAiB,EACA,CACA,QAAAlD,KAAAsD,EAEA,GAAAtD,EAAA,UAAAA,EAAA,eAAA,QAAA,OAAAA,EAAA,QAAA,SAAA,CACA,IAAAL,EAAAuD,EAAA,IAAAlD,EAAA,QAAA,EACA,GAAAL,IAAA,OACA,SAGA4D,GAAAvD,EAAA,OAAAA,EAAAiC,EAAAtC,CAAA,CACA,CAEA,CAMA,SAAA6D,GAAAxD,EAAA,CACA,OAAAA,EAAA,YACA,OAAAA,EAAA,aACA,OAAAA,EAAA,YACA,CAKA,SAAAuD,GACAE,EACAzD,EACAiC,EACAtC,EACA,CAGA,GAAAK,EAAA,SAAA,QAAAL,IAAA,OAAA,CACAiC,IAAAC,EAAA,MAAA,kEAAA,EACA,MACA,CAEA7B,EAAA,YAAA,CAAA,EACA,QAAA,EAAA0D,GAAAD,EAAAxB,CAAA,EAAA,EAAAwB,EAAA,IAAA,CAGA,IAAAjD,EAAAb,EAAA,CAAA,EACA,GAAAa,IAAA,OAAA,CACAgD,GAAAxD,CAAA,EACA4B,IAAAC,EAAA,MAAA,uBAAA,CAAA,YAAA7B,EAAA,QAAA,EAAA,EACA,MACA,CAEAA,EAAA,YAAA,KAAAQ,CAAA,CACA,CAIA,GAAAb,EAAA8D,CAAA,IAAA,OAAA,CACAD,GAAAxD,CAAA,EACA4B,IAAAC,EAAA,MAAA,uBAAA4B,CAAA,YAAAzD,EAAA,QAAA,EAAA,EACA,MACA,CAEAA,EAAA,aAAAL,EAAA8D,CAAA,EAEA,IAAAE,EAAAC,GAAAH,EAAAxB,CAAA,EACAjC,EAAA,aAAA,CAAA,EACA,QAAA,EAAAyD,EAAA,EAAA,GAAAE,EAAA,IAAA,CAGA,IAAAnD,EAAAb,EAAA,CAAA,EACA,GAAAa,IAAA,OACA,MAEAR,EAAA,aAAA,KAAAQ,CAAA,CACA,CACA,CAMA,SAAAkD,GAAAlD,EAAAD,EAAA,CACA,OAAA,KAAA,IAAA,EAAAC,EAAAD,CAAA,CACA,CAEA,SAAAqD,GAAApD,EAAAD,EAAA,CACA,OAAAC,EAAAD,CACA,CAEA,SAAAG,GAAAF,EAAAD,EAAA,CACA,MAAA,CAAAmD,GAAAlD,EAAAD,CAAA,EAAAqD,GAAApD,EAAAD,CAAA,CAAA,CACA,CAGA,IAAAsD,GAAA,CAAAC,EAAA,CAAA,IAAA,CACA,IAAA7B,EAAA6B,EAAA,oBAAA,OAAAA,EAAA,kBAAA1E,GAEA,MAAA,CACA,KAAAC,GACA,aAAA2C,EAAA,CACA,OAAAD,GAAAC,EAAAC,CAAA,CACA,CACA,CACA,EAKA8B,GAAAF,yDChZ5EG,IAQO,SAASC,GACdC,EACAC,EACAC,EACoB,CACpB,IAAIC,EAAQ,EACRC,EAAe,EACfC,EAAkB,EAEtB,mBAAY,IAAM,CACZA,IAAoB,EAClBF,EAAQH,IACVI,GAAgB,EAChBF,EAAQE,CAAY,EAGhBA,EAAe,QACjBA,EAAe,OAEjBC,EAAkBD,IAGpBC,GAAmB,EAEfA,IAAoB,GACtBJ,EAAM,GAIVE,EAAQ,CACZ,EAAK,GAAK,EAAE,MAAK,EAER,IAAM,CACXA,GAAS,CACb,CACA,CAWO,SAASG,GAAYC,EAAmC,CAC7D,OAAOA,IAAS,SAAcA,EAAK,SAAW,GAAKA,IAAS,KAAOA,IAAS,cAC9E,CAGO,SAASC,GAAmBC,EAAuBC,EAAgC,CACxF,OAAOD,IAAMC,GAAMJ,GAAYG,CAAC,GAAKH,GAAYI,CAAC,CACpD,CAGO,SAASC,GAAWC,EAAsD,CAC/E,GAAIA,IAAW,OAKf,OAAOA,EAAO,MAAM,GAAG,EAAE,OAAO,CAACC,EAAKC,IAAU,GAACD,CAAA,IAAAC,EAAA,QAAA,IAAAA,EAAA,MAAA,IAAAA,EAAA,KAAA,GAAA,EAAA,CACA,CAMA,SAAAC,GAAAC,EAAAC,EAAA,CACA,GAAAA,IAAA,OAIA,OAAAN,GAAAK,EAAAC,EAAA,CAAA,CAAA,CACA,CChF5C,IAAMC,GAAqB,+nOAElC,SAASC,MAAOC,EAAuB,CACrCC,EAAO,IAAI,mBAAoB,GAAGD,CAAI,CACxC,CAKa,IAAAE,GAAoD,CAC/DC,EAAuD,CAAE,IACtD,CACH,IAAMC,EAAiD,IAAIC,GAAO,EAAE,EAEpE,SAASC,EAA6BC,EAA4B,CAChE,IAAMC,EAAOC,GAAUC,EAAA,CAACH,EAAW,iBAAAI,GAAAA,EAAA,WAAY,iBAAAC,GAAAA,EAAA,MAAA,CAAA,CAAM,EAErD,GAAIJ,IAAS,OACX,OAKF,IAAMK,EAAcT,EAAa,OAAOI,CAAI,EAE5C,GAAIK,IAAgB,OAClB,OAKF,IAAMC,GAASJ,EAAA,CAACH,EAAU,SAAAQ,GAAAA,EAAA,WAAY,iBAAAC,GAAAA,EAAA,MAAA,CAAA,GAAU,CAAA,GAAI,OAAOC,GAASA,EAAM,WAAa,aAAa,EAEpG,QAASC,EAAI,EAAGA,EAAIJ,EAAO,OAAQI,IAAK,CAEtC,IAAMC,EAAaL,EAAO,OAASI,EAAI,EAEjCE,EAAsBP,EAAYK,CAAC,EACnCG,EAAgBP,EAAOK,CAAU,EAEvC,GAAI,CAACE,GAAiB,CAACD,EAErB,MAKAA,EAAoB,OAAS,QAE7BC,EAAc,SAAW,IAEzB,CAACC,GAAmBD,EAAc,SAAUD,EAAoB,QAAQ,IAK1EC,EAAc,KAAOD,EAAoB,KAC3C,CACF,CAEA,SAASG,EAAyBC,EAAqB,CACrD,QAAWjB,KAAaG,EAAA,CAAAc,EAAM,SAAAC,GAAAA,EAAA,UAAW,iBAAAC,GAAAA,EAAA,MAAA,CAAA,GAAU,CAAA,EACjDpB,EAA6BC,CAAS,EAGxC,OAAOiB,CACT,CAEA,eAAeG,GAAgC,CAE7C,IAAMC,EAAY,KAAM,QAAO,gBAAgB,EAC1CA,EAAU,IAAG,GAChBA,EAAU,KAAK,CAAC,CAEpB,CAEA,SAASC,EAAYC,EAAyC,CAC5D,IAAMC,EAAS,IAAIC,GAAO,IAAI,IAAI,sCAAsClC,EAAkB,EAAC,EAAA,CACA,WAAAgC,EAEA,SAAA,CAAA,CACA,CAAA,EAEA,QAAA,GAAA,OAAA,IAAA,CAEAC,EAAA,UAAA,CACA,CAAA,EAEAA,EAAA,GAAA,UAAA,CAAA,CAAA,cAAAE,EAAA,OAAAnB,CAAA,IAAA,CACAV,EAAA,IAAA6B,EAAAnB,CAAA,CACA,CAAA,EAEAiB,EAAA,KAAA,QAAAG,GAAA,CACAnC,GAAA,eAAAmC,CAAA,CACA,CAAA,EAEAH,EAAA,KAAA,OAAAI,GAAA,CACApC,GAAA,cAAAoC,CAAA,CACA,CAAA,EAGAJ,EAAA,MAAA,CACA,CAEA,MAAA,CACA,KAAA,sBACA,MAAAK,EAAA,CAGA,GAAA,CAFAA,EAAA,WAAA,EAEA,sBACA,OAGA,IAAAN,EAAA,CACA,GAAA3B,EACA,MAAAF,EAAA,UAAA,CACA,EAEA0B,EAAA,EAAA,KACA,IAAA,CACA,GAAA,CACAE,EAAAC,CAAA,CACA,OAAAO,EAAA,CACApC,EAAA,MAAA,yBAAAoC,CAAA,CACA,CACA,EACAA,GAAA,CACApC,EAAA,MAAA,4BAAAoC,CAAA,CACA,CACA,CACA,EACA,aAAAb,EAAA,CACA,OAAAD,EAAAC,CAAA,CACA,CACA,CACA,MClHxF,SAASc,GAAsBC,EAAuC,CAE3E,IAAIC,EAAuB,CAAA,EAEvBC,EAAkB,GACtB,SAASC,EAAgBC,EAAiB,CACxCH,EAAY,CAAA,EACR,CAAAC,IAGJA,EAAkB,GAClBF,EAASI,CAAM,EACjB,CAGAH,EAAU,KAAKE,CAAe,EAE9B,SAASE,EAAIC,EAAmB,CAC9BL,EAAU,KAAKK,CAAE,CACnB,CAEA,SAASC,EAAKH,EAAiB,CAC7B,IAAMI,EAASP,EAAU,IAAG,GAAME,EAElC,GAAI,CACFK,EAAOJ,CAAM,CACb,MAAU,CAEVD,EAAgBC,CAAM,CACxB,CACF,CAEA,MAAO,CAAE,IAAAC,EAAK,KAAAE,CAAA,CAChB,CAWA,IAAME,GAAN,MAAMC,CAAqC,CAEjC,YAA6BC,EAAmB,CAAA,KAAA,SAAAA,CAExD,CAEO,aAAa,OAAOC,EAA6D,CACtF,GAAIA,EACF,OAAOA,EAGT,IAAMC,EAAY,KAAM,QAAO,gBAAgB,EAC/C,OAAO,IAAIH,EAAa,IAAIG,EAAU,OAAS,CACjD,CAGO,oBAAoBC,EAA8DC,EAA2B,CAClH,KAAK,SAAS,QAAO,EAErB,KAAK,SAAS,GAAG,kBAAmBC,GAAS,CAC3CF,EAAQE,EAAO,IAAM,CAEnB,KAAK,SAAS,KAAK,iBAAiB,CAC5C,CAAO,CACP,CAAK,EAED,KAAK,SAAS,KAAK,iBAAiB,EACpC,KAAK,SAAS,KAAK,gCAAiC,CAAE,MAAOD,EAAa,MAAQ,UAAA,CAAY,CAChG,CAEO,qBAAqBA,EAA2B,CACrD,KAAK,SAAS,KAAK,gCAAiC,CAAE,MAAOA,EAAa,MAAQ,UAAA,CAAY,CAChG,CAGO,kBAAkBE,EAAkBjB,EAA2C,CACpF,KAAK,eAAeiB,EAAUC,GAAS,CACrC,GAAM,CAAE,IAAAb,EAAK,KAAAE,CAAA,EAASR,GAA8BC,CAAQ,EAE5D,QAAWmB,KAAQD,EACjB,GAAGE,EAAA,CAACD,EAAI,iBAAAE,GAAAA,EAAE,MAAO,iBAAAC,GAAAA,EAAA,QAAA,CAAA,GAAYF,EAAA,CAAAD,EAAI,iBAAAI,GAAAA,EAAE,MAAK,SAAAC,GAAAA,EAAC,SAAU,CAAA,IAAI,QAAS,CAC9D,IAAMC,EAAKN,EAAK,MAAM,SACtBd,EAAIqB,GAAQ,KAAK,aAAaD,EAAIN,EAAK,KAAMO,EAAMnB,CAAI,CAAC,UAC/Ca,EAAA,CAAAD,EAAI,iBAAAQ,GAAAA,EAAE,MAAK,iBAAAC,GAAAA,EAAE,QAAS,CAAA,GAAAR,EAAA,CAAGD,EAAM,iBAAAU,GAAAA,EAAA,MAAK,iBAAAC,GAAAA,EAAE,SAAU,CAAA,IAAI,SAAU,CACvE,IAAML,EAAKN,EAAK,MAAM,SACtBd,EAAIqB,GAAQ,KAAK,cAAcD,EAAIN,EAAK,KAAMO,EAAMnB,CAAI,CAAC,CACnE,MAAea,EAAA,CAAID,EAAI,iBAAAY,GAAAA,EAAE,KAAA,CAAA,GACf1B,EAAIqB,GAAQ,KAAK,aAAaP,EAAMO,EAAMnB,CAAI,CAAC,EAInDA,EAAK,CAAE,CAAA,CACb,CAAK,CACH,CAKQ,eAAeU,EAAkBV,EAA4D,CACnG,KAAK,SAAS,KACZ,wBACA,CACE,SAAAU,EACA,cAAe,EAChB,EACD,CAACe,EAAKC,IAAW,CAEb1B,EADEyB,EACG,CAAE,EAEFC,EAAO,MAFL,CAIV,CACP,CACE,CAKQ,aAAahB,EAAkBiB,EAAcR,EAAiBnB,EAAuC,CAC3G,KAAK,eAAeU,EAAUC,GAAS,CACrCQ,EAAKQ,CAAI,EAAIhB,EACV,OAAOiB,GAAKA,EAAE,OAAS,UAAY,CAAC,MAAM,SAASA,EAAE,KAAM,EAAE,CAAC,CAAC,EAC/D,KAAK,CAACC,EAAGC,IAAM,SAASD,EAAE,KAAM,EAAE,EAAI,SAASC,EAAE,KAAM,EAAE,CAAC,EAC1D,IAAIF,GAAEf,EAAA,CAAGe,EAAG,iBAAAG,GAAAA,EAAA,MAAO,iBAAAC,GAAAA,EAAA,KAAA,CAAA,CAAK,EAE3BhC,EAAKmB,CAAI,CACf,CAAK,CACH,CAKQ,cAAcT,EAAkBiB,EAAcR,EAAiBnB,EAAsC,CAC3G,KAAK,eAAeU,EAAUC,GAAS,CACrCQ,EAAKQ,CAAI,EAAIhB,EACV,IAAuBiB,GAAK,CAACA,EAAE,KAAIf,EAAA,CAAEe,EAAC,iBAAAK,GAAAA,EAAE,MAAK,iBAAAC,GAAAA,EAAE,KAAA,CAAA,CAAK,CAAC,EACrD,OAAO,CAACC,EAAK,CAACC,EAAKC,CAAG,KACrBF,EAAIC,CAAG,EAAIC,EACJF,GACN,CAAC,CAAA,EAENnC,EAAKmB,CAAI,CACf,CAAK,CACH,CAKQ,aAAaP,EAAkCO,EAAiBnB,EAAuC,CACzGY,EAAK,QACH,UAAWA,EAAK,MACdA,EAAK,MAAM,QAAU,QAAaA,EAAK,MAAM,QAAU,KACzDO,EAAKP,EAAK,IAAI,EAAI,IAAIA,EAAK,MAAM,KAAK,IAEtCO,EAAKP,EAAK,IAAI,EAAIA,EAAK,MAAM,MAEtB,gBAAiBA,EAAK,OAASA,EAAK,MAAM,OAAS,WAC5DO,EAAKP,EAAK,IAAI,EAAI,IAAIA,EAAK,MAAM,WAAW,IACnCA,EAAK,MAAM,OAAS,cAC7BO,EAAKP,EAAK,IAAI,EAAI,gBAItBZ,EAAKmB,CAAI,CACX,CACF,EAEMmB,GAAmB,iBAKnBC,GAAkC,CACtCC,EAA4C,CAAE,EAC9CC,IACG,CACH,IAAMC,EAAiD,IAAIC,GAAO,EAAE,EAChEC,EACAC,EAAqB,GAEzB,SAASC,EAA6BC,EAA4B,CAChE,IAAMC,EAAOC,GAAUpC,EAAA,CAACkC,EAAW,iBAAAG,GAAAA,EAAA,WAAY,iBAAAC,GAAAA,EAAA,MAAA,CAAA,CAAM,EAErD,GAAIH,IAAS,OACX,OAKF,IAAMI,EAAcV,EAAa,OAAOM,CAAI,EAE5C,GAAII,IAAgB,OAClB,OAKF,IAAMC,GAASxC,EAAA,CAACkC,EAAU,SAAAO,GAAAA,EAAA,WAAY,iBAAAC,GAAAA,EAAA,MAAA,CAAA,GAAU,CAAA,GAAI,OAAOC,GAASA,EAAM,WAAa,aAAa,EAEpG,QAASC,EAAI,EAAGA,EAAIJ,EAAO,OAAQI,IAAK,CAEtC,IAAMC,EAAaL,EAAO,OAASI,EAAI,EAEjCE,EAAsBP,EAAYK,CAAC,EACnCG,EAAgBP,EAAOK,CAAU,EAGvC,GAAI,CAACE,GAAiB,CAACD,EACrB,MAKAA,EAAoB,OAAS,QAE7BC,EAAc,SAAW,IAEzB,CAACC,GAAmBD,EAAc,SAAUD,EAAoB,QAAQ,IAK1EC,EAAc,KAAOD,EAAoB,KAC3C,CACF,CAEA,SAASG,EAAyBrD,EAAqB,CACrD,QAAWsC,KAAalC,EAAA,CAAAJ,EAAO,iBAAAsD,GAAAA,EAAA,UAAW,iBAAAC,GAAAA,EAAA,MAAA,CAAA,GAAU,CAAA,EAClDlB,EAA6BC,CAAS,EAGxC,OAAOtC,CACT,CAEA,MAAO,CACL,KAAM6B,GACN,WAAY,CACV,IAAM2B,EAASC,GAAS,EAClBC,EAActD,EAAA,CAAEoD,EAAQ,iBAAAG,GAAAA,EAAA,WAAU,OAAAC,GAAAA,EAAA,CAAE,CAAA,EAE1C,GAAI,CAAAxD,EAAA,CAACsD,EAAa,iBAAAG,GAAAA,EAAE,qBAAA,CAAA,EAClB,OAOF,GAF+BC,GAAa,GAEhB,CAC1BC,EAAO,IAAI,oEAAoE,EAC/E,MACF,CAEAtE,GAAa,OAAOuC,CAAe,EAAE,KACnCgC,GAAW,CACT,SAASC,EACPC,EACA,CAAE,OAAQ,CAAE,OAAAC,EAAQ,KAAAC,EAAM,WAAAC,CAAW,CAAG,EACxCrF,EACM,CACN,GAAImF,IAAW,aAAeA,IAAW,mBAAoB,CAC3DnF,EAAQ,EACR,MACF,CAEAoB,EAAA,CAAA+B,EAAa,eAAAmC,GAAAA,EAAE,CAAA,CAAA,EAGf,IAAMC,EAAgBC,GAAcN,EAAa9D,EAAA,CAAAgE,EAAM,iBAAAK,GAAAA,EAAA,WAAA,CAAA,CAAW,EAElE,GAAIF,GAAiB,KAAW,CAC9BvF,EAAQ,EACR,MACF,CAEA,GAAM,CAAE,IAAAK,EAAK,KAAAE,CAAA,EAASR,GAAqC6D,GAAU,CACnEX,EAAa,IAAIsC,EAAe3B,CAAM,EACtC5D,EAAQ,CACtB,CAAa,EAID,QAASgE,EAAI,EAAGA,EAAI,KAAK,IAAIqB,EAAW,OAAQ,CAAC,EAAGrB,IAAK,CAEvD,GAAM,CAAE,WAAA0B,EAAY,aAAAC,EAAc,KAAMjD,CAAA,EAAQ2C,EAAWrB,CAAC,EAEtD4B,EAAaF,EAAW,KAAKG,GAASA,EAAM,OAAS,OAAO,EAG5DvF,GACJoC,EAAI,YAAc,UAAY,CAACA,EAAI,UAAYiD,EAAe,GAACjD,EAAA,SAAA,IAAAiD,CAAA,GAEA,GAAAvE,EAAA,CAAAwE,EAAA,iBAAAE,GAAAA,EAAA,OAAA,SAAAC,GAAAA,EAAA,QAAA,CAAA,IAAA,OACA1F,EAAAuD,GAAA,CACAA,EAAAI,CAAA,EAAA,CAAA,SAAA1D,EAAA,EACAC,EAAAqD,CAAA,CACA,CAAA,MACA,CACA,IAAAnC,EAAAmE,EAAA,OAAA,SACAvF,EAAAuD,GACAxC,EAAA,CAAA4D,EAAA,iBAAAgB,GAAAA,EAAA,kBAAA,OAAAC,GAAAA,EAAAxE,EAAAC,GAAA,CACAkC,EAAAI,CAAA,EAAA,CAAA,SAAA1D,GAAA,KAAAoB,CAAA,EACAnB,EAAAqD,CAAA,CACA,CAAA,CAAA,CAAA,CACA,CACA,CACA,CAEArD,EAAA,CAAA,CAAA,CACA,CAEA,IAAAQ,EAAAgC,EAAA,uBAAA,GAQA,GANAiC,EAAA,oBACA,CAAAkB,EAAAlG,IACAiF,EAAAP,EAAA,YAAAwB,EAAAlG,CAAA,EACAe,CACA,EAEAA,EAAA,CACA,IAAAoF,EAAApD,EAAA,wBAAA,GAEAI,EAAAiD,GACAD,EACA,IAAA,CACApB,EAAA,IAAA,oCAAA,EACA3D,EAAA,CAAA4D,EAAA,iBAAAqB,GAAAA,EAAA,qBAAA,OAAAC,GAAAA,EAAA,EAAA,CAAA,CAAA,CACA,EACAC,GAAA,CACAxB,EAAA,IACA,qFAAAwB,CAAA,WACA,EACAnF,EAAA,CAAA4D,EAAA,iBAAAwB,GAAAA,EAAA,qBAAA,OAAAC,GAAAA,EAAA,EAAA,CAAA,CAAA,CACA,CACA,CACA,CAEArD,EAAA,EACA,EACAsD,GAAA,CACA3B,EAAA,IAAA,oDAAA2B,CAAA,CACA,CACA,CACA,EACA,aAAA1F,EAAA,CACA,OAAAoC,EACAiB,EAAArD,CAAA,EAGAA,CACA,EAEA,uBAAA,CACA,OAAAiC,EAAA,IACA,EACA,sBAAA,CACA,OAAAA,EAAA,OAAA,EAAA,CAAA,CACA,CACA,CACA,EAKA0D,GAAA7D,GCzYxE,IAAM8D,GAA4B,CAACC,EAA4C,CAAA,IAC7EC,GAAa,MAAQ,GAAKC,GAA8BF,CAAO,EAAIG,GAA+BH,CAAO,+GCFlH,IAAII,GAEEC,GAAmB,UAEnBC,GAAuB,KACpB,CACL,KAAMD,GACN,aAAaE,EAAO,CAClB,OAAAA,EAAM,QAAU,CACd,GAAGA,EAAM,QACT,GAAGC,GAAW,CACtB,EAEaD,CACb,CACA,GAMaE,GAAuCH,GAGpD,SAASI,IAAqB,CAC5B,GAAI,CACF,OAAOC,EAAQ,MAAQ,OAAO,KAAKA,EAAQ,KAAA,EAAoC,CAAA,CACnF,MAAc,CACV,MAAO,CAAA,CACX,CACA,CAGA,SAASC,IAEP,CACA,IAAMC,EAAaF,EAAQ,MAAQA,EAAQ,KAAK,OAAU,CAAA,EACpDG,EAAQJ,GAAQ,EAChBK,EAEF,CAAA,EACEC,EAEF,CAAA,EAEJ,OAAAF,EAAM,QAAQG,GAAQ,CACpB,IAAIC,EAAMD,EAGJE,EAAQ,IAA2B,CACvC,IAAMC,EAAOF,EAGb,GAFAA,EAAMG,GAAQD,CAAI,EAEd,CAACF,GAAOE,IAASF,GAAOF,EAAKI,CAAI,EACnC,OAEF,GAAIP,EAAU,QAAQK,CAAG,EAAI,EAC3B,OAAOC,EAAK,EAGd,IAAMG,EAAUC,GAAKH,EAAM,cAAc,EAGzC,GAFAJ,EAAKI,CAAI,EAAI,GAET,CAACI,GAAWF,CAAO,EACrB,OAAOH,EAAK,EAGd,GAAI,CACF,IAAMM,EAAO,KAAK,MAAMC,GAAaJ,EAAS,MAAM,CAAC,EAIrDP,EAAMU,EAAK,IAAI,EAAIA,EAAK,OAChC,MAAoB,CAEpB,CACA,EAEIN,EAAK,CACT,CAAG,EAEMJ,CACT,CAGA,SAASP,IAAyC,CAChD,OAAKJ,KACHA,GAAcQ,GAAc,GAEvBR,EACT,SC1FA,IAAMuB,GAA2B,IAK1B,SAASC,GAAkBC,EAAoB,CACpDC,GAAe,IAAM,CAEnB,QAAQ,MAAMD,CAAK,CACvB,CAAG,EAED,IAAME,EAASC,GAAS,EAExB,GAAID,IAAW,OAAW,CACxBE,IAAeC,EAAO,KAAK,4DAA4D,EACvF,OAAO,QAAQ,KAAK,CAAC,EACrB,MACJ,CAEE,IAAMC,EAAUJ,EAAO,WAAU,EAC3BK,EACHD,GAAWA,EAAQ,iBAAmBA,EAAQ,gBAAkB,GAAKA,EAAQ,iBAC9ER,GACFI,EAAO,MAAMK,CAAO,EAAE,KACnBC,GAAoB,CACdA,GACHJ,IAAeC,EAAO,KAAK,4EAA4E,EAEzG,OAAO,QAAQ,KAAK,CAAC,CAC3B,EACIL,GAAS,CACPI,IAAeC,EAAO,MAAML,CAAK,CACvC,CACA,CACA,CCJA,IAAMS,GAAmB,sBAKZC,GAAmD,CAACC,EAA+C,CAAA,IAAO,CACrH,IAAMC,EAAsB,CAC1B,qCAAsC,GACtC,GAAGD,CACP,EAEE,MAAO,CACL,KAAMF,GACN,MAAMI,EAAoB,CACxB,OAAO,QAAQ,GAAG,oBAAqBC,GAAiBD,EAAQD,CAAmB,CAAC,CAC1F,CACA,CACA,EAKO,SAASE,GAAiBD,EAAoBF,EAAmD,CAEtG,IAAII,EAA4B,GAC5BC,EAA6B,GAC7BC,EAA4B,GAC5BC,EAEEC,EAAgBN,EAAO,WAAU,EAEvC,OAAO,OAAO,OACXO,GAAuB,CACtB,IAAIC,EAAoCC,GAEpCX,EAAQ,aACVU,EAAeV,EAAQ,aACdQ,EAAc,eACvBE,EAAeF,EAAc,cAsB/B,IAAMI,EAd8B,OAAO,QAAQ,UAAU,mBAAmB,EAAuB,OACrGC,GAIIA,EAAS,OAAS,gCAElBA,EAAS,MAAQ,+BAEhBA,EAA0B,gBAAkB,EAGzD,EAAQ,SAEsD,EAClDC,EAAgCd,EAAQ,sCAAwCY,EAEjFR,EAyBCU,IACER,GAEFS,IACEC,EAAO,KACL,gGAChB,EACYL,GAAkBF,CAAK,GACbJ,IAeVA,EAAoB,GACpB,WAAW,IAAM,CACVC,IAEHA,EAAmB,GACnBI,EAAaH,EAAYE,CAAK,EAI9C,EAAe,GAAO,KArDdF,EAAaE,EACbL,EAAmB,GAEfa,GAAS,IAAOf,GAClBgB,GAAiBT,EAAO,CACtB,kBAAmBA,EACnB,eAAgB,CACd,MAAO,OACrB,EACY,UAAW,CACT,QAAS,GACT,KAAM,qBACpB,CACA,CAAW,EAGC,CAACH,GAAoBQ,IACvBR,EAAmB,GACnBI,EAAaD,CAAK,GAuC5B,EACI,CAAE,cAAe,EAAA,CACrB,CACA,KCnJA,IAAMU,GAAmB,uBAEnBC,GAAoC,CAACC,EAAgD,CAAA,IAAO,CAChG,IAAMC,EAAOD,EAAQ,MAAQ,OAE7B,MAAO,CACL,KAAMF,GACN,MAAMI,EAAQ,CACZ,OAAO,QAAQ,GAAG,qBAAsBC,GAA4BD,EAAQ,CAAE,KAAAD,CAAK,CAAC,CAAC,CAC3F,CACA,CACA,EAKaG,GAAoDL,GAS1D,SAASI,GACdD,EACAF,EAC6C,CAC7C,OAAO,SAA8BK,EAAiBC,EAAwB,CACxEC,GAAS,IAAOL,IAIpBM,GAAiBH,EAAQ,CACvB,kBAAmBC,EACnB,eAAgB,CACd,MAAO,CAAE,0BAA2B,EAAA,CAC5C,EACM,UAAW,CACT,QAAS,GACT,KAAM,sBACd,CACA,CAAK,EAEDG,GAAgBJ,EAAQL,CAAO,EACnC,CACA,CAMA,SAASS,GAEPJ,EACAL,EACM,CAEN,IAAMU,EACJ,mMAMEV,EAAQ,OAAS,OACnBW,GAAe,IAAM,CACnB,QAAQ,KAAKD,CAAgB,EAE7B,QAAQ,MAAML,GAAUA,EAAO,MAAQA,EAAO,MAAQA,CAAM,CAClE,CAAK,EACQL,EAAQ,OAAS,WAC1BW,GAAe,IAAM,CACnB,QAAQ,KAAKD,CAAgB,CACnC,CAAK,EACDE,GAAkBP,CAAM,EAG5B,0BC3FA,IAAMQ,GAAgD,CAAA,EAM/C,SAASC,EACdC,EACAC,EACgD,CAChD,OAAO,OAAO,OACXC,GAAsB,CACrB,IAAMC,EAAeL,GAAaE,CAAI,EACtC,GAAIG,EAAc,CAEZD,GACFC,EAAa,UAAUD,CAAO,EAEhC,MACR,CAEM,IAAME,EAAkBH,EAAQC,CAAO,EACvCJ,GAAaE,CAAI,EAAII,EAErBC,GAAgCD,CAAe,CACrD,EACI,CAAE,GAAIJ,CAAA,CACV,CACA,CC/BAM,IACO,SAASC,IAAiB,CAC/B,OAAO,OAAOC,EAAY,GAC5B,CCSA,IAAMC,GAAmB,UAEZC,GAAoBC,EAC/BF,GACA,IACE,IAAI,0BAAuB,CACzB,YAAYG,EAAM,CAChBC,GAAgBD,EAAM,wBAAwB,EAE9C,IAAME,EAAaC,GAAWH,CAAI,EAAE,MAAQ,CAAA,EAEtCI,EAAOF,EAAW,cAAc,EAElCE,GACFJ,EAAK,aAAaK,GAA8B,GAACD,CAAA,UAAA,EAIA,IAAAE,EAAAJ,EAAA,cAAA,EACA,OAAAI,GAAA,UACAN,EAAA,WAAAM,CAAA,CAEA,EACA,aAAAC,EAAAC,EAAA,CACA,GAAAC,GAAA,IAAAC,GAAA,EACA,OAAAC,IACAC,EAAA,KAAA,qFAAA,EACAJ,EAEA,GAAAD,EAAA,YAAA,kBAAA,CAEA,IAAAM,EAAAN,EAAA,QACAO,EAAAD,EAAA,OAAAA,EAAA,OAAA,YAAA,EAAA,MACAJ,GAAA,EAAA,mBAAA,GAAAK,CAAA,IAAAP,EAAA,KAAA,EAAA,CACA,CACA,OAAAC,CACA,CACA,CAAA,CACA,EAEAO,GAAA,KACA,CACA,KAAAlB,GACA,WAAA,CACAC,GAAA,CACA,CACA,GASAkB,GAAAD,wBChC3D,IAAME,GAAmB,UAEZC,GAAoBC,EAC/BF,GACA,IACE,IAAI,0BAAuB,CACzB,YAAYG,EAAM,CAChBC,GAAyBD,CAAI,CAC9B,CACP,CAAK,CACL,EAEME,GAAuB,KACpB,CACL,KAAML,GACN,WAAY,CACVC,GAAiB,CAClB,CACL,GAQaK,GAAuCD,GAiDJ,SAAAE,GAAAC,EAAA,CACA,IAAAC,EAAAC,GAAAF,CAAA,EAAA,MAAA,CAAA,EAGAG,EAAAF,EAAA,cAAA,EAGA,GAAAA,EAAAG,EAAA,GAAA,CAAAD,EACA,OAGAH,EAAA,cAAA,CACA,CAAAK,EAAA,EAAA,yBACA,CAAAD,EAAA,EAAA,GAAAD,CAAA,UACA,CAAA,EAGA,IAAAG,EAAAL,EAAA,cAAA,GAAAA,EAAA,aAAA,GAAAA,EAAA,WAAA,EACA,OAAAK,GAAA,UAEAN,EAAA,WAAAM,EAAA,QAAA,eAAA,EAAA,CAAA,CAEA,sBC9GhD,IAAMC,GAAmB,UAEZC,GAAoBC,EAC/BF,GACA,CAACG,EAA2B,CAAA,IAAO,CACjC,IAAMC,EAAU,CACd,mBAAoB,GACpB,0BAA2B,GAC3B,GAAGD,CACT,EAEI,OAAO,IAAI,0BAAuB,CAChC,GAAGC,EACH,aAAaC,EAAM,CACjBC,GAAgBD,EAAM,2BAA2B,CACzD,CACA,CAAK,CACL,CACA,EAEME,GAAuB,CAACH,EAA0B,CAAA,KAC/C,CACL,KAAMJ,GACN,WAAY,CACVC,GAAkBG,CAAO,CAC/B,CACA,GAQaI,GAAuCD,wBCjDpD,IAAME,GAAmB,QAEZC,GAAkBC,EAC7BF,GACA,IACE,IAAI,0BAAuB,CACzB,aAAaG,EAAM,CACjBC,GAAgBD,EAAM,oBAAoB,CAClD,CACA,CAAK,CACL,EAEME,GAAqB,KAClB,CACL,KAAML,GACN,WAAY,CACVC,GAAe,CACrB,CACA,GAQaK,GAAqCD,wBC1BlD,IAAME,GAAmB,WAEZC,GAAqBC,EAChCF,GACA,IACE,IAAI,2BAAwB,CAC1B,aAAaG,EAAM,CACjBC,GAAgBD,EAAM,uBAAuB,CACrD,CACA,CAAK,CACL,EAEME,GAAwB,KACrB,CACL,KAAML,GACN,WAAY,CACVC,GAAkB,CACxB,CACA,GAQaK,GAAwCD,wBC5BrD,IAAME,GAAmB,QAEZC,GAAkBC,EAAuBF,GAAkB,IAAM,IAAI,wBAAqB,CAAA,CAAE,CAAC,EAEpGG,GAAqB,KAClB,CACL,KAAMH,GACN,WAAY,CACVC,GAAe,CACrB,CACA,GAQaG,GAAqCD,wBChBlD,IAAME,GAAmB,SAEZC,GAAmBC,EAC9BF,GACA,IACE,IAAI,yBAAsB,CACxB,aAAaG,EAAM,CACjBC,GAAgBD,EAAM,qBAAqB,CACnD,CACA,CAAK,CACL,EAEME,GAAsB,KACnB,CACL,KAAML,GACN,WAAY,CACVC,GAAgB,CACtB,CACA,GAQaK,GAAsCD,yCC9BnD,IAAME,GAAsB,CAAC,MAAO,MAAO,OAAO,EAErCC,GAAe,CAAC,MAAO,MAAM,EAC7BC,GAAe,CAAC,MAAO,OAAO,EAKpC,SAASC,GAAaC,EAAyBC,EAA0B,CAC9E,OAAOD,EAAc,SAASC,EAAQ,YAAW,CAAE,CACrD,CAGO,SAASC,GACdD,EACwE,CACxE,OAAIF,GAAaF,GAAcI,CAAO,EAC7B,YACEF,GAAaD,GAAcG,CAAO,EACpC,YAEP,MAEJ,CAEA,SAASE,GAAaC,EAAaC,EAA6B,CAC9D,OAAOA,EAAS,KAAKC,GAAUF,EAAI,WAAWE,CAAM,CAAC,CACvD,CAGO,SAASC,GAAkBC,EAAsBC,EAAmD,CACzG,GAAI,CACF,GAAIA,EAAQ,SAAW,EACrB,OAIF,IAAMC,EAAcC,GACd,OAAOA,GAAQ,UAAY,OAAOA,GAAQ,UAAY,OAAO,SAASA,CAAG,EACpE,CAACA,EAAI,SAAQ,CAAE,EACb,MAAM,QAAQA,CAAG,EACnBC,GAAQD,EAAI,IAAIA,GAAOD,EAAWC,CAAG,CAAC,CAAC,EAEvC,CAAC,WAAW,EAIjBE,EAAWJ,EAAQ,CAAC,EAC1B,OAAIV,GAAaH,GAAqBY,CAAY,GAAKK,GAAY,KAC1DH,EAAWG,CAAQ,EAGrBD,GAAQH,EAAQ,IAAIE,GAAOD,EAAWC,CAAG,CAAC,CAAC,CACtD,MAAc,CACV,MACJ,CACA,CAIO,SAASG,GAAuBN,EAAsBO,EAAgBV,EAA6B,CACxG,GAAI,CAACH,GAAkBM,CAAY,EACjC,MAAO,GAGT,QAAWJ,KAAOW,EAChB,GAAIZ,GAAaC,EAAKC,CAAQ,EAC5B,MAAO,GAGX,MAAO,EACT,CAGO,SAASW,GAAuBC,EAAuC,CAC5E,IAAMC,EAAWC,GAAuC,CACtD,GAAI,CACF,OAAI,OAAO,SAASA,CAAK,EAAUA,EAAM,WAChC,OAAOA,GAAU,SAAiBA,EAAM,OACxC,OAAOA,GAAU,SAAiBA,EAAM,SAAQ,EAAG,OACnDA,GAAU,KAAoC,EAChD,KAAK,UAAUA,CAAK,EAAE,MACnC,MAAgB,CACV,MACN,CACA,EAEE,OAAO,MAAM,QAAQF,CAAQ,EACzBA,EAAS,OAAO,CAACG,EAAyBC,IAAS,CACjD,IAAMC,EAAOJ,EAAQG,CAAI,EACzB,OAAO,OAAOC,GAAS,SAAYF,IAAQ,OAAYA,EAAME,EAAOA,EAAQF,CACpF,EAAS,CAAC,EACJF,EAAQD,CAAQ,CACtB,CCnEA,IAAMM,GAAmB,QAErBC,GAA8B,CAAA,EAE5BC,GAA0D,CAACC,EAAYC,EAAcC,EAASC,IAAa,CAC/GH,EAAK,aAAaI,GAAkC,oBAAoB,EAExE,IAAMC,EAAUC,GAAkBL,EAAcC,CAAO,EACjDK,EAAiBC,GAAkBP,CAAY,EAErD,GACE,CAACI,GACD,CAACE,GACD,CAAAE,EAAA,CAACX,GAAa,iBAAAY,GAAAA,EAAE,aAAc,CAAA,GAC9B,CAACC,GAAuBV,EAAcI,EAASP,GAAc,aAAa,EAG1E,OAKF,IAAMc,EAAqBH,EAAA,CAAAI,GAAW,OAAAC,GAAAA,EAAAd,CAAI,EAAC,SAAAe,GAAAA,EAAC,KAAI,iBAAAC,GAAAA,EAAG,eAAe,CAAC,CAAA,EAC7DC,EAAkBR,EAAA,CAAAI,GAAW,OAAAK,GAAAA,EAAAlB,CAAI,EAAC,SAAAmB,GAAAA,EAAC,KAAI,iBAAAC,GAAAA,EAAG,eAAe,CAAC,CAAA,EAC5DH,GAAmBL,GACrBZ,EAAK,cAAc,CAAE,uBAAwBY,EAAoB,oBAAqBK,CAAA,CAAiB,EAGzG,IAAMI,EAAgBC,GAAuBnB,CAAQ,EAEjDkB,GACFrB,EAAK,aAAauB,GAAoCF,CAAa,EAGjEG,GAAaC,GAAcxB,CAAY,GAAKoB,IAAkB,QAChErB,EAAK,aAAa0B,GAA8BL,EAAgB,CAAC,EAGnErB,EAAK,cAAc,CACjB,CAAC2B,EAA4B,EAAGpB,EAChC,CAACqB,EAA4B,EAAGvB,CACpC,CAAG,EAED,IAAMwB,EAAkBxB,EAAQ,KAAK,IAAI,EAEzCL,EAAK,WAAW8B,GAASD,EAAiB,IAAI,CAAC,CACjD,EAEME,GAAoBC,EAAuB,UAAW,IACnD,IAAI,0BAAuB,CAChC,aAAcjC,EAClB,CAAG,CACF,EAEKkC,GAAmBD,EAAuB,UAAW,IAClD,IAAI,wBAAqB,CAC9B,aAAcjC,EAClB,CAAG,CACF,EAGYmC,GAAkB,OAAO,OACpC,IAAY,CACVH,GAAiB,EACjBE,GAAgB,CAIjB,EACD,CAAE,GAAIpC,EAAkB,CAC1B,EAEMsC,GAAqB,CAACC,EAAwB,CAAA,KAC3C,CACL,KAAMvC,GACN,WAAY,CACVC,GAAgBsC,EAChBF,GAAe,CAChB,CACL,GAQaG,GAAqCF,wBCxElD,IAAMG,GAAmB,OAEZC,GAAiBC,EAAuBF,GAAkB,IAAM,IAAI,sBAAqB,EAEhGG,GAAoB,KACjB,CACL,KAAMH,GACN,WAAY,CACVC,GAAc,CACf,CACL,GAQaG,GAAoCD,wBCvDjD,IAAME,GAAmB,WAEZC,GAAqBC,EAChCF,GACA,IACE,IAAI,qBAAkB,CACpB,kBAAmB,GACnB,YAAYG,EAAM,CAChBC,GAAgBD,EAAM,uBAAuB,CACrD,CACA,CAAK,CACL,EAEME,GAAwB,KACrB,CACL,KAAML,GACN,WAAY,CACVC,GAAkB,CACxB,CACA,GAQaK,GAAwCD,wBCfrD,IAAME,GAAmB,OAEZC,GAAiBC,EAAuBF,GAAkB,IAAM,IAAI,sBAAqB,EAEhGG,GAAoB,KACjB,CACL,KAAMH,GACN,WAAY,CACVC,GAAc,CACf,CACL,GASaG,GAAoCD,6BCrBjD,IAAME,GAAmB,MAEZC,GAAgBC,EAC3BF,GACA,IACE,IAAI,sBAAmB,CACrB,YAAYG,EAAMC,EAAM,CAGtB,GAFAC,GAAqBF,CAAI,EAErBG,GAAiB,IAAOC,GAAwB,EAAI,CACtDC,IAAeC,EAAO,KAAK,+EAA+E,EAC1G,MACF,CACA,IAAMC,EAAaC,GAAWR,CAAI,EAAE,KAC9BS,EAAQF,GAAcA,EAAWG,EAAmB,EAEpDC,EAAiBC,EAAA,CAAAX,EAAI,iBAAAY,GAAAA,EAAE,QAAO,iBAAAC,GAAAA,EAAE,QAAO,iBAAAC,GAAAA,EAAE,OAAQ,iBAAAC,GAAAA,EAAA,YAAY,OAAAC,GAAAA,EAAA,CAAA,CAAA,GAAK,MACpER,GACFN,GAAiB,EAAG,mBAAmB,GAACQ,CAAA,IAAAF,CAAA,EAAA,CAEA,CACA,CAAA,CACA,EAEAS,GAAA,KACA,CACA,KAAArB,GACA,WAAA,CACAC,GAAA,CACA,CACA,GAGAqB,GAAAD,GAgBA,SAAAE,GAAAC,EAAA,CACAA,EAAA,aAAAC,GAAA,oBAAA,EAEA,IAAAC,EAAAC,GAAAH,CAAA,EAAA,MAAA,CAAA,EAGAI,EAAAF,EAAA,UAAA,EAEAE,GACAJ,EAAA,aAAAK,GAAA,GAAAD,CAAA,MAAA,EAIA,IAAAE,EAAAJ,EAAA,UAAA,EACA,OAAAI,GAAA,UAGAN,EAAA,WAAAM,GAAA,aAAA,CAEA,sBCnElD,IAAMC,GAAmB,UAEZC,GAAoBC,EAAuBF,GAAkB,IAAM,IAAI,yBAAwB,EAEtGG,GAAuB,KACpB,CACL,KAAMH,GACN,WAAY,CACVC,GAAiB,CACvB,CACA,GAGaG,GAAuCD,WCX7C,SAASE,IAAgD,CAC9D,MAAO,CACLC,GAAkB,EAClBC,GAAkB,EAClBC,GAAkB,EAClBC,GAAgB,EAChBC,GAAmB,EACnBC,GAAgB,EAChBC,GAAiB,EACjBC,GAAgB,EAChBC,GAAmB,EAKnBC,GAAe,EACfC,GAAe,EACfC,GAAc,EACdC,GAAkB,CACtB,CACA,6OCWA,IAAMC,GAAW,OAAO,wBAAwB,EAQ1BC,GAAN,cAAyB,QAAM,CAO7C,YAAYC,EAA0B,CACpC,MAAMA,CAAI,EACV,KAAKF,EAAQ,EAAI,CAAA,CACnB,CAUA,iBAAiBG,EAAqC,CACpD,GAAIA,EAAS,CAIX,GAAI,OAAQA,EAAgB,gBAAmB,UAC7C,OAAOA,EAAQ,eAMjB,GAAI,OAAOA,EAAQ,UAAa,SAC9B,OAAOA,EAAQ,WAAa,QAEhC,CAKA,GAAM,CAAE,MAAAC,CAAM,EAAI,IAAI,MACtB,OAAI,OAAOA,GAAU,SAAiB,GAC/BA,EAAM,MAAM;CAAI,EAAE,KAAKC,GAAKA,EAAE,QAAQ,YAAY,IAAM,IAAMA,EAAE,QAAQ,aAAa,IAAM,EAAE,CACtG,CAEA,aAAaC,EAAyBH,EAA2BI,EAAmD,CAClH,IAAMC,EAAc,CAClB,GAAGL,EACH,eAAgB,KAAK,iBAAiBA,CAAO,CACnD,EACI,QAAQ,QAAQ,EACb,KAAK,IAAM,KAAK,QAAQG,EAAKE,CAAW,CAAC,EACzC,KAAKC,GAAU,CACd,GAAIA,aAAuB,SAEzB,OAAOA,EAAO,WAAWH,EAAKE,CAAW,EAE3C,KAAKR,EAAQ,EAAE,cAAgBS,EAE/B,MAAM,aAAaH,EAAKH,EAASI,CAAE,CACpC,EAAEA,CAAE,CACT,CAEA,kBAA2B,CACzB,IAAME,EAAS,KAAKT,EAAQ,EAAE,cAE9B,GADA,KAAKA,EAAQ,EAAE,cAAgB,OAC3B,CAACS,EACH,MAAM,IAAI,MAAM,oDAAoD,EAEtE,OAAOA,CACT,CAEA,IAAI,aAAsB,CACxB,OAAAC,GAAO,KAAKV,EAAQ,EAAE,YAAe,IAAC,KAAK,WAAa,SAAW,IAAM,EAAG,CAC9E,CAEA,IAAI,YAAYW,EAAW,CACrB,KAAKX,EAAQ,IACf,KAAKA,EAAQ,EAAE,YAAcW,EAEjC,CAEA,IAAI,UAAmB,CACrB,OAAAD,GAAO,KAAKV,EAAQ,EAAE,SAAY,IAAC,KAAK,iBAAiB,EAAI,SAAW,OAAQ,CAClF,CAEA,IAAI,SAASW,EAAW,CAClB,KAAKX,EAAQ,IACf,KAAKA,EAAQ,EAAE,SAAWW,EAE9B,CACF,MCpHA,SAASC,MAASC,EAAuB,CACvCC,EAAO,IAAI,2CAA4C,GAAGD,CAAI,CAChE,CAQO,SAASE,GAAmBC,EAA2E,CAC5G,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CAKtC,IAAIC,EAAgB,EACdC,EAAoB,CAAA,EAE1B,SAASC,GAAO,CACd,IAAMC,EAAIN,EAAO,KAAI,EACjBM,EAAGC,EAAOD,CAAC,EACVN,EAAO,KAAK,WAAYK,CAAI,CACvC,CAEI,SAASG,GAAU,CACjBR,EAAO,eAAe,MAAOS,CAAK,EAClCT,EAAO,eAAe,QAASU,CAAO,EACtCV,EAAO,eAAe,WAAYK,CAAI,CAC5C,CAEI,SAASI,GAAQ,CACfD,EAAO,EACPZ,GAAM,OAAO,EACbM,EAAO,IAAI,MAAM,0DAA0D,CAAC,CAClF,CAEI,SAASQ,EAAQC,EAAY,CAC3BH,EAAO,EACPZ,GAAM,aAAce,CAAG,EACvBT,EAAOS,CAAG,CAChB,CAEI,SAASJ,EAAOD,EAAW,CACzBF,EAAQ,KAAKE,CAAC,EACdH,GAAiBG,EAAE,OAEnB,IAAMM,EAAW,OAAO,OAAOR,EAASD,CAAa,EAC/CU,EAAeD,EAAS,QAAQ;;CAAU,EAEhD,GAAIC,IAAiB,GAAI,CAEvBjB,GAAM,8CAA8C,EACpDS,EAAI,EACJ,MACR,CAEM,IAAMS,EAAcF,EAAS,MAAM,EAAGC,CAAY,EAAE,SAAS,OAAO,EAAE,MAAM;CAAM,EAC5EE,EAAYD,EAAY,MAAK,EACnC,GAAI,CAACC,EACH,OAAAf,EAAO,QAAO,EACPE,EAAO,IAAI,MAAM,gDAAgD,CAAC,EAE3E,IAAMc,EAAiBD,EAAU,MAAM,GAAG,EACpCE,EAAa,EAAED,EAAe,CAAC,GAAK,GACpCE,EAAaF,EAAe,MAAM,CAAC,EAAE,KAAK,GAAG,EAC7CG,EAA+B,CAAA,EACrC,QAAWC,KAAUN,EAAa,CAChC,GAAI,CAACM,EAAQ,SACb,IAAMC,EAAaD,EAAO,QAAQ,GAAG,EACrC,GAAIC,IAAe,GACjB,OAAArB,EAAO,QAAO,EACPE,EAAO,IAAI,MAAM,gDAAgDkB,CAAM,GAAG,CAAC,EAEpF,IAAME,EAAMF,EAAO,MAAM,EAAGC,CAAU,EAAE,YAAW,EAC7CE,EAAQH,EAAO,MAAMC,EAAa,CAAC,EAAE,UAAS,EAC9CG,EAAUL,EAAQG,CAAG,EACvB,OAAOE,GAAY,SACrBL,EAAQG,CAAG,EAAI,CAACE,EAASD,CAAK,EACrB,MAAM,QAAQC,CAAO,EAC9BA,EAAQ,KAAKD,CAAK,EAElBJ,EAAQG,CAAG,EAAIC,CAEzB,CACM3B,GAAM,mCAAoCmB,EAAWI,CAAO,EAC5DX,EAAO,EACPP,EAAQ,CACN,QAAS,CACP,WAAAgB,EACA,WAAAC,EACA,QAAAC,CACV,EACQ,SAAAP,CACR,CAAO,CACP,CAEIZ,EAAO,GAAG,QAASU,CAAO,EAC1BV,EAAO,GAAG,MAAOS,CAAK,EAEtBJ,EAAI,CACR,CAAG,CACH,CCjGA,SAASoB,MAASC,EAAuB,CACvCC,EAAO,IAAI,sBAAuB,GAAGD,CAAI,CAC3C,CA8BA,IAAAE,GAAA,cAAAC,EAAA,CACA,OAAA,cAAA,CAAA,KAAA,UAAA,CAAA,OAAA,OAAA,CAAA,CAMA,YAAAC,EAAAC,EAAA,CACA,MAAAA,CAAA,EACA,KAAA,QAAA,CAAA,EACA,KAAA,MAAA,OAAAD,GAAA,SAAA,IAAA,IAAAA,CAAA,EAAAA,EACA,KAAA,aAAAE,GAAAC,EAAA,CAAAF,EAAA,iBAAAG,GAAAA,EAAA,OAAA,CAAA,EAAA,KAAA,CAAA,EAAA,EACAT,GAAA,4CAAA,KAAA,MAAA,IAAA,EAGA,IAAAU,GAAA,KAAA,MAAA,UAAA,KAAA,MAAA,MAAA,QAAA,WAAA,EAAA,EACAC,EAAA,KAAA,MAAA,KAAA,SAAA,KAAA,MAAA,KAAA,EAAA,EAAA,KAAA,MAAA,WAAA,SAAA,IAAA,GACA,KAAA,YAAA,CAEA,cAAA,CAAA,UAAA,EACA,GAAAL,EAAAM,GAAAN,EAAA,SAAA,EAAA,KACA,KAAAI,EACA,KAAAC,CACA,CACA,CAMA,MAAA,QAAAE,EAAAP,EAAA,CACA,GAAA,CAAA,MAAAD,CAAA,EAAA,KAEA,GAAA,CAAAC,EAAA,KACA,MAAA,IAAA,UAAA,oBAAA,EAIA,IAAAQ,EACA,GAAAT,EAAA,WAAA,SAAA,CACAL,GAAA,4BAAA,KAAA,WAAA,EACA,IAAAe,EAAA,KAAA,YAAA,YAAA,KAAA,YAAA,KACAD,EAAA,WAAA,CACA,GAAA,KAAA,YACA,WAAAC,GAAA,QAAAA,CAAA,EAAA,OAAAA,CACA,CAAA,CACA,MACAf,GAAA,4BAAA,KAAA,WAAA,EACAc,EAAA,WAAA,KAAA,WAAA,EAGA,IAAAE,EACA,OAAA,KAAA,cAAA,WAAA,KAAA,aAAA,EAAA,CAAA,GAAA,KAAA,YAAA,EACAN,EAAA,UAAAJ,EAAA,IAAA,EAAA,IAAAA,EAAA,IAAA,IAAAA,EAAA,KACAW,EAAA,WAAAP,CAAA,IAAAJ,EAAA,IAAA;EAGA,GAAAD,EAAA,UAAAA,EAAA,SAAA,CACA,IAAAa,EAAA,GAAA,mBAAAb,EAAA,QAAA,CAAA,IAAA,mBAAAA,EAAA,QAAA,CAAA,GACAW,EAAA,qBAAA,EAAA,SAAA,OAAA,KAAAE,CAAA,EAAA,SAAA,QAAA,CAAA,EACA,CAEAF,EAAA,KAAA,GAAAN,CAAA,IAAAJ,EAAA,IAAA,GAEAU,EAAA,kBAAA,IACAA,EAAA,kBAAA,EAAA,KAAA,UAAA,aAAA,SAEA,QAAAG,KAAA,OAAA,KAAAH,CAAA,EACAC,GAAA,GAAAE,CAAA,KAAAH,EAAAG,CAAA,CAAA;EAGA,IAAAC,EAAAC,GAAAP,CAAA,EAEAA,EAAA,MAAA,GAAAG,CAAA;CAAA,EAEA,GAAA,CAAA,QAAAK,EAAA,SAAAC,CAAA,EAAA,MAAAH,EAMA,GALAP,EAAA,KAAA,eAAAS,CAAA,EAGA,KAAA,KAAA,eAAAA,EAAAT,CAAA,EAEAS,EAAA,aAAA,IAAA,CAGA,GAFAT,EAAA,KAAA,SAAAW,EAAA,EAEAlB,EAAA,eAAA,CAGAN,GAAA,oCAAA,EACA,IAAAe,EAAAT,EAAA,YAAAA,EAAA,KACA,OAAA,WAAA,CACA,GAAAM,GAAAN,EAAA,OAAA,OAAA,MAAA,EACA,OAAAQ,EACA,WAAA,QAAAC,CAAA,EAAA,OAAAA,CACA,CAAA,CACA,CAEA,OAAAD,CACA,CAaAA,EAAA,QAAA,EAEA,IAAAW,EAAA,IAAA,UAAA,CAAA,SAAA,EAAA,CAAA,EACA,OAAAA,EAAA,SAAA,GAGAZ,EAAA,KAAA,SAAAa,GAAA,CACA1B,GAAA,2CAAA,EAIA0B,EAAA,KAAAH,CAAA,EACAG,EAAA,KAAA,IAAA,CACA,CAAA,EAEAD,CACA,CACA,EAAAtB,GAAA,aAAA,EAEA,SAAAqB,GAAAV,EAAA,CACAA,EAAA,OAAA,CACA,CAEA,SAAAF,GACAe,KACAC,EAGA,CACA,IAAAC,EAAA,CAAA,EAGAC,EACA,IAAAA,KAAAH,EACAC,EAAA,SAAAE,CAAA,IACAD,EAAAC,CAAA,EAAAH,EAAAG,CAAA,GAGA,OAAAD,CACA,CC9LA,IAAME,GAAiB,KAAO,GAM9B,SAASC,GAAeC,EAAqC,CAC3D,OAAO,IAAIC,GAAS,CAClB,MAAO,CACL,KAAK,KAAKD,CAAI,EACd,KAAK,KAAK,IAAI,CACf,CACL,CAAG,CACH,CAKO,SAASE,GAAkBC,EAA0C,CAC1E,IAAIC,EAEJ,GAAI,CACFA,EAAc,IAAI,IAAID,EAAQ,GAAG,CACjC,MAAU,CACV,OAAAE,GAAe,IAAM,CAEnB,QAAQ,KACN,yHACR,CACA,CAAK,EACMC,GAAgBH,EAAS,IAAM,QAAQ,QAAQ,CAAE,CAAA,CAAC,CAC3D,CAEA,IAAMI,EAAUH,EAAY,WAAa,SAInCI,EAAQC,GACZL,EACAD,EAAQ,QAAUI,EAAU,QAAQ,IAAI,YAAc,SAAc,QAAQ,IAAI,UACpF,EAEQG,EAAmBH,EAAUI,GAAQC,GACrCC,EAAYV,EAAQ,YAAc,OAAY,GAAQA,EAAQ,UAI9DW,EAAQN,EACT,IAAIO,GAAgBP,CAAK,EAC1B,IAAIE,EAAiB,MAAM,CAAE,UAAAG,EAAW,WAAY,GAAI,QAAS,GAAA,CAAM,EAG3E,OAAOG,GAAgB,IAAM,CAC3B,IAAMC,EAAkBC,GAAsBf,EAAOgB,GAAEhB,EAAQ,WAAW,IAAGO,CAAgB,EAAEI,CAAK,EACpG,OAAOR,GAAgBH,EAASc,CAAe,CACnD,CAAG,CACH,CASA,SAASR,GAAmBW,EAA2BZ,EAA+C,CACpG,GAAM,CAAE,SAAAa,CAAA,EAAa,QAAQ,IAU7B,GAPE,EAAAA,GACAA,EACG,MAAM,GAAG,EACT,KACCC,GAAaF,EAAqB,KAAK,SAASE,CAAS,GAAKF,EAAqB,SAAS,SAASE,CAAS,CACtH,GAKI,OAAOd,CAEX,CAKA,SAASU,GACPf,EACAoB,EACAT,EAC0B,CAC1B,GAAM,CAAE,SAAAU,EAAU,SAAAC,EAAU,KAAAC,EAAM,SAAAC,EAAU,OAAAC,CAAO,EAAI,IAAI,IAAIzB,EAAQ,GAAG,EAC1E,OAAO,SAAqB0B,EAAkE,CAC5F,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,IAAI/B,EAAOD,GAAe8B,EAAQ,IAAI,EAEhCG,EAAkC,CAAE,GAAG7B,EAAQ,OAAA,EAEjD0B,EAAQ,KAAK,OAAS/B,KACxBkC,EAAQ,kBAAkB,EAAI,OAC9BhC,EAAOA,EAAK,KAAKiC,GAAY,CAAA,GAG/B,IAAMC,EAAMX,EAAW,QACrB,CACE,OAAQ,OACR,MAAAT,EACA,QAAAkB,EACA,SAAAR,EACA,KAAM,GAACC,CAAA,GAAAG,CAAA,GACA,KAAAF,EACA,SAAAC,EACA,GAAAxB,EAAA,OACA,EACAgC,GAAA,CACAA,EAAA,GAAA,OAAA,IAAA,CAEA,CAAA,EAEAA,EAAA,GAAA,MAAA,IAAA,CAEA,CAAA,EAEAA,EAAA,YAAA,MAAA,EAIA,IAAAC,EAAAjB,GAAAgB,EAAA,QAAA,aAAA,EAAA,IAAA,IAAA,EACAE,EAAAlB,GAAAgB,EAAA,QAAA,sBAAA,EAAA,IAAA,IAAA,EAEAL,EAAA,CACA,WAAAK,EAAA,WACA,QAAA,CACA,cAAAC,EACA,uBAAA,MAAA,QAAAC,CAAA,EAAAA,EAAA,CAAA,GAAA,KAAAA,CACA,CACA,CAAA,CACA,CACA,EAEAH,EAAA,GAAA,QAAAH,CAAA,EACA/B,EAAA,KAAAkC,CAAA,CACA,CAAA,CACA,CACA,sDC1KjB,SAASI,GAAqBC,EAAsB,CAClD,OAAOA,EACJ,QAAQ,UAAW,EAAE,EACrB,QAAQ,MAAO,GAAG,CACvB,CAGO,SAASC,GACdC,EAAmB,QAAQ,KAAK,CAAC,EAAIC,GAAQ,QAAQ,KAAK,CAAC,CAAC,EAAI,QAAQ,IAAG,EAC3EC,EAAqBC,KAAQ,KACyB,CACtD,IAAMC,EAAiBF,EAAYL,GAAqBG,CAAQ,EAAIA,EAEpE,OAAQK,GAAiC,CACvC,GAAI,CAACA,EACH,OAGF,IAAMC,EAAqBJ,EAAYL,GAAqBQ,CAAQ,EAAIA,EAGpE,CAAE,IAAAE,EAAK,KAAMC,EAAM,IAAAC,CAAI,EAAIC,GAAM,MAAMJ,CAAkB,GAEzDG,IAAQ,OAASA,IAAQ,QAAUA,IAAQ,UAC7CD,EAAOA,EAAK,MAAM,EAAGC,EAAI,OAAS,EAAE,GAGjCF,IAEHA,EAAM,KAGR,IAAMI,EAAIJ,EAAI,YAAY,eAAe,EACzC,GAAII,EAAI,GACN,MAAO,GAACJ,EAAA,MAAAI,EAAA,EAAA,EAAA,QAAA,MAAA,GAAA,CAAA,IAAAH,CAAA,GAKA,GAAAD,EAAA,WAAAH,CAAA,EAAA,CACA,IAAAQ,EAAAL,EAAA,MAAAH,EAAA,OAAA,CAAA,EAAA,QAAA,MAAA,GAAA,EAEA,OAAAQ,IACAA,GAAA,KAEAA,GAAAJ,EAEAI,CACA,CAEA,OAAAJ,CACA,CACA,CCuDD,IAAAK,GAAkCC,GAAkBC,GAAoBC,GAA2B,CAAE,CAAC,mGCpGnH,IAAMC,GAA0C,IAGnCC,GAAN,cAAyBC,EAAuC,CAM9D,YAAYC,EAA4B,CAC7C,IAAMC,EAA4C,CAChD,GAAGD,EACH,SAAU,OACV,QAAS,CAAE,KAAM,OAAQ,QAAS,OAAO,QAAQ,OAAS,EAC1D,WAAYA,EAAQ,YAAc,OAAO,QAAQ,IAAI,aAAkB,YAAU,CACvF,EAEIE,GAAiBD,EAAe,MAAM,EAEtCE,EAAO,IACL,iCAAiC,QAAQ,GAAG,aAAaC,GAAe,OAAS,UAAUC,EAAQ,EAAC,GACA,EAEA,MAAAJ,CAAA,CACA,CAGA,IAAA,QAAA,CACA,GAAA,KAAA,QACA,OAAA,KAAA,QAGA,IAAAK,EAAA,eACAC,EAAAC,GACAC,EAAAC,GAAA,UAAAJ,EAAAC,CAAA,EACA,YAAA,QAAAE,EAEAA,CACA,CAIA,MAAA,MAAAE,EAAA,CACA,IAAAC,EAAA,KAAA,cACAC,EAAAC,EAAA,CAAAF,EAAA,iBAAAG,GAAAA,EAAA,mBAAA,CAAA,EAEA,OAAAF,GACA,MAAAA,EAAA,WAAA,EAGA,KAAA,WAAA,EAAA,mBACA,KAAA,eAAA,EAGA,MAAA,MAAAF,CAAA,CACA,CAIA,MAAAA,EAAA,CACA,OAAA,KAAA,uBACA,cAAA,KAAA,qBAAA,EAGA,KAAA,kCACA,QAAA,IAAA,aAAA,KAAA,gCAAA,EAGA,MAAA,MAAAA,CAAA,CACA,CAiBA,2BAAA,CACA,IAAAV,EAAA,KAAA,WAAA,EACAA,EAAA,oBACA,KAAA,iCAAA,IAAA,CACA,KAAA,eAAA,CACA,EAEA,KAAA,sBAAA,YACA,IAAA,CACAe,IAAAb,EAAA,IAAA,4CAAA,EACA,KAAA,eAAA,CACA,EACAc,GAAAhB,EAAA,0BAAA,IAAAJ,EAAA,CACA,EAEA,MAAA,EAEA,QAAA,GAAA,aAAA,KAAA,gCAAA,EAEA,CACA,ECtE1G,SAASqB,IAAwC,CAC/C,OAAOC,GAAK,EAAK,CAACC,GAAkB,CAAE,EAAI,CAAA,CAC5C,CAKO,SAASC,IAA0D,CACxE,MAAO,CAELC,GAAyB,EACzBC,GAA2B,EAC3BC,GAAuB,EACvBC,GAAsB,EAEtBC,GAAkB,EAClBC,GAAe,EACfC,GAA0B,EAE1BC,GAA8B,EAC9BC,GAA+B,EAE/BC,GAAuB,EACvBC,GAAyB,EACzBC,GAAsB,EACtB,GAAGf,GAAsB,CAC7B,CACA,CAGO,SAASgB,GAAuBC,EAAiC,CACtE,MAAO,CACL,GAAGd,GAAwC,EAK3C,GAAIe,GAAiCD,CAAO,EAAIE,GAA8B,EAAK,CAAA,CACvF,CACA,CAEA,SAASD,GAAiCD,EAA2B,CACnE,OAAKG,GAAkBH,CAAO,EAMvBA,EAAQ,eAAiBA,EAAQ,kBAAoB,MAAQ,kBAAmBA,EAL9E,EAMX,CxErFA,IAAAI,GAAmB,UAQnB,OAAOC,OAAkB,cAyBlB,IAAMC,MAAoB,YAAQ,CACvC,YAAU,WAA4B,EACtC,QAAS,CAAC,CACZ,CAAC,EAGKC,GAAc,CAClBC,EACAC,EACA,CAAE,KAAAC,CAAK,EAAwB,CAAC,IAC7B,CACH,GAAI,CAACC,GAAiBF,CAAa,EACjC,OAAOH,GAAkB,QAAQ,EAGnC,IAAMM,KAAQ,WAAOH,EAAc,QAASI,GAAmB,cAAc,EACzEJ,EAAc,QAAQ,MACtBA,EAEEK,EAAUN,EAAM,iBAAiBI,EAAO,CAC5C,KAAAF,EACA,eAAiBK,GAAe,CAC9B,IAAMC,EAAYC,GAAiBL,CAAK,EACxC,OAAII,IACFD,EAAW,OAAO,YAAaC,EAAU,SAAS,EAClDD,EAAW,WAAW,cAAeG,GAAiBF,CAAS,CAAC,GAE9DJ,aAAiB,OACnBG,EAAW,WAAW,gBAAiB,CACrC,KAAM,GAAAI,QAAO,KAAKP,CAAK,EACvB,UAAW,GAAAO,QAAO,UAAUP,CAAK,CACnC,CAAC,EAGIG,CACT,CACF,CAAC,EAED,OAAOT,GAAkB,SAAS,CAAE,QAAAQ,CAAQ,CAAC,CAC/C,EAEO,SAASM,GAAoB,CAAE,IAAAC,EAAK,QAAAC,CAAQ,EAAyB,CAC1E,GAAM,CAAE,UAAWC,CAAkB,EAAIC,GAAiB,EAGpDC,EAAe,IAAIC,GAAW,CAClC,QACEH,IAAsB,QAAa,GACrC,IAAKA,GAAqBF,EAC1B,QAAAC,EACA,aAAcK,GAAuB,CAAC,CAAC,EAAE,OACtCC,GACCA,EAAY,OAAS,wBACrBA,EAAY,OAAS,uBAErBA,EAAY,OAAS,SACzB,EACA,YAAaC,GACb,UAAWC,GACX,WAAWC,EAAO,CAIhB,cAAOA,EAAM,YACNA,CACT,EAIA,eAAgB,EAClB,CAAC,EAEKC,EAAc,IAAIC,GACxBD,EAAY,UAAUP,CAAY,EAClCA,EAAa,KAAK,EAElB,IAAMS,EAA6B,IAAI7B,GAEvC,MAAO,CACL,GAAI6B,EAAQ,GAAG,KAAKA,CAAO,EAC3B,YAAa,CACXzB,EACA,CAAE,KAAAC,CAAK,EAAwB,CAAC,IAC7B,CACH,IAAME,EAAQuB,GAAe1B,CAAa,EACpC2B,EAAS7B,GAAYyB,EAAapB,EAAO,CAAE,KAAAF,CAAK,CAAC,EAEvD,OAAAwB,EAAQ,KAAK,gBAAiBtB,CAAK,EAE5BwB,CACT,EACA,mBAAoB,MAAO,CAAE,OAAAC,EAAQ,QAAAvB,EAAS,SAAAwB,CAAS,IAAoB,CAOzE,GAAM,CAAE,cAAAC,CAAc,EAAI,KAAM,QAAO,mBAAiB,EAEzC,IAAIA,EAAc,CAC/B,QAASd,EAAa,WAAW,EAAE,QACnC,IAAKA,EAAa,WAAW,EAAE,IAC/B,aAAc,CAAC,EACf,UAAWK,GACX,YAAaD,EACf,CAAC,EAEM,oBAAoB,CACzB,SAAUf,EACV,KAAM,GACN,MAAO,GAAGuB,CAAM,WAChB,SAAUG;AAAA;AAAA,8CAE4BH,CAAM;AAAA;AAAA,YAExCC,CAAQ;AAAA,SAEd,CAAC,CACH,EACA,WAAY,CAACG,EAAcC,IACzBV,EAAY,WAAWS,EAAMC,CAAO,EACtC,QAAUC,GAAeX,EAAY,QAAQW,CAAI,EACjD,QAAS,IAAwB,CAC/B,IAAMA,EAAOX,EAAY,QAAQ,EACjC,GAAI,OAAOW,GAAM,IAAO,SACtB,MAAO,CAAE,GAAIA,EAAK,EAAG,CAEzB,CACF,CACF,CyE9KAC,IACA,IAAAC,GAAkB,UAClBC,GAAuB,UAFvB,OAAS,SAAAC,OAAa,eCAtBC,IAKA,IAAAC,GAAgC,UAFhC,OAAS,QAAAC,OAAY,YAKd,IAAMC,MAAa,YAAQ,CAChC,UAAQ,WAA0B,EAClC,UAAW,CAAC,CACd,CAAC,EAIKC,GAAYC,GAAE,OAAO,CACzB,KAAMA,GAAE,QAAQ,EAChB,UAAWA,GAAE,OAAO,CACtB,CAAC,EASKC,GAAgB,CAACC,EAAmBC,IACjC,KAAK,IAAI,EAAID,EAAU,QAAQ,EAAIC,EAAa,GAAK,GAAK,IAG5D,SAASC,GAAmBC,EAAiBC,EAAkB,CACpE,IAAMC,EAAgBC,GAAiB,EAEvC,OAAID,EAAc,WACTE,GAAKF,EAAc,WAAYD,CAAQ,EAGzCG,GAAKJ,EAASC,CAAQ,CAC/B,CAEO,SAASI,GAAc,CAC5B,SAAAC,EACA,WAAAR,EAAa,GAAK,CACpB,EAAoB,CAqClB,MAAO,CACL,IArCU,SAAiC,CAC3C,GAAI,CAGF,GAFsB,MAAMS,GAAWD,CAAQ,EAE5B,CACjB,IAAME,EAAYd,GAAU,MAAM,MAAMe,GAASH,CAAQ,CAAC,EAE1D,GAAI,CAACV,GAAcY,EAAU,UAAWV,CAAU,EAChD,OAAOL,GAAW,OAAO,CAAE,KAAMe,EAAU,IAAK,CAAC,CAErD,CAEA,OAAOf,GAAW,UAAU,CAC9B,OAASiB,EAAG,CACV,MAAM,IAAIC,GAAS,CACjB,KAAMC,GAAa,kBAAkB,CAAE,KAAMN,CAAS,CAAC,EACvD,MAAOI,CACT,CAAC,CACH,CACF,EAmBE,IAjBU,MAAOG,GAAuC,CACxD,GAAI,CACF,aAAMC,GAAUR,EAAU,CACxB,KAAAO,EACA,UAAW,KAAK,IAAI,CACtB,CAAC,EACMpB,GAAW,OAAO,CAAE,KAAAoB,CAAK,CAAC,CACnC,OAASH,EAAG,CACV,MAAM,IAAIC,GAAS,CACjB,KAAMC,GAAa,mBAAmB,CAAE,KAAMN,CAAS,CAAC,EACxD,MAAOI,CACT,CAAC,CACH,CACF,CAKA,CACF,CCrFAK,IAAA,IAAAC,GAA6C,UCA7CC,IAAA,IAAAC,GAAkB,UAKX,IAAMC,GAAgB,IAC3B,GAAAC,QAAA,cAACC,GAAA,CACC,QAAQ,2BACR,WAAY,CAAC,GAAAD,QAAA,cAACE,GAAA,CAAK,IAAI,iCAAiC,CAAE,EAC5D,EDCK,IAAMC,GAA8B,CAAC,CAAE,SAAAC,CAAS,IAAM,CAC3D,GAAM,CAAE,EAAAC,CAAE,EAAIC,GAAe,EACvB,CAACC,EAAaC,CAAc,KAAI,aAAS,EAAK,EAC9C,CAACC,EAASC,CAAU,KAAI,aAAkB,EAE1CC,KAAsB,gBAAaC,GAAmB,CAC1DF,EAAWE,CAAK,EACXA,GAAOJ,EAAe,EAAI,CACjC,EAAG,CAAC,CAAC,EAECK,KAAe,gBAClBC,GAAqB,CACpBN,EAAe,EAAI,EACnBJ,EAAS,CAAE,SAAAU,CAAS,CAAC,CACvB,EACA,CAACV,CAAQ,CACX,EAEA,OACE,GAAAW,QAAA,iBAAAA,QAAA,cACE,GAAAA,QAAA,cAACC,GAAA,CAAI,cAAc,SAAS,UAAW,EAAG,aAAc,GACtD,GAAAD,QAAA,cAACE,EAAA,KAAMZ,EAAE,qBAAqB,CAAE,EAChC,GAAAU,QAAA,cAACE,EAAA,CAAK,KAAK,aAAaZ,EAAE,wBAAwB,CAAE,CACtD,EACA,GAAAU,QAAA,cAACG,GAAA,CACC,MAAOb,EAAE,6BAA6B,EACtC,SAAUM,EACZ,EACCF,IAAY,IACX,GAAAM,QAAA,cAACI,GAAA,CACC,MAAOd,EAAE,8BAA8B,EACvC,SAAUQ,EACZ,EAEDN,GACC,GAAAQ,QAAA,cAACC,GAAA,CAAI,cAAc,SAAS,UAAW,GACrC,GAAAD,QAAA,cAACE,EAAA,KAEKZ,EADHI,EACK,0BACA,wBADyB,CAEjC,EACA,GAAAM,QAAA,cAACK,GAAA,IAAU,CACb,CAEJ,CAEJ,EExDAC,IAAA,IAAAC,GAAkB,UAKX,IAAMC,GAA2B,IAEpC,GAAAC,QAAA,cAACC,GAAA,CAAI,cAAc,SAAS,UAAW,GACrC,GAAAD,QAAA,cAACE,GAAA,IAAU,CACb,ECTJ,IAAAC,GAAA,CACE,sBAAuB,4FACvB,yBAA0B,4DAC1B,8BAA+B,mBAC/B,+BAAgC,sBAChC,0BAA2B,4EAC3B,yBAA0B,+BAC1B,2BAA4B,4DAC9B,ELUA,eAAsBC,GAAoB,CACxC,UAAAC,EACA,aAAAC,EACA,cAAAC,CACF,EAAY,CACV,GACE,CAACC,GAAM,OACP,CAACH,GACD,IAAC,WAAOC,EAAcG,GAAkB,QAAQ,EAEhD,OAGF,IAAMC,EAAUC,GAAc,CAC5B,SAAUN,EACV,WAAY,CACd,CAAC,EACKO,EAAa,MAAMF,EAAQ,IAAI,EAErC,MAAI,WAAOE,EAAYC,GAAW,MAAM,EACtC,OAGF,IAAMC,EAAOP,EAAc,QAAQ,EAE/BO,EACF,MAAMC,GACJ,GAAAC,QAAA,cAACC,GAAA,CAAa,SAAUC,IACtB,GAAAF,QAAA,cAACG,GAAA,CACC,SAAU,CAAC,CAAE,SAAAC,CAAS,IAAM,CACrBb,EAAc,mBAAmB,CACpC,OAAQO,EAAK,GACb,QAASR,EAAa,QACtB,SAAAc,CACF,CAAC,CACH,EACF,CACF,CACF,EAEAC,GACE,GAAAL,QAAA,cAACC,GAAA,CAAa,SAAUC,IACtB,GAAAF,QAAA,cAACM,GAAA,IAAqB,CACxB,CACF,EAGF,MAAMZ,EAAQ,IAAI,CAAE,SAAU,EAAK,CAAC,CACtC,CjFvDO,SAASa,GAAmB,CACjC,gBAAAC,EACA,sBAAAC,EACA,GAAGC,CACL,EAG0B,CACxB,IAAMC,EAAgBC,GAAoBF,CAAoB,EAExDG,EAA0B,SAAU,CAAE,MAAAC,EAAO,KAAAC,CAAK,EAAG,CACzD,IAAMC,EAAeL,EAAc,YAAYG,EAAO,CAAE,KAAAC,CAAK,CAAC,EAC9DE,GAAgB,GAAAC,QAAA,cAACC,GAAA,CAAY,MAAOL,EAAO,CAAE,EAC7CM,GAAiBZ,EAAiBM,CAAK,EACvCO,GAAQ,SAAW,EAEnBC,GAAoB,CAClB,aAAAN,EACA,cAAAL,EACA,UAAWF,CACb,CAAC,EAAE,MAAOc,GAAe,CACvBH,GAAiBZ,EAAiBe,CAAC,CACrC,CAAC,CACH,EA6BA,MAAO,CACL,QAAAV,EACA,cAAAF,EACA,wBA9B8B,UAAY,CAC1CU,GAAQ,GAAG,oBAAsBP,GAAU,CACzCD,EAAQ,CACN,MAAAC,EACA,KAAM,CAAE,UAAW,CAAE,QAAS,GAAO,KAAM,mBAAoB,CAAE,CACnE,CAAC,CACH,CAAC,EAEDO,GAAQ,GAAG,qBAAuBP,GAAU,CAKxCA,aAAiB,OACjBA,EAAM,QAAQ,WAAW,mBAAmB,GAC5CA,EAAM,OAAO,SAAS,SAAS,GAKjCD,EAAQ,CACN,MAAAC,EACA,KAAM,CAAE,UAAW,CAAE,QAAS,GAAO,KAAM,oBAAqB,CAAE,CACpE,CAAC,CACH,CAAC,CACH,CAMA,CACF,CuFpEAU,IAAA,IAAAC,GAAiD,UAI3CC,MAAuB,kBAAoC,IAAI,EAOxDC,GAAoCC,GAC/C,GAAAC,QAAA,cAACH,GAAqB,SAArB,CAA+B,GAAGE,EAAO,EAG/BE,GAAmB,IAAqB,CACnD,IAAMC,KAAU,eAAWL,EAAoB,EAC/C,GAAIK,IAAY,KACd,MAAM,IAAI,MACR,sEACF,EAEF,OAAOA,CACT,ECvBAC,ICAAC,IACA,IAAAC,GAAiD,UAG3CC,MAAY,kBAA+B,IAAI,EAExCC,GAAa,SAAU,CAClC,SAAAC,EACA,MAAOC,CACT,EAGG,CACD,OAAO,GAAAC,QAAA,cAACJ,GAAU,SAAV,CAAmB,MAAOG,GAAWD,CAAS,CACxD,EAEaG,GAAc,IAAgB,CACzC,IAAMC,KAAU,eAAWN,EAAS,EAEpC,GAAIM,IAAY,KACd,MAAM,IAAI,MAAM,sDAAsD,EAGxE,OAAOA,CACT,ECxBAC","names":["suppressTracing","context","SUPPRESS_TRACING_KEY","unsuppressTracing","isTracingSuppressed","init_suppress_tracing","__esmMin","init_esm_shims","init_esm","createContextKey","BAGGAGE_KEY_PAIR_SEPARATOR","BAGGAGE_PROPERTIES_SEPARATOR","BAGGAGE_ITEMS_SEPARATOR","BAGGAGE_HEADER","BAGGAGE_MAX_NAME_VALUE_PAIRS","BAGGAGE_MAX_PER_NAME_VALUE_PAIRS","BAGGAGE_MAX_TOTAL_LENGTH","init_constants","__esmMin","init_esm_shims","serializeKeyPairs","keyPairs","hValue","current","value","BAGGAGE_ITEMS_SEPARATOR","BAGGAGE_MAX_TOTAL_LENGTH","getKeyPairs","baggage","_a","_b","__read","key","entry","BAGGAGE_PROPERTIES_SEPARATOR","parsePairKeyValue","valueProps","keyPairPart","separatorIndex","BAGGAGE_KEY_PAIR_SEPARATOR","metadata","baggageEntryMetadataFromString","parseKeyPairsIntoRecord","keyPair","headers","init_esm","init_constants","W3CBaggagePropagator","init_W3CBaggagePropagator","__esmMin","init_esm_shims","init_esm","init_suppress_tracing","init_constants","init_utils","context","carrier","setter","baggage","propagation","isTracingSuppressed","keyPairs","getKeyPairs","pair","BAGGAGE_MAX_PER_NAME_VALUE_PAIRS","BAGGAGE_MAX_NAME_VALUE_PAIRS","headerValue","serializeKeyPairs","BAGGAGE_HEADER","getter","baggageString","BAGGAGE_ITEMS_SEPARATOR","pairs","entry","keyPair","parsePairKeyValue","baggageEntry","AnchoredClock","init_anchored_clock","__esmMin","init_esm_shims","systemClock","monotonicClock","delta","sanitizeAttributes","attributes","out","_b","__values","_c","_d","__read","key","val","isAttributeKey","diag","isAttributeValue","isHomogeneousAttributeValueArray","isValidPrimitiveAttributeValue","arr","type","arr_1","arr_1_1","element","init_attributes","__esmMin","init_esm_shims","init_esm","loggingErrorHandler","ex","diag","stringifyException","flattenException","result","current","propertyName","value","init_logging_error_handler","__esmMin","init_esm_shims","init_esm","setGlobalErrorHandler","handler","delegateHandler","globalErrorHandler","ex","init_global_error_handler","__esmMin","init_esm_shims","init_logging_error_handler","loggingErrorHandler","TracesSamplerValues","init_sampling","__esmMin","init_esm_shims","isEnvVarABoolean","key","ENVIRONMENT_BOOLEAN_KEYS","isEnvVarANumber","ENVIRONMENT_NUMBERS_KEYS","isEnvVarAList","ENVIRONMENT_LISTS_KEYS","parseBoolean","environment","values","value","parseNumber","name","min","max","parseStringList","output","input","separator","DEFAULT_LIST_SEPARATOR","givenValue","v","setLogLevelFromEnv","theLevel","logLevelMap","parseEnvironment","env","DEFAULT_ENVIRONMENT","DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT","DEFAULT_ATTRIBUTE_COUNT_LIMIT","DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","init_environment","__esmMin","init_esm_shims","init_esm","init_sampling","DiagLogLevel","TracesSamplerValues","getEnv","processEnv","parseEnvironment","DEFAULT_ENVIRONMENT","getEnvWithoutDefaults","init_environment","__esmMin","init_esm_shims","_globalThis","init_globalThis","__esmMin","init_esm_shims","intValue","charCode","hexToBinary","hexStr","buf","offset","i","hi","lo","init_hex_to_binary","__esmMin","init_esm_shims","hexToBase64","hexStr","hexToBinary","init_hex_to_base64","__esmMin","init_esm_shims","init_hex_to_binary","getIdGenerator","bytes","i","SHARED_BUFFER","SPAN_ID_BYTES","TRACE_ID_BYTES","RandomIdGenerator","init_RandomIdGenerator","__esmMin","init_esm_shims","performance","otperformance","init_performance","__esmMin","init_esm_shims","VERSION","init_version","__esmMin","init_esm_shims","SDK_INFO","init_sdk_info","__esmMin","init_esm_shims","init_version","init_esm","_a","SEMRESATTRS_TELEMETRY_SDK_NAME","SEMRESATTRS_PROCESS_RUNTIME_NAME","SEMRESATTRS_TELEMETRY_SDK_LANGUAGE","TELEMETRYSDKLANGUAGEVALUES_NODEJS","SEMRESATTRS_TELEMETRY_SDK_VERSION","VERSION","unrefTimer","timer","init_timer_util","__esmMin","init_esm_shims","init_node","__esmMin","init_esm_shims","init_environment","init_globalThis","init_hex_to_base64","init_RandomIdGenerator","init_performance","init_sdk_info","init_timer_util","init_platform","__esmMin","init_esm_shims","init_node","millisToHrTime","epochMillis","epochSeconds","seconds","nanos","MILLISECONDS_TO_NANOSECONDS","getTimeOrigin","timeOrigin","otperformance","perf","hrTime","performanceNow","now","addHrTimes","timeInputToHrTime","time","isTimeInputHrTime","hrTimeDuration","startTime","endTime","SECOND_TO_NANOSECONDS","hrTimeToTimeStamp","precision","NANOSECOND_DIGITS","tmp","nanoString","date","hrTimeToNanoseconds","hrTimeToMilliseconds","hrTimeToMicroseconds","value","isTimeInput","time1","time2","out","NANOSECOND_DIGITS_IN_MILLIS","init_time","__esmMin","init_esm_shims","init_platform","init_types","__esmMin","init_esm_shims","ExportResultCode","init_ExportResult","__esmMin","init_esm_shims","CompositePropagator","init_composite","__esmMin","init_esm_shims","init_esm","config","_a","p","x","y","context","carrier","setter","_b","__values","_c","propagator","err","diag","getter","ctx","validateKey","key","VALID_KEY_REGEX","validateValue","value","VALID_VALUE_BASE_REGEX","INVALID_VALUE_COMMA_EQUAL_REGEX","VALID_KEY_CHAR_RANGE","VALID_KEY","VALID_VENDOR_KEY","init_validators","__esmMin","init_esm_shims","MAX_TRACE_STATE_ITEMS","MAX_TRACE_STATE_LEN","LIST_MEMBERS_SEPARATOR","LIST_MEMBER_KEY_VALUE_SPLITTER","TraceState","init_TraceState","__esmMin","init_esm_shims","init_validators","rawTraceState","key","value","traceState","_this","agg","part","listMember","validateKey","validateValue","parseTraceParent","traceParent","match","TRACE_PARENT_REGEX","TRACE_PARENT_HEADER","TRACE_STATE_HEADER","VERSION","VERSION_PART","TRACE_ID_PART","PARENT_ID_PART","FLAGS_PART","W3CTraceContextPropagator","init_W3CTraceContextPropagator","__esmMin","init_esm_shims","init_esm","init_suppress_tracing","init_TraceState","context","carrier","setter","spanContext","trace","isTracingSuppressed","isSpanContextValid","TraceFlags","getter","traceParentHeader","traceStateHeader","state","TraceState","init_IdGenerator","__esmMin","init_esm_shims","setRPCMetadata","context","meta","RPC_METADATA_KEY","deleteRPCMetadata","getRPCMetadata","RPCType","init_rpc_metadata","__esmMin","init_esm_shims","init_esm","createContextKey","AlwaysOffSampler","init_AlwaysOffSampler","__esmMin","init_esm_shims","init_esm","SamplingDecision","AlwaysOnSampler","init_AlwaysOnSampler","__esmMin","init_esm_shims","init_esm","SamplingDecision","ParentBasedSampler","init_ParentBasedSampler","__esmMin","init_esm_shims","init_esm","init_global_error_handler","init_AlwaysOffSampler","init_AlwaysOnSampler","config","globalErrorHandler","AlwaysOnSampler","_a","_b","AlwaysOffSampler","_c","_d","context","traceId","spanName","spanKind","attributes","links","parentContext","trace","isSpanContextValid","TraceFlags","TraceIdRatioBasedSampler","init_TraceIdRatioBasedSampler","__esmMin","init_esm_shims","init_esm","_ratio","context","traceId","isValidTraceId","SamplingDecision","ratio","accumulation","i","pos","part","overArg","func","transform","arg","isPlainObject","value","isObjectLike","baseGetTag","objectTag","proto","getPrototype","Ctor","hasOwnProperty","funcToString","objectCtorString","undefinedTag","nullTag","symToStringTag","getRawTag","objectToString","isOwn","tag","unmasked","result","nativeObjectToString","funcProto","objectProto","init_lodash_merge","__esmMin","init_esm_shims","merge","args","_i","result","objects","mergeTwoObjects","takeValue","value","isArray","one","two","level","MAX_LEVEL","isPrimitive","isFunction","j","isObject","keys","key","shouldMerge","twoValue","obj1","obj2","wasObjectReferenced","arr1","arr2","obj","arr","i","info","isPlainObject","init_merge","__esmMin","init_esm_shims","init_lodash_merge","callWithTimeout","promise","timeout","timeoutHandle","timeoutPromise","_resolve","reject","TimeoutError","result","reason","init_timeout","__esmMin","init_esm_shims","_super","__extends","message","_this","urlMatches","url","urlToMatch","isUrlIgnored","ignoredUrls","ignoredUrls_1","__values","ignoredUrls_1_1","ignoreUrl","isWrapped","func","init_wrap","__esmMin","init_esm_shims","Deferred","init_promise","__esmMin","init_esm_shims","_this","resolve","reject","val","err","BindOnceFuture","init_callback","__esmMin","init_esm_shims","init_promise","_callback","_that","Deferred","_this","args","_i","_a","__spreadArray","__read","val","err","_export","exporter","arg","resolve","context","suppressTracing","result","init_exporter","__esmMin","init_esm_shims","init_esm","init_suppress_tracing","esm_exports","__export","AlwaysOffSampler","AlwaysOnSampler","AnchoredClock","BindOnceFuture","CompositePropagator","DEFAULT_ATTRIBUTE_COUNT_LIMIT","DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT","DEFAULT_ENVIRONMENT","DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","ExportResultCode","ParentBasedSampler","RPCType","RandomIdGenerator","SDK_INFO","TRACE_PARENT_HEADER","TRACE_STATE_HEADER","TimeoutError","TraceIdRatioBasedSampler","TraceState","TracesSamplerValues","VERSION","W3CBaggagePropagator","W3CTraceContextPropagator","_globalThis","addHrTimes","utils_exports","callWithTimeout","deleteRPCMetadata","getEnv","getEnvWithoutDefaults","getRPCMetadata","getTimeOrigin","globalErrorHandler","hexToBase64","hexToBinary","hrTime","hrTimeDuration","hrTimeToMicroseconds","hrTimeToMilliseconds","hrTimeToNanoseconds","hrTimeToTimeStamp","internal","isAttributeKey","isAttributeValue","isTimeInput","isTimeInputHrTime","isTracingSuppressed","isUrlIgnored","isWrapped","loggingErrorHandler","merge","millisToHrTime","otperformance","parseEnvironment","parseTraceParent","sanitizeAttributes","setGlobalErrorHandler","setRPCMetadata","suppressTracing","timeInputToHrTime","unrefTimer","unsuppressTracing","urlMatches","init_esm","__esmMin","init_esm_shims","init_W3CBaggagePropagator","init_anchored_clock","init_attributes","init_global_error_handler","init_logging_error_handler","init_time","init_types","init_hex_to_binary","init_ExportResult","init_platform","init_composite","init_W3CTraceContextPropagator","init_IdGenerator","init_rpc_metadata","init_AlwaysOffSampler","init_AlwaysOnSampler","init_ParentBasedSampler","init_TraceIdRatioBasedSampler","init_suppress_tracing","init_TraceState","init_environment","init_merge","init_sampling","init_timeout","init_url","init_wrap","init_callback","init_version","init_exporter","_export","AttributeNames","exports","api_1","semantic_conventions_1","core_1","url","AttributeNames_1","getAbsoluteUrl","requestUrl","headers","fallbackProtocol","reqUrlObject","protocol","port","path","host","exports","parseResponseStatus","kind","statusCode","upperBound","satisfiesPattern","constant","pattern","isIgnored","list","onException","e","setSpanWithError","span","error","message","setRequestContentLengthAttribute","request","attributes","length","getContentLength","setResponseContentLengthAttribute","response","contentLengthHeader","contentLength","isCompressed","encoding","getRequestInfo","options","extraOptions","pathname","origin","optionsParsed","hostname","method","isValidOptionsType","type","extractHostnameAndPort","requestOptions","matches","_a","getOutgoingRequestAttributes","requestMethod","userAgent","getOutgoingRequestMetricAttributes","spanAttributes","metricAttributes","setAttributesFromHttpKind","getOutgoingRequestAttributesOnResponse","statusMessage","httpVersion","socket","remoteAddress","remotePort","getOutgoingRequestMetricAttributesOnResponse","getIncomingRequestAttributes","ips","serverName","getIncomingRequestMetricAttributes","getIncomingRequestAttributesOnResponse","rpcMetadata","localAddress","localPort","getIncomingRequestMetricAttributesOnResponse","headerCapture","normalizedHeaders","i","len","capturedHeader","getHeader","value","normalizedHeader","key","exports","init_Logger","__esmMin","init_esm_shims","init_LoggerProvider","__esmMin","init_esm_shims","SeverityNumber","init_LogRecord","__esmMin","init_esm_shims","init_LoggerOptions","__esmMin","init_esm_shims","init_AnyValue","__esmMin","init_esm_shims","NoopLogger","NOOP_LOGGER","init_NoopLogger","__esmMin","init_esm_shims","_logRecord","NoopLoggerProvider","NOOP_LOGGER_PROVIDER","init_NoopLoggerProvider","__esmMin","init_esm_shims","init_NoopLogger","_name","_version","_options","NoopLogger","_globalThis","init_globalThis","__esmMin","init_esm_shims","init_node","__esmMin","init_esm_shims","init_globalThis","init_platform","__esmMin","init_esm_shims","init_node","makeGetter","requiredVersion","instance","fallback","version","GLOBAL_LOGS_API_KEY","_global","API_BACKWARDS_COMPATIBILITY_VERSION","init_global_utils","__esmMin","init_esm_shims","init_platform","_globalThis","LogsAPI","init_logs","__esmMin","init_esm_shims","init_global_utils","init_NoopLoggerProvider","provider","_global","GLOBAL_LOGS_API_KEY","makeGetter","API_BACKWARDS_COMPATIBILITY_VERSION","NOOP_LOGGER_PROVIDER","_b","_a","name","version","options","logs","init_esm","__esmMin","init_esm_shims","init_Logger","init_LoggerProvider","init_LogRecord","init_LoggerOptions","init_AnyValue","init_NoopLogger","init_NoopLoggerProvider","init_logs","LogsAPI","enableInstrumentations","instrumentations","tracerProvider","meterProvider","loggerProvider","i","j","instrumentation","disableInstrumentations","init_autoLoaderUtils","__esmMin","init_esm_shims","registerInstrumentations","options","tracerProvider","trace","meterProvider","metrics","loggerProvider","logs","instrumentations","_b","_a","enableInstrumentations","disableInstrumentations","init_autoLoader","__esmMin","init_esm_shims","init_esm","init_autoLoaderUtils","require_shimmer","__commonJSMin","exports","module","init_esm_shims","isFunction","funktion","logger","defineProperty","obj","name","value","enumerable","shimmer","options","wrap","nodule","wrapper","original","wrapped","massWrap","nodules","names","unwrap","massUnwrap","shimmer","InstrumentationAbstract","init_instrumentation","__esmMin","init_esm_shims","init_esm","instrumentationName","instrumentationVersion","config","__assign","diag","trace","metrics","logs","meterProvider","loggerProvider","initResult","_a","tracerProvider","hookHandler","triggerName","span","info","e","require_homedir","__commonJSMin","exports","module","init_esm_shims","os","home","user","require_caller","__commonJSMin","exports","module","init_esm_shims","origPrepareStackTrace","_","stack","require_path_parse","__commonJSMin","exports","module","init_esm_shims","isWindows","splitWindowsRe","win32","win32SplitPath","filename","pathString","allParts","splitPathRe","posix","posixSplitPath","require_node_modules_paths","__commonJSMin","exports","module","init_esm_shims","path","parse","getNodeModulesDirs","absoluteStart","modules","prefix","paths","parsed","dirs","aPath","moduleDir","start","opts","request","require_normalize_options","__commonJSMin","exports","module","init_esm_shims","path","_","opts","findPnpApi","runPnpResolution","request","basedir","parts","api","manifestPath","packagePath","unqualifiedPath","runPnpResolutionOnArray","paths","i","resolution","originalPaths","packageIterator","getCandidates","pathsToTest","getNodeModulePaths","nodeModules","isInsideIterator","require_implementation","__commonJSMin","exports","module","init_esm_shims","ERROR_MESSAGE","toStr","max","funcType","concatty","a","b","arr","i","j","slicy","arrLike","offset","joiny","joiner","str","that","target","args","bound","binder","result","boundLength","boundArgs","Empty","require_function_bind","__commonJSMin","exports","module","init_esm_shims","implementation","require_hasown","__commonJSMin","exports","module","init_esm_shims","call","$hasOwn","bind","require_core","__commonJSMin","exports","module","require_is_core_module","__commonJSMin","exports","module","init_esm_shims","hasOwn","specifierIncluded","current","specifier","nodeParts","parts","op","versionParts","i","cur","ver","matchesRange","range","specifiers","versionIncluded","nodeVersion","specifierValue","data","x","require_async","__commonJSMin","exports","module","init_esm_shims","fs","getHomedir","path","caller","nodeModulesPaths","normalizeOptions","isCore","realpathFS","homedir","defaultPaths","defaultIsFile","file","cb","err","stat","defaultIsDir","dir","defaultRealpath","x","realpathErr","realPath","maybeRealpath","realpath","opts","defaultReadPackage","readFile","pkgfile","readFileErr","body","pkg","getPackageCandidates","start","dirs","options","callback","isFile","isDirectory","readPackage","conflictErr","packageIterator","extensions","includeCoreModules","basedir","parent","absoluteStart","realStart","init","res","loadAsDirectory","onfile","loadAsFile","loadNodeModules","n","realN","moduleError","m","d","realD","thePackage","loadAsFilePackage","exts","load","loadPackage","onpkg","loadpkg","pkg_","rfile","rel","r","onex","ex","unwrapErr","pkgdir","pkgParam","loadAsDirectoryPackage","fpkg","mainError","processDirs","isdir","ondir","thunk","require_core","__commonJSMin","exports","module","require_core","__commonJSMin","exports","module","init_esm_shims","isCoreModule","data","core","mod","require_is_core","__commonJSMin","exports","module","init_esm_shims","isCoreModule","x","require_sync","__commonJSMin","exports","module","init_esm_shims","isCore","fs","path","getHomedir","caller","nodeModulesPaths","normalizeOptions","realpathFS","homedir","defaultPaths","defaultIsFile","file","stat","e","defaultIsDir","dir","defaultRealpathSync","x","realpathErr","maybeRealpathSync","realpathSync","opts","defaultReadPackageSync","readFileSync","pkgfile","body","pkg","getPackageCandidates","start","dirs","options","isFile","isDirectory","readPackageSync","packageIterator","extensions","includeCoreModules","basedir","parent","absoluteStart","res","m","loadAsFileSync","loadAsDirectorySync","n","loadNodeModulesSync","err","loadpkg","rfile","r","i","mainError","thunk","require_resolve","__commonJSMin","exports","module","init_esm_shims","async","require_module_details_from_path","__commonJSMin","exports","module","init_esm_shims","path","file","segments","index","scoped","name","offset","require_package","__commonJSMin","exports","module","require_require_in_the_middle","__commonJSMin","exports","module","init_esm_shims","path","Module","resolve","debug","moduleDetailsFromPath","Hook","isCore","major","minor","moduleName","normalize","ExportsCache","filename","isBuiltin","mod","__require","cachedExports","modules","options","onrequire","self","patching","internals","hasWhitelist","id","patchedRequire","args","coreOnly","core","idWithoutPrefix","resolveErr","basedir","isPatching","parsedPath","stat","fullModuleName","resolveModuleName","matchFound","res","patchedExports","normalizedPath","ModuleNameSeparator","ModuleNameTrieNode","ModuleNameTrie","init_ModuleNameTrie","__esmMin","init_esm_shims","hook","trieNode","_b","__values","_c","moduleNamePart","nextNode","moduleName","_a","maintainInsertionOrder","fullOnly","results","foundFull","_d","_e","__spreadArray","__read","a","path","normalizePathSeparators","moduleNameOrPath","ModuleNameSeparator","import_require_in_the_middle","isMocha","RequireInTheMiddleSingleton","init_RequireInTheMiddleSingleton","__esmMin","init_esm_shims","init_ModuleNameTrie","fn","ModuleNameTrie","_this","exports","name","basedir","normalizedModuleName","matches","matches_1","__values","matches_1_1","onRequire","moduleName","hooked","_a","require_register","__commonJSMin","exports","init_esm_shims","importHooks","setters","specifiers","toHook","proxyHandler","target","name","value","property","descriptor","register","namespace","set","specifier","proxy","hook","require_import_in_the_middle","__commonJSMin","exports","module","init_esm_shims","path","parse","fileURLToPath","importHooks","specifiers","toHook","addHook","hook","name","namespace","removeHook","index","callHookFn","hookFn","baseDir","newDefault","Hook","modules","options","internals","filename","isBuiltin","details","moduleName","safeExecuteInTheMiddle","execute","onFinish","preventThrowingError","error","result","e","safeExecuteInTheMiddleAsync","_a","e_1","isWrapped","func","init_utils","__esmMin","init_esm_shims","path","utilTypes","readFileSync","isSupported","supportedVersions","version","includePrerelease","supportedVersion","import_semver","import_shimmer","import_import_in_the_middle","import_require_in_the_middle","InstrumentationBase","init_instrumentation","__esmMin","init_esm_shims","init_RequireInTheMiddleSingleton","init_esm","init_utils","_super","__extends","instrumentationName","instrumentationVersion","config","_this","RequireInTheMiddleSingleton","moduleExports","name","wrapper","isWrapped","wrapped","moduleExportsArray","names","diag","modules","module","resolvedModule","__require","baseDir","json","exports","files","_a","normalizedName","supportedFileInstrumentations","patchedExports","file","_d","__values","_e","module_1","_f","e_2","_g","module_2","hookFn","onRequire","hook","HookRequire","this_1","esmHook","HookImport","_h","_j","_c","module_3","e_5","InstrumentationAbstract","normalize","init_normalize","__esmMin","init_esm_shims","init_node","__esmMin","init_esm_shims","init_instrumentation","init_normalize","init_platform","__esmMin","init_esm_shims","init_node","InstrumentationNodeModuleDefinition","init_instrumentationNodeModuleDefinition","__esmMin","init_esm_shims","name","supportedVersions","patch","unpatch","files","InstrumentationNodeModuleFile","init_instrumentationNodeModuleFile","__esmMin","init_esm_shims","init_platform","name","supportedVersions","patch","unpatch","normalize","init_types","__esmMin","init_esm_shims","init_types_internal","__esmMin","init_esm_shims","esm_exports","__export","InstrumentationBase","InstrumentationNodeModuleDefinition","InstrumentationNodeModuleFile","isWrapped","registerInstrumentations","safeExecuteInTheMiddle","safeExecuteInTheMiddleAsync","init_esm","__esmMin","init_esm_shims","init_autoLoader","init_platform","init_instrumentationNodeModuleDefinition","init_instrumentationNodeModuleFile","init_types","init_types_internal","init_utils","api_1","core_1","semver","url","utils","version_1","instrumentation_1","core_2","events_1","semantic_conventions_1","HttpInstrumentation","config","moduleExports","component","original","clientRequest","_original","options","args","req","instrumentation","_a","request","span","startTime","metricAttributes","responseFinished","response","responseAttributes","header","endHandler","status","error","event","pathname","method","e","_b","headers","spanAttributes","spanOptions","ctx","rpcMetadata","hasError","err","extraOptions","origin","optionsParsed","hostname","port","attributes","parentContext","requestContext","cb","route","name","requireParent","currentSpan","spanKind","duration","hookFunc","_c","_f","_e","_d","_j","_h","_g","_m","_l","_k","exports","require_types","__commonJSMin","exports","init_esm_shims","__exportStar","exports","ExpressLayerType","exports","AttributeNames","exports","exports","ExpressLayerType_1","AttributeNames_1","internal_types_1","storeLayerPath","request","value","exports","getLayerMetadata","layer","layerPath","satisfiesPattern","constant","pattern","isLayerIgnored","name","type","config","_a","asErrorAndMessage","error","getLayerPath","args","arg","extractLayerPathSegment","exports","core_1","api_1","ExpressLayerType_1","AttributeNames_1","utils_1","version_1","instrumentation_1","semantic_conventions_1","internal_types_1","ExpressInstrumentation","config","moduleExports","routerProto","instrumentation","original","args","route","layer","layerPath","patched","req","res","path","attributes","metadata","type","rpcMetadata","spanName","span","e","spanHasEnded","onResponseFinish","callbackIdx","arg","maybeError","isError","error","message","_a","anyError","key","value","info","defaultName","hook","err","exports","__exportStar","exports","AttributeNames","exports","FastifyTypes","FastifyNames","exports","api_1","constants_1","startSpan","reply","tracer","spanName","spanAttributes","span","spans","exports","endSpan","err","safeExecuteInTheMiddleMaybePromise","execute","onFinish","preventThrowingError","error","result","isPromise","res","e","val","_a","exports","api_1","core_1","instrumentation_1","semantic_conventions_1","constants_1","AttributeNames_1","utils_1","version_1","exports","FastifyInstrumentation","config","moduleExports","instrumentation","request","reply","done","anyRequest","rpcMetadata","routeName","pluginName","hookName","original","syncFunctionWithDone","args","name","spanName","span","origDone","doneArgs","err","handler","fastify","app","maybeError","_a","_b","handlerName","spanAttributes","e","__exportStar","exports","AllowedOperationTypes","exports","TokenKind","SpanNames","AttributeNames","exports","exports","symbols_1","exports","api","enum_1","AttributeNames_1","symbols_1","OPERATION_VALUES","isPromise","value","exports","isObjectLike","addInputVariableAttribute","span","key","variable","idx","nestedKey","addInputVariableAttributes","variableValues","addSpanSource","loc","allowValues","start","end","source","getSourceFromLocation","createFieldIfNotExists","tracer","getConfig","contextValue","info","path","field","getField","spanAdded","parent","getParentField","createResolverSpan","addField","parentSpan","attributes","document","fieldNode","_a","_b","endSpan","error","getOperation","operationName","definition","i","pathToArray","mergeItems","flattened","curr","repeatBreak","repeatChar","repeatSpace","char","to","text","KindsToBeRemoved","inputStart","inputEnd","next","previousLine","space","wrapFields","type","fields","wrapFieldResolver","unwrappedType","handleResolveSpanError","resolveSpan","err","shouldEndSpan","handleResolveSpanSuccess","fieldResolver","isDefaultResolver","wrappedFieldResolver","args","config","depth","item","newField","res","r","exports","api_1","instrumentation_1","enum_1","AttributeNames_1","symbols_1","internal_types_1","utils_1","version_1","DEFAULT_CONFIG","supportedVersions","GraphQLInstrumentation","config","module","moduleExports","defaultFieldResolved","instrumentation","original","processedArgs","args","operation","span","err","result","resultData","error","source","options","schema","documentAST","rules","typeInfo","obj","errors","operationType","nameNode","operationName","_a","document","rootValue","contextValue","variableValues","fieldResolver","typeResolver","isUsingDefaultResolver","fieldResolverForExecute","exports","__exportStar","exports","MongodbCommandType","exports","exports","api_1","instrumentation_1","semantic_conventions_1","internal_types_1","version_1","MongoDBInstrumentation","_MongoDBInstrumentation","config","v3PatchConnection","v3UnpatchConnection","v4PatchConnect","v4UnpatchConnect","v4PatchConnectionCallback","v4PatchConnectionPromise","v4UnpatchConnection","v4PatchConnectionPool","v4UnpatchConnectionPool","v4PatchSessions","v4UnpatchSessions","moduleExports","instrumentation","original","nSessionsBeforeAcquire","session","nSessionsAfterAcquire","cmdPromise","poolPrototype","callback","patchedCallback","options","result","err","conn","operationName","server","ns","ops","currentSpan","resultHandler","span","cmd","commandType","type","operation","args","res","cursorState","batchSize","command","connectionCtx","host","port","hostParts","commandObj","topology","_b","_a","_e","_d","_c","address","_f","addressSegments","dbName","dbCollection","_h","_g","portNumber","dbStatementSerializer","query","resultObj","value","element","key","connectionId","activeContext","error","database","poolName","exports","MongodbCommandType","exports","__exportStar","exports","api_1","instrumentation_1","semantic_conventions_1","getAttributesFromCollection","collection","exports","setErrorStatus","span","error","applyResponseHook","response","responseHook","moduleVersion","e","handlePromiseResponse","execResponse","err","handleCallbackResponse","callback","exec","originalThis","args","callbackArgumentIndex","exports","api_1","core_1","utils_1","instrumentation_1","version_1","semantic_conventions_1","contextCaptureFunctions","exports","MongooseInstrumentation","config","moduleExports","moduleVersion","funcName","self","originalAggregate","callback","parentSpan","attributes","span","_a","originalExec","op","originalOnModelFunction","options","serializePayload","original","currentSpan","aggregate","collection","modelName","operation","exec","originalThis","args","response","originalFunction","require_types","__commonJSMin","exports","init_esm_shims","__exportStar","exports","AttributeNames","exports","semantic_conventions_1","getConnectionAttributes","config","host","port","database","user","getConfig","portNumber","getJDBCString","exports","jdbcString","getDbStatement","query","getDbValues","values","arrayStringifyHelper","getSpanName","arr","getPoolName","pool","c","poolName","exports","api_1","instrumentation_1","semantic_conventions_1","AttributeNames_1","utils_1","version_1","MySQLInstrumentation","_MySQLInstrumentation","config","meterProvider","moduleExports","originalCreateConnection","thisPlugin","_connectionUri","originalResult","originalCreatePool","_config","pool","originalPoolEnd","callback","nAll","nFree","nUsed","poolName","originalCreatePoolCluster","cluster","originalAdd","id","nodes","nodeId","originalGetConnection","arg1","arg2","arg3","patchFn","cb","activeContext","err","connection","originalQuery","query","_valuesOrCallback","_callback","span","values","cbIndex","arg","parentContext","streamableQuery","originalCallback","results","fields","exports","__exportStar","exports","api_1","core_1","hasValidSqlComment","query","indexOpeningDashDashComment","indexClosingSlashComment","fixedEncodeURIComponent","str","c","addSqlCommenterComment","span","propagator","headers","sortedKeys","commentString","key","encodedValue","exports","semantic_conventions_1","getConnectionAttributes","config","host","port","database","user","getConfig","portNumber","getJDBCString","exports","jdbcString","getDbStatement","query","format","values","getSpanName","rawQuery","_a","once","fn","called","args","exports","api","instrumentation_1","semantic_conventions_1","sql_common_1","utils_1","version_1","MySQL2Instrumentation","_MySQL2Instrumentation","config","moduleExports","ConnectionPrototype","format","isPrepared","originalQuery","thisPlugin","query","_valuesOrCallback","_callback","thisPluginConfig","values","span","endSpan","err","results","streamableQuery","originalCallback","fields","exports","__exportStar","exports","api_1","endSpan","span","err","exports","serializationSubsets","defaultDbStatementSerializer","cmdName","cmdArgs","nArgsToSerialize","_b","_a","regex","argsToSerialize","exports","exports","api_1","instrumentation_1","semantic_conventions_1","instrumentation_2","utils_1","redis_common_1","version_1","DEFAULT_CONFIG","IORedisInstrumentation","config","module","moduleVersion","moduleExports","original","instrumentation","cmd","dbStatementSerializer","hasNoParentSpan","span","e","host","port","result","origResolve","_a","origReject","err","error","client","exports","__exportStar","exports","semantic_conventions_1","getClientAttributes","diag","options","_a","_b","removeCredentialsFromDBConnectionStringAttribute","exports","url","u","err","exports","api_1","instrumentation_1","utils_1","redis_common_1","version_1","semantic_conventions_1","OTEL_OPEN_SPANS","MULTI_COMMAND_OPTIONS","DEFAULT_CONFIG","RedisInstrumentation","_RedisInstrumentation","config","basePackageName","commanderModuleFile","moduleExports","moduleVersion","transformCommandArguments","functionToPatch","multiCommanderModule","redisClientMultiCommandPrototype","_a","clientIndexModule","redisClientPrototype","plugin","original","origExecutor","command","args","redisCommandArguments","execRes","redisRes","openSpans","err","replies","multiRes","options","attributes","span","result","error","origFunction","origThis","origArguments","clientOptions","commandName","commandArgs","dbStatementSerializer","_b","dbStatement","e","res","redisClientMultiCommand","i","currCommandRes","response","exports","__exportStar","exports","exports","AttributeNames","exports","NestType","exports","AttributeNames_1","exports","NestType_1","api","instrumentation_1","version_1","semantic_conventions_1","enums_1","supportedVersions","NestInstrumentation","_NestInstrumentation","config","module","versions","NestFactoryStatic","moduleVersion","createWrapNestFactoryCreate","RouterExecutionContext","createWrapCreateHandler","obj","methodName","wrapper","exports","tracer","original","nestModule","span","spanContext","e","addError","instance","callback","createWrapHandler","handler","callbackName","instanceName","spanName","req","res","next","_a","_b","options","wrappedHandler","metadataKey","error","__exportStar","exports","AttributeNames","exports","SpanNames","exports","api_1","AttributeNames_1","semantic_conventions_1","instrumentation_1","SpanNames_1","getQuerySpanName","dbName","queryConfig","command","parseNormalizedOperationName","exports","queryText","indexOfFirstSpace","sqlCommand","getConnectionString","params","host","port","database","getPort","getSemanticAttributesFromConnection","getSemanticAttributesFromPool","shouldSkipInstrumentation","instrumentationConfig","handleConfigQuery","tracer","connectionParameters","spanName","span","convertedValues","value","e","handleExecutionResult","config","pgResult","err","patchCallback","cb","res","patchCallbackPGPool","done","patchClientConnectCallback","getErrorMessage","isObjectWithTextString","it","_a","exports","instrumentation_1","api_1","utils","sql_common_1","version_1","SpanNames_1","PgInstrumentation","config","modulePG","module","moduleExports","modulePGPool","plugin","original","callback","span","parentSpan","connectResult","handleConnectResult","args","arg0","firstArgIsString","firstArgIsQueryObjectWithText","queryConfig","instrumentationConfig","database","host","port","user","connection","err","result","e","resolve","error","_","reject","originalConnect","exports","connectResultPromise","__exportStar","exports","exports","exports","AttributeNames","exports","semantic_conventions_1","internal_types_1","AttributeNames_1","getPluginName","plugin","exports","isLifecycleExtType","variableToCheck","isLifecycleExtEventObj","event","_a","isDirectExtInput","isPatchableExtMethod","getRouteMetadata","route","pluginName","getExtMetadata","extPoint","getPluginFromInput","pluginObj","api","core_1","instrumentation_1","version_1","internal_types_1","utils_1","HapiInstrumentation","config","module","moduleExports","original","instrumentation","self","opts","newServer","originalRouter","originalExtHandler","pluginInput","options","pluginObj","plugin","pluginName","args","eventsList","i","eventObj","lifecycleEventObj","handler","extInput","method","route","newRoute","oldHandler","newRegisterHandler","server","extPoint","params","metadata","span","err","wrapHandler","rpcMetadata","oldOptions","_a","exports","__exportStar","exports","KoaLayerType","exports","exports","AttributeNames","exports","types_1","AttributeNames_1","semantic_conventions_1","getMiddlewareMetadata","context","layer","isRouter","layerPath","_a","exports","isLayerIgnored","type","config","exports","api","instrumentation_1","types_1","version_1","utils_1","core_1","internal_types_1","KoaInstrumentation","config","module","moduleExports","original","plugin","middlewareFunction","patchedFunction","dispatchLayer","router","routesStack","_a","pathLayer","path","pathStack","j","routedMiddleware","middlewareLayer","isRouter","layerPath","layerType","context","next","metadata","span","rpcMetadata","e","newContext","err","exports","__exportStar","exports","AttributeNames","exports","ConnectTypes","ConnectNames","exports","exports","api_1","internal_types_1","addNewStackLayer","request","stackLength","exports","replaceCurrentStackRoute","newRoute","generateRoute","acc","sub","api_1","core_1","AttributeNames_1","version_1","instrumentation_1","semantic_conventions_1","utils_1","exports","ConnectInstrumentation","config","moduleExports","patchedApp","original","instrumentation","args","app","next","finishSpan","err","result","routeName","middleWare","connectType","connectName","connectTypeName","spanName","options","isErrorMiddleware","patchedMiddleware","reqArgIdx","resArgIdx","nextArgIdx","req","res","rpcMetadata","span","spanFinished","reqIdx","outIdx","out","completeStack","__exportStar","exports","init_esm_shims","import_react","process","init_esm_shims","import_react","import_verror","dirname","appendFileSync","mkdirSync","init_esm_shims","import_http_client","import_verror","extractHttpError","error","nestedError","VError","init_esm_shims","getHttpErrorInfo","httpError","writeCrashReport","reportPath","error","content","VError","httpError","extractHttpError","getHttpErrorInfo","mkdirSync","dirname","appendFileSync","DebugLogContext","init_esm_shims","import_react","init_esm_shims","import_react","import_variant","init_esm_shims","noop","args","_i","createWeakMap","fakeSetOrMap","k","hop","has","obj","prop","extend","target","source","reLeadingNewline","reTrailingNewline","reStartsWithNewlineOrIsEmpty","reDetectIndentation","reOnlyWhitespaceWithAtLeastOneNewline","_outdentArray","strings","firstInterpolatedValueSetsIndentationLevel","options","indentationLevel","match","reSource","reMatchIndent","newline","trimLeadingNewline","trimTrailingNewline","normalizeNewlines","l","outdentedStrings","v","i","_","concatStringsAndValues","values","ret","isTemplateStringsArray","createInstance","arrayAutoIndentCache","arrayFirstInterpSetsIndentCache","outdent","stringsOrOptions","defaultOutdent","cache","renderedArray","rendered","fullOutdent","str","defaultOutdent","init_esm_shims","import_react","ErrorMessage","message","explanation","hint","React","Box_default","Alert","InsightIcon","Text","SystemErrorMessage","getErrorComponent","code","error","React","Text","SystemErrorMessage","siteId","ErrorMessage","email","cause","packageFolder","causeMessage","getErrorMessage","currentVersion","latestVersion","updateCommand","Newline","folder","packageName","validations","validation","id","packageManagerName","appId","revision","path","filePath","configFilename","configPath","srcDir","zodError","defaultOutdent","formatZodIssue","paramsOverridePath","maxSizeViolationsData","filePaths","errorMessage","f","issues","Issue","issue","typeToName","type","Box_default","name","hint","fileName","deploymentUrl","templatePath","url","cliVersion","cliAppVersion","route","templateFilename","tagName","versionRange","Link","version","relativePath","ErrorViewer","originalError","systemErrorOverride","error","normalizeError","isCliSystemError","getErrorComponent","init_esm_shims","import_variant","init_esm_shims","SENTRY_TRACE_STATE_DSC","SENTRY_TRACE_STATE_PARENT_SPAN_ID","SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING","SENTRY_SCOPES_CONTEXT_KEY","createContextKey","SENTRY_FORK_ISOLATION_SCOPE_CONTEXT_KEY","SENTRY_FORK_SET_SCOPE_CONTEXT_KEY","SENTRY_FORK_SET_ISOLATION_SCOPE_CONTEXT_KEY","getScopesFromContext","context","SENTRY_SCOPES_CONTEXT_KEY","makeTraceState","parentSpanId","dsc","sampled","dscString","dynamicSamplingContextToSentryBaggageHeader","traceStateBase","TraceState","SENTRY_TRACE_STATE_PARENT_SPAN_ID","traceStateWithDsc","SENTRY_TRACE_STATE_DSC","SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING","generateSpanContextForPropagationContext","propagationContext","traceState","TraceFlags","_optionalChain","ops","lastAccessLHS","value","i","op","fn","args","getSamplingDecision","spanContext","traceFlags","traceState","sampledNotRecording","SENTRY_TRACE_STATE_SAMPLED_NOT_RECORDING","TraceFlags","dscString","SENTRY_TRACE_STATE_DSC","dsc","baggageHeaderToDynamicSamplingContext","_","_2","getPropagationContextFromSpan","span","spanContext","traceId","spanId","traceState","dscString","SENTRY_TRACE_STATE_DSC","traceStateDsc","baggageHeaderToDynamicSamplingContext","parentSpanId","SENTRY_TRACE_STATE_PARENT_SPAN_ID","sampled","getSamplingDecision","dsc","getDynamicSamplingContextFromSpan","getRootSpan","addOpenTelemetryInstrumentation","instrumentations","registerInstrumentations","setIsolationScope","isolationScope","scopes","getScopesFromContext","context","addOriginToSpan","span","origin","SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN","init_esm_shims","getRequestUrl","requestOptions","protocol","hostname","port","path","INTEGRATION_NAME","_httpOptions","_httpInstrumentation","instrumentHttp","_InstrumentationClass","_optionalChain","_","_2","request","url","getRequestUrl","isSentryRequestUrl","getClient","_ignoreOutgoingRequests","urlPath","method","_3","_4","_5","_ignoreIncomingRequests","span","req","addOriginToSpan","_isClientRequest","_6","_7","_8","scopes","getCapturedScopesOnSpan","isolationScope","getIsolationScope","scope","getCurrentScope","client","setIsolationScope","setCapturedScopesOnSpan","httpMethod","httpTarget","stripUrlQueryAndFragment","bestEffortTransactionName","_9","_10","_11","res","_12","_13","_14","response","_addRequestBreadcrumb","_15","_16","_17","addOpenTelemetryInstrumentation","_httpIntegration","options","httpIntegration","data","getBreadcrumbData","addBreadcrumb","host","parsedUrl","parseUrl","getSanitizedUrlString","init_esm_shims","DEBUG_BUILD","NODE_VERSION","parseSemver","NODE_MAJOR","_nativeNodeFetchIntegration","options","_breadcrumbs","_ignoreOutgoingRequests","getInstrumentation","NODE_MAJOR","DEBUG_BUILD","logger","pkg","FetchInstrumentation","SentryNodeFetchInstrumentation","request","response","_addRequestBreadcrumb","url","getAbsoluteUrl","tracingDisabled","hasTracingEnabled","ctx","context","addedHeaders","activeSpan","trace","propagationContext","getPropagationContextFromSpan","getCurrentScope","spanContext","generateSpanContextForPropagationContext","_optionalChain","_","_2","_3","ctxWithUrlTraceState","propagation","requestHeaders","headers","k","v","span","_updateSpan","error","instrumentation","addOpenTelemetryInstrumentation","nativeNodeFetchIntegration","addOriginToSpan","data","getBreadcrumbData","addBreadcrumb","parsedUrl","parseUrl","getSanitizedUrlString","origin","path","INTEGRATION_NAME","_consoleIntegration","client","addConsoleInstrumentationHandler","args","level","getClient","addBreadcrumb","severityLevelFromString","consoleIntegration","readFileAsync","promisify","readFile","readDirAsync","readdir","INTEGRATION_NAME","_nodeContextIntegration","options","cachedContext","_options","addContext","event","_getContexts","updatedContext","_updateContext","_optionalChain","_","_2","_3","_4","_5","_6","_7","_8","_9","_10","contexts","getOsContext","getAppContext","getDeviceContext","culture","getCultureContext","getCloudResourceContext","nodeContextIntegration","_11","_12","_13","_14","freeMemory","_15","_16","_17","_18","platformId","getDarwinInfo","getLinuxInfo","PLATFORM_NAMES","january","app_memory","appContext","_19","_20","deviceOpt","device","uptime","cpuInfo","firstCpu","LINUX_DISTROS","LINUX_VERSIONS","content","matchFirst","regex","text","match","darwinInfo","output","resolve","reject","execFile","error","stdout","getLinuxDistroId","name","linuxInfo","etcFiles","distroFile","file","distroPath","join","contents","distros","d","id","_21","_22","LRU_FILE_CONTENTS_CACHE","LRUMap","LRU_FILE_CONTENTS_FS_READ_FAILED","DEFAULT_LINES_OF_CONTEXT","INTEGRATION_NAME","MAX_CONTEXTLINES_COLNO","MAX_CONTEXTLINES_LINENO","emplace","map","key","contents","value","shouldSkipContextLinesForFile","path","shouldSkipContextLinesForFrame","frame","rangeExistsInContentCache","file","range","i","makeLineReaderRanges","lines","linecontext","line","current","makeContextRange","out","next","getContextLinesFromFile","ranges","output","resolve","_reject","stream","createReadStream","lineReaded","createInterface","lineNumber","currentRangeIndex","rangeStart","rangeEnd","onStreamError","e","DEBUG_BUILD","logger","snipLine","addSourceContext","event","contextLines","filesToLines","_optionalChain","_","_2","exception","_3","_4","_5","filename","_6","files","readlinePromises","filesToLineRanges","a","b","r","cache","_7","_8","addSourceContextToFrames","frames","addContextToFrame","clearLineContext","lineno","makeRangeStart","end","makeRangeEnd","_contextLinesIntegration","options","contextLinesIntegration","init_esm_shims","createRateLimiter","maxPerSecond","enable","disable","count","retrySeconds","disabledTimeout","isAnonymous","name","functionNamesMatch","a","b","hashFrames","frames","acc","frame","hashFromStack","stackParser","stack","base64WorkerScript","log","args","logger","localVariablesAsyncIntegration","integrationOptions","cachedFrames","LRUMap","addLocalVariablesToException","exception","hash","hashFrames","_optionalChain","_","_2","cachedFrame","frames","_3","_4","frame","i","frameIndex","cachedFrameVariable","frameVariable","functionNamesMatch","addLocalVariablesToEvent","event","_5","_6","startInspector","inspector","startWorker","options","worker","Worker","exceptionHash","err","code","client","e","createCallbackList","complete","callbacks","completedCalled","checkedComplete","result","add","fn","next","popped","AsyncSession","_AsyncSession","_session","orDefault","inspector","onPause","captureAll","event","objectId","props","prop","_optionalChain","_2","_3","_4","_5","id","vars","_6","_7","_8","_9","_10","err","params","name","v","a","b","_11","_12","_13","_14","obj","key","val","INTEGRATION_NAME","_localVariablesSyncIntegration","options","sessionOverride","cachedFrames","LRUMap","rateLimiter","shouldProcessEvent","addLocalVariablesToException","exception","hash","hashFrames","_15","_16","cachedFrame","frames","_17","_18","frame","i","frameIndex","cachedFrameVariable","frameVariable","functionNamesMatch","addLocalVariablesToEvent","_19","_20","client","getClient","clientOptions","_21","_22","_23","NODE_MAJOR","logger","session","handlePaused","stackParser","reason","data","callFrames","_24","exceptionHash","hashFromStack","_25","scopeChain","functionName","localScope","scope","_26","_27","_28","_29","ev","max","createRateLimiter","_30","_31","seconds","_32","_33","error","localVariablesSyncIntegration","localVariablesIntegration","options","NODE_VERSION","localVariablesSyncIntegration","localVariablesAsyncIntegration","moduleCache","INTEGRATION_NAME","_modulesIntegration","event","_getModules","modulesIntegration","getPaths","__require","collectModules","mainPaths","paths","infos","seen","path","dir","updir","orig","dirname","pkgfile","join","existsSync","info","readFileSync","DEFAULT_SHUTDOWN_TIMEOUT","logAndExitProcess","error","consoleSandbox","client","getClient","DEBUG_BUILD","logger","options","timeout","result","INTEGRATION_NAME","onUncaughtExceptionIntegration","options","optionsWithDefaults","client","makeErrorHandler","caughtFirstError","caughtSecondError","calledFatalError","firstError","clientOptions","error","onFatalError","logAndExitProcess","processWouldExit","listener","shouldApplyFatalHandlingLogic","DEBUG_BUILD","logger","getClient","captureException","INTEGRATION_NAME","_onUnhandledRejectionIntegration","options","mode","client","makeUnhandledPromiseHandler","onUnhandledRejectionIntegration","reason","promise","getClient","captureException","handleRejection","rejectionWarning","consoleSandbox","logAndExitProcess","INSTRUMENTED","generateInstrumentOnce","name","creator","options","instrumented","instrumentation","addOpenTelemetryInstrumentation","init_esm_shims","isCjs","__require","INTEGRATION_NAME","instrumentExpress","generateInstrumentOnce","span","addOriginToSpan","attributes","spanToJSON","type","SEMANTIC_ATTRIBUTE_SENTRY_OP","name","info","defaultName","getIsolationScope","getDefaultIsolationScope","DEBUG_BUILD","logger","req","method","_expressIntegration","expressIntegration","INTEGRATION_NAME","instrumentFastify","generateInstrumentOnce","span","addFastifySpanAttributes","_fastifyIntegration","fastifyIntegration","addFastifySpanAttributes","span","attributes","spanToJSON","type","SEMANTIC_ATTRIBUTE_SENTRY_OP","SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN","name","INTEGRATION_NAME","instrumentGraphql","generateInstrumentOnce","_options","options","span","addOriginToSpan","_graphqlIntegration","graphqlIntegration","INTEGRATION_NAME","instrumentMongo","generateInstrumentOnce","span","addOriginToSpan","_mongoIntegration","mongoIntegration","INTEGRATION_NAME","instrumentMongoose","generateInstrumentOnce","span","addOriginToSpan","_mongooseIntegration","mongooseIntegration","INTEGRATION_NAME","instrumentMysql","generateInstrumentOnce","_mysqlIntegration","mysqlIntegration","INTEGRATION_NAME","instrumentMysql2","generateInstrumentOnce","span","addOriginToSpan","_mysql2Integration","mysql2Integration","SINGLE_ARG_COMMANDS","GET_COMMANDS","SET_COMMANDS","isInCommands","redisCommands","command","getCacheOperation","keyHasPrefix","key","prefixes","prefix","getCacheKeySafely","redisCommand","cmdArgs","processArg","arg","flatten","firstArg","shouldConsiderForCache","keys","calculateCacheItemSize","response","getSize","value","acc","curr","size","INTEGRATION_NAME","_redisOptions","cacheResponseHook","span","redisCommand","cmdArgs","response","SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN","safeKey","getCacheKeySafely","cacheOperation","getCacheOperation","_optionalChain","_","shouldConsiderForCache","networkPeerAddress","spanToJSON","_2","_3","_4","networkPeerPort","_5","_6","_7","cacheItemSize","calculateCacheItemSize","SEMANTIC_ATTRIBUTE_CACHE_ITEM_SIZE","isInCommands","GET_COMMANDS","SEMANTIC_ATTRIBUTE_CACHE_HIT","SEMANTIC_ATTRIBUTE_SENTRY_OP","SEMANTIC_ATTRIBUTE_CACHE_KEY","spanDescription","truncate","instrumentIORedis","generateInstrumentOnce","instrumentRedis4","instrumentRedis","_redisIntegration","options","redisIntegration","INTEGRATION_NAME","instrumentNest","generateInstrumentOnce","_nestIntegration","nestIntegration","INTEGRATION_NAME","instrumentPostgres","generateInstrumentOnce","span","addOriginToSpan","_postgresIntegration","postgresIntegration","INTEGRATION_NAME","instrumentHapi","generateInstrumentOnce","_hapiIntegration","hapiIntegration","INTEGRATION_NAME","instrumentKoa","generateInstrumentOnce","span","info","addKoaSpanAttributes","getIsolationScope","getDefaultIsolationScope","DEBUG_BUILD","logger","attributes","spanToJSON","route","SEMATTRS_HTTP_ROUTE","method","_optionalChain","_","_2","_3","_4","_5","_koaIntegration","koaIntegration","addKoaSpanAttributes","span","SEMANTIC_ATTRIBUTE_SENTRY_ORIGIN","attributes","spanToJSON","type","SEMANTIC_ATTRIBUTE_SENTRY_OP","name","INTEGRATION_NAME","instrumentConnect","generateInstrumentOnce","_connectIntegration","connectIntegration","getAutoPerformanceIntegrations","expressIntegration","fastifyIntegration","graphqlIntegration","mongoIntegration","mongooseIntegration","mysqlIntegration","mysql2Integration","redisIntegration","postgresIntegration","nestIntegration","hapiIntegration","koaIntegration","connectIntegration","INTERNAL","Agent","opts","options","stack","l","req","cb","connectOpts","socket","_nullishCoalesce","v","debug","args","logger","parseProxyResponse","socket","resolve","reject","buffersLength","buffers","read","b","ondata","cleanup","onend","onerror","err","buffered","endOfHeaders","headerParts","firstLine","firstLineParts","statusCode","statusText","headers","header","firstColon","key","value","current","debug","args","logger","HttpsProxyAgent","Agent","proxy","opts","_nullishCoalesce","_optionalChain","_2","host","port","omit","req","socket","servername","headers","payload","auth","name","proxyResponsePromise","parseProxyResponse","connect","buffered","resume","fakeSocket","s","obj","keys","ret","key","GZIP_THRESHOLD","streamFromBody","body","Readable","makeNodeTransport","options","urlSegments","consoleSandbox","createTransport","isHttps","proxy","applyNoProxyOption","nativeHttpModule","https","http","keepAlive","agent","HttpsProxyAgent","suppressTracing","requestExecutor","createRequestExecutor","_nullishCoalesce","transportUrlSegments","no_proxy","exemption","httpModule","hostname","pathname","port","protocol","search","request","resolve","reject","headers","createGzip","req","res","retryAfterHeader","rateLimitsHeader","normalizeWindowsPath","path","createGetModuleFromFilename","basePath","dirname","isWindows","sep","normalizedBase","filename","normalizedFilename","dir","file","ext","posix","n","moduleName","defaultStackParser","createStackParser","nodeStackLineParser","createGetModuleFromFilename","DEFAULT_CLIENT_REPORT_FLUSH_INTERVAL_MS","NodeClient","ServerRuntimeClient","options","clientOptions","applySdkMetadata","logger","isMainThread","threadId","name","version","SDK_VERSION","tracer","trace","timeout","provider","spanProcessor","_optionalChain","_","DEBUG_BUILD","_nullishCoalesce","getCjsOnlyIntegrations","isCjs","modulesIntegration","getDefaultIntegrationsWithoutPerformance","inboundFiltersIntegration","functionToStringIntegration","linkedErrorsIntegration","requestDataIntegration","consoleIntegration","httpIntegration","nativeNodeFetchIntegration","onUncaughtExceptionIntegration","onUnhandledRejectionIntegration","contextLinesIntegration","localVariablesIntegration","nodeContextIntegration","getDefaultIntegrations","options","shouldAddPerformanceIntegrations","getAutoPerformanceIntegrations","hasTracingEnabled","import_verror","EventEmitter","ReportErrorResult","reportError","scope","originalError","data","isCliSystemError","error","CliSystemErrorCode","eventId","localScope","httpError","extractHttpError","getHttpErrorInfo","VError","createErrorReporter","dsn","release","sentryDsnOverride","getTestOverrides","sentryClient","NodeClient","getDefaultIntegrations","integration","defaultStackParser","makeNodeTransport","event","sentryScope","Scope","emitter","normalizeError","result","userId","feedback","BrowserClient","defaultOutdent","name","context","user","init_esm_shims","import_react","import_variant","stdin","init_esm_shims","import_variant","join","CacheState","CacheData","z","isFileExpired","createdAt","ttlInHours","getFsCacheFilePath","dirPath","fileName","testOverrides","getTestOverrides","join","createFsCache","filePath","pathExists","cacheData","readJson","e","CliError","CliErrorCode","data","writeJson","init_esm_shims","import_react","init_esm_shims","import_react","ContactUs","React","Trans","Link","UserFeedbackForm","onSubmit","t","useTranslation","isSubmitted","setIsSubmitted","consent","setConsent","handleConsentSubmit","value","handleSubmit","feedback","React","Box_default","Text","ConfirmInput","TextInput","ContactUs","init_esm_shims","import_react","UserFeedbackFallback","React","Box_default","ContactUs","messages_default","collectUserFeedback","cachePath","reportResult","errorReporter","stdin","ReportErrorResult","fsCache","createFsCache","cacheState","CacheState","user","render","React","I18nProvider","messages_default","UserFeedbackForm","feedback","renderSync","UserFeedbackFallback","createErrorHandler","debugOutputPath","userFeedbackCachePath","errorReporterOptions","errorReporter","createErrorReporter","handler","error","data","reportResult","renderErrorSync","React","ErrorViewer","writeCrashReport","process","collectUserFeedback","e","init_esm_shims","import_react","ErrorReporterContext","ErrorReporterProvider","props","React","useErrorReporter","context","init_esm_shims","init_esm_shims","import_react","BiContext","BiProvider","children","biLogger","React","useBiLogger","context","init_esm_shims"]}